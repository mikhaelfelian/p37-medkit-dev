<?php
/**
 * Description of transaksi
 *
 * @author USER
 */
class medcheck extends CI_Controller {
    // put your code here
    function __construct() {
        parent::__construct();
        $this->load->library('cart');
        $this->load->library('excel/PHPExcel');

        $this->load->library('qrcode/ciqrcode');
    }
    
    public function index() {
        if (akses::aksesLogin() == TRUE) {
            /* -- Grup hak akses -- */
            $role        = $this->input->get('role');
            $tipe        = $this->input->get('tipe');
            $grup        = $this->ion_auth->get_users_groups()->row();
            $id_user     = $this->ion_auth->user()->row()->id;
            $id_grup     = $this->ion_auth->get_users_groups()->row();
            $id_dokter   = $this->ion_auth->get_users_groups()->row();
            $pengaturan  = $this->db->get('tbl_pengaturan')->row();
            
            if(isset($_GET['tipe'])){
                /* -- Blok Filter -- */
                $hal     = $this->input->get('halaman');
                $id      = $this->input->get('id');
                $cs      = $this->input->get('filter_nama');
                $by      = $this->input->get('filter_bayar');
                $tp      = $this->input->get('filter_tipe');
                $tg      = $this->input->get('filter_tgl');
                $sp      = $this->input->get('filter_periksa');
                $jml     = $this->input->get('jml');

                # Jika User dokter, maka pilih rajal dan ranap
                if(akses::hakDokter()){
                    $jml_sql = $this->db
                                    ->where('id_dokter', $id_user)
                                    ->like('tipe', $tp)
                                    ->like('pasien', $cs)
                                    ->like('id_poli', $pl)
                                    ->like('status_bayar', $by)
//                                    ->group_by('tgl_simpan, pasien')
                                    ->get('v_medcheck_dokter')->num_rows();
                }else{
                    $jml_sql = $this->db->where('status_hps', '0')
                                        ->where('status_pos', '0')
                                        ->like('DATE(tgl_simpan)', $this->tanggalan->tgl_indo_sys($tg))
                                        ->like('tipe', $tp)
                                        ->like('id_dokter', ($id_grup->name == 'dokter' ? $id_user : ''), ($id_grup->name == 'dokter' ? 'none' : ''))
                                        ->like('id', general::dekrip($id))
                                        ->like('pasien', $cs)
                                        ->like('tipe', $tp)
                                        ->like('status_bayar', $by)
                                        ->like('status_periksa', $sp)
//                                        ->group_by('tgl_masuk, pasien')
                                        ->order_by('id','desc')
                                        ->get('v_medcheck')->num_rows();                
                }

                if(!empty($jml)){
                    $jml_hal = $jml;
                }else{
                    $jml_hal = $jml_sql;
                }
                /* -- End Blok Filter -- */

                /* -- Form Error -- */
                $data['hasError']                = $this->session->flashdata('form_error');

                /* -- Blok Pagination -- */
                $config['base_url']              = base_url('medcheck/index.php?tipe=1'.(!empty($cs) ? '&filter_nama='.$cs : '').(!empty($tg) ? '&filter_tgl='.$tg : '').(!empty($tp) ? '&filter_tipe='.$tp : '').(!empty($sp) ? '&filter_periksa='.$sp : '').(isset($by) ? '&filter_bayar='.$by : '').(!empty($jml_hal) ? '&jml='.$jml_hal : ''));
                $config['total_rows']            = $jml_hal;

                $config['query_string_segment']  = 'halaman';
                $config['page_query_string']     = TRUE;
                $config['per_page']              = $pengaturan->jml_item;
                $config['num_links']             = 2;

                $config['first_tag_open']        = '<li class="page-item">';
                $config['first_tag_close']       = '</li>';

                $config['prev_tag_open']         = '<li class="page-item">';
                $config['prev_tag_close']        = '</li>';

                $config['num_tag_open']          = '<li class="page-item">';
                $config['num_tag_close']         = '</li>';

                $config['next_tag_open']         = '<li class="page-item">';
                $config['next_tag_close']        = '</li>';

                $config['last_tag_open']         = '<li class="page-item">';
                $config['last_tag_close']        = '</li>';

                $config['cur_tag_open']          = '<li class="page-item"><a href="#" class="page-link text-dark"><b>';
                $config['cur_tag_close']         = '</b></a></li>';

                $config['first_link']            = '&laquo;';
                $config['prev_link']             = '&lsaquo;';
                $config['next_link']             = '&rsaquo;';
                $config['last_link']             = '&raquo;';
                $config['anchor_class']          = 'class="page-link"';
                /* -- End Blok Pagination -- */

                // Jika User dokter, maka pilih rajal dan ranap
                if(akses::hakDokter() == TRUE){
                    if (!empty($hal)) {
                        $data['penj'] = $this->db
                                             ->where('id_dokter', $id_user)
                                             ->like('tipe', $tp)
                                             ->like('pasien', $cs)
                                             ->like('id_poli', $pl)
                                             ->like('status_bayar', $by)
                                             ->like('status_periksa', $sp)
                                             ->limit($config['per_page'], $hal)
//                                             ->group_by('tgl_simpan, pasien')
                                             ->get('v_medcheck_dokter')->result();
                    } else {
                        $data['penj'] = $this->db
                                             ->where('id_dokter', $id_user)
                                             ->like('tipe', $tp)
                                             ->like('pasien', $cs)
                                             ->like('id_poli', $pl)
                                             ->like('status_bayar', $by)
                                             ->like('status_periksa', $sp)
                                             ->limit($config['per_page'])
//                                             ->group_by('tgl_simpan, pasien')
                                             ->get('v_medcheck_dokter')->result();
                    }         
                }else{
                    // Bukan Dokter
                    if (!empty($hal)) {
//                        $data['penj'] = $this->db
//                                             ->where('status_hps', '0')
//                                             ->where('status_pos', '0')
//                                             ->like('DATE(tgl_simpan)', $this->tanggalan->tgl_indo_sys($tg))
//                                             ->like('tipe', $tp)
//                                             ->like('id_dokter', ($id_grup->name == 'dokter' ? $id_user : ''), ($id_grup->name == 'dokter' ? 'none' : ''))
//                                             ->like('id', general::dekrip($id))
//                                             ->like('pasien', $cs)
//                                             ->like('status_bayar', $by)
//                                             ->like('status_periksa', $sp)
//                                             ->limit($config['per_page'], $hal)
////                                             ->group_by('tgl_masuk, pasien')
//                                             ->order_by('tgl_simpan', 'desc')
//                                             ->get('v_medcheck')->result();
                        
                               $kueri = "SELECT
                                            tbl_trans_medcheck.id, tbl_trans_medcheck.id_user, tbl_trans_medcheck.id_dokter, tbl_trans_medcheck.id_nurse, tbl_trans_medcheck.id_analis,
                                            tbl_trans_medcheck.id_pasien, tbl_trans_medcheck.id_poli, tbl_trans_medcheck.id_dft, tbl_trans_medcheck.id_ant, tbl_trans_medcheck.id_kasir, tbl_trans_medcheck.id_instansi, 
                                            tbl_trans_medcheck.id_encounter, tbl_trans_medcheck.id_condition, tbl_trans_medcheck.id_post_location,
                                            tbl_trans_medcheck.id_icd, tbl_trans_medcheck.id_icd10, tbl_trans_medcheck.tgl_simpan, tbl_trans_medcheck.tgl_modif, tbl_trans_medcheck.tgl_masuk, 
                                            tbl_trans_medcheck.tgl_periksa, tbl_trans_medcheck.tgl_periksa_lab, tbl_trans_medcheck.tgl_periksa_rad, tbl_trans_medcheck.tgl_periksa_pen, 
                                            tbl_trans_medcheck.tgl_ranap, tbl_trans_medcheck.tgl_keluar, tbl_trans_medcheck.tgl_bayar, tbl_trans_medcheck.tgl_ttd,
                                            tbl_trans_medcheck.no_rm, tbl_trans_medcheck.no_akun, tbl_trans_medcheck.no_nota, tbl_trans_medcheck.poli, tbl_trans_medcheck.dokter_nik AS nik_dokter, tbl_trans_medcheck.dokter AS nama_dokter, tbl_trans_medcheck.pasien_nik AS nik_pasien, tbl_trans_medcheck.pasien, tbl_trans_medcheck.tgl_lahir, tbl_trans_medcheck.keluhan, tbl_trans_medcheck.ttv,
                                            tbl_trans_medcheck.ttv_st, tbl_trans_medcheck.ttv_bb, tbl_trans_medcheck.ttv_tb, tbl_trans_medcheck.ttv_td, tbl_trans_medcheck.ttv_sistole, tbl_trans_medcheck.ttv_diastole, tbl_trans_medcheck.ttv_nadi, tbl_trans_medcheck.ttv_laju, tbl_trans_medcheck.ttv_saturasi, tbl_trans_medcheck.ttv_skala,
                                            tbl_trans_medcheck.diagnosa, tbl_trans_medcheck.anamnesa, tbl_trans_medcheck.pemeriksaan, tbl_trans_medcheck.program, tbl_trans_medcheck.alergi,
                                            tbl_trans_medcheck.metode, tbl_trans_medcheck.platform, tbl_trans_medcheck.jml_total, tbl_trans_medcheck.jml_dp,
                                            tbl_trans_medcheck.jml_diskon, tbl_trans_medcheck.jml_potongan, tbl_trans_medcheck.jml_potongan_poin, tbl_trans_medcheck.jml_subtotal, tbl_trans_medcheck.jml_ppn, tbl_trans_medcheck.ppn, tbl_trans_medcheck.jml_gtotal, tbl_trans_medcheck.jml_bayar, tbl_trans_medcheck.jml_kembali, tbl_trans_medcheck.jml_kurang, tbl_trans_medcheck.jml_poin, tbl_trans_medcheck.jml_poin_nom,
                                            tbl_trans_medcheck.tipe, tbl_trans_medcheck.tipe_bayar, tbl_trans_medcheck.status, tbl_trans_medcheck.status_bayar, tbl_trans_medcheck.status_nota, tbl_trans_medcheck.status_hps, tbl_trans_medcheck.status_pos, tbl_trans_medcheck.status_periksa
                                        FROM tbl_trans_medcheck
                                        WHERE tbl_trans_medcheck.status_hps='0' AND tbl_trans_medcheck.status_pos='0' 
                                        AND DATE(tgl_simpan) LIKE '%". $this->tanggalan->tgl_indo_sys($tg)."%'
                                        AND pasien LIKE '%". $cs."%'
                                        AND tipe LIKE '%". $tp."%'
                                        AND status_bayar LIKE '%". $by."%'
                                        GROUP BY DATE_FORMAT(tbl_trans_medcheck.tgl_simpan, '%Y-%m-%d %H'), DATE_FORMAT(tbl_trans_medcheck.tgl_masuk, '%Y-%m-%d %H'), tbl_trans_medcheck.keluhan, tbl_trans_medcheck.tipe, tbl_trans_medcheck.id_pasien
                                        ORDER BY tbl_trans_medcheck.id DESC LIMIT ".$config['per_page'].", ".$hal;

                        $data['penj']   = $this->db->query($kueri)->result();
                    } else {
//                        $data['penj'] = $this->db
//                                             ->where('status_hps', '0')
//                                             ->where('status_pos', '0')
//                                             ->like('DATE(tgl_simpan)', $this->tanggalan->tgl_indo_sys($tg))
//                                             ->like('tipe', $tp)
//                                             ->like('id_dokter', ($id_grup->name == 'dokter' ? $id_user : ''), ($id_grup->name == 'dokter' ? 'none' : ''))
//                                             ->like('id', general::dekrip($id))
//                                             ->like('pasien', $cs)
//                                             ->like('status_bayar', $by)
//                                             ->like('status_periksa', $sp)
//                                             ->limit($config['per_page'])
////                                             ->group_by('tgl_masuk, pasien')
//                                             ->order_by('tgl_simpan', 'desc')
//                                             ->get('v_medcheck')->result();
                                             
                               $kueri = "SELECT
                                            tbl_trans_medcheck.id, tbl_trans_medcheck.id_user, tbl_trans_medcheck.id_dokter, tbl_trans_medcheck.id_nurse, tbl_trans_medcheck.id_analis,
                                            tbl_trans_medcheck.id_pasien, tbl_trans_medcheck.id_poli, tbl_trans_medcheck.id_dft, tbl_trans_medcheck.id_ant, tbl_trans_medcheck.id_kasir, tbl_trans_medcheck.id_instansi, 
                                            tbl_trans_medcheck.id_encounter, tbl_trans_medcheck.id_condition, tbl_trans_medcheck.id_post_location,
                                            tbl_trans_medcheck.id_icd, tbl_trans_medcheck.id_icd10, tbl_trans_medcheck.tgl_simpan, tbl_trans_medcheck.tgl_modif, tbl_trans_medcheck.tgl_masuk, 
                                            tbl_trans_medcheck.tgl_periksa, tbl_trans_medcheck.tgl_periksa_lab, tbl_trans_medcheck.tgl_periksa_rad, tbl_trans_medcheck.tgl_periksa_pen, 
                                            tbl_trans_medcheck.tgl_ranap, tbl_trans_medcheck.tgl_keluar, tbl_trans_medcheck.tgl_bayar, tbl_trans_medcheck.tgl_ttd,
                                            tbl_trans_medcheck.no_rm, tbl_trans_medcheck.no_akun, tbl_trans_medcheck.no_nota, tbl_trans_medcheck.poli, tbl_trans_medcheck.dokter_nik AS nik_dokter, tbl_trans_medcheck.dokter AS nama_dokter, tbl_trans_medcheck.pasien_nik AS nik_pasien, tbl_trans_medcheck.pasien, tbl_trans_medcheck.tgl_lahir, tbl_trans_medcheck.keluhan, tbl_trans_medcheck.ttv,
                                            tbl_trans_medcheck.ttv_st, tbl_trans_medcheck.ttv_bb, tbl_trans_medcheck.ttv_tb, tbl_trans_medcheck.ttv_td, tbl_trans_medcheck.ttv_sistole, tbl_trans_medcheck.ttv_diastole, tbl_trans_medcheck.ttv_nadi, tbl_trans_medcheck.ttv_laju, tbl_trans_medcheck.ttv_saturasi, tbl_trans_medcheck.ttv_skala,
                                            tbl_trans_medcheck.diagnosa, tbl_trans_medcheck.anamnesa, tbl_trans_medcheck.pemeriksaan, tbl_trans_medcheck.program, tbl_trans_medcheck.alergi,
                                            tbl_trans_medcheck.metode, tbl_trans_medcheck.platform, tbl_trans_medcheck.jml_total, tbl_trans_medcheck.jml_dp,
                                            tbl_trans_medcheck.jml_diskon, tbl_trans_medcheck.jml_potongan, tbl_trans_medcheck.jml_potongan_poin, tbl_trans_medcheck.jml_subtotal, tbl_trans_medcheck.jml_ppn, tbl_trans_medcheck.ppn, tbl_trans_medcheck.jml_gtotal, tbl_trans_medcheck.jml_bayar, tbl_trans_medcheck.jml_kembali, tbl_trans_medcheck.jml_kurang, tbl_trans_medcheck.jml_poin, tbl_trans_medcheck.jml_poin_nom,
                                            tbl_trans_medcheck.tipe, tbl_trans_medcheck.tipe_bayar, tbl_trans_medcheck.status, tbl_trans_medcheck.status_bayar, tbl_trans_medcheck.status_nota, tbl_trans_medcheck.status_hps, tbl_trans_medcheck.status_pos, tbl_trans_medcheck.status_periksa
                                        FROM tbl_trans_medcheck
                                        WHERE tbl_trans_medcheck.status_hps='0' AND tbl_trans_medcheck.status_pos='0' 
                                        AND DATE(tgl_simpan) LIKE '%". $this->tanggalan->tgl_indo_sys($tg)."%'
                                        AND pasien LIKE '%". $cs."%'
                                        AND tipe LIKE '%". $tp."%'
                                        AND status_bayar LIKE '%". $by."%'
                                        GROUP BY DATE_FORMAT(tbl_trans_medcheck.tgl_simpan, '%Y-%m-%d %H'), DATE_FORMAT(tbl_trans_medcheck.tgl_masuk, '%Y-%m-%d %H'), tbl_trans_medcheck.keluhan, tbl_trans_medcheck.tipe, tbl_trans_medcheck.id_pasien
                                        ORDER BY tbl_trans_medcheck.id DESC LIMIT ".$config['per_page'];
                                
                        $data['penj']   = $this->db->query($kueri)->result();
                        // GROUP BY DATE_FORMAT(tbl_trans_medcheck.tgl_simpan, '%Y-%m-%d %H'), DATE_FORMAT(tbl_trans_medcheck.tgl_masuk, '%Y-%m-%d %H'), tbl_trans_medcheck.keluhan, tbl_trans_medcheck.tipe, tbl_trans_medcheck.id_pasien
                    }
                }

                $this->pagination->initialize($config);

                /* Blok pagination */
                $data['total_rows'] = $config['total_rows'];
                $data['PerPage']    = $config['per_page'];
                $data['pagination'] = $this->pagination->create_links();
                /* --End Blok pagination-- */

                $data['kmr_label']      = $this->crud->kmr_label();
                $data['kmr_kaps']       = $this->crud->kmr_kapasitas();
                $data['sql_kamar']      = $this->db->select('id, kode, kamar, jml, jml_max, style')->where('status', '1')->get('tbl_m_kamar')->result();
                $data['sql_kary_jdwl']  = $this->db->select('tbl_m_karyawan.nama_dpn, tbl_m_karyawan.nama, tbl_m_karyawan.nama_blk, tbl_m_poli.lokasi, tbl_m_karyawan_jadwal.hari_1, tbl_m_karyawan_jadwal.hari_2, tbl_m_karyawan_jadwal.hari_3, tbl_m_karyawan_jadwal.hari_4, tbl_m_karyawan_jadwal.hari_5, tbl_m_karyawan_jadwal.hari_6, tbl_m_karyawan_jadwal.hari_7, tbl_m_karyawan_jadwal.waktu')
                                                   ->join('tbl_m_karyawan', 'tbl_m_karyawan.id=tbl_m_karyawan_jadwal.id_karyawan')
                                                   ->join('tbl_m_poli', 'tbl_m_poli.id=tbl_m_karyawan_jadwal.id_poli')
                                                   ->get('tbl_m_karyawan_jadwal')->result();
                $data['pengaturan']     = $pengaturan;             
            }

            /* Sidebar Menu */
            $data['sidebar']    = 'admin-lte-3/includes/medcheck/sidebar_med';
            /* --- Sidebar Menu --- */   

            /* Load view tampilan */
            $this->load->view('admin-lte-3/1_atas', $data);
            $this->load->view('admin-lte-3/2_header', $data);
            $this->load->view('admin-lte-3/3_navbar', $data);
            $this->load->view('admin-lte-3/includes/medcheck/'.(isset($_GET['tipe']) ? 'index' : 'content'), $data);
            $this->load->view('admin-lte-3/5_footer', $data);
            $this->load->view('admin-lte-3/6_bawah', $data);
        }else{
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();            
        }
    }
    
    public function data_satusehat() {
        if (akses::aksesLogin() == TRUE) {
            /* -- Grup hak akses -- */
            $role        = $this->input->get('role');
            $tipe        = $this->input->get('tipe');
            $grup        = $this->ion_auth->get_users_groups()->row();
            $id_user     = $this->ion_auth->user()->row()->id;
            $id_grup     = $this->ion_auth->get_users_groups()->row();
            $id_dokter   = $this->ion_auth->get_users_groups()->row();
            $pengaturan  = $this->db->get('tbl_pengaturan')->row();

            /* -- Blok Filter -- */
            $hal     = $this->input->get('halaman');
            $id      = $this->input->get('id');
            $cs      = $this->input->get('filter_nama');
            $by      = $this->input->get('filter_bayar');
            $tp      = $this->input->get('filter_tipe');
            $tg      = $this->input->get('filter_tgl');
            $sp      = $this->input->get('filter_periksa');
            $st      = $this->input->get('status');
            $jml     = $this->input->get('jml');
            
            $jml_sql = $this->db->order_by('id', 'DESC')
                                ->get('tbl_util_log_satusehat')->num_rows();

            if(!empty($jml)){
                $jml_hal = $jml;
            }else{
                $jml_hal = $jml_sql;
            }
            
            /* -- End Blok Filter -- */

            /* -- Form Error -- */
            $data['hasError']                = $this->session->flashdata('form_error');

            /* -- Blok Pagination -- */
            $config['base_url']              = base_url('medcheck/data_satusehat.php?'.(!empty($tg) ? 'filter_tgl='.$tg.'&' : '').(!empty($jml_hal) ? 'jml='.$jml_hal : ''));
            $config['total_rows']            = $jml_hal;

            $config['query_string_segment']  = 'halaman';
            $config['page_query_string']     = TRUE;
            $config['per_page']              = $pengaturan->jml_item;
            $config['num_links']             = 2;

            $config['first_tag_open']        = '<li class="page-item">';
            $config['first_tag_close']       = '</li>';

            $config['prev_tag_open']         = '<li class="page-item">';
            $config['prev_tag_close']        = '</li>';
            
            $config['num_tag_open']          = '<li class="page-item">';
            $config['num_tag_close']         = '</li>';

            $config['next_tag_open']         = '<li class="page-item">';
            $config['next_tag_close']        = '</li>';
            
            $config['last_tag_open']         = '<li class="page-item">';
            $config['last_tag_close']        = '</li>';
            
            $config['cur_tag_open']          = '<li class="page-item"><a href="#" class="page-link text-dark"><b>';
            $config['cur_tag_close']         = '</b></a></li>';
            
            $config['first_link']            = '&laquo;';
            $config['prev_link']             = '&lsaquo;';
            $config['next_link']             = '&rsaquo;';
            $config['last_link']             = '&raquo;';
            $config['anchor_class']          = 'class="page-link"';
            /* -- End Blok Pagination -- */

            if(!empty($hal)){
                   $data['sql_log'] = $this->db->limit($config['per_page'], $hal)
                                               ->order_by('id', 'DESC')
                                               ->get('tbl_util_log_satusehat')->result();
            }else{
                   $data['sql_log'] = $this->db->limit($config['per_page'])
                                               ->order_by('id', 'DESC')
                                               ->get('tbl_util_log_satusehat')->result();
            }
            
            $this->pagination->initialize($config);

            /* Blok pagination */
            $data['total_rows'] = $config['total_rows'];
            $data['PerPage']    = $config['per_page'];
            $data['pagination'] = $this->pagination->create_links();
            /* --End Blok pagination-- */
            
            /* Sidebar Menu */
            $data['sidebar']    = 'admin-lte-3/includes/medcheck/sidebar_med';
            /* --- Sidebar Menu --- */
            
            /* Load view tampilan */
            $this->load->view('admin-lte-3/1_atas', $data);
            $this->load->view('admin-lte-3/2_header', $data);
            $this->load->view('admin-lte-3/3_navbar', $data);
            $this->load->view('admin-lte-3/includes/medcheck/data_satusehat', $data);
            $this->load->view('admin-lte-3/5_footer', $data);
            $this->load->view('admin-lte-3/6_bawah', $data);
        }else{
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();            
        }
    }
    
    public function data_resep() {
        if (akses::aksesLogin() == TRUE) {
            /* -- Grup hak akses -- */
            $role        = $this->input->get('role');
            $tipe        = $this->input->get('tipe');
            $grup        = $this->ion_auth->get_users_groups()->row();
            $id_user     = $this->ion_auth->user()->row()->id;
            $id_grup     = $this->ion_auth->get_users_groups()->row();
            $id_dokter   = $this->ion_auth->get_users_groups()->row();
            $pengaturan  = $this->db->get('tbl_pengaturan')->row();

            /* -- Blok Filter -- */
            $hal     = $this->input->get('halaman');
            $id      = $this->input->get('id');
            $cs      = $this->input->get('filter_nama');
            $by      = $this->input->get('filter_bayar');
            $tp      = $this->input->get('filter_tipe');
            $tg      = $this->input->get('filter_tgl');
            $sp      = $this->input->get('filter_periksa');
            $st      = $this->input->get('status');
            $jml     = $this->input->get('jml');
            
            $jml_sql = $this->db->like('status', $st)
                                ->like('pasien', (!empty($cs) ? $cs : ''))
                                ->like('DATE(tgl_simpan)', $this->tanggalan->tgl_indo_sys($tg))
                                ->order_by('id', 'DESC')
                                ->get('v_medcheck_resep')->num_rows();

            if(!empty($jml)){
                $jml_hal = $jml;
            }else{
                $jml_hal = $jml_sql;
            }
            
            /* -- End Blok Filter -- */

            /* -- Form Error -- */
            $data['hasError']                = $this->session->flashdata('form_error');

            /* -- Blok Pagination -- */
            $config['base_url']              = base_url('medcheck/resep/data_resep.php?status='.(isset($st) ? $st : '').(!empty($cs) ? '&filter_nama='.$cs : '').(!empty($tg) ? '&filter_tgl='.$tg : '').(!empty($jml_hal) ? '&jml='.$jml_hal : ''));
            $config['total_rows']            = $jml_hal;

            $config['query_string_segment']  = 'halaman';
            $config['page_query_string']     = TRUE;
            $config['per_page']              = $pengaturan->jml_item;
            $config['num_links']             = 2;

            $config['first_tag_open']        = '<li class="page-item">';
            $config['first_tag_close']       = '</li>';

            $config['prev_tag_open']         = '<li class="page-item">';
            $config['prev_tag_close']        = '</li>';
            
            $config['num_tag_open']          = '<li class="page-item">';
            $config['num_tag_close']         = '</li>';

            $config['next_tag_open']         = '<li class="page-item">';
            $config['next_tag_close']        = '</li>';
            
            $config['last_tag_open']         = '<li class="page-item">';
            $config['last_tag_close']        = '</li>';
            
            $config['cur_tag_open']          = '<li class="page-item"><a href="#" class="page-link text-dark"><b>';
            $config['cur_tag_close']         = '</b></a></li>';
            
            $config['first_link']            = '&laquo;';
            $config['prev_link']             = '&lsaquo;';
            $config['next_link']             = '&rsaquo;';
            $config['last_link']             = '&raquo;';
            $config['anchor_class']          = 'class="page-link"';
            /* -- End Blok Pagination -- */

            if(!empty($hal)){
                   $data['penj'] = $this->db->like('status', $st)
                                            ->like('pasien', (!empty($cs) ? $cs : ''))
                                            ->like('DATE(tgl_simpan)', $this->tanggalan->tgl_indo_sys($tg))
                                            ->limit($config['per_page'], $hal)
                                            ->order_by('id', 'DESC')
                                            ->get('v_medcheck_resep')->result();
            }else{
                   $data['penj'] = $this->db->like('status', $st)
                                            ->like('pasien', (!empty($cs) ? $cs : ''))
                                            ->like('DATE(tgl_simpan)', $this->tanggalan->tgl_indo_sys($tg))
                                            ->limit($config['per_page'])
                                            ->order_by('id', 'DESC')
                                            ->get('v_medcheck_resep')->result();
            }
            
            $this->pagination->initialize($config);

            /* Blok pagination */
            $data['total_rows'] = $config['total_rows'];
            $data['PerPage']    = $config['per_page'];
            $data['pagination'] = $this->pagination->create_links();
            $data['cetak']      = '<button type="button" onclick="window.location.href = \''.base_url('transaksi/cetak_data_penj.php?'.(!empty($nt) ? 'filter_nota='.$nt : '').(!empty($tg) ? '&filter_tgl='.$tg : '').(!empty($tp) ? '&filter_tgl_tempo='.$tp : '').(!empty($cs) ? '&filter_cust='.$cs : '').(!empty($sl) ? '&filter_sales='.$sl : '').(!empty($jml) ? '&jml='.$jml : '')).'\'" class="btn btn-warning"><i class="fa fa-print"></i> Cetak</button>';
            /* --End Blok pagination-- */
            
            /* Sidebar Menu */
            $data['sidebar']    = 'admin-lte-3/includes/medcheck/sidebar_med';
            /* --- Sidebar Menu --- */
            
            /* Load view tampilan */
            $this->load->view('admin-lte-3/1_atas', $data);
            $this->load->view('admin-lte-3/2_header', $data);
            $this->load->view('admin-lte-3/3_navbar', $data);
            $this->load->view('admin-lte-3/includes/medcheck/data_resep', $data);
            $this->load->view('admin-lte-3/5_footer', $data);
            $this->load->view('admin-lte-3/6_bawah', $data);
        }else{
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();            
        }
    }
    
    public function data_radiologi() {
        if (akses::aksesLogin() == TRUE) {
            /* -- Grup hak akses -- */
            $role        = $this->input->get('role');
            $tipe        = $this->input->get('tipe');
            $grup        = $this->ion_auth->get_users_groups()->row();
            $id_user     = $this->ion_auth->user()->row()->id;
            $id_grup     = $this->ion_auth->get_users_groups()->row();
            $id_dokter   = $this->ion_auth->get_users_groups()->row();
            $pengaturan  = $this->db->get('tbl_pengaturan')->row();

            /* -- Blok Filter -- */
            $hal     = $this->input->get('halaman');
            $id      = $this->input->get('id');
            $cs      = $this->input->get('filter_nama');
            $by      = $this->input->get('filter_bayar');
            $tp      = $this->input->get('filter_tipe');
            $tg      = $this->input->get('filter_tgl');
            $sp      = $this->input->get('filter_periksa');
            $st      = $this->input->get('status');
            $jml     = $this->input->get('jml');
            
            $jml_sql = $this->db->select('tbl_trans_medcheck.id, tbl_trans_medcheck.id_pasien, tbl_trans_medcheck.no_rm, tbl_trans_medcheck.no_nota, tbl_trans_medcheck.pasien, tbl_trans_medcheck_rad.tgl_simpan, tbl_trans_medcheck_rad.id_radiografer, tbl_trans_medcheck_rad.id_dokter, tbl_trans_medcheck_rad.no_sample, tbl_trans_medcheck_rad.no_rad, tbl_trans_medcheck_rad.status')
                                        ->join('tbl_trans_medcheck', 'tbl_trans_medcheck.id=tbl_trans_medcheck_rad.id_medcheck')
                                        ->like('tbl_trans_medcheck_rad.status', (isset($st) ? $st : ''))
                                        ->like('tbl_trans_medcheck.pasien', (!empty($cs) ? $cs : ''))
                                        ->like('DATE(tbl_trans_medcheck.tgl_simpan)', $this->tanggalan->tgl_indo_sys($tg))
                                        ->order_by('tbl_trans_medcheck_rad.id', 'DESC')
                                        ->get('tbl_trans_medcheck_rad')->num_rows();

            if(!empty($jml)){
                $jml_hal = $jml;
            }else{
                $jml_hal = $jml_sql;
            }
            
            /* -- End Blok Filter -- */

            /* -- Form Error -- */
            $data['hasError']                = $this->session->flashdata('form_error');

            /* -- Blok Pagination -- */
            $config['base_url']              = base_url('medcheck/data_radiologi.php?status='.(isset($st) ? $st : '').(!empty($cs) ? '&filter_nama='.$cs : '').(!empty($tg) ? '&filter_tgl='.$tg : '').(!empty($tp) ? '&filter_tipe='.$tp : '').(!empty($sp) ? '&filter_periksa='.$sp : '').(!empty($jml_hal) ? '&jml='.$jml_hal : ''));
            $config['total_rows']            = $jml_hal;

            $config['query_string_segment']  = 'halaman';
            $config['page_query_string']     = TRUE;
            $config['per_page']              = $pengaturan->jml_item;
            $config['num_links']             = 2;

            $config['first_tag_open']        = '<li class="page-item">';
            $config['first_tag_close']       = '</li>';

            $config['prev_tag_open']         = '<li class="page-item">';
            $config['prev_tag_close']        = '</li>';
            
            $config['num_tag_open']          = '<li class="page-item">';
            $config['num_tag_close']         = '</li>';

            $config['next_tag_open']         = '<li class="page-item">';
            $config['next_tag_close']        = '</li>';
            
            $config['last_tag_open']         = '<li class="page-item">';
            $config['last_tag_close']        = '</li>';
            
            $config['cur_tag_open']          = '<li class="page-item"><a href="#" class="page-link text-dark"><b>';
            $config['cur_tag_close']         = '</b></a></li>';
            
            $config['first_link']            = '&laquo;';
            $config['prev_link']             = '&lsaquo;';
            $config['next_link']             = '&rsaquo;';
            $config['last_link']             = '&raquo;';
            $config['anchor_class']          = 'class="page-link"';
            /* -- End Blok Pagination -- */

            if(!empty($hal)){
                   $data['penj'] = $this->db->select('tbl_trans_medcheck.id, tbl_trans_medcheck.id_pasien, tbl_trans_medcheck.no_rm, tbl_trans_medcheck.no_nota, tbl_trans_medcheck.pasien, tbl_trans_medcheck_rad.id AS id_rad, tbl_trans_medcheck_rad.tgl_simpan, tbl_trans_medcheck_rad.id_radiografer, tbl_trans_medcheck_rad.id_dokter, tbl_trans_medcheck_rad.no_sample, tbl_trans_medcheck_rad.no_rad, tbl_trans_medcheck_rad.status')
                                        ->join('tbl_trans_medcheck', 'tbl_trans_medcheck.id=tbl_trans_medcheck_rad.id_medcheck')
                                        ->like('tbl_trans_medcheck_rad.status', (isset($st) ? $st : ''))
                                        ->like('tbl_trans_medcheck.pasien', (!empty($cs) ? $cs : ''))
                                        ->like('DATE(tbl_trans_medcheck.tgl_simpan)', $this->tanggalan->tgl_indo_sys($tg))
                                        ->limit($config['per_page'],$hal)
                                        ->order_by('tbl_trans_medcheck_rad.id', 'DESC')
                                        ->get('tbl_trans_medcheck_rad')->result();
            }else{
                   $data['penj'] = $this->db->select('tbl_trans_medcheck.id, tbl_trans_medcheck.id_pasien, tbl_trans_medcheck.no_rm, tbl_trans_medcheck.no_nota, tbl_trans_medcheck.pasien, tbl_trans_medcheck_rad.id AS id_rad, tbl_trans_medcheck_rad.tgl_simpan, tbl_trans_medcheck_rad.id_radiografer, tbl_trans_medcheck_rad.id_dokter, tbl_trans_medcheck_rad.no_sample, tbl_trans_medcheck_rad.no_rad, tbl_trans_medcheck_rad.status')
                                        ->join('tbl_trans_medcheck', 'tbl_trans_medcheck.id=tbl_trans_medcheck_rad.id_medcheck')
                                        ->like('tbl_trans_medcheck_rad.status', (isset($st) ? $st : ''))
                                        ->like('tbl_trans_medcheck.pasien', (!empty($cs) ? $cs : ''))
                                        ->like('DATE(tbl_trans_medcheck.tgl_simpan)', $this->tanggalan->tgl_indo_sys($tg))
                                        ->limit($config['per_page'])
                                        ->order_by('tbl_trans_medcheck_rad.id', 'DESC')
                                        ->get('tbl_trans_medcheck_rad')->result();
            }
            
            $this->pagination->initialize($config);

            /* Blok pagination */
            $data['total_rows'] = $config['total_rows'];
            $data['PerPage']    = $config['per_page'];
            $data['pagination'] = $this->pagination->create_links();
            $data['cetak']      = '<button type="button" onclick="window.location.href = \''.base_url('transaksi/cetak_data_penj.php?'.(!empty($nt) ? 'filter_nota='.$nt : '').(!empty($tg) ? '&filter_tgl='.$tg : '').(!empty($tp) ? '&filter_tgl_tempo='.$tp : '').(!empty($cs) ? '&filter_cust='.$cs : '').(!empty($sl) ? '&filter_sales='.$sl : '').(!empty($jml) ? '&jml='.$jml : '')).'\'" class="btn btn-warning"><i class="fa fa-print"></i> Cetak</button>';
            /* --End Blok pagination-- */
            
            /* Sidebar Menu */
            $data['sidebar']    = 'admin-lte-3/includes/medcheck/sidebar_med';
            /* --- Sidebar Menu --- */
            
            /* Load view tampilan */
            $this->load->view('admin-lte-3/1_atas', $data);
            $this->load->view('admin-lte-3/2_header', $data);
            $this->load->view('admin-lte-3/3_navbar', $data);
            $this->load->view('admin-lte-3/includes/medcheck/data_radiologi', $data);
            $this->load->view('admin-lte-3/5_footer', $data);
            $this->load->view('admin-lte-3/6_bawah', $data);
        }else{
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();            
        }
    }
    
    public function data_laborat() {
        if (akses::aksesLogin() == TRUE) {
            /* -- Grup hak akses -- */
            $role        = $this->input->get('role');
            $tipe        = $this->input->get('tipe');
            $grup        = $this->ion_auth->get_users_groups()->row();
            $id_user     = $this->ion_auth->user()->row()->id;
            $id_grup     = $this->ion_auth->get_users_groups()->row();
            $id_dokter   = $this->ion_auth->get_users_groups()->row();
            $pengaturan  = $this->db->get('tbl_pengaturan')->row();

            /* -- Blok Filter -- */
            $hal     = $this->input->get('halaman');
            $id      = $this->input->get('id');
            $cs      = $this->input->get('filter_nama');
            $by      = $this->input->get('filter_bayar');
            $tp      = $this->input->get('filter_tipe');
            $tg      = $this->input->get('filter_tgl');
            $sp      = $this->input->get('filter_periksa');
            $st      = $this->input->get('status');
            $jml     = $this->input->get('jml');
            
            $jml_sql = $this->db->select('tbl_trans_medcheck.id, tbl_trans_medcheck.id_pasien, tbl_trans_medcheck.no_rm, tbl_trans_medcheck.no_nota, tbl_trans_medcheck.pasien, tbl_trans_medcheck_lab.tgl_simpan, tbl_trans_medcheck_lab.id_analis, tbl_trans_medcheck_lab.id_dokter, tbl_trans_medcheck_lab.no_sample, tbl_trans_medcheck_lab.no_lab, tbl_trans_medcheck_lab.status')
                                        ->join('tbl_trans_medcheck', 'tbl_trans_medcheck.id=tbl_trans_medcheck_lab.id_medcheck')
                                        ->like('tbl_trans_medcheck_lab.status', (isset($st) ? $st : ''))
                                        ->like('tbl_trans_medcheck.pasien', (!empty($cs) ? $cs : ''))
                                        ->like('DATE(tbl_trans_medcheck.tgl_simpan)', $this->tanggalan->tgl_indo_sys($tg))
                                        ->order_by('tbl_trans_medcheck_lab.id', 'DESC')
                                        ->get('tbl_trans_medcheck_lab')->num_rows();

            if(!empty($jml)){
                $jml_hal = $jml;
            }else{
                $jml_hal = $jml_sql;
            }
            
            /* -- End Blok Filter -- */

            /* -- Form Error -- */
            $data['hasError']                = $this->session->flashdata('form_error');

            /* -- Blok Pagination -- */
            $config['base_url']              = base_url('medcheck/data_laborat.php?status='.(isset($st) ? $st : '').(!empty($cs) ? '&filter_nama='.$cs : '').(!empty($tg) ? '&filter_tgl='.$tg : '').(!empty($tp) ? '&filter_tipe='.$tp : '').(!empty($sp) ? '&filter_periksa='.$sp : '').(!empty($jml_hal) ? '&jml='.$jml_hal : ''));
            $config['total_rows']            = $jml_hal;

            $config['query_string_segment']  = 'halaman';
            $config['page_query_string']     = TRUE;
            $config['per_page']              = $pengaturan->jml_item;
            $config['num_links']             = 2;

            $config['first_tag_open']        = '<li class="page-item">';
            $config['first_tag_close']       = '</li>';

            $config['prev_tag_open']         = '<li class="page-item">';
            $config['prev_tag_close']        = '</li>';
            
            $config['num_tag_open']          = '<li class="page-item">';
            $config['num_tag_close']         = '</li>';

            $config['next_tag_open']         = '<li class="page-item">';
            $config['next_tag_close']        = '</li>';
            
            $config['last_tag_open']         = '<li class="page-item">';
            $config['last_tag_close']        = '</li>';
            
            $config['cur_tag_open']          = '<li class="page-item"><a href="#" class="page-link text-dark"><b>';
            $config['cur_tag_close']         = '</b></a></li>';
            
            $config['first_link']            = '&laquo;';
            $config['prev_link']             = '&lsaquo;';
            $config['next_link']             = '&rsaquo;';
            $config['last_link']             = '&raquo;';
            $config['anchor_class']          = 'class="page-link"';
            /* -- End Blok Pagination -- */

            if(!empty($hal)){
                   $data['penj'] = $this->db->select('tbl_trans_medcheck.id, tbl_trans_medcheck.id_pasien, tbl_trans_medcheck.no_rm, tbl_trans_medcheck.no_nota, tbl_trans_medcheck.pasien, tbl_trans_medcheck_lab.id AS id_rad, tbl_trans_medcheck_lab.id AS id_lab, tbl_trans_medcheck_lab.tgl_simpan, tbl_trans_medcheck_lab.id_analis, tbl_trans_medcheck_lab.id_dokter, tbl_trans_medcheck_lab.no_sample, tbl_trans_medcheck_lab.no_lab, tbl_trans_medcheck_lab.status')
                                        ->join('tbl_trans_medcheck', 'tbl_trans_medcheck.id=tbl_trans_medcheck_lab.id_medcheck')
                                        ->like('tbl_trans_medcheck_lab.status', (isset($st) ? $st : ''))
                                        ->like('tbl_trans_medcheck.pasien', (!empty($cs) ? $cs : ''))
                                        ->like('DATE(tbl_trans_medcheck.tgl_simpan)', $this->tanggalan->tgl_indo_sys($tg))
                                        ->limit($config['per_page'],$hal)
                                        ->order_by('tbl_trans_medcheck_lab.id', 'DESC')
                                        ->get('tbl_trans_medcheck_lab')->result();
            }else{
                   $data['penj'] = $this->db->select('tbl_trans_medcheck.id, tbl_trans_medcheck.id_pasien, tbl_trans_medcheck.no_rm, tbl_trans_medcheck.no_nota, tbl_trans_medcheck.pasien, tbl_trans_medcheck_lab.id AS id_rad, tbl_trans_medcheck_lab.id AS id_lab, tbl_trans_medcheck_lab.tgl_simpan, tbl_trans_medcheck_lab.id_analis, tbl_trans_medcheck_lab.id_dokter, tbl_trans_medcheck_lab.no_sample, tbl_trans_medcheck_lab.no_lab, tbl_trans_medcheck_lab.status')
                                        ->join('tbl_trans_medcheck', 'tbl_trans_medcheck.id=tbl_trans_medcheck_lab.id_medcheck')
                                        ->like('tbl_trans_medcheck_lab.status', (isset($st) ? $st : ''))
                                        ->like('tbl_trans_medcheck.pasien', (!empty($cs) ? $cs : ''))
                                        ->like('DATE(tbl_trans_medcheck.tgl_simpan)', $this->tanggalan->tgl_indo_sys($tg))
                                        ->limit($config['per_page'])
                                        ->order_by('tbl_trans_medcheck_lab.id', 'DESC')
                                        ->get('tbl_trans_medcheck_lab')->result();
            }
            
            $this->pagination->initialize($config);

            /* Blok pagination */
            $data['total_rows'] = $config['total_rows'];
            $data['PerPage']    = $config['per_page'];
            $data['pagination'] = $this->pagination->create_links();
            $data['cetak']      = '<button type="button" onclick="window.location.href = \''.base_url('transaksi/cetak_data_penj.php?'.(!empty($nt) ? 'filter_nota='.$nt : '').(!empty($tg) ? '&filter_tgl='.$tg : '').(!empty($tp) ? '&filter_tgl_tempo='.$tp : '').(!empty($cs) ? '&filter_cust='.$cs : '').(!empty($sl) ? '&filter_sales='.$sl : '').(!empty($jml) ? '&jml='.$jml : '')).'\'" class="btn btn-warning"><i class="fa fa-print"></i> Cetak</button>';
            /* --End Blok pagination-- */
            
            /* Sidebar Menu */
            $data['sidebar']    = 'admin-lte-3/includes/medcheck/sidebar_med';
            /* --- Sidebar Menu --- */
            
            /* Load view tampilan */
            $this->load->view('admin-lte-3/1_atas', $data);
            $this->load->view('admin-lte-3/2_header', $data);
            $this->load->view('admin-lte-3/3_navbar', $data);
            $this->load->view('admin-lte-3/includes/medcheck/data_laborat', $data);
            $this->load->view('admin-lte-3/5_footer', $data);
            $this->load->view('admin-lte-3/6_bawah', $data);
        }else{
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();            
        }
    }
    
    public function data_pen_spiro() {
        if (akses::aksesLogin() == TRUE) {
            /* -- Grup hak akses -- */
            $role        = $this->input->get('role');
            $tipe        = $this->input->get('tipe');
            $grup        = $this->ion_auth->get_users_groups()->row();
            $id_user     = $this->ion_auth->user()->row()->id;
            $id_grup     = $this->ion_auth->get_users_groups()->row();
            $id_dokter   = $this->ion_auth->get_users_groups()->row();
            $pengaturan  = $this->db->get('tbl_pengaturan')->row();

            /* -- Blok Filter -- */
            $hal     = $this->input->get('halaman');
            $id      = $this->input->get('id');
            $cs      = $this->input->get('filter_nama');
            $by      = $this->input->get('filter_bayar');
            $tp      = $this->input->get('filter_tipe');
            $tg      = $this->input->get('filter_tgl');
            $sp      = $this->input->get('filter_periksa');
            $st      = $this->input->get('status');
            $jml     = $this->input->get('jml');
            
            $jml_sql = $this->db->where('status', '0')
                                ->like('pasien', (!empty($cs) ? $cs : ''))
                                ->like('DATE(tgl_simpan)', $this->tanggalan->tgl_indo_sys($tg))
                                ->order_by('id', 'DESC')
                                ->get('v_medcheck_pen_spiro')->num_rows();

            if(!empty($jml)){
                $jml_hal = $jml;
            }else{
                $jml_hal = $jml_sql;
            }
            
            /* -- End Blok Filter -- */

            /* -- Form Error -- */
            $data['hasError']                = $this->session->flashdata('form_error');

            /* -- Blok Pagination -- */
            $config['base_url']              = base_url('medcheck/data_pen_spiro.php?status='.(isset($st) ? $st : '').(!empty($cs) ? '&filter_nama='.$cs : '').(!empty($tg) ? '&filter_tgl='.$tg : '').(!empty($jml_hal) ? '&jml='.$jml_hal : ''));
            $config['total_rows']            = $jml_hal;

            $config['query_string_segment']  = 'halaman';
            $config['page_query_string']     = TRUE;
            $config['per_page']              = $pengaturan->jml_item;
            $config['num_links']             = 2;

            $config['first_tag_open']        = '<li class="page-item">';
            $config['first_tag_close']       = '</li>';

            $config['prev_tag_open']         = '<li class="page-item">';
            $config['prev_tag_close']        = '</li>';
            
            $config['num_tag_open']          = '<li class="page-item">';
            $config['num_tag_close']         = '</li>';

            $config['next_tag_open']         = '<li class="page-item">';
            $config['next_tag_close']        = '</li>';
            
            $config['last_tag_open']         = '<li class="page-item">';
            $config['last_tag_close']        = '</li>';
            
            $config['cur_tag_open']          = '<li class="page-item"><a href="#" class="page-link text-dark"><b>';
            $config['cur_tag_close']         = '</b></a></li>';
            
            $config['first_link']            = '&laquo;';
            $config['prev_link']             = '&lsaquo;';
            $config['next_link']             = '&rsaquo;';
            $config['last_link']             = '&raquo;';
            $config['anchor_class']          = 'class="page-link"';
            /* -- End Blok Pagination -- */

            if(!empty($hal)){
                   $data['penj'] = $this->db->where('status', '0')
                                            ->like('pasien', (!empty($cs) ? $cs : ''))
                                            ->like('DATE(tgl_simpan)', $this->tanggalan->tgl_indo_sys($tg))
                                            ->limit($config['per_page'], $hal)
                                            ->order_by('id', 'DESC')
                                            ->get('v_medcheck_pen_spiro')->result();
            }else{
                   $data['penj'] = $this->db->where('status', '0')
                                            ->like('pasien', (!empty($cs) ? $cs : ''))
                                            ->like('DATE(tgl_simpan)', $this->tanggalan->tgl_indo_sys($tg))
                                            ->limit($config['per_page'])
                                            ->order_by('id', 'DESC')
                                            ->get('v_medcheck_pen_spiro')->result();
            }
            
            $this->pagination->initialize($config);

            /* Blok pagination */
            $data['total_rows'] = $config['total_rows'];
            $data['PerPage']    = $config['per_page'];
            $data['pagination'] = $this->pagination->create_links();
            $data['cetak']      = '<button type="button" onclick="window.location.href = \''.base_url('transaksi/cetak_data_penj.php?'.(!empty($nt) ? 'filter_nota='.$nt : '').(!empty($tg) ? '&filter_tgl='.$tg : '').(!empty($tp) ? '&filter_tgl_tempo='.$tp : '').(!empty($cs) ? '&filter_cust='.$cs : '').(!empty($sl) ? '&filter_sales='.$sl : '').(!empty($jml) ? '&jml='.$jml : '')).'\'" class="btn btn-warning"><i class="fa fa-print"></i> Cetak</button>';
            /* --End Blok pagination-- */
            
            /* Sidebar Menu */
            $data['sidebar']    = 'admin-lte-3/includes/medcheck/sidebar_med';
            /* --- Sidebar Menu --- */
            
            /* Load view tampilan */
            $this->load->view('admin-lte-3/1_atas', $data);
            $this->load->view('admin-lte-3/2_header', $data);
            $this->load->view('admin-lte-3/3_navbar', $data);
            $this->load->view('admin-lte-3/includes/medcheck/data_pen_spiro', $data);
            $this->load->view('admin-lte-3/5_footer', $data);
            $this->load->view('admin-lte-3/6_bawah', $data);
        }else{
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();            
        }
    }
    
    public function data_pen_ekg() {
        if (akses::aksesLogin() == TRUE) {
            /* -- Grup hak akses -- */
            $role        = $this->input->get('role');
            $tipe        = $this->input->get('tipe');
            $grup        = $this->ion_auth->get_users_groups()->row();
            $id_user     = $this->ion_auth->user()->row()->id;
            $id_grup     = $this->ion_auth->get_users_groups()->row();
            $id_dokter   = $this->ion_auth->get_users_groups()->row();
            $pengaturan  = $this->db->get('tbl_pengaturan')->row();

            /* -- Blok Filter -- */
            $hal     = $this->input->get('halaman');
            $id      = $this->input->get('id');
            $cs      = $this->input->get('filter_nama');
            $by      = $this->input->get('filter_bayar');
            $tp      = $this->input->get('filter_tipe');
            $tg      = $this->input->get('filter_tgl');
            $sp      = $this->input->get('filter_periksa');
            $st      = $this->input->get('status');
            $jml     = $this->input->get('jml');
            
            $jml_sql = $this->db->where('status', '0')
                                ->like('pasien', (!empty($cs) ? $cs : ''))
                                ->like('DATE(tgl_simpan)', $this->tanggalan->tgl_indo_sys($tg))
                                ->order_by('id', 'DESC')
                                ->get('v_medcheck_pen_ekg')->num_rows();

            if(!empty($jml)){
                $jml_hal = $jml;
            }else{
                $jml_hal = $jml_sql;
            }
            
            /* -- End Blok Filter -- */

            /* -- Form Error -- */
            $data['hasError']                = $this->session->flashdata('form_error');

            /* -- Blok Pagination -- */
            $config['base_url']              = base_url('medcheck/data_pen_ekg.php?status='.(isset($st) ? $st : '').(!empty($cs) ? '&filter_nama='.$cs : '').(!empty($tg) ? '&filter_tgl='.$tg : '').(!empty($jml_hal) ? '&jml='.$jml_hal : ''));
            $config['total_rows']            = $jml_hal;

            $config['query_string_segment']  = 'halaman';
            $config['page_query_string']     = TRUE;
            $config['per_page']              = $pengaturan->jml_item;
            $config['num_links']             = 2;

            $config['first_tag_open']        = '<li class="page-item">';
            $config['first_tag_close']       = '</li>';

            $config['prev_tag_open']         = '<li class="page-item">';
            $config['prev_tag_close']        = '</li>';
            
            $config['num_tag_open']          = '<li class="page-item">';
            $config['num_tag_close']         = '</li>';

            $config['next_tag_open']         = '<li class="page-item">';
            $config['next_tag_close']        = '</li>';
            
            $config['last_tag_open']         = '<li class="page-item">';
            $config['last_tag_close']        = '</li>';
            
            $config['cur_tag_open']          = '<li class="page-item"><a href="#" class="page-link text-dark"><b>';
            $config['cur_tag_close']         = '</b></a></li>';
            
            $config['first_link']            = '&laquo;';
            $config['prev_link']             = '&lsaquo;';
            $config['next_link']             = '&rsaquo;';
            $config['last_link']             = '&raquo;';
            $config['anchor_class']          = 'class="page-link"';
            /* -- End Blok Pagination -- */

            if(!empty($hal)){
                   $data['penj'] = $this->db->where('status', '0')
                                            ->like('pasien', (!empty($cs) ? $cs : ''))
                                            ->like('DATE(tgl_simpan)', $this->tanggalan->tgl_indo_sys($tg))
                                            ->limit($config['per_page'], $hal)
                                            ->order_by('id', 'DESC')
                                            ->get('v_medcheck_pen_ekg')->result();
            }else{
                   $data['penj'] = $this->db->where('status', '0')
                                            ->like('pasien', (!empty($cs) ? $cs : ''))
                                            ->like('DATE(tgl_simpan)', $this->tanggalan->tgl_indo_sys($tg))
                                            ->limit($config['per_page'])
                                            ->order_by('id', 'DESC')
                                            ->get('v_medcheck_pen_ekg')->result();
            }
            
            $this->pagination->initialize($config);

            /* Blok pagination */
            $data['total_rows'] = $config['total_rows'];
            $data['PerPage']    = $config['per_page'];
            $data['pagination'] = $this->pagination->create_links();
            $data['cetak']      = '<button type="button" onclick="window.location.href = \''.base_url('transaksi/cetak_data_penj.php?'.(!empty($nt) ? 'filter_nota='.$nt : '').(!empty($tg) ? '&filter_tgl='.$tg : '').(!empty($tp) ? '&filter_tgl_tempo='.$tp : '').(!empty($cs) ? '&filter_cust='.$cs : '').(!empty($sl) ? '&filter_sales='.$sl : '').(!empty($jml) ? '&jml='.$jml : '')).'\'" class="btn btn-warning"><i class="fa fa-print"></i> Cetak</button>';
            /* --End Blok pagination-- */
            
            /* Sidebar Menu */
            $data['sidebar']    = 'admin-lte-3/includes/medcheck/sidebar_med';
            /* --- Sidebar Menu --- */
            
            /* Load view tampilan */
            $this->load->view('admin-lte-3/1_atas', $data);
            $this->load->view('admin-lte-3/2_header', $data);
            $this->load->view('admin-lte-3/3_navbar', $data);
            $this->load->view('admin-lte-3/includes/medcheck/data_pen_ekg', $data);
            $this->load->view('admin-lte-3/5_footer', $data);
            $this->load->view('admin-lte-3/6_bawah', $data);
        }else{
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();            
        }
    }
    
    public function data_pen_hrv() {
        if (akses::aksesLogin() == TRUE) {
            /* -- Grup hak akses -- */
            $role        = $this->input->get('role');
            $tipe        = $this->input->get('tipe');
            $grup        = $this->ion_auth->get_users_groups()->row();
            $id_user     = $this->ion_auth->user()->row()->id;
            $id_grup     = $this->ion_auth->get_users_groups()->row();
            $id_dokter   = $this->ion_auth->get_users_groups()->row();
            $pengaturan  = $this->db->get('tbl_pengaturan')->row();

            /* -- Blok Filter -- */
            $hal     = $this->input->get('halaman');
            $id      = $this->input->get('id');
            $cs      = $this->input->get('filter_nama');
            $by      = $this->input->get('filter_bayar');
            $tp      = $this->input->get('filter_tipe');
            $tg      = $this->input->get('filter_tgl');
            $sp      = $this->input->get('filter_periksa');
            $st      = $this->input->get('status');
            $jml     = $this->input->get('jml');
            
            $jml_sql = $this->db->where('status', '0')
                                ->like('pasien', (!empty($cs) ? $cs : ''))
                                ->like('DATE(tgl_simpan)', $this->tanggalan->tgl_indo_sys($tg))
                                ->order_by('id', 'DESC')
                                ->get('v_medcheck_pen_hrv')->num_rows();

            if(!empty($jml)){
                $jml_hal = $jml;
            }else{
                $jml_hal = $jml_sql;
            }
            
            /* -- End Blok Filter -- */

            /* -- Form Error -- */
            $data['hasError']                = $this->session->flashdata('form_error');

            /* -- Blok Pagination -- */
            $config['base_url']              = base_url('medcheck/data_pen_hrv.php?status='.(isset($st) ? $st : '').(!empty($cs) ? '&filter_nama='.$cs : '').(!empty($tg) ? '&filter_tgl='.$tg : '').(!empty($jml_hal) ? '&jml='.$jml_hal : ''));
            $config['total_rows']            = $jml_hal;

            $config['query_string_segment']  = 'halaman';
            $config['page_query_string']     = TRUE;
            $config['per_page']              = $pengaturan->jml_item;
            $config['num_links']             = 2;

            $config['first_tag_open']        = '<li class="page-item">';
            $config['first_tag_close']       = '</li>';

            $config['prev_tag_open']         = '<li class="page-item">';
            $config['prev_tag_close']        = '</li>';
            
            $config['num_tag_open']          = '<li class="page-item">';
            $config['num_tag_close']         = '</li>';

            $config['next_tag_open']         = '<li class="page-item">';
            $config['next_tag_close']        = '</li>';
            
            $config['last_tag_open']         = '<li class="page-item">';
            $config['last_tag_close']        = '</li>';
            
            $config['cur_tag_open']          = '<li class="page-item"><a href="#" class="page-link text-dark"><b>';
            $config['cur_tag_close']         = '</b></a></li>';
            
            $config['first_link']            = '&laquo;';
            $config['prev_link']             = '&lsaquo;';
            $config['next_link']             = '&rsaquo;';
            $config['last_link']             = '&raquo;';
            $config['anchor_class']          = 'class="page-link"';
            /* -- End Blok Pagination -- */

            if(!empty($hal)){
                   $data['penj'] = $this->db->where('status', '0')
                                            ->like('pasien', (!empty($cs) ? $cs : ''))
                                            ->like('DATE(tgl_simpan)', $this->tanggalan->tgl_indo_sys($tg))
                                            ->limit($config['per_page'], $hal)
                                            ->order_by('id', 'DESC')
                                            ->get('v_medcheck_pen_hrv')->result();
            }else{
                   $data['penj'] = $this->db->where('status', '0')
                                            ->like('pasien', (!empty($cs) ? $cs : ''))
                                            ->like('DATE(tgl_simpan)', $this->tanggalan->tgl_indo_sys($tg))
                                            ->limit($config['per_page'])
                                            ->order_by('id', 'DESC')
                                            ->get('v_medcheck_pen_hrv')->result();
            }
            
            $this->pagination->initialize($config);

            /* Blok pagination */
            $data['total_rows'] = $config['total_rows'];
            $data['PerPage']    = $config['per_page'];
            $data['pagination'] = $this->pagination->create_links();
            $data['cetak']      = '<button type="button" onclick="window.location.href = \''.base_url('transaksi/cetak_data_penj.php?'.(!empty($nt) ? 'filter_nota='.$nt : '').(!empty($tg) ? '&filter_tgl='.$tg : '').(!empty($tp) ? '&filter_tgl_tempo='.$tp : '').(!empty($cs) ? '&filter_cust='.$cs : '').(!empty($sl) ? '&filter_sales='.$sl : '').(!empty($jml) ? '&jml='.$jml : '')).'\'" class="btn btn-warning"><i class="fa fa-print"></i> Cetak</button>';
            /* --End Blok pagination-- */
            
            /* Sidebar Menu */
            $data['sidebar']    = 'admin-lte-3/includes/medcheck/sidebar_med';
            /* --- Sidebar Menu --- */
            
            /* Load view tampilan */
            $this->load->view('admin-lte-3/1_atas', $data);
            $this->load->view('admin-lte-3/2_header', $data);
            $this->load->view('admin-lte-3/3_navbar', $data);
            $this->load->view('admin-lte-3/includes/medcheck/data_pen_hrv', $data);
            $this->load->view('admin-lte-3/5_footer', $data);
            $this->load->view('admin-lte-3/6_bawah', $data);
        }else{
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();            
        }
    }
    
    public function data_konsul() {
        if (akses::aksesLogin() == TRUE) {
            /* -- Grup hak akses -- */
            $role        = $this->input->get('role');
            $tipe        = $this->input->get('tipe');
            $grup        = $this->ion_auth->get_users_groups()->row();
            $id_user     = $this->ion_auth->user()->row()->id;
            $id_grup     = $this->ion_auth->get_users_groups()->row();
            $pengaturan  = $this->db->get('tbl_pengaturan')->row();

            /* -- Blok Filter -- */
            $hal     = $this->input->get('halaman');
            $jd      = $this->input->get('filter_judul');
            $jml     = $this->input->get('jml');
//            $jml_sql = ($id_grup->name == 'superadmin' || $id_grup->name == 'owner' || $id_grup->name == 'admin' ? $this->db->get('tbl_trans_jual')->num_rows() : $this->db->where('id_user', $id_user)->where('tgl_masuk', date('Y-m-d'))->get('tbl_trans_jual')->num_rows());

            if(!empty($jml)){
                $jml_hal = $jml;
            }else{
                $jml_hal = $this->db->select('*')
                                ->where('id_parent', '0')
                                ->like('judul', $jd)
                                ->get('tbl_trans_konsul')->num_rows();
            }
            /* -- End Blok Filter -- */

            /* -- Form Error -- */
            $data['hasError']                = $this->session->flashdata('form_error');

            /* -- Blok Pagination -- */
            $config['base_url']              = base_url('medcheck/data_konsul.php?'.(!empty($jd) ? '&filter_judul='.$jd.'&' : '').'jml='.$jml_hal);
            $config['total_rows']            = $jml_hal;

            $config['query_string_segment']  = 'halaman';
            $config['page_query_string']     = TRUE;
            $config['per_page']              = $pengaturan->jml_item;
            $config['num_links']             = 2;

            $config['first_tag_open']        = '<li class="page-item">';
            $config['first_tag_close']       = '</li>';

            $config['prev_tag_open']         = '<li class="page-item">';
            $config['prev_tag_close']        = '</li>';
            
            $config['num_tag_open']          = '<li class="page-item">';
            $config['num_tag_close']         = '</li>';

            $config['next_tag_open']         = '<li class="page-item">';
            $config['next_tag_close']        = '</li>';
            
            $config['last_tag_open']         = '<li class="page-item">';
            $config['last_tag_close']        = '</li>';
            
            $config['cur_tag_open']          = '<li class="page-item"><a href="#" class="page-link text-dark"><b>';
            $config['cur_tag_close']         = '</b></a></li>';
            
            $config['first_link']            = '&laquo;';
            $config['prev_link']             = '&lsaquo;';
            $config['next_link']             = '&rsaquo;';
            $config['last_link']             = '&raquo;';
            $config['anchor_class']          = 'class="page-link"';
            /* -- End Blok Pagination -- */

            if(!empty($hal)){
                   $data['sql_konsul'] = $this->db
                                              ->select('*')
                                              ->where('id_parent', '0')
                                              ->like('judul', $jd)
                                              ->limit($config['per_page'], $hal)
                                              ->order_by('id','desc')
                                              ->get('tbl_trans_konsul')->result();
            }else{
                   $data['sql_konsul'] = $this->db
                                              ->select('*')
                                              ->where('id_parent', '0')
                                              ->like('judul', $jd)
                                              ->limit($config['per_page'])
                                              ->order_by('id','desc')
                                              ->get('tbl_trans_konsul')->result();
            }

            $this->pagination->initialize($config);

            /* Blok pagination */
            $data['total_rows'] = $config['total_rows'];
            $data['PerPage']    = $config['per_page'];
            $data['pagination'] = $this->pagination->create_links();
            /* --End Blok pagination-- */
            
            /* Sidebar Menu */
            $data['sidebar']    = 'admin-lte-3/includes/medcheck/sidebar_med';
            /* --- Sidebar Menu --- */
            
            /* Load view tampilan */
            $this->load->view('admin-lte-3/1_atas', $data);
            $this->load->view('admin-lte-3/2_header', $data);
            $this->load->view('admin-lte-3/3_navbar', $data);
            $this->load->view('admin-lte-3/includes/medcheck/data_konsul', $data);
            $this->load->view('admin-lte-3/5_footer', $data);
            $this->load->view('admin-lte-3/6_bawah', $data);
        }else{
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();            
        }
    }
    
    public function data_konsul_cari() {
        if (akses::aksesLogin() == TRUE) {
            /* -- Grup hak akses -- */
            $role        = $this->input->get('role');
            $tipe        = $this->input->get('tipe');
            $grup        = $this->ion_auth->get_users_groups()->row();
            $id_user     = $this->ion_auth->user()->row()->id;
            $id_grup     = $this->ion_auth->get_users_groups()->row();
            $id_dokter   = $this->ion_auth->get_users_groups()->row();
            $pengaturan  = $this->db->get('tbl_pengaturan')->row();

            /* -- Blok Filter -- */
            $hal     = $this->input->get('halaman');
            $id      = $this->input->get('id');
            $cs      = $this->input->get('filter_nama');
            $by      = $this->input->get('filter_bayar');
            $tp      = $this->input->get('filter_tipe');
            $tg      = $this->input->get('filter_tgl');
            $sp      = $this->input->get('filter_periksa');
            $jml     = $this->input->get('jml');
            

            $jml_sql = $this->db->select('id')
                            ->where('status_hps', '0')
                            ->where('status_bayar', '0')
                            ->like('pasien', $cs)
                            ->order_by('id', 'desc')
                            ->get('tbl_trans_medcheck')->num_rows();

            if(!empty($jml)){
                $jml_hal = $jml;
            }else{
                $jml_hal = $jml_sql;
            }
            /* -- End Blok Filter -- */

            /* -- Form Error -- */
            $data['hasError']                = $this->session->flashdata('form_error');

            /* -- Blok Pagination -- */
            $config['base_url']              = base_url('medcheck/data_konsul_cari.php?'.(!empty($cs) ? '&filter_nama='.$cs : '').(!empty($jml_sql) ? '&jml='.$jml_sql : ''));
            $config['total_rows']            = $jml_hal;

            $config['query_string_segment']  = 'halaman';
            $config['page_query_string']     = TRUE;
            $config['per_page']              = $pengaturan->jml_item;
            $config['num_links']             = 3;

            $config['first_tag_open']        = '<li class="page-item">';
            $config['first_tag_close']       = '</li>';

            $config['prev_tag_open']         = '<li class="page-item">';
            $config['prev_tag_close']        = '</li>';
            
            $config['num_tag_open']          = '<li class="page-item">';
            $config['num_tag_close']         = '</li>';

            $config['next_tag_open']         = '<li class="page-item">';
            $config['next_tag_close']        = '</li>';
            
            $config['last_tag_open']         = '<li class="page-item">';
            $config['last_tag_close']        = '</li>';
            
            $config['cur_tag_open']          = '<li class="page-item"><a href="#" class="page-link text-dark"><b>';
            $config['cur_tag_close']         = '</b></a></li>';
            
            $config['first_link']            = '&laquo;';
            $config['prev_link']             = '&lsaquo;';
            $config['next_link']             = '&rsaquo;';
            $config['last_link']             = '&raquo;';
            $config['anchor_class']          = 'class="page-link"';
            /* -- End Blok Pagination -- */

            if (!empty($hal)) {
                $data['sql_konsul'] = $this->db
                                           ->select('tbl_trans_medcheck.id, tbl_trans_medcheck.id_user, tbl_trans_medcheck.id_dokter, tbl_trans_medcheck.tgl_simpan, tbl_trans_medcheck.tgl_masuk, tbl_trans_medcheck.no_rm, tbl_trans_medcheck.pasien, tbl_trans_medcheck.keluhan, tbl_trans_medcheck.diagnosa, tbl_trans_medcheck.anamnesa, tbl_m_pasien.kode, tbl_m_pasien.kode_dpn, tbl_m_pasien.tgl_lahir, tbl_m_pasien.jns_klm, tbl_m_pasien.file_name')
                                           ->join('tbl_m_pasien', 'tbl_m_pasien.id=tbl_trans_medcheck.id_pasien')
                                           ->where('tbl_trans_medcheck.status_hps', '0')
                                           ->where('tbl_trans_medcheck.status_bayar', '0')
                                           ->like('tbl_trans_medcheck.pasien', $cs)
                                           ->limit($config['per_page'], $hal)
                                           ->order_by('tbl_trans_medcheck.id', 'desc')
                                           ->get('tbl_trans_medcheck')->result();
            } else {
                $data['sql_konsul'] = $this->db
                                           ->select('tbl_trans_medcheck.id, tbl_trans_medcheck.id_user, tbl_trans_medcheck.id_dokter, tbl_trans_medcheck.tgl_simpan, tbl_trans_medcheck.tgl_masuk, tbl_trans_medcheck.no_rm, tbl_trans_medcheck.pasien, tbl_trans_medcheck.keluhan, tbl_trans_medcheck.diagnosa, tbl_trans_medcheck.anamnesa, tbl_m_pasien.kode, tbl_m_pasien.kode_dpn, tbl_m_pasien.tgl_lahir, tbl_m_pasien.jns_klm, tbl_m_pasien.file_name')
                                           ->join('tbl_m_pasien', 'tbl_m_pasien.id=tbl_trans_medcheck.id_pasien')
                                           ->where('tbl_trans_medcheck.status_hps', '0')
                                           ->where('tbl_trans_medcheck.status_bayar', '0')
                                           ->like('tbl_trans_medcheck.pasien', $cs)
                                           ->limit($config['per_page'])
                                           ->order_by('tbl_trans_medcheck.id', 'desc')
                                           ->get('tbl_trans_medcheck')->result();
            }

            $this->pagination->initialize($config);

            /* Blok pagination */
            $data['total_rows'] = $config['total_rows'];
            $data['PerPage']    = $config['per_page'];
            $data['pagination'] = $this->pagination->create_links();
            /* --End Blok pagination-- */
            
            /* Sidebar Menu */
            $data['sidebar']    = 'admin-lte-3/includes/medcheck/sidebar_med';
            /* --- Sidebar Menu --- */
            
            /* Load view tampilan */
            $this->load->view('admin-lte-3/1_atas', $data);
            $this->load->view('admin-lte-3/2_header', $data);
            $this->load->view('admin-lte-3/3_navbar', $data);
            $this->load->view('admin-lte-3/includes/medcheck/data_konsul_cari', $data);
            $this->load->view('admin-lte-3/5_footer', $data);
            $this->load->view('admin-lte-3/6_bawah', $data);
        }else{
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();            
        }
    }
    
    public function data_konsul_post() {
        if (akses::aksesLogin() == TRUE) {
            $setting                = $this->db->get('tbl_pengaturan')->row();
            $id_medc                = $this->input->get('id_medc');
            $id                     = $this->input->get('id');
            $id_resep               = $this->input->get('id_resep');
            $id_pasien              = $this->input->get('id_pasien');
            $id_item                = $this->input->get('id_item');
            $id_item_res            = $this->input->get('id_item_resep');
            $dft_id                 = $this->input->get('dft');
            $userid                 = $this->ion_auth->user()->row()->id;

            $data['poli']           = $this->db->where('status_ant', '1')->get('tbl_m_poli')->result();
            $data['platform']       = $this->db->get('tbl_m_platform')->result();
            $data['gelar']          = $this->db->get('tbl_m_gelar')->result();
            $data['sql_doc']        = $this->db->where('id_user_group', '10')->get('tbl_m_karyawan')->result();
            $data['kerja']          = $this->db->get('tbl_m_jenis_kerja')->result();
            $data['sql_poli']       = $this->db->where('id', $data['sql_dft_id']->id_poli)->get('tbl_m_poli')->row();
            $data['sql_dft_id']     = $this->db->where('id', general::dekrip($dft_id))->get('tbl_pendaftaran')->row();            
            $data['sql_itm_pas']    = $this->db->select('id, nama, nama_pgl')->get('tbl_m_pasien')->result();
            $data['sql_pas']        = $this->db->where('id', general::dekrip($id_pasien))->get('tbl_m_pasien')->row();
            $data['sql_penjamin']   = $this->db->where('status', '1')->get('tbl_m_penjamin')->result();
            
            if(!empty($id_pasien)){
               $data['pasien']         = $this->db->where('id', general::dekrip($id_pasien))->get('tbl_m_pasien')->row(); 
            }
            
            /* Sidebar Menu */
            $data['sidebar']    = 'admin-lte-3/includes/medcheck/sidebar_med';
            /* --- Sidebar Menu --- */
            
            /* Load view tampilan */
            $this->load->view('admin-lte-3/1_atas', $data);
            $this->load->view('admin-lte-3/2_header', $data);
            $this->load->view('admin-lte-3/3_navbar', $data);
            $this->load->view('admin-lte-3/includes/medcheck/data_konsul_post', $data);
            $this->load->view('admin-lte-3/5_footer', $data);
            $this->load->view('admin-lte-3/6_bawah', $data);
        }else{
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();            
        }
    }
    
    public function data_konsul_balas() {
        if (akses::aksesLogin() == TRUE) {
            $setting                = $this->db->get('tbl_pengaturan')->row();
            $id                     = $this->input->get('id');
            $userid                 = $this->ion_auth->user()->row()->id;
            
            if(!empty($id)){
               $data['sql_konsul']         = $this->db->where('id', general::dekrip($id))->get('tbl_trans_konsul')->row(); 
               $data['sql_konsul_bls']     = $this->db->where('id_parent', $data['sql_konsul']->id)->group_by('DATE(tgl_simpan)')->order_by('id', 'desc')->get('tbl_trans_konsul')->result(); 
            }
            
            /* Sidebar Menu */
            $data['sidebar']    = 'admin-lte-3/includes/medcheck/sidebar_med';
            /* --- Sidebar Menu --- */
            
            /* Load view tampilan */
            $this->load->view('admin-lte-3/1_atas', $data);
            $this->load->view('admin-lte-3/2_header', $data);
            $this->load->view('admin-lte-3/3_navbar', $data);
            $this->load->view('admin-lte-3/includes/medcheck/data_konsul_balas', $data);
            $this->load->view('admin-lte-3/5_footer', $data);
            $this->load->view('admin-lte-3/6_bawah', $data);
        }else{
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();            
        }
    }
    
    
    public function trans_medcheck_dft() {
        if (akses::aksesLogin() == TRUE) {
            /* -- Grup hak akses -- */
            $role        = $this->input->get('role');
            $tipe        = $this->input->get('tipe');
            $grup        = $this->ion_auth->get_users_groups()->row();
            $id_user     = $this->ion_auth->user()->row()->id;
            $id_grup     = $this->ion_auth->get_users_groups()->row();
            $pengaturan  = $this->db->get('tbl_pengaturan')->row();

            /* -- Blok Filter -- */
            $query   = $this->input->get('q');
            $hal     = $this->input->get('halaman');
            $nt      = $this->input->get('filter_nota');
            $fn      = explode('/', $nt);
            $tg      = $this->input->get('filter_tgl');
            $tb      = $this->input->get('filter_tgl_bayar');
            $tp      = $this->input->get('filter_tgl_tempo');
            $lk      = $this->input->get('filter_lokasi');
            $cs      = $this->input->get('filter_nama');
            $sn      = $this->input->get('filter_status');
            $sl      = $this->input->get('filter_sales');
            $stts    = $this->input->get('status');
            $jml     = $this->input->get('jml');
//            $jml_sql = ($id_grup->name == 'superadmin' || $id_grup->name == 'owner' || $id_grup->name == 'admin' ? $this->db->get('tbl_trans_jual')->num_rows() : $this->db->where('id_user', $id_user)->where('tgl_masuk', date('Y-m-d'))->get('tbl_trans_jual')->num_rows());

            if(!empty($jml)){
                $jml_hal = $jml;
            }else{
                $jml_hal = $this->db->select('*')
                                ->where('status_akt !=', '2')
                                ->where('DATE(tgl_masuk)', (!empty($tg) ? $tg : date('Y-m-d')))
                                ->like('nama', $cs)                                
                                ->group_by('tgl_simpan, nama')
                                ->get('tbl_pendaftaran')->num_rows();
            }
            /* -- End Blok Filter -- */

            /* -- Form Error -- */
            $data['hasError']                = $this->session->flashdata('form_error');

            /* -- Blok Pagination -- */
            $config['base_url']              = base_url('medcheck/data_pendaftaran.php?'.(!empty($cs) ? '&filter_nama='.$cs : '').(!empty($tg) ? '&filter_tgl='.$tg : '').'&jml='.$jml);
            $config['total_rows']            = $jml_hal;

            $config['query_string_segment']  = 'halaman';
            $config['page_query_string']     = TRUE;
            $config['per_page']              = $pengaturan->jml_item;
            $config['num_links']             = 2;

            $config['first_tag_open']        = '<li class="page-item">';
            $config['first_tag_close']       = '</li>';

            $config['prev_tag_open']         = '<li class="page-item">';
            $config['prev_tag_close']        = '</li>';
            
            $config['num_tag_open']          = '<li class="page-item">';
            $config['num_tag_close']         = '</li>';

            $config['next_tag_open']         = '<li class="page-item">';
            $config['next_tag_close']        = '</li>';
            
            $config['last_tag_open']         = '<li class="page-item">';
            $config['last_tag_close']        = '</li>';
            
            $config['cur_tag_open']          = '<li class="page-item"><a href="#" class="page-link text-dark"><b>';
            $config['cur_tag_close']         = '</b></a></li>';
            
            $config['first_link']            = '&laquo;';
            $config['prev_link']             = '&lsaquo;';
            $config['next_link']             = '&rsaquo;';
            $config['last_link']             = '&raquo;';
            $config['anchor_class']          = 'class="page-link"';
            /* -- End Blok Pagination -- */

            if(!empty($hal)){
                   $data['penj'] = $this->db->select('*')
                           ->where('status_hps', '0')
                           ->where('status_akt !=', '2')
                           ->like('DATE(tgl_masuk)', (!empty($tg) ? $tg : ''), (!empty($tg) ? 'none' : ''))
                           ->like('nama', $cs)
                           ->limit($config['per_page'],$hal)
                           ->group_by('tgl_simpan, nama')
                           ->order_by('status_gc','desc')
                           ->get('tbl_pendaftaran')->result();
            }else{
                   $data['penj'] = $this->db->select('*')
                           ->where('status_hps', '0')
                           ->where('status_akt !=', '2')
                           ->like('DATE(tgl_masuk)', (!empty($tg) ? $tg : ''), (!empty($tg) ? 'none' : ''))
                           ->like('nama', $cs)
                           ->limit($config['per_page'])
                           ->group_by('tgl_simpan, nama')
                           ->order_by('status_gc','desc')
                           ->get('tbl_pendaftaran')->result();
            }

            $this->pagination->initialize($config);

            /* Blok pagination */
            $data['total_rows'] = $config['total_rows'];
            $data['PerPage']    = $config['per_page'];
            $data['pagination'] = $this->pagination->create_links();
            $data['cetak']      = '<button type="button" onclick="window.location.href = \''.base_url('transaksi/cetak_data_penj.php?'.(!empty($nt) ? 'filter_nota='.$nt : '').(!empty($tg) ? '&filter_tgl='.$tg : '').(!empty($tp) ? '&filter_tgl_tempo='.$tp : '').(!empty($cs) ? '&filter_cust='.$cs : '').(!empty($sl) ? '&filter_sales='.$sl : '').(!empty($jml) ? '&jml='.$jml : '')).'\'" class="btn btn-warning"><i class="fa fa-print"></i> Cetak</button>';
            /* --End Blok pagination-- */
            
            $data['pengaturan'] = $pengaturan;
            
            /* Sidebar Menu */
            $data['sidebar']    = 'admin-lte-3/includes/medcheck/sidebar_med';
            /* --- Sidebar Menu --- */
            
            /* Load view tampilan */
            $this->load->view('admin-lte-3/1_atas', $data);
            $this->load->view('admin-lte-3/2_header', $data);
            $this->load->view('admin-lte-3/3_navbar', $data);
            $this->load->view('admin-lte-3/includes/medcheck/data_pendf', $data);
            $this->load->view('admin-lte-3/5_footer', $data);
            $this->load->view('admin-lte-3/6_bawah', $data);
        }else{
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();            
        }
    }
        
    public function trans_medcheck_ant() {
        if (akses::aksesLogin() == TRUE) {
            /* -- Grup hak akses -- */
            $role        = $this->input->get('role');
            $tipe        = $this->input->get('tipe');
            $grup        = $this->ion_auth->get_users_groups()->row();
            $id_user     = $this->ion_auth->user()->row()->id;
            $id_grup     = $this->ion_auth->get_users_groups()->row();
            $pengaturan  = $this->db->get('tbl_pengaturan')->row();

            /* -- Blok Filter -- */
            $query   = $this->input->get('q');
            $hal     = $this->input->get('halaman');
            $nt      = $this->input->get('filter_nota');
            $fn      = explode('/', $nt);
            $tg      = $this->input->get('filter_tgl');
            $tb      = $this->input->get('filter_tgl_bayar');
            $tp      = $this->input->get('filter_tgl_tempo');
            $lk      = $this->input->get('filter_lokasi');
            $cs      = $this->input->get('filter_nama');
            $sn      = $this->input->get('filter_status');
            $sl      = $this->input->get('filter_sales');
            $stts    = $this->input->get('status');
            $jml     = $this->input->get('jml');
//            $jml_sql = ($id_grup->name == 'superadmin' || $id_grup->name == 'owner' || $id_grup->name == 'admin' ? $this->db->get('tbl_trans_jual')->num_rows() : $this->db->where('id_user', $id_user)->where('tgl_masuk', date('Y-m-d'))->get('tbl_trans_jual')->num_rows());

            if(!empty($jml)){
                $jml_hal = $jml;
            }else{
                $jml_hal = $this->db->select('*')
                                ->where('status_akt !=', '2')
                                ->where('DATE(tgl_masuk)', (!empty($tg) ? $tg : date('Y-m-d')))
                                ->like('nama', $cs)
                                ->get('tbl_pendaftaran')->num_rows();
            }
            /* -- End Blok Filter -- */

            /* -- Form Error -- */
            $data['hasError']                = $this->session->flashdata('form_error');

            /* -- Blok Pagination -- */
            $config['base_url']              = base_url('medcheck/data_pendaftaran.php?'.(!empty($filter_nama) ? '&filter_nama='.$filter_nama : '').'&jml='.$jml);
            $config['total_rows']            = $jml_hal;

            $config['query_string_segment']  = 'halaman';
            $config['page_query_string']     = TRUE;
            $config['per_page']              = $pengaturan->jml_item;
            $config['num_links']             = 2;

            $config['first_tag_open']        = '<li class="page-item">';
            $config['first_tag_close']       = '</li>';

            $config['prev_tag_open']         = '<li class="page-item">';
            $config['prev_tag_close']        = '</li>';
            
            $config['num_tag_open']          = '<li class="page-item">';
            $config['num_tag_close']         = '</li>';

            $config['next_tag_open']         = '<li class="page-item">';
            $config['next_tag_close']        = '</li>';
            
            $config['last_tag_open']         = '<li class="page-item">';
            $config['last_tag_close']        = '</li>';
            
            $config['cur_tag_open']          = '<li class="page-item"><a href="#" class="page-link text-dark"><b>';
            $config['cur_tag_close']         = '</b></a></li>';
            
            $config['first_link']            = '&laquo;';
            $config['prev_link']             = '&lsaquo;';
            $config['next_link']             = '&rsaquo;';
            $config['last_link']             = '&raquo;';
            $config['anchor_class']          = 'class="page-link"';
            /* -- End Blok Pagination -- */

            if(!empty($hal)){
//                   $data['penj'] = $this->db->select('*')
//                           ->where('status_akt !=', '2')
//                           ->where('DATE(tgl_masuk)', (!empty($tg) ? $tg : date('Y-m-d')))
//                           ->like('nama', $cs)
//                           ->limit($config['per_page'],$hal)
//                           ->order_by('no_urut','asc')
//                           ->get('tbl_pendaftaran')->result();
            }else{
                   $data['penj'] = $this->db->select('*')
                                           ->where('ddate', date('Y-m-d'))->where('status !=', '2')->limit(100)
                                           ->get('tr_queue')->result();
            }

            $this->pagination->initialize($config);

            /* Blok pagination */
            $data['total_rows'] = $config['total_rows'];
            $data['PerPage']    = $config['per_page'];
            $data['pagination'] = $this->pagination->create_links();
            $data['cetak']      = '<button type="button" onclick="window.location.href = \''.base_url('transaksi/cetak_data_penj.php?'.(!empty($nt) ? 'filter_nota='.$nt : '').(!empty($tg) ? '&filter_tgl='.$tg : '').(!empty($tp) ? '&filter_tgl_tempo='.$tp : '').(!empty($cs) ? '&filter_cust='.$cs : '').(!empty($sl) ? '&filter_sales='.$sl : '').(!empty($jml) ? '&jml='.$jml : '')).'\'" class="btn btn-warning"><i class="fa fa-print"></i> Cetak</button>';
            /* --End Blok pagination-- */
            
            /* Sidebar Menu */
            $data['sidebar']    = 'admin-lte-3/includes/medcheck/sidebar_med';
            /* --- Sidebar Menu --- */
            
            /* Load view tampilan */
            $this->load->view('admin-lte-3/1_atas', $data);
            $this->load->view('admin-lte-3/2_header', $data);
            $this->load->view('admin-lte-3/3_navbar', $data);
            $this->load->view('admin-lte-3/includes/medcheck/data_antrian', $data);
            $this->load->view('admin-lte-3/5_footer', $data);
            $this->load->view('admin-lte-3/6_bawah', $data);
        }else{
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();            
        }
    }
    
    public function trans_medcheck_ant_det() {
        if (akses::aksesLogin() == TRUE) {         
            $setting                = $this->db->get('tbl_pengaturan')->row();
            $id_medc                = $this->input->get('id_medc');
            $id                     = $this->input->get('id');
            $id_resep               = $this->input->get('id_resep');
            $id_pasien              = $this->input->get('id_pasien');
            $id_item                = $this->input->get('id_item');
            $id_item_res            = $this->input->get('id_item_resep');
            $dft_id                 = $this->input->get('dft');
            $userid                 = $this->ion_auth->user()->row()->id;
            
            $data['poli']           = $this->db->where('status_ant', '1')->get('tbl_m_poli')->result();
            $data['platform']       = $this->db->get('tbl_m_platform')->result();
            $data['gelar']          = $this->db->get('tbl_m_gelar')->result();
            $data['sql_doc']        = $this->db->where('id_user_group', '10')->get('tbl_m_karyawan')->result();
            $data['kerja']          = $this->db->get('tbl_m_jenis_kerja')->result();
            $data['sql_poli']       = $this->db->where('id', $data['sql_dft_id']->id_poli)->get('tbl_m_poli')->row();
            $data['sql_dft_id']     = $this->db->where('id', general::dekrip($dft_id))->get('tbl_pendaftaran')->row();            
            $data['sql_itm_pas']    = $this->db->select('id, nama, nama_pgl')->get('tbl_m_pasien')->result();
            $data['sql_pas']        = $this->db->where('id', general::dekrip($id_pasien))->get('tbl_m_pasien')->row();
            $data['sql_penjamin']   = $this->db->where('status', '1')->get('tbl_m_penjamin')->result();
            
            if(!empty($id)){
               $data['sql_antrian']    = $this->db->where('id', $id)->get('tr_queue')->row(); 
            }
            
//            echo '<pre>';
//            print_r($_SERVER);
//            echo '</pre>';
            
//            echo BASE_ANTRIAN;
//            echo $_SERVER['SERVER_ADDR'];
            
            /* Sidebar Menu */
            $data['sidebar']    = 'admin-lte-3/includes/medcheck/sidebar_med';
            /* --- Sidebar Menu --- */

            $this->load->view('admin-lte-3/1_atas', $data);
            $this->load->view('admin-lte-3/2_header', $data);
            $this->load->view('admin-lte-3/3_navbar', $data);
            $this->load->view('admin-lte-3/includes/medcheck/data_antrian_det', $data);
            $this->load->view('admin-lte-3/5_footer',$data);
            $this->load->view('admin-lte-3/6_bawah',$data);
        }else{
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();            
        }
    }
    
    public function trans_medcheck_ant_simpan() {
        if (akses::aksesLogin() == TRUE) {
            $id     = $this->input->get('id');
            $ant    = $this->input->get('antrian');
            $typ    = $this->input->get('type');
        }else{
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();            
        }
    }
    
    public function set_data_antrian() {
        $id             = $this->input->get('id');
        $idv            = $this->input->get('id_view');
        $ant            = $this->input->get('antrian');
        $poli           = $this->input->get('poli');
        $sts            = $this->input->get('status_pgl');
        $tipe           = $this->input->get('type');
        $status         = $this->input->get('status');
        $stp            = $this->input->post('status_poli');

        $id['id']       = $id; //$this->input->post('cari');
        $dt['csflagqu'] = $sts;
        $dt['ccustsrv'] = strtoupper($this->session->userdata('nama_lengkap'));
        $dt['cnote']    = (!empty($stp) ? $stp : 'PANGGILAN');
        $dt['csflaghd'] = $this->session->userdata('cs_number');
        $dt['crgcode']  = $this->session->userdata('region');
        $dt['ccode']    = $this->session->userdata('company');
        
        if ($sts == '0') {
            $quevw      = $this->db->select('tr_queue.id, tr_queue.id_dft, tr_queue.id_medcheck, tr_queue.ddate, tr_queue.ddatestart, tr_queue.ddatepross, tr_queue.ddateend, tr_queue.cnoro, tr_queue.ncount, tr_queue.status_pgl AS status')->where('tr_queue.id', $id)->get('tr_queue')->row();
            $sql_medc   = $this->db->where('id', $quevw->id_medcheck)->get('tbl_trans_medcheck');
            $sql_dft    = $this->db->where('id', $quevw->id_dft)->get('tbl_pendaftaran')->row();
            $id_pasien  = ($sql_medc->num_rows() > 0 ? $sql_medc->row()->id_pasien : $sql_dft->id_pasien);
            $nama       = ($sql_medc->num_rows() > 0 ? $sql_medc->row()->pasien : $sql_dft->nama);
            $sql_pas    = $this->db->where('id', $id_pasien)->get('tbl_m_pasien')->row();
            $pasien     = ($sql_medc->num_rows() > 0 ? $sql_pas->nama : $sql_dft->nama);
            
            $nama_poli  = str_replace(' ', '_', strtolower($poli));

            $text       = "Antrian " . (!empty($ant) ? $ant : '0') . " ke " . $poli;
            $text2      = "Pasien " . strtolower($pasien) ." ke " . $poli; // antrian ".$quevw->ncount. "

            // Yes French is a beautiful language.
            $lang       = "en";

            // MP3 filename generated using MD5 hash
            // Added things to prevent bug if you want same sentence in two different languages
            $filename   = substr(md5($lang . "?" . urlencode($text)), 0, 7) . '_' . sprintf('%03d', $quevw->ncount) . '_' . date('Ymd') . '_' . $nama_poli;
            $filename2  =  'pasien_' . $quevw->id . '_' . date('Ymd') . '_' . $nama_poli;

            // Save MP3 file in folder with .mp3 extension 
            $fldr   = realpath('../'.BASE_ANTRIAN.'/scale/audio');
            $file   = $fldr . "/" . $filename . ".mp3";
            $file2  = $fldr . "/" . $filename2 . ".mp3";

            // Check folder exists, if not create it, else verify CHMOD
            if (!is_dir($fldr))
                mkdir($fldr);
            else
            if (substr(sprintf('%o', fileperms('../'.BASE_ANTRIAN.'/scale/audio/')), -4) != "0777")
                chmod("scale/audio/", 0777);


            // If MP3 file exists do not create new request
            if (!file_exists($file2)) {
                // Download content
                $mp3        = file_get_contents('https://translate.google.com/translate_tts?ie=UTF-8&client=tw-ob&q=' . urlencode($text) . '&tl=ID');
                $mp3_jeneng = file_get_contents('https://translate.google.com/translate_tts?ie=UTF-8&client=tw-ob&q=' . urlencode($text2) . '&tl=ID');
                file_put_contents($file, $mp3);
                file_put_contents($file2, $mp3_jeneng);
            }

            $this->db->query("UPDATE tr_queue SET status_pgl='0' WHERE id_view='".$idv."';");
            
            $upd = array(
                'status_pgl' => '0'
            );
            
            $this->db->where('id_view', $idv)->update("tr_queue", $upd);
			
            $dt['ddatepross']   = date('Y-m-d H:i:s');
            $dt['status']       = '1';
            $dt['status_pgl']   = '1';
            $dt['suara']        = $filename.".mp3";
            $dt['suara2']       = (!empty($pasien) ? $filename2.".mp3" : $filename.".mp3");
        }elseif ($sts == '1') {
            $dt['ddateend']     = date('Y-m-d H:i:s');
            $dt['status']       = '2';
            $dt['status_pgl']   = '0';
        }
        
        $id = $this->input->get('id');
        
//        $dt['cUser'] = $this->ion_auth->user()->row()->username;
        $dt['dLastUpdate'] = date('Y-m-d H:i:s');
        
        $this->db->where('id', $id)->update("tr_queue", $dt);

        if ($sts == 'CS') {
            $sts = 'DF';
        }
        
        redirect(base_url('medcheck/data_antrian_det.php?id='.$id.'&antrian='.$ant.'&type='.$tipe.'&status='.$status.'&status_pgl=1&id_view='.$idv.'&poli='.$poli));
    }

    
    public function trans_medcheck_dft_tambah() {
        if (akses::aksesLogin() == TRUE) {
            $setting                = $this->db->get('tbl_pengaturan')->row();
            $id_medc                = $this->input->get('id_medc');
            $id                     = $this->input->get('id');
            $id_resep               = $this->input->get('id_resep');
            $id_pasien              = $this->input->get('id_pasien');
            $id_item                = $this->input->get('id_item');
            $id_item_res            = $this->input->get('id_item_resep');
            $dft_id                 = $this->input->get('dft');
            $userid                 = $this->ion_auth->user()->row()->id;

            $data['poli']           = $this->db->where('status', '1')->where('status_ant', '1')->get('tbl_m_poli')->result();
            $data['platform']       = $this->db->get('tbl_m_platform')->result();
            $data['gelar']          = $this->db->get('tbl_m_gelar')->result();
            $data['sql_doc']        = $this->db->where('id_user_group', '10')->where('status_aps', '0')->get('tbl_m_karyawan')->result();
            $data['kerja']          = $this->db->get('tbl_m_jenis_kerja')->result();
            $data['sql_poli']       = $this->db->where('id', $data['sql_dft_id']->id_poli)->get('tbl_m_poli')->row();
            $data['sql_dft_id']     = $this->db->where('id', general::dekrip($dft_id))->get('tbl_pendaftaran')->row();            
            $data['sql_itm_pas']    = $this->db->select('id, nama, nama_pgl')->get('tbl_m_pasien')->result();
            $data['sql_pas']        = $this->db->where('id', general::dekrip($id_pasien))->get('tbl_m_pasien')->row();
            $data['sql_penjamin']   = $this->db->where('status', '1')->get('tbl_m_penjamin')->result();
            
            if(!empty($id_pasien)){
               $data['pasien']         = $this->db->where('id', general::dekrip($id_pasien))->get('tbl_m_pasien')->row(); 
            }
            
            
            /* Sidebar Menu */
            $data['sidebar']    = 'admin-lte-3/includes/medcheck/sidebar_med';
            /* --- Sidebar Menu --- */

            $this->load->view('admin-lte-3/1_atas', $data);
            $this->load->view('admin-lte-3/2_header', $data);
            $this->load->view('admin-lte-3/3_navbar', $data);
            $this->load->view('admin-lte-3/includes/medcheck/med_daftar', $data);
            $this->load->view('admin-lte-3/5_footer',$data);
            $this->load->view('admin-lte-3/6_bawah',$data);
        }else{
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();            
        }
    }
    
    public function trans_medcheck_dft_gc() {
        if (akses::aksesLogin() == TRUE) {
            $setting             = $this->db->get('tbl_pengaturan')->row();
            $dft_id              = $this->input->get('dft');
            $userid              = $this->ion_auth->user()->row()->id;

            $data['poli']        = $this->db->where('status_ant', '1')->get('tbl_m_poli')->result();
            $data['platform']    = $this->db->get('tbl_m_platform')->result();
            $data['gelar']       = $this->db->get('tbl_m_gelar')->result();
            $data['sql_doc']     = $this->db->where('id_user_group', '10')->get('tbl_m_karyawan')->result();
            $data['kerja']       = $this->db->get('tbl_m_jenis_kerja')->result();
            $data['sql_poli']    = $this->db->where('id', $data['sql_dft_id']->id_poli)->get('tbl_m_poli')->row();
            $data['sql_dft']     = $this->db->where('id', general::dekrip($dft_id))->get('tbl_pendaftaran')->row();            
            
            /* Sidebar Menu */
            $data['sidebar']    = 'admin-lte-3/includes/medcheck/sidebar_med';
            /* --- Sidebar Menu --- */

            $this->load->view('admin-lte-3/1_atas', $data);
            $this->load->view('admin-lte-3/2_header', $data);
            $this->load->view('admin-lte-3/3_navbar', $data);
            $this->load->view('admin-lte-3/includes/medcheck/med_daftar_gc', $data);
            $this->load->view('admin-lte-3/5_footer',$data);
            $this->load->view('admin-lte-3/6_bawah',$data);
        }else{
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();            
        }
    }
    
    public function trans_medcheck_dft_gc_ttd() {
        if (akses::aksesLogin() == TRUE) {
            $setting             = $this->db->get('tbl_pengaturan')->row();
            $dft_id              = $this->input->get('dft');
            $userid              = $this->ion_auth->user()->row()->id;

            $data['sql_dft']     = $this->db->where('id', general::dekrip($dft_id))->get('tbl_pendaftaran')->row();            
            $data['sql_dft_gc']  = $this->db->where('id_pendaftaran', $data['sql_dft']->id)->get('tbl_pendaftaran_gc')->row();            

            /* Sidebar Menu */
            $data['sidebar']    = 'admin-lte-3/includes/medcheck/sidebar_med';
            /* --- Sidebar Menu --- */

            $this->load->view('admin-lte-3/1_atas', $data);
            $this->load->view('admin-lte-3/2_header', $data);
            $this->load->view('admin-lte-3/3_navbar', $data);
            $this->load->view('admin-lte-3/includes/medcheck/med_daftar_gc_ttd', $data);
            $this->load->view('admin-lte-3/5_footer',$data);
            $this->load->view('admin-lte-3/6_bawah',$data);
        }else{
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();            
        }
    }
    
    public function trans_medcheck_dft_gc_det() {
        if (akses::aksesLogin() == TRUE) {
            $setting             = $this->db->get('tbl_pengaturan')->row();
            $dft_id              = $this->input->get('dft');
            $userid              = $this->ion_auth->user()->row()->id;

            $data['sql_dft']     = $this->db->where('id', general::dekrip($dft_id))->get('tbl_pendaftaran')->row();            
            $data['sql_dft_gc']  = $this->db->where('id_pendaftaran', $data['sql_dft']->id)->get('tbl_pendaftaran_gc')->row();            
                        
            /* Sidebar Menu */
            $data['sidebar']    = 'admin-lte-3/includes/medcheck/sidebar_med';
            /* --- Sidebar Menu --- */

            $this->load->view('admin-lte-3/1_atas', $data);
            $this->load->view('admin-lte-3/2_header', $data);
            $this->load->view('admin-lte-3/3_navbar', $data);
            $this->load->view('admin-lte-3/includes/medcheck/med_daftar_gc_det', $data);
            $this->load->view('admin-lte-3/5_footer',$data);
            $this->load->view('admin-lte-3/6_bawah',$data);
        }else{
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();            
        }
    }
    
    public function trans_medcheck_dft_konfirm() {
        if (akses::aksesLogin() == TRUE) {
            $setting                = $this->db->get('tbl_pengaturan')->row();
            $id_medc                = $this->input->get('id_medc');
            $id                     = $this->input->get('dft');
            $id_resep               = $this->input->get('id_resep');
            $id_item                = $this->input->get('id_item');
            $id_item_res            = $this->input->get('id_item_resep');
            $userid                 = $this->ion_auth->user()->row()->id;

            $data['poli']       = $this->db->where('status_ant', '1')->get('tbl_m_poli')->result();
            $data['gelar']      = $this->db->get('tbl_m_gelar')->result();
            $data['sql_doc']    = $this->db->where('id_user_group', '10')->where('status_aps', '0')->get('tbl_m_karyawan')->result();
            $data['kerja']      = $this->db->get('tbl_m_jenis_kerja')->result();
            $data['sql_dft_id'] = $this->db->where('id', general::dekrip($id))->get('tbl_pendaftaran')->row();
            $data['sql_poli']   = $this->db->where('id', $data['sql_dft_id']->id_poli)->get('tbl_m_poli')->row();
            
            /* Sidebar Menu */
            $data['sidebar']    = 'admin-lte-3/includes/medcheck/sidebar_med';
            /* --- Sidebar Menu --- */

            $this->load->view('admin-lte-3/1_atas', $data);
            $this->load->view('admin-lte-3/2_header', $data);
            $this->load->view('admin-lte-3/3_navbar', $data);
            $this->load->view('admin-lte-3/includes/medcheck/med_daftar_konfirm', $data);
            $this->load->view('admin-lte-3/5_footer',$data);
            $this->load->view('admin-lte-3/6_bawah',$data);
        }else{
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();            
        }
    }
    
    public function trans_medcheck_dft_konfirm_simpan() {
        if (akses::aksesLogin() == TRUE) {
            $id           = $this->input->post('id');
            $antrian      = $this->input->post('no_antrian');
            $hadir        = $this->input->post('status_hdr');
            
            $this->form_validation->set_error_delimiters('<div class="alert alert-danger">', '</div>');

            $this->form_validation->set_rules('id', 'NIK', 'required');

            if ($this->form_validation->run() == FALSE) {
                $msg_error = array(
                    'id'     => form_error('id'),
                );

                $this->session->set_flashdata('form_error', $msg_error);
                redirect(base_url('medcheck/data_pendaftaran.php'));
            } else {
                $tmsk    = $this->tanggalan->tgl_indo_sys($tgl_masuk);
                
                $data_pas = array(
                    'tgl_modif'    => date('Y-m-d H:i:s'),
                    'no_urut'      => (int)$antrian,
                    'status_akt'   => '1',
                    'status_hdr'   => $hadir
                );
                
                $this->session->set_flashdata('master', '<div class="alert alert-success">Data member berhasil diubah</div>');
                crud::update('tbl_pendaftaran', 'id', general::dekrip($id), $data_pas);
                $last_id = general::dekrip($id);                
                
                redirect(base_url('medcheck/data_pendaftaran.php?filter_tgl='.date('Y-m-d')));
            }
        }else{
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();            
        }
    }
    
    public function trans_medcheck_dft_simpan() {
        if (akses::aksesLogin() == TRUE) {
            $id_ant       = $this->input->post('id_ant');
            $id_pasien    = $this->input->post('id_pasien');
            $ant          = $this->input->post('antrian');
            $no_rm        = $this->input->post('no_rm');
            $nik_lama     = $this->input->post('nik_lama');
            $nik_baru     = $this->input->post('nik_baru');
            $gelar        = $this->input->post('gelar');
            $nama         = $this->input->post('nama');
            $no_hp        = $this->input->post('no_hp');
            $no_rmh       = $this->input->post('no_rmh');
            $tmp_lahir    = $this->input->post('tmp_lahir');
            $tgl_lahir    = $this->input->post('tgl_lahir');
            $alamat       = $this->input->post('alamat');
            $alamat_dom   = $this->input->post('alamat_dom');
            $jns_klm      = $this->input->post('jns_klm');
            $pekerjaan    = $this->input->post('pekerjaan');
            $tipe_pas     = $this->input->post('tipe_pas');
            $tipe_rwt     = $this->input->post('tipe_rawat');
            $file         = $this->input->post('file');
            $file_id      = $this->input->post('file_id');
            $alergi       = $this->input->post('alergi');
            $inst         = $this->input->post('instansi');
            $inst_alamat  = $this->input->post('instansi_almt');
            
            $tgl_masuk    = $this->input->post('tgl_masuk');
            $plat         = $this->input->post('platform');
            $tipe         = $this->input->post('tipe');
            $poli         = $this->input->post('poli');
            $dokter       = $this->input->post('dokter');
            
            $pengaturan   = $this->db->get('tbl_pengaturan')->row();
            
            // Pilih tipe pasien
            switch ($tipe_pas){ 
                
                default:
                    // value data pasien                        
                    $this->session->set_flashdata('tipe_pas', $tipe_pas);
                    $this->session->set_flashdata('nik_baru', $nik_baru);
                    $this->session->set_flashdata('nama', $nama);
                    $this->session->set_flashdata('tmp_lahir', $tmp_lahir);
                    $this->session->set_flashdata('tgl_lahir', $tgl_lahir);
                    $this->session->set_flashdata('jns_klm', $jns_klm);
                    $this->session->set_flashdata('no_hp', $no_hp);
                    $this->session->set_flashdata('no_rmh', $no_rmh);
                    $this->session->set_flashdata('alamat', $alamat);
                    $this->session->set_flashdata('alamat_dom', $alamat_dom);
                    $this->session->set_flashdata('pekerjaan', $pekerjaan);
                    $this->session->set_flashdata('poli', $poli);
                    $this->session->set_flashdata('plat', $plat);
                    $this->session->set_flashdata('dokter', $dokter);
                    $this->session->set_flashdata('alergi', $alergi);

                    $this->session->set_flashdata('master', '<div class="alert alert-danger">Silahkan pilih tipe pilihan pasien dahulu</div>');
                    redirect(base_url('medcheck/daftar.php'));
                    break;
                
                // Pasien Lama
                case '1':
                    $this->form_validation->set_error_delimiters('<div class="alert alert-danger">', '</div>');
        
                    $this->form_validation->set_rules('gelar', 'Gelar', 'required');
                    $this->form_validation->set_rules('nama', 'Nama Pasien', 'required');
                    $this->form_validation->set_rules('jns_klm', 'Jenis Kelamin', 'required');
                    $this->form_validation->set_rules('platform', 'Platform', 'required');
                    $this->form_validation->set_rules('tipe_rawat', 'Tipe', 'required');
                    
        
                    if ($this->form_validation->run() == FALSE) {
                        $msg_error = array(
                            'gelar'         => form_error('gelar'),
                            'nama'          => form_error('nama'),
                            'jns_klm'       => form_error('jns_klm'),
                            'platform'      => form_error('platform'),
                            'tipe_rawat'    => form_error('tipe_rawat'),
                        );

                        // value data pasien                        
                        $this->session->set_flashdata('tipe_pas', $tipe_pas);
                        $this->session->set_flashdata('nik_baru', $nik_baru);
                        $this->session->set_flashdata('nama', $nama);
                        $this->session->set_flashdata('tmp_lahir', $tmp_lahir);
                        $this->session->set_flashdata('tgl_lahir', $tgl_lahir);
                        $this->session->set_flashdata('jns_klm', $jns_klm);
                        $this->session->set_flashdata('no_hp', $no_hp);
                        $this->session->set_flashdata('no_rmh', $no_rmh);
                        $this->session->set_flashdata('alamat', $alamat);
                        $this->session->set_flashdata('alamat_dom', $alamat_dom);
                        $this->session->set_flashdata('pekerjaan', $pekerjaan);
                        $this->session->set_flashdata('poli', $poli);
                        $this->session->set_flashdata('dokter', $dokter);
                        $this->session->set_flashdata('alergi', $alergi);
                        
                        $this->session->set_flashdata('form_error', $msg_error);
                        redirect(base_url('medcheck/daftar.php?tipe_pas='.$tipe_pas.'&id_ant='.'&id_pasien='.$id_pasien));
                    } else {
                        $tmsk    = $this->tanggalan->tgl_indo_sys($tgl_masuk);
                        $sql_ins = $this->db->where('nama', $inst)->get('tbl_m_pelanggan')->row();
                        $sql_cek1= $this->db->where('id', general::dekrip($id_pasien))->get('tbl_m_pasien');
                        $sql_cek2= $this->db->like('nik', $nik)->get('tbl_m_pasien');
                        
                        if($sql_cek1->num_rows() > 0){
//                            $sql_num    = $this->db->where('DATE(tgl_masuk)', $tmsk)->where('id_poli', $poli)->get('tbl_pendaftaran');
                            $sql_num    = $this->db->select('COUNT(*) AS jml')->where('DATE(tgl_masuk)', $tmsk)->where('id_poli', $poli)->get('tbl_pendaftaran');
                            $pasien     = $sql_cek1->row();
                            $sql_glr    = $this->db->where('id', $pasien->id_gelar)->get('tbl_m_gelar')->row();
//                            $no_urut    = $sql_num->num_rows() + 1;
                            $no_urut    = $sql_num->row()->jml + 1;
                            
                        }elseif($sql_cek2->num_rows() > 0){
//                            $sql_num    = $this->db->where('DATE(tgl_masuk)', $tmsk)->where('id_poli', $poli)->get('tbl_pendaftaran');
                            $sql_num    = $this->db->select('COUNT(*) AS jml')->where('DATE(tgl_masuk)', $tmsk)->where('id_poli', $poli)->get('tbl_pendaftaran');
                            $pasien     = $sql_cek2->row();
                            $sql_glr    = $this->db->where('id', $pasien->id_gelar)->get('tbl_m_gelar')->row();
//                            $no_urut    = $sql_num->num_rows() + 1;
                            $no_urut    = $sql_num->row()->jml + 1;
                            
                        }else{
                            $this->session->set_flashdata('master', '<div class="alert alert-danger">NIK atau No. RM Pasien tidak ditemukan di database !!</div>');
                        }
                        
                        $data_pas = array(
                            'tgl_simpan'   => date('Y-m-d H:i:s'),
                            'tgl_masuk'    => $tmsk.' '.date('H:i:s'),
                            'id_ant'       => (!empty($id_ant) ? $id_ant : 0),
                            'id_pasien'    => general::dekrip($id_pasien),
                            'id_gelar'     => (!empty($gelar) ? $gelar : '0'),
                            'id_poli'      => (!empty($poli) ? $poli : '0'),
                            'id_dokter'    => (!empty($dokter) ? $dokter : '0'),
                            'id_pekerjaan' => (!empty($pekerjaan) ? $pekerjaan : '0'),
                            'id_instansi'  => (!empty($inst) ? $sql_ins->id : '0'),
                            'no_urut'      => $no_urut,
                            'nik'          => $nik_lama,
                            'nama'         => stripslashes($nama),
                            'nama_pgl'     => stripslashes(strtoupper($sql_glr->gelar.' '.$nama)),
                            'tmp_lahir'    => (!empty($tmp_lahir) ? $tmp_lahir : ''),
                            'tgl_lahir'    => (!empty($tgl_lahir) ? $this->tanggalan->tgl_indo_sys($tgl_lahir) : '0000-00-00'),
                            'jns_klm'      => (!empty($jns_klm) ? $jns_klm : 0),
                            'kontak'       => $no_hp,
                            'kontak_rmh'   => $no_rmh,
                            'alamat'       => $alamat,
                            'alamat_dom'   => $alamat_dom,
                            'instansi'          => $inst,
                            'instansi_alamat'   => $inst_alamat,
                            'file_base64'       => $file,
                            'file_base64_id'    => $file_id,
                            'alergi'       => $alergi,
                            'tipe'         => (!empty($tipe) ? $tipe : '0'),
                            'tipe_bayar'   => (!empty($plat) ? $plat : '0'),
                            'tipe_rawat'   => (!empty($tipe_rwt) ? $tipe_rwt : '0'),
                            'status'       => $tipe_pas,
                            'status_akt'   => '0',
                            'status_hdr'   => '0',
                            'status_dft'   => '1',
                        );

                        $this->session->set_flashdata('master', '<div class="alert alert-success">Data member berhasil diubah</div>');

                        $this->db->insert('tbl_pendaftaran', $data_pas);
                        $last_id = crud::last_id();

                        redirect(base_url('medcheck/data_pendaftaran.php?id='.general::enkrip($last_id).'&filter_tgl='.date('Y-m-d')));
                    }
                    break;
                
                // Pasien Baru
                case '2':
                    $this->form_validation->set_error_delimiters('<div class="alert alert-danger">', '</div>');
        
                    $this->form_validation->set_rules('gelar', 'Gelar', 'required');
                    $this->form_validation->set_rules('nama', 'Nama Pasien', 'required');
                    $this->form_validation->set_rules('jns_klm', 'Jenis Kelamin', 'required');
                    $this->form_validation->set_rules('alamat', 'Alamat', 'required');
                    $this->form_validation->set_rules('platform', 'Platform', 'required');
                    $this->form_validation->set_rules('tipe_rawat', 'Tipe', 'required');
        
                    if ($this->form_validation->run() == FALSE) {
                        $msg_error = array(
                            'gelar'     => form_error('gelar'),
                            'nama'      => form_error('nama'),
                            'jns_klm'   => form_error('jns_klm'),
                            'alamat'    => form_error('alamat'),
                            'platform'  => form_error('platform'),
                            'tipe_rawat'=> form_error('tipe_rawat'),
                        );
                        
                        // value data pasien
                        $this->session->set_flashdata('nik_baru', $nik_baru);
                        $this->session->set_flashdata('nama', $nama);
                        $this->session->set_flashdata('tmp_lahir', $tmp_lahir);
                        $this->session->set_flashdata('tgl_lahir', $tgl_lahir);
                        $this->session->set_flashdata('jns_klm', $jns_klm);
                        $this->session->set_flashdata('no_hp', $no_hp);
                        $this->session->set_flashdata('no_rmh', $no_rmh);
                        $this->session->set_flashdata('alamat', $alamat);
                        $this->session->set_flashdata('alamat_dom', $alamat_dom);
                        $this->session->set_flashdata('pekerjaan', $pekerjaan);
                        $this->session->set_flashdata('poli', $poli);
                        $this->session->set_flashdata('dokter', $dokter);
                        $this->session->set_flashdata('alergi', $alergi);
                        
                        $this->session->set_flashdata('form_error', $msg_error);
                        redirect(base_url('medcheck/daftar.php?tipe_pas='.$tipe_pas));
                    } else {
                        $tmsk    = $this->tanggalan->tgl_indo_sys($tgl_masuk);
                        $sql_ins = $this->db->where('nama', $inst)->get('tbl_m_pelanggan')->row();
//                        $sql_num = $this->db->where('DATE(tgl_masuk)', $tmsk)->where('id_poli', $poli)->get('tbl_pendaftaran');
                        $sql_num = $this->db->select('COUNT(*) AS jml')->where('DATE(tgl_masuk)', $tmsk)->where('id_poli', $poli)->get('tbl_pendaftaran');
                        $sql_glr = $this->db->where('id', $gelar)->get('tbl_m_gelar')->row();
                        $kode    = sprintf('%05d', $sql_num);
                        $sql_kat = $this->db->get('tbl_m_kategori');
                        
                        # Check point
                        $this->session->set_userdata('form_timestamp', $this->input->post('timestamp'));
                        
                        $sql_cek = $this->db->where('kode', $no_rm)->get('tbl_pendaftaran');
                        
//                        $no_urut = $sql_num->num_rows() + 1;
                        $no_urut = $sql_num->row()->jml + 1;
                        
                        $data_pas = array(
                            'tgl_simpan'   => date('Y-m-d H:i:s'),
                            'tgl_masuk'    => $tmsk.' '.date('H:i:s'),
                            'id_ant'       => (!empty($id_ant) ? $id_ant : 0),
                            'id_gelar'     => (!empty($gelar) ? $gelar : 0),
                            'id_poli'      => (!empty($poli) ? $poli : 0),
                            'id_dokter'    => (!empty($dokter) ? $dokter : 0),
                            'id_pekerjaan' => (!empty($pekerjaan) ? $pekerjaan : 0),
                            'id_instansi'  => (!empty($inst) ? $sql_ins->id : '0'),
                            'tipe_bayar'   => (!empty($plat) ? $plat : '0'),
                            'no_urut'      => $no_urut,
                            'nik'          => $nik_baru,
                            'nama'         => stripslashes($nama),
                            'nama_pgl'     => stripslashes(strtoupper($sql_glr->gelar.' '.$nama)),
                            'tmp_lahir'    => $tmp_lahir,
                            'tgl_lahir'    => (!empty($tgl_lahir) ? $this->tanggalan->tgl_indo_sys($tgl_lahir) : '0000-00-00'),
                            'jns_klm'      => $jns_klm,
                            'kontak'       => $no_hp,
                            'kontak_rmh'   => $no_rmh,
                            'alamat'       => (!empty($alamat) ? $alamat : ''),
                            'alamat_dom'   => (!empty($alamat_dom) ? $alamat_dom : ''),
                            'instansi'          => $inst,
                            'instansi_alamat'   => $inst_alamat,
                            'file_base64'       => (!empty($file) ? $file : '-'),
                            'file_base64_id'    => $file_id,
                            'alergi'       => $alergi,
                            'tipe'         => (!empty($tipe) ? $tipe : '0'),
                            'tipe_bayar'   => (!empty($plat) ? $plat : '0'),
                            'tipe_rawat'   => (!empty($tipe_rwt) ? $tipe_rwt : '0'),
                            'status'       => $tipe_pas,
                            'status_akt'   => '0'
                        );
                                                
                        # Transact SQL
                        $this->db->trans_off();
                        $this->db->trans_start();
                        
                        # Simpan ke tabel pendaftaran
                        $this->db->insert('tbl_pendaftaran', $data_pas);
                        $last_id = $this->db->insert_id();
                        
                        # Transact SQL End
                        $this->db->trans_complete();
                        
//                        if ($this->db->trans_status() === FALSE) {
//                            # Rollback jika gagal
//                            $this->db->trans_rollback();
//
//                            # Tampilkan pesan error
//                            $this->session->set_flashdata('medcheck', '<div class="alert alert-danger">Pendaftaran pasien gagal !!</div>');
//                        }else{
//                            $this->db->trans_commit();
//                            
//                            # Tampilkan pesan sukses
//                            $this->session->set_flashdata('medcheck', '<div class="alert alert-success">Pendaftaran pasien berhasil !!</div>'); 
//                        }   
//
                        redirect(base_url('medcheck/data_pendaftaran.php?id='.general::enkrip($last_id).'&filter_tgl='.date('Y-m-d')));
                    }
                    break;
            }
        }else{
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();            
        }
    }
    
    public function trans_medcheck_dft_update() {
        if (akses::aksesLogin() == TRUE) {
            $dft          = $this->input->post('id_dft');
            $id_pasien    = $this->input->post('id_pasien');
            $no_rm        = $this->input->post('no_rm');
            $nik_lama     = $this->input->post('nik_lama');
            $nik_baru     = $this->input->post('nik_baru');
            $gelar        = $this->input->post('gelar');
            $nama         = $this->input->post('nama');
            $no_hp        = $this->input->post('no_hp');
            $no_rmh       = $this->input->post('no_rmh');
            $tmp_lahir    = $this->input->post('tmp_lahir');
            $tgl_lahir    = $this->input->post('tgl_lahir');
            $alamat       = $this->input->post('alamat');
            $alamat_dom   = $this->input->post('alamat_dom');
            $jns_klm      = $this->input->post('jns_klm');
            $pekerjaan    = $this->input->post('pekerjaan');
            $tipe_pas     = $this->input->post('tipe_pas');
            $file         = $this->input->post('file');
            $file_id      = $this->input->post('file_id');
            $alergi       = $this->input->post('alergi');
            $inst         = $this->input->post('instansi');
            $inst_alamat  = $this->input->post('instansi_almt');
            
            $tgl_masuk    = $this->input->post('tgl_masuk');
            $plat         = $this->input->post('platform');
            $poli         = $this->input->post('poli');
            $dokter       = $this->input->post('dokter');
            
            $pengaturan = $this->db->get('tbl_pengaturan')->row();
            
            $this->form_validation->set_error_delimiters('<div class="alert alert-danger">', '</div>');

            $this->form_validation->set_rules('gelar', 'Gelar', 'required');
            $this->form_validation->set_rules('nama', 'Nama Pasien', 'required');
            $this->form_validation->set_rules('jns_klm', 'Jenis Kelamin', 'required');
//            $this->form_validation->set_rules('alamat', 'Alamat', 'required');

            if ($this->form_validation->run() == FALSE) {
                $msg_error = array(
                    'gelar'   => form_error('gelar'),
                    'nama'    => form_error('nama'),
                    'jns_klm' => form_error('jns_klm'),
//                    'alamat'  => form_error('alamat'),
                );
                
                // value data pasien
                $this->session->set_flashdata('nik_baru', $nik_baru);
                $this->session->set_flashdata('nama', $nama);
                $this->session->set_flashdata('tmp_lahir', $tmp_lahir);
                $this->session->set_flashdata('tgl_lahir', $tgl_lahir);
                $this->session->set_flashdata('jns_klm', $jns_klm);
                $this->session->set_flashdata('no_hp', $no_hp);
                $this->session->set_flashdata('no_rmh', $no_rmh);
                $this->session->set_flashdata('alamat', $alamat);
                $this->session->set_flashdata('alamat_dom', $alamat_dom);
                $this->session->set_flashdata('pekerjaan', $pekerjaan);
                $this->session->set_flashdata('poli', $poli);
                $this->session->set_flashdata('dokter', $dokter);
                $this->session->set_flashdata('alergi', $alergi);
                
                $this->session->set_flashdata('form_error', $msg_error);
                redirect(base_url('medcheck/daftar.php?tipe_pas='.$tipe_pas));
            } else {
                $tmsk    = $this->tanggalan->tgl_indo_sys($tgl_masuk);
                $sql_num = $this->db->where('DATE(tgl_masuk)', $tmsk)->where('id_poli', $poli)->get('tbl_pendaftaran');
                $sql_glr = $this->db->where('id', $gelar)->get('tbl_m_gelar')->row();
                $kode    = sprintf('%05d', $sql_num);
                $sql_kat = $this->db->get('tbl_m_kategori');
                
                # Check point
                $this->session->set_userdata('form_timestamp', $this->input->post('timestamp'));
                
                $sql_cek = $this->db->where('id', general::dekrip($dft))->get('tbl_pendaftaran');
                
                $no_urut = $sql_num->num_rows() + 1;
                
                $data_pas = array(
                    'tgl_simpan'   => date('Y-m-d H:i:s'),
                    'tgl_masuk'    => date('Y-m-d'),
                    'id_gelar'     => (!empty($gelar) ? $gelar : 0),
                    'id_poli'      => (!empty($poli) ? $poli : 0),
                    'id_dokter'    => (!empty($dokter) ? $dokter : 0),
                    'id_pekerjaan' => (!empty($pekerjaan) ? $pekerjaan : 0),
                    'nik'          => $nik_baru,
                    'nama'         => $nama,
                    'nama_pgl'     => strtoupper($sql_glr->gelar.' '.$nama),
                    'tmp_lahir'    => $tmp_lahir,
                    'tgl_lahir'    => (!empty($tgl_lahir) ? $this->tanggalan->tgl_indo_sys($tgl_lahir) : '0000-00-00'),
                    'jns_klm'      => $jns_klm,
                    'kontak'       => $no_hp,
                    'kontak_rmh'   => $no_rmh,
                    'alamat'       => (!empty($alamat) ? $alamat : ''),
                    'alamat_dom'   => (!empty($alamat_dom) ? $alamat_dom : ''),
                    'instansi'          => $inst,
                    'instansi_alamat'   => $inst_alamat,
                    'file_base64'  => $file,
                    'file_base64_id'=> $file_id,
                    'alergi'       => $alergi,
                    'tipe_bayar'   => (!empty($plat) ? $plat : '0'),
                    'status_akt'   => '0'
                );
                
//                echo general::dekrip($dft);
//                echo '<pre>';
//                print_r($data_pas);
//                echo '</pre>';

                # Transact SQL
                $this->db->trans_off();
                $this->db->trans_start();
                
                # Simpan ke tabel pendaftaran
                $this->db->where('id', general::dekrip($dft))->update('tbl_pendaftaran', $data_pas);
                $last_id = general::dekrip($dft);
                
                # Transact SQL End
                $this->db->trans_complete();
                
//                if ($this->db->trans_status() === FALSE) {
//                    # Rollback jika gagal
//                    $this->db->trans_rollback();
////
//                    # Tampilkan pesan error
//                    $this->session->set_flashdata('medcheck', '<div class="alert alert-danger">Pendaftaran pasien gagal !!</div>');
//                }else{
//                    $this->db->trans_commit();
//                    
//                    # Tampilkan pesan sukses
//                    $this->session->set_flashdata('medcheck', '<div class="alert alert-success">Pendaftaran pasien berhasil !!</div>'); 
//                }           
//
                redirect(base_url('medcheck/data_pendaftaran.php?id='.general::enkrip($last_id).'&filter_tgl='.date('Y-m-d')));
            }
        }else{
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();            
        }
    }
    
    public function trans_medcheck_dft_hapus() {
        if (akses::aksesLogin() == TRUE) {
            $dft          = $this->input->get('id');
            
            if(!empty($dft)){
//                $this->db->where('id', general::dekrip($dft))->delete('tbl_pendaftaran');

//                if($this->db->affected_rows() > 0){
                    $this->db->where('id', general::dekrip($dft))->update('tbl_pendaftaran', array('status_hps'=>'1'));
//                    $this->db->where('id', $sql_dft->id)->update('tbl_pendaftaran', array('status_hps'=>'1'));
                    
                    $this->session->set_flashdata('medcheck_toast', 'toastr.success("Entri pendaftaran berhasil dihapus !");');
//                }else{
//                    $this->session->set_flashdata('medcheck_toast', 'toastr.error("Entri pendaftaran gagal dihapus !");');
//                }
            }
            
            redirect(base_url('medcheck/data_pendaftaran.php'));
        }else{
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();            
        }
    }
    
    public function trans_medcheck() {
        if (akses::aksesLogin() == TRUE) {
            $setting            = $this->db->get('tbl_pengaturan')->row();
            $id                 = $this->input->get('id');
            $id_produk          = $this->input->get('id_produk');
            $id_resep           = $this->input->get('id_resep');
            $id_ass             = $this->input->get('id_ass');
            $id_lab             = $this->input->get('id_lab');
            $id_pen             = $this->input->get('id_pen');
            $id_rad             = $this->input->get('id_rad');
            $id_rsm             = $this->input->get('id_resm');
            $id_item            = $this->input->get('id_item');
            $id_item_res        = $this->input->get('id_item_resep');
            $id_form            = $this->input->get('id_form');
            $id_post            = $this->input->get('id_post');
            $status             = $this->input->get('status');
            $dft_pas            = $this->input->get('dft_pas');
            $dft_id             = $this->input->get('dft_id');
            $userid             = $this->ion_auth->user()->row()->id;
            
            $data['sess_jual']    = $this->session->userdata('trans_medcheck');
            $data['kategori']     = $this->db->get('tbl_m_kategori')->result();
            $data['poli']         = $this->db->where('status','1')->get('tbl_m_poli')->result();
            $data['sql_doc']      = $this->db->where('id_user_group', '10')->where('status_aps', '0')->order_by('nama, status_aps', 'asc')->get('tbl_m_karyawan')->result();              
            $data['sql_doc_rad']  = $this->db->where('id_poli', '76')->order_by('nama', 'asc')->get('v_master_dokter')->result();              
            $data['sql_dft_pas']  = $this->db->where('id', general::dekrip($dft_pas))->get('tbl_m_pasien')->row();
            $data['sql_dft_id']   = $this->db->where('id', general::dekrip($dft_id))->get('tbl_pendaftaran')->row();
            $data['sql_dft_gc']   = $this->db->where('id_pendaftaran', $data['sql_dft_id']->id)->get('tbl_pendaftaran_gc')->row(); 

            if(!empty($data['sess_jual']) OR !empty($id)){
                $data['sql_spirometri']     = $this->db->where('status', '1')->get('tbl_m_kategori_spiro')->result();
                $data['sql_produk']         = $this->db->where('id', general::dekrip($id_produk))->get('tbl_m_produk')->row();
                $data['sql_produk_ip']      = $this->db->where('id_produk', general::dekrip($id_produk))->get('tbl_m_produk_ref_input')->result();
                $data['sql_sat_pake']       = $this->db->get('tbl_m_satuan_pakai')->result();
                $data['sql_kat_lab']        = $this->db->where('status_lab', '1')->get('tbl_m_kategori')->result();                
                $data['sql_kamar']          = $this->db->where('status', '1')->get('tbl_m_kamar');
                $data['sql_medc']           = $this->db->where('id', general::dekrip($id))->get('tbl_trans_medcheck')->row();
                $data['sql_medc_det']       = $this->db->where('id_medcheck', general::dekrip($id))->where('status', $status)->group_by('id_item_kat')->get('tbl_trans_medcheck_det')->result();
                $data['sql_medc_det_rw']    = $this->db->where('id', general::dekrip($id_item))->get('tbl_trans_medcheck_det')->row();
                $data['sql_medc_res']       = $this->db->where('id_medcheck', general::dekrip($id))->get('tbl_trans_medcheck_resep');
                $data['sql_medc_res_rw']    = $this->db->where('id', general::dekrip($id_resep))->get('tbl_trans_medcheck_resep')->row();
                $data['sql_medc_res_m']     = $this->db->where('id_medcheck', general::dekrip($id))->get('tbl_trans_medcheck_resep')->result();
                $data['sql_medc_res_dt']    = $this->db->where('id_medcheck', $data['sql_medc']->id)->where('id_resep', general::dekrip($id_resep))->get('tbl_trans_medcheck_resep_det')->result();
                $data['sql_medc_res_dt_rw'] = $this->db->where('id', general::dekrip($id_item_res))->get('tbl_trans_medcheck_resep_det')->row();
                $data['sql_medc_lab']       = $this->db->where('id_medcheck', general::dekrip($id))->get('tbl_trans_medcheck_lab');
                $data['sql_medc_lab_rw']    = $this->db->where('id', general::dekrip($id_lab))->get('tbl_trans_medcheck_lab')->row();
                $data['sql_medc_lab_m']     = $this->db->where('id_medcheck', general::dekrip($id))->get('tbl_trans_medcheck_lab')->result();
                $data['sql_medc_lab_dt']    = $this->db->where('id_medcheck', general::dekrip($id))->where('id_lab', general::dekrip($id_lab))->where('status', '3')->group_by('id_lab_kat')->get('tbl_trans_medcheck_det')->result();
                $data['sql_medc_lab_spr']   = $this->db->where('id_medcheck', general::dekrip($id))->get('tbl_trans_medcheck_lab_spiro');
                $data['sql_medc_lab_spr_rw']= $this->db->where('id', general::dekrip($id_lab))->get('tbl_trans_medcheck_lab_spiro')->row();
                $data['sql_medc_lab_spr_dt']= $this->db->where('id_lab_spiro', $data['sql_medc_lab_spr_rw']->id)->get('tbl_trans_medcheck_lab_spiro_hsl')->result();
                $data['sql_medc_lab_ekg']   = $this->db->where('id_medcheck', general::dekrip($id))->get('tbl_trans_medcheck_lab_ekg');
                $data['sql_medc_lab_ekg_rw']= $this->db->where('id_medcheck', general::dekrip($id))->get('tbl_trans_medcheck_lab_ekg')->row();
                $data['sql_medc_rm']        = $this->db->where('id_medcheck', general::dekrip($id))->order_by('id', 'desc')->get('tbl_trans_medcheck_rm')->result();
                $data['sql_medc_rm_rw']     = $this->db->where('id', general::dekrip($id_item))->get('tbl_trans_medcheck_rm')->row();
                $data['sql_medc_rad']       = $this->db->where('id_medcheck', general::dekrip($id))->get('tbl_trans_medcheck_rad');
                $data['sql_medc_rad_rw']    = $this->db->where('id_medcheck', general::dekrip($id))->where('id', general::dekrip($id_rad))->get('tbl_trans_medcheck_rad')->row();
                $data['sql_medc_rad_dt']    = $this->db->where('id_medcheck', general::dekrip($id))->where('id_rad', general::dekrip($id_rad))->group_by('id_item_kat')->get('tbl_trans_medcheck_det')->result();
                $data['sql_medc_rsm']       = $this->db->where('id_medcheck', general::dekrip($id))->get('tbl_trans_medcheck_resume');
                $data['sql_medc_rsm_rw']    = $this->db->where('id', general::dekrip($id_rsm))->get('tbl_trans_medcheck_resume')->row();
                $data['sql_medc_rsm_dt']    = $this->db->where('id_medcheck', general::dekrip($id))->where('id_resume', general::dekrip($id_rsm))->get('tbl_trans_medcheck_resume_det')->result();
                $data['sql_medc_rsm_dt2']   = $this->db->where('id_medcheck', general::dekrip($id))->where('id_resume', general::dekrip($id_rsm))->where('status_rnp', '1')->get('tbl_trans_medcheck_resume_det')->result();
                $data['sql_medc_rsm_dt3']   = $this->db->where('id_medcheck', general::dekrip($id))->where('id_resume', general::dekrip($id_rsm))->where('status_trp', '1')->get('tbl_trans_medcheck_resume_det')->result();
                $data['sql_medc_rsm_dt4']   = $this->db->where('id', general::dekrip($id_item))->get('tbl_trans_medcheck_resume_det')->row();
                $data['sql_medc_mcu']       = $this->db->where('id_medcheck', general::dekrip($id))->get('tbl_trans_medcheck_mcu');
//                $data['sql_medc_mcu_rw']= $this->db->where('id_medcheck', general::dekrip($id))->where('id', general::dekrip($id_mcu))->get('tbl_trans_medcheck_mcu')->row();
//                $data['sql_medc_mcu_dt']= $this->db->where('id_medcheck', general::dekrip($id))->where('id_mcu', general::dekrip($id_mcu))->group_by('id_item_kat')->get('tbl_trans_medcheck_det')->result();
                $data['sql_medc_file']      = $this->db->where('id_medcheck', general::dekrip($id))->get('tbl_trans_medcheck_file')->result();
                $data['sql_medc_kmr']       = $this->db->select('tbl_trans_medcheck_kamar.id, tbl_m_kamar.kode, tbl_m_kamar.kamar, tbl_m_kamar.tipe, tbl_trans_medcheck_kamar.id, tbl_trans_medcheck_kamar.id_medcheck, tbl_trans_medcheck_kamar.tgl_simpan, tbl_trans_medcheck_kamar.tgl_simpan, tbl_trans_medcheck_kamar.keterangan')->where('tbl_trans_medcheck_kamar.id_medcheck', general::dekrip($id))->join('tbl_m_kamar', 'tbl_m_kamar.id=tbl_trans_medcheck_kamar.id_kamar')->get('tbl_trans_medcheck_kamar')->result();
                $data['sql_pasien']         = $this->db->where('id', $data['sql_medc']->id_pasien)->get('tbl_m_pasien')->row();
                $data['sql_pasien_poin']    = $this->db->where('id_pasien', $data['sql_medc']->id_pasien)->get('tbl_m_pasien_poin')->row();
                $data['sql_dokter']         = $this->db->where('id_user', $data['sql_medc']->id_dokter)->get('tbl_m_karyawan')->row();
                $data['sql_petugas']        = $this->db->where('id_user', $data['sql_medc']->id_user)->get('tbl_m_karyawan')->row();
                $data['sql_poli']           = $this->db->where('id', $data['sql_medc']->id_poli)->get('tbl_m_poli')->row();
                $data['sql_dft']            = $this->db->where('id', $data['sql_medc']->id_dft)->get('tbl_pendaftaran')->row();
                $data['sql_penjamin']       = $this->db->where('id', $data['sql_medc']->tipe_bayar)->get('tbl_m_penjamin')->row();
                $data['sql_icd']            = $this->db->where('id', $data['sql_medc']->id_icd)->get('tbl_m_icd')->row();
                $data['sql_icd10']          = $this->db->where('id', $data['sql_medc']->id_icd10)->get('tbl_m_icd')->row();
                $data['sql_konsul']         = $this->db->where('id_medcheck', $data['sql_medc']->id)->where('id_parent', '0')->get('tbl_trans_konsul')->result();
                $data['sql_konsul_rw']      = $this->db->where('id', general::dekrip($id_post))->get('tbl_trans_konsul')->row();
                $data['sql_antrian']        = $this->db->where('id_medcheck', $data['sql_medc']->id)->get('tr_queue')->result();
                $data['pengaturan']         = $setting; 
//                $data['sql_konsul_bls']     = $this->db->where('id_parent', general::dekrip($id_post))->get('tbl_trans_konsul')->result();
                
                $st_medrep                  = (!empty($status) ? $status : $data['sql_medc']->status);
                $data['st_medrep']          = $st_medrep;
                
                switch ($st_medrep){                        
                    case '1':
                        $view = 'med_trans_periksa';
                        break;
                    
                    case '2':
                        $view = 'med_trans_tindakan';
                        break;
                    
                    case '3':
                        $data['sql_doc']      = $this->db->where('id_user_group', '10')->order_by('status_aps', 'asc')->get('tbl_m_karyawan')->result();              
                        
                        $view = 'med_trans_lab';
                        break;
                    
                    case '4':
                        $view = 'med_trans_obat';
                        break;
                    
                    case '5':
                        $view = 'med_trans_rad';
                        break;
                    
                    case '6':
                        $data['sql_medc_srt']   = $this->db->where('id_medcheck', general::dekrip($id))->get('tbl_trans_medcheck_surat')->result();
                        $data['sql_medc_srt_dt']= $this->db->where('id', general::dekrip($id_form))->get('tbl_trans_medcheck_surat')->row();
                        
                        # Jika terdapat param id_form tampilkan edit form
                        if(!empty($id_form)){
                            $view = 'med_trans_surat_ubah';
                        }else{
                            $view = 'med_trans_surat';
                        }                        
                        break;
                    
                    case '7':
                        $view = 'med_trans_rm';
                        break;
                    
                    case '8':
                        $view = 'med_trans_upload';
                        break;
                    
                    case '9':
                        $data['sql_medc_ass']   = $this->db->where('id_medcheck', general::dekrip($id))->get('tbl_trans_medcheck_ass_fisik');
                        $data['sql_medc_ass_rw']= $this->db->where('id', general::dekrip($id_ass))->get('tbl_trans_medcheck_ass_fisik')->row();
                        
                        $view = 'med_trans_resume';
                        break;
                    
                    case '10':
                        # Modul MCU
                        $view = 'med_trans_mcu';
                        break;
                    
                    case '11':
                        # Modul untuk rawat bersama
                        $data['sql_raber'] = $this->db->select('tbl_trans_medcheck_dokter.id, tbl_trans_medcheck_dokter.id_medcheck, tbl_trans_medcheck_dokter.id_dokter, tbl_trans_medcheck_dokter.tgl_simpan, tbl_trans_medcheck_dokter.keterangan, tbl_trans_medcheck_dokter.status, tbl_m_karyawan.nama_dpn, tbl_m_karyawan.nama, tbl_m_karyawan.nama_blk')->join('tbl_m_karyawan', 'tbl_m_karyawan.id_user=tbl_trans_medcheck_dokter.id_dokter')->where('tbl_trans_medcheck_dokter.id_medcheck', $data['sql_medc']->id)->get('tbl_trans_medcheck_dokter')->result();
                        
                        $view = 'med_dokter';
                        break;
                    
                    case '12':
                        # Modul untuk kuitansi
                        $data['sql_kwitansi']   = $this->db->where('id_medcheck', $data['sql_medc']->id)->where('status_kwi', '1')->get('tbl_trans_medcheck_kwi')->result();

                        $view = 'med_kwitansi';
                        break;
                    
                    case '13':
                        # Modul untuk Inform Consent
                        $data['sql_medc_inf']   = $this->db->where('id_medcheck', general::dekrip($id))->get('tbl_trans_medcheck_surat_inform')->result();
                        $data['sql_medc_inf_rw']= $this->db->where('id', general::dekrip($id_form))->get('tbl_trans_medcheck_surat_inform')->row();
                        
                        $view = 'med_trans_inform';
                        break;
                    
                    case '14':
                        $data['sql_kamar_rw']   = $this->db->where('id', general::dekrip($id_item))->get('tbl_m_kamar')->row();
                        
                        $view = 'med_trans_kamar';
                        break;
                    
                    case '15':
                        $data['sql_medc_ass']   = $this->db->where('id_medcheck', general::dekrip($id))->get('tbl_trans_medcheck_ass_fisik');
                        $data['sql_medc_ass_rw']= $this->db->where('id', general::dekrip($id_ass))->get('tbl_trans_medcheck_ass_fisik')->row();
                        $data['sql_ass_kiri']   = $this->db->where('status', '1')->where('tipe', '1')->where('status_posisi', 'L')->get('tbl_m_ass_pny');
                        $data['sql_ass_kanan']  = $this->db->where('status', '1')->where('tipe', '1')->where('status_posisi', 'R')->get('tbl_m_ass_pny');
                        $data['sql_ass_ortu']   = $this->db->where('status', '1')->where('tipe', '2')->get('tbl_m_ass_pny');
                        $data['sql_ass_fisik']  = $this->db->where('status', '1')->where('tipe', '3')->get('tbl_m_ass_pny');
                        $data['sql_ass_mata']   = $this->db->where('status', '1')->where('tipe', '4')->get('tbl_m_ass_pny');
                        $data['sql_ass_tht_l']  = $this->db->where('status', '1')->where('tipe', '5')->where('status_posisi', 'L')->get('tbl_m_ass_pny');
                        $data['sql_ass_tht_r']  = $this->db->where('status', '1')->where('tipe', '5')->where('status_posisi', 'R')->get('tbl_m_ass_pny');
                        $data['sql_ass_thrx']   = $this->db->where('status', '1')->where('tipe', '6')->get('tbl_m_ass_pny');
                        $data['sql_ass_paru']   = $this->db->where('status', '1')->where('tipe', '7')->get('tbl_m_ass_pny');
                        $data['sql_ass_jntg']   = $this->db->where('status', '1')->where('tipe', '8')->get('tbl_m_ass_pny');
                        $data['sql_ass_abdmn']  = $this->db->where('status', '1')->where('tipe', '9')->get('tbl_m_ass_pny');
                        $data['sql_ass_urgntl'] = $this->db->where('status', '1')->where('tipe', '10')->get('tbl_m_ass_pny');
                        $data['sql_ass_ekstl']  = $this->db->where('status', '1')->where('tipe', '11')->where('status_posisi', 'L')->get('tbl_m_ass_pny');
                        $data['sql_ass_ekstr']  = $this->db->where('status', '1')->where('tipe', '11')->where('status_posisi', 'R')->get('tbl_m_ass_pny');
                        $data['sql_ass_psi']    = $this->db->where('status', '1')->where('tipe', '12')->get('tbl_m_ass_pny');
                        $data['sql_ass_gigil']  = $this->db->where('status', '1')->where('tipe', '13')->where('status_posisi', 'L')->get('tbl_m_ass_pny');
                        $data['sql_ass_gigir']  = $this->db->where('status', '1')->where('tipe', '13')->where('status_posisi', 'R')->get('tbl_m_ass_pny');
                        $data['sql_ass_syrfl']  = $this->db->where('status', '1')->where('tipe', '14')->where('status_posisi', 'L')->get('tbl_m_ass_pny');
                        $data['sql_ass_syrfr']  = $this->db->where('status', '1')->where('tipe', '14')->where('status_posisi', 'R')->get('tbl_m_ass_pny');
                        $data['sql_ass_riw1']   = $this->db->where('status', '1')->where('tipe', '15')->get('tbl_m_ass_pny');
                        $data['sql_ass_riw2']   = $this->db->where('status', '1')->where('tipe', '16')->get('tbl_m_ass_pny');
                        
                        $view = 'med_trans_ass_fisik';
                        break;
                    
                    case '16':
                        $data['sql_ass_rnp']        = $this->db->where('id_medcheck', $data['sql_medc']->id)->get('tbl_trans_medcheck_ass_ranap')->row();
                        $data['sql_ass_rnp_obt']    = $this->db->where('id_ass_ranap', $data['sql_ass_rnp']->id)->get('tbl_trans_medcheck_ass_ranap_obat')->result();

                        $view = 'med_trans_ass_ranap';
                        break;
                    
                    # Pemeriksaan Penunjang
                    case '17':
                        $data['sql_medc_hrv']       = $this->db->where('id_medcheck', general::dekrip($id))->get('tbl_trans_medcheck_pen_hrv');
                        $data['sql_medc_hrv_rw']    = $this->db->where('id', general::dekrip($id_pen))->get('tbl_trans_medcheck_pen_hrv')->row();
                        
                        $data['sql_medc_ekg_file']  = $this->db->where('id_medcheck', general::dekrip($id))->get('tbl_trans_medcheck_lab_ekg_file')->result();
                        $data['sql_medc_ass']       = $this->db->where('id_medcheck', general::dekrip($id))->get('tbl_trans_medcheck_ass_fisik');
                        $data['sql_medc_ass_rw']    = $this->db->where('id', general::dekrip($id_ass))->get('tbl_trans_medcheck_ass_fisik')->row();
                        $data['sql_ass_kiri']       = $this->db->where('status', '1')->where('tipe', '1')->where('status_posisi', 'L')->get('tbl_m_ass_pny');
                        $data['sql_ass_kanan']      = $this->db->where('status', '1')->where('tipe', '1')->where('status_posisi', 'R')->get('tbl_m_ass_pny');
                        $data['sql_ass_ortu']       = $this->db->where('status', '1')->where('tipe', '2')->get('tbl_m_ass_pny');
                        $data['sql_ass_fisik']      = $this->db->where('status', '1')->where('tipe', '3')->get('tbl_m_ass_pny');
                        $data['sql_ass_mata']       = $this->db->where('status', '1')->where('tipe', '4')->get('tbl_m_ass_pny');
                        $data['sql_ass_tht_l']      = $this->db->where('status', '1')->where('tipe', '5')->where('status_posisi', 'L')->get('tbl_m_ass_pny');
                        $data['sql_ass_tht_r']      = $this->db->where('status', '1')->where('tipe', '5')->where('status_posisi', 'R')->get('tbl_m_ass_pny');
                        $data['sql_ass_thrx']       = $this->db->where('status', '1')->where('tipe', '6')->get('tbl_m_ass_pny');
                        $data['sql_ass_paru']       = $this->db->where('status', '1')->where('tipe', '7')->get('tbl_m_ass_pny');
                        $data['sql_ass_jntg']       = $this->db->where('status', '1')->where('tipe', '8')->get('tbl_m_ass_pny');
                        $data['sql_ass_abdmn']      = $this->db->where('status', '1')->where('tipe', '9')->get('tbl_m_ass_pny');
                        $data['sql_ass_urgntl']     = $this->db->where('status', '1')->where('tipe', '10')->get('tbl_m_ass_pny');
                        $data['sql_ass_ekstl']      = $this->db->where('status', '1')->where('tipe', '11')->where('status_posisi', 'L')->get('tbl_m_ass_pny');
                        $data['sql_ass_ekstr']      = $this->db->where('status', '1')->where('tipe', '11')->where('status_posisi', 'R')->get('tbl_m_ass_pny');
                        $data['sql_ass_psi']        = $this->db->where('status', '1')->where('tipe', '12')->get('tbl_m_ass_pny');
                        $data['sql_ass_gigil']      = $this->db->where('status', '1')->where('tipe', '13')->where('status_posisi', 'L')->get('tbl_m_ass_pny');
                        $data['sql_ass_gigir']      = $this->db->where('status', '1')->where('tipe', '13')->where('status_posisi', 'R')->get('tbl_m_ass_pny');
                        $data['sql_ass_syrfl']      = $this->db->where('status', '1')->where('tipe', '14')->where('status_posisi', 'L')->get('tbl_m_ass_pny');
                        $data['sql_ass_syrfr']      = $this->db->where('status', '1')->where('tipe', '14')->where('status_posisi', 'R')->get('tbl_m_ass_pny');
                        $data['sql_ass_riw1']       = $this->db->where('status', '1')->where('tipe', '15')->get('tbl_m_ass_pny');
                        $data['sql_ass_riw2']       = $this->db->where('status', '1')->where('tipe', '16')->get('tbl_m_ass_pny');
                        
                        $view = 'med_trans_pen';
                        break;
                    
                    # Tracer Pengunjung
                    case '18':
                        $view = 'med_trans_tracer';
                        break;
                    
                    # Tracer Pengunjung
                    case '19':
                        $sql_jml_dp             = $this->db->select_sum('nominal')->where('id_medcheck', $data['sql_medc']->id)->get('tbl_trans_medcheck_kwi')->row();
                        $sql_jml_tot            = $this->db->select_sum('subtotal')->where('id_medcheck', $data['sql_medc']->id)->get('tbl_trans_medcheck_det')->row();
                        
                        $data['jml_total']      = $sql_jml_tot->subtotal - $sql_jml_dp->nominal;
                        $data['sql_kwitansi']   = $this->db->where('id_medcheck', $data['sql_medc']->id)->where('status_kwi', '2')->get('tbl_trans_medcheck_kwi')->result();
                                                
                        $view = 'med_bayar_dp';
                        break;
                    
                    # TPP
                    case '20':
                        $sql_jml_dp             = $this->db->select_sum('nominal')->where('id_medcheck', $data['sql_medc']->id)->get('tbl_trans_medcheck_kwi')->row();
                        $sql_jml_tot            = $this->db->select_sum('subtotal')->where('id_medcheck', $data['sql_medc']->id)->get('tbl_trans_medcheck_det')->row();
                        
                        $data['jml_total']      = $sql_jml_tot->subtotal;
                        $data['sql_kwitansi']   = $this->db->where('id_medcheck', $data['sql_medc']->id)->where('status_kwi', '3')->get('tbl_trans_medcheck_kwi');
                                                
                        $view = 'med_bayar_tpp';
                        break;
                    
                    # Grafik Pantauan TTV
                    case '21':
                        $data['sql_ttv'] = $this->db
                                                   ->where('id_medcheck', $data['sql_medc']->id)
                                                   ->order_by('id', 'asc')
                                                   ->get('v_medcheck_rm')->result();
                                                
                        $view = 'med_trans_rm_ttv';
                        break;
                }
            }
            
            /* Sidebar Menu */
            $data['sidebar']    = 'admin-lte-3/includes/medcheck/sidebar_med';
            /* --- Sidebar Menu --- */

            $this->load->view('admin-lte-3/1_atas', $data);
            $this->load->view('admin-lte-3/2_header', $data);
            $this->load->view('admin-lte-3/3_navbar', $data);
            $this->load->view('admin-lte-3/includes/medcheck/'.(!empty($view) ? $view : 'med_trans'), $data);
            $this->load->view('admin-lte-3/5_footer',$data);
            $this->load->view('admin-lte-3/6_bawah',$data);
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }
    
    public function trans_medcheck_retur() {
        if (akses::aksesLogin() == TRUE) {
            $setting            = $this->db->get('tbl_pengaturan')->row();
            $id                 = $this->input->get('pasien');
            $id_produk          = $this->input->get('id_produk');
            $id_resep           = $this->input->get('id_resep');
            $id_lab             = $this->input->get('id_lab');
            $id_item            = $this->input->get('id_item');
            $status             = $this->input->get('status');
            $dft_pas            = $this->input->get('dft_pas');
            $dft_id             = $this->input->get('dft_id');
            $userid             = $this->ion_auth->user()->row()->id;

            $data['sess_retur']   = $this->session->userdata('trans_medcheck_retur');
            $data['sql_doc']      = $this->db->where('id_user_group', '10')->get('tbl_m_karyawan')->result();
            $data['sql_medc']     = $this->db->where('id', general::dekrip($id))->get('tbl_trans_medcheck')->row();
            $data['sql_pas']      = $this->db->where('id', $data['sql_medc']->id_pasien)->get('tbl_m_pasien')->row();

            if(!empty($data['sess_retur'])){
                $data['sql_medc_row']   = $this->db->where('id', $data['sess_retur']['id'])->get('tbl_trans_medcheck')->row();
                $data['sql_medc_det']   = $this->db->where('id_medcheck', general::dekrip($id))->group_by('id_item_kat')->get('tbl_trans_medcheck_det')->result();            
                $data['sql_medc_retur'] = $this->db->where('id_medcheck', general::dekrip($id))->get('tbl_trans_medcheck_retur')->result(); 
                $data['sql_produk']     = $this->db->where('id', general::dekrip($id_produk))->get('tbl_m_produk')->row();          
                $data['sql_pasien']     = $this->db->where('id', $data['sql_medc_row']->id_pasien)->get('tbl_m_pasien')->row();
                $data['sql_dokter']     = $this->db->where('id', $data['sql_medc_row']->id_dokter)->get('tbl_m_karyawan')->row();
                $data['sql_poli']       = $this->db->where('id', $data['sql_medc_row']->id_poli)->get('tbl_m_poli')->row();              
            }

            /* Sidebar Menu */
            $data['sidebar']    = 'admin-lte-3/includes/medcheck/sidebar_med';
            /* --- Sidebar Menu --- */

            $this->load->view('admin-lte-3/1_atas', $data);
            $this->load->view('admin-lte-3/2_header', $data);
            $this->load->view('admin-lte-3/3_navbar', $data);
            $this->load->view('admin-lte-3/includes/medcheck/med_trans_retur', $data);
            $this->load->view('admin-lte-3/5_footer',$data);
            $this->load->view('admin-lte-3/6_bawah',$data);
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }
    
    public function trans_medcheck_retur_ranap() {
        if (akses::aksesLogin() == TRUE) {
            $setting            = $this->db->get('tbl_pengaturan')->row();
            $id                 = $this->input->get('id');
            $id_produk          = $this->input->get('id_produk');
            $id_resep           = $this->input->get('id_resep');
            $id_lab             = $this->input->get('id_lab');
            $id_item            = $this->input->get('id_item');
            $status             = $this->input->get('status');
            $dft_pas            = $this->input->get('dft_pas');
            $dft_id             = $this->input->get('dft_id');
            $userid             = $this->ion_auth->user()->row()->id;

            $data['sess_retur']   = $this->session->userdata('trans_medcheck_retur');
            $data['sql_doc']      = $this->db->where('id_user_group', '10')->get('tbl_m_karyawan')->result();              
            $data['sql_dft_pas']  = $this->db->where('id', general::dekrip($dft_pas))->get('tbl_m_pasien')->row();
            $data['sql_dft_id']   = $this->db->where('id', general::dekrip($dft_id))->get('tbl_pendaftaran')->row();
            $data['sql_medc']       = $this->db->where('id', general::dekrip($id))->get('tbl_trans_medcheck')->row();

            if(!empty($id)){
                $data['sql_medc_det']   = $this->db->select('tbl_trans_medcheck_det.id, tbl_trans_medcheck_det.id_medcheck, tbl_trans_medcheck_det.id_item_kat, tbl_m_kategori.keterangan, tbl_m_kategori.kategori')->join('tbl_m_kategori', 'tbl_m_kategori.id=tbl_trans_medcheck_det.id_item_kat')->where('tbl_trans_medcheck_det.id_medcheck', general::dekrip($id))->group_by('tbl_trans_medcheck_det.id_item_kat')->get('tbl_trans_medcheck_det')->result();            
                $data['sql_medc_retur'] = $this->db->where('id_medcheck', general::dekrip($id))->get('tbl_trans_medcheck_retur')->result(); 
                $data['sql_produk']     = $this->db->where('id', general::dekrip($id_produk))->get('tbl_m_produk')->row();          
                $data['sql_pasien']     = $this->db->where('id', $data['sql_medc']->id_pasien)->get('tbl_m_pasien')->row();
                $data['sql_dokter']     = $this->db->where('id', $data['sql_medc']->id_dokter)->get('tbl_m_karyawan')->row();
                $data['sql_poli']       = $this->db->where('id', $data['sql_medc']->id_poli)->get('tbl_m_poli')->row();              
            }

            /* Sidebar Menu */
            $data['sidebar']    = 'admin-lte-3/includes/medcheck/sidebar_med';
            /* --- Sidebar Menu --- */

            $this->load->view('admin-lte-3/1_atas', $data);
            $this->load->view('admin-lte-3/2_header', $data);
            $this->load->view('admin-lte-3/3_navbar', $data);
            $this->load->view('admin-lte-3/includes/medcheck/med_trans_retur_rnp', $data);
            $this->load->view('admin-lte-3/5_footer',$data);
            $this->load->view('admin-lte-3/6_bawah',$data);
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }

    public function trans_medcheck_tindakan() {
        if (akses::aksesLogin() == TRUE) {
            $setting              = $this->db->get('tbl_pengaturan')->row();
            $id                   = $this->input->get('id');
            $id_produk            = $this->input->get('id_produk');
            $status               = $this->input->get('status');
            $dft                  = $this->input->get('dft');
            $userid               = $this->ion_auth->user()->row()->id;
            

            $data['sess_jual']    = $this->session->userdata('trans_medcheck');
            $data['kategori']     = $this->db->get('tbl_m_kategori')->result();
            $data['poli']         = $this->db->get('tbl_m_poli')->result();
            $data['sql_doc']      = $this->db->where('status', '2')->get('tbl_m_sales')->result();

            if(!empty($id)){
                $data['sql_produk']         = $this->db->where('id', general::dekrip($id_produk))->get('tbl_m_produk')->row();
                $data['sql_medc']           = $this->db->where('id', general::dekrip($id))->get('tbl_trans_medcheck')->row();
                $data['sql_medc_det']       = $this->db->select('tbl_trans_medcheck_det.id, tbl_trans_medcheck_det.id_medcheck, tbl_trans_medcheck_det.id_item_kat, tbl_m_kategori.keterangan, tbl_m_kategori.kategori')->join('tbl_m_kategori', 'tbl_m_kategori.id=tbl_trans_medcheck_det.id_item_kat')->where('tbl_trans_medcheck_det.id_medcheck', general::dekrip($id))->where('tbl_trans_medcheck_det.status_pkt', '0')->group_by('tbl_trans_medcheck_det.id_item_kat')->get('tbl_trans_medcheck_det')->result();
                $data['sql_medc_plat']      = $this->db->where('id', $data['sql_medc']->metode)->get('tbl_m_platform')->row();
                $data['sql_dft']            = $this->db->where('id', $data['sql_medc']->id_dft)->get('tbl_pendaftaran')->row();
                $data['sql_dft_gc']         = $this->db->where('id_pendaftaran', $data['sql_dft']->id)->get('tbl_pendaftaran_gc')->row();
                $data['sql_poli']           = $this->db->where('id', $data['sql_medc']->id_poli)->get('tbl_m_poli')->row();         
                $data['sql_pasien']         = $this->db->where('id', $data['sql_medc']->id_pasien)->get('tbl_m_pasien')->row();
                $data['sql_pasien_poin']    = $this->db->where('id_pasien', $data['sql_medc']->id_pasien)->get('tbl_m_pasien_poin')->row();
                $data['sql_dokter']         = $this->db->where('id_user', $data['sql_medc']->id_dokter)->get('tbl_m_karyawan')->row();
                $data['sql_petugas']        = $this->db->where('id_user', $data['sql_medc']->id_user)->get('tbl_m_karyawan')->row();
                $data['sql_penjamin']       = $this->db->where('id', $data['sql_medc']->tipe_bayar)->get('tbl_m_penjamin')->row();
                $data['sql_penjamin2']      = $this->db->where('status', '1')->get('tbl_m_penjamin')->result();
                $data['sql_icd']            = $this->db->where('id', $data['sql_medc']->id_icd)->get('tbl_m_icd')->row();
                $data['sql_icd10']          = $this->db->where('id', $data['sql_medc']->id_icd10)->get('tbl_m_icd')->row();
                $data['sql_antrian']        = $this->db->where('id_medcheck', $data['sql_medc']->id)->get('tr_queue')->result();
                $data['pengaturan']         = $setting;
            }
            
            /* Sidebar Menu */
            $data['sidebar']    = 'admin-lte-3/includes/medcheck/sidebar_med';
            /* --- Sidebar Menu --- */

            $this->load->view('admin-lte-3/1_atas', $data);
            $this->load->view('admin-lte-3/2_header', $data);
            $this->load->view('admin-lte-3/3_navbar', $data);
            $this->load->view('admin-lte-3/includes/medcheck/med_tindakan', $data);
            $this->load->view('admin-lte-3/5_footer',$data);
            $this->load->view('admin-lte-3/6_bawah',$data);
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }

    public function trans_medcheck_trf() {
        if (akses::aksesLogin() == TRUE) {
            $setting              = $this->db->get('tbl_pengaturan')->row();
            $id                   = $this->input->get('id');
            $id_produk            = $this->input->get('id_produk');
            $status               = $this->input->get('status');
            $dft                  = $this->input->get('dft');
            $userid               = $this->ion_auth->user()->row()->id;

            $data['sess_jual']    = $this->session->userdata('trans_medcheck');
            $data['kategori']     = $this->db->get('tbl_m_kategori')->result();
            $data['poli']         = $this->db->where('status', '1')->get('tbl_m_poli')->result();
            $data['sql_doc']      = $this->db->where('id_user_group', '10')->where('status_aps', '0')->get('tbl_m_karyawan')->result();

            if(!empty($id)){
                $data['sql_produk']     = $this->db->where('id', general::dekrip($id_produk))->get('tbl_m_produk')->row();
                $data['sql_medc']       = $this->db->where('id', general::dekrip($id))->get('tbl_trans_medcheck')->row();
                $data['sql_medc_det']   = $this->db->where('id_medcheck', general::dekrip($id))->group_by('id_item_kat')->get('tbl_trans_medcheck_det')->result();            
                $data['sql_medc_trf']   = $this->db->where('id_medcheck', general::dekrip($id))->get('tbl_trans_medcheck_trf')->result();            
                $data['sql_pasien']     = $this->db->where('id', $data['sql_medc']->id_pasien)->get('tbl_m_pasien')->row();
                $data['sql_dokter']     = $this->db->where('id_user', $data['sql_medc']->id_dokter)->get('tbl_m_karyawan')->row();
                $data['sql_poli']       = $this->db->where('id', $data['sql_medc']->id_poli)->get('tbl_m_poli')->row();  
                $data['sql_petugas']    = $this->db->where('id_user', $data['sql_medc']->id_user)->get('tbl_m_karyawan')->row();
                $data['sql_dft']        = $this->db->where('id', $data['sql_medc']->id_dft)->get('tbl_pendaftaran')->row();
                $data['sql_kamar']      = $this->db->get('v_trans_kamar');
                $data['sql_penjamin']   = $this->db->where('id', $data['sql_medc']->tipe_bayar)->get('tbl_m_penjamin')->row();
            }
            
            /* Sidebar Menu */
            $data['sidebar']    = 'admin-lte-3/includes/medcheck/sidebar_med';
            /* --- Sidebar Menu --- */

            $this->load->view('admin-lte-3/1_atas', $data);
            $this->load->view('admin-lte-3/2_header', $data);
            $this->load->view('admin-lte-3/3_navbar', $data);
            $this->load->view('admin-lte-3/includes/medcheck/med_transfer', $data);
            $this->load->view('admin-lte-3/5_footer',$data);
            $this->load->view('admin-lte-3/6_bawah',$data);
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }
        
    public function trans_medcheck_detail() {
        if (akses::aksesLogin() == TRUE) {
            $setting              = $this->db->get('tbl_pengaturan')->row();
            $id                   = $this->input->get('id');
            $id_produk            = $this->input->get('id_produk');
            $status               = $this->input->get('status');
            $dft                  = $this->input->get('dft');
            $userid               = $this->ion_auth->user()->row()->id;

            $data['sess_jual']    = $this->session->userdata('trans_medcheck');
            $data['kategori']     = $this->db->get('tbl_m_kategori')->result();
            $data['poli']         = $this->db->get('tbl_m_poli')->result();
            $data['sql_doc']      = $this->db->where('status', '2')->get('tbl_m_sales')->result();

            if(!empty($id)){
                $data['sql_produk']     = $this->db->where('id', general::dekrip($id_produk))->get('tbl_m_produk')->row();
                $data['sql_medc']       = $this->db->where('id', general::dekrip($id))->get('tbl_trans_medcheck')->row();
                $data['sql_medc_det']   = $this->db->where('id_medcheck', general::dekrip($id))->where('status_pkt', '0')->group_by('id_item_kat')->get('tbl_trans_medcheck_det')->result();            
                $data['sql_pasien']     = $this->db->where('id', $data['sql_medc']->id_pasien)->get('tbl_m_pasien')->row();
                $data['sql_dokter']     = $this->db->where('id', $data['sql_medc']->id_dokter)->get('tbl_m_karyawan')->row();
                $data['sql_poli']       = $this->db->where('id', $data['sql_medc']->id_poli)->get('tbl_m_poli')->row();  
            }
            
            /* Sidebar Menu */
            $data['sidebar']    = 'admin-lte-3/includes/medcheck/sidebar_med';
            /* --- Sidebar Menu --- */

            $this->load->view('admin-lte-3/1_atas', $data);
            $this->load->view('admin-lte-3/2_header', $data);
            $this->load->view('admin-lte-3/3_navbar', $data);
            $this->load->view('admin-lte-3/includes/medcheck/med_detail', $data);
            $this->load->view('admin-lte-3/5_footer',$data);
            $this->load->view('admin-lte-3/6_bawah',$data);
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }
        
    public function trans_medcheck_detail_kamar() {
        if (akses::aksesLogin() == TRUE) {
            $setting              = $this->db->get('tbl_pengaturan')->row();
            $id                   = $this->input->get('id');
            $userid               = $this->ion_auth->user()->row()->id;

            if(!empty($id)){
                $data['sql_kamar_rw']     = $this->db->where('id', general::dekrip($id))->get('tbl_m_kamar')->row();
                $data['sql_kamar_rs']     = $this->db
                                                 ->select('tbl_trans_medcheck.id, tbl_trans_medcheck.tgl_masuk, tbl_trans_medcheck.tgl_keluar, tbl_trans_medcheck.no_rm, tbl_trans_medcheck.pasien, tbl_trans_medcheck_kamar.id_kamar, tbl_trans_medcheck_kamar.tgl_simpan, tbl_trans_medcheck_kamar.keterangan, tbl_m_pasien.kode_dpn, tbl_m_pasien.kode, tbl_m_pasien.jns_klm')
                                                 ->join('tbl_trans_medcheck', 'tbl_trans_medcheck.id=tbl_trans_medcheck_kamar.id_medcheck')
                                                 ->join('tbl_m_kamar', 'tbl_m_kamar.id=tbl_trans_medcheck_kamar.id_kamar')
                                                 ->join('tbl_m_pasien', 'tbl_m_pasien.id=tbl_trans_medcheck.id_pasien')
                                                 ->where('tbl_trans_medcheck_kamar.id_kamar', $data['sql_kamar_rw']->id)
                                                 ->where('tbl_trans_medcheck_kamar.status', '1')
                                                 ->where('tbl_trans_medcheck.status_bayar', '0')
                                                 ->get('tbl_trans_medcheck_kamar');
            }

            $this->load->view('admin-lte-3/1_atas', $data);
            $this->load->view('admin-lte-3/2_header', $data);
            $this->load->view('admin-lte-3/3_navbar', $data);
            $this->load->view('admin-lte-3/includes/medcheck/med_detail_kamar', $data);
            $this->load->view('admin-lte-3/5_footer',$data);
            $this->load->view('admin-lte-3/6_bawah',$data);
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }
    
    public function trans_medcheck_bayar() {
        if (akses::aksesLogin() == TRUE) {                   
            $id         = $this->input->get('id');
            $id_produk  = $this->input->get('item_id');
            $status     = $this->input->get('status');
            $userid     = $this->ion_auth->user()->row()->id;

            if(!empty($id)){
                $data['setting']        = $this->db->get('tbl_pengaturan')->row();
                $data['sql_medc']       = $this->db->where('id', general::dekrip($id))->get('tbl_trans_medcheck')->row();
                $data['sql_medc_det']   = $this->db->select('tbl_trans_medcheck_det.id, tbl_trans_medcheck_det.id_medcheck, tbl_trans_medcheck_det.id_item_kat, tbl_m_kategori.keterangan, tbl_m_kategori.kategori')->join('tbl_m_kategori', 'tbl_m_kategori.id=tbl_trans_medcheck_det.id_item_kat')->where('tbl_trans_medcheck_det.id_medcheck', general::dekrip($id))->group_by('tbl_trans_medcheck_det.id_item_kat')->get('tbl_trans_medcheck_det')->result();             
                $data['sql_medc_det2']  = $this->db->where('id', general::dekrip($id_produk))->get('tbl_trans_medcheck_det')->row();            
                $data['sql_medc_plat']  = $this->db->where('id_medcheck', general::dekrip($id))->get('v_medcheck_plat')->result();
                $data['sql_produk']     = $this->db->where('id', ($_GET['status'] != '1' ? $data['sql_medc_det2']->id_item : general::dekrip($id_produk)))->get('tbl_m_produk')->row();
                $data['sql_satuan']     = $this->db->get('tbl_m_satuan')->result();
                $data['sql_pasien']     = $this->db->where('id', $data['sql_medc']->id_pasien)->get('tbl_m_pasien')->row();               
                $data['sql_dokter']     = $this->db->where('id_user', $data['sql_medc_det2']->id_dokter)->get('tbl_m_karyawan')->row();               
                $data['sql_platform']   = $this->db->order_by('id', 'asc')->get('tbl_m_platform')->result();
                $data['sql_poin']       = $this->db->where('id_pasien', $data['sql_medc']->id_pasien)->get('tbl_m_pasien_poin')->row();

                $sql_jml_dp             = $this->db->select_sum('nominal')->where('status_kwi', '2')->where('id_medcheck', $data['sql_medc']->id)->get('tbl_trans_medcheck_kwi')->row();
                $sql_jml_tot            = $this->db->select_sum('subtotal')->where('id_medcheck', $data['sql_medc']->id)->get('tbl_trans_medcheck_det')->row();    
                $data['jml_total']      = $sql_jml_tot->subtotal - $sql_jml_dp->nominal;
                $data['jml_total_dp']   = $sql_jml_dp->nominal;
            }
            
            /* Sidebar Menu */
            $data['sidebar']    = 'admin-lte-3/includes/medcheck/sidebar_med';
            /* --- Sidebar Menu --- */

            $this->load->view('admin-lte-3/1_atas', $data);
            $this->load->view('admin-lte-3/2_header', $data);
            $this->load->view('admin-lte-3/3_navbar', $data);
            $this->load->view('admin-lte-3/includes/medcheck/med_bayar', $data);
            $this->load->view('admin-lte-3/5_footer',$data);
            $this->load->view('admin-lte-3/6_bawah',$data);            
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }
    
    public function trans_medcheck_hapus() {
        if (akses::aksesLogin() == TRUE) {
            $id                   = $this->input->get('id');
            $userid               = $this->ion_auth->user()->row()->id;
            
            $sql_medc = $this->db->where('id', general::dekrip($id))->get('tbl_trans_medcheck');
            
            if($sql_medc->num_rows() > 0){
                $this->session->set_flashdata('medcheck', '<div class="alert alert-success">Transaksi berhasil dihapus</div>');
                crud::update('tbl_trans_medcheck', 'id', general::dekrip($id), array('status_hps'=>'1'));
            }
            
            redirect(base_url('medcheck/index.php?tipe='.$sql_medc->row()->tipe));
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }
    
    public function trans_medcheck_restore() {
        if (akses::aksesLogin() == TRUE) {
            $id                   = $this->input->get('id');
            $userid               = $this->ion_auth->user()->row()->id;
            
            $sql_medc = $this->db->where('id', general::dekrip($id))->get('tbl_trans_medcheck');
            
            if($sql_medc->num_rows() > 0){
                $this->session->set_flashdata('medcheck', '<div class="alert alert-success">Transaksi berhasil dihapus</div>');
                crud::update('tbl_trans_medcheck', 'id', general::dekrip($id), array('status_hps'=>'0'));
            }
            
            redirect(base_url('medcheck/index.php?tipe='.$sql_medc->row()->tipe));
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }
    
    public function trans_medcheck_invoice() {
        if (akses::aksesLogin() == TRUE) {                   
            $id                   = $this->input->get('id');
            $id_produk            = $this->input->get('id_produk');
            $status               = $this->input->get('status');
            $userid               = $this->ion_auth->user()->row()->id;

            if(!empty($id)){
                $data['setting']        = $this->db->get('tbl_pengaturan')->row();
                $data['sql_produk']     = $this->db->where('id', general::dekrip($id_produk))->get('tbl_m_produk')->row();
                $data['sql_medc']       = $this->db->where('id', general::dekrip($id))->get('tbl_trans_medcheck')->row();
                $data['sql_medc_det']   = $this->db->where('id_medcheck', general::dekrip($id))->where('status_pkt', '0')->group_by('id_item_kat')->get('tbl_trans_medcheck_det')->result();            
                $data['sql_medc_sum']   = $this->db->select('SUM(diskon) AS diskon, SUM(potongan) AS potongan, SUM(subtotal) AS subtotal')->where('id_medcheck', $data['sql_medc']->id)->get('tbl_trans_medcheck_det')->row();            
                $data['sql_medc_plat']  = $this->db->where('id_medcheck', general::dekrip($id))->get('v_medcheck_plat')->result();            
                $data['sql_medc_file']  = $this->db->where('id_medcheck', general::dekrip($id))->where('status', '3')->get('tbl_trans_medcheck_file')->result();            
                $data['sql_pasien']     = $this->db->where('id', $data['sql_medc']->id_pasien)->get('tbl_m_pasien')->row();
                $data['sql_dokter']     = $this->db->where('id', $data['sql_medc']->id_dokter)->get('tbl_m_karyawan')->row();
                $data['sql_poli']       = $this->db->where('id', $data['sql_medc']->id_poli)->get('tbl_m_poli')->row();
                $data['sql_platform']   = $this->db->get('tbl_m_platform')->result();             
            }

            /* Sidebar Menu */
            $data['sidebar']    = 'admin-lte-3/includes/medcheck/sidebar_med';
            /* --- Sidebar Menu --- */

            $this->load->view('admin-lte-3/1_atas', $data);
            $this->load->view('admin-lte-3/2_header', $data);
            $this->load->view('admin-lte-3/3_navbar', $data);
            $this->load->view('admin-lte-3/includes/medcheck/med_invoice', $data);
            $this->load->view('admin-lte-3/5_footer',$data);
            $this->load->view('admin-lte-3/6_bawah',$data);
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }
    
    public function trans_medcheck_print_dm() {
        if (akses::aksesLogin() == TRUE) {                   
            $id                   = $this->input->get('id');
            $id_produk            = $this->input->get('id_produk');
            $status               = $this->input->get('status');
            $userid               = $this->ion_auth->user()->row()->id;

            if(!empty($id)){
                $data['setting']            = $this->db->get('tbl_pengaturan')->row();
                $data['sql_produk']         = $this->db->where('id', general::dekrip($id_produk))->get('tbl_m_produk')->row();
                $data['sql_medc']           = $this->db->where('id', general::dekrip($id))->get('tbl_trans_medcheck')->row();
                $data['sql_medc_sum']       = $this->db->select('SUM(diskon) AS diskon, SUM(potongan) AS potongan, SUM(potongan_poin) AS potongan_poin, SUM(subtotal) AS subtotal')->where('id_medcheck', $data['sql_medc']->id)->where('status_pkt', '0')->get('tbl_trans_medcheck_det')->row();  //->where('status_pkt', '0')          
                $data['sql_medc_det']       = $this->db->where('id_medcheck', general::dekrip($id))->where('status_pkt', '0')->group_by('id_item_kat')->get('tbl_trans_medcheck_det')->result();            
                $data['sql_medc_plat']      = $this->db->where('id_medcheck', general::dekrip($id))->get('v_medcheck_plat')->result();
                $data['sql_pasien']         = $this->db->where('id', $data['sql_medc']->id_pasien)->get('tbl_m_pasien')->row();
                $data['sql_pasien_poin']    = $this->db->where('id_pasien', $data['sql_medc']->id_pasien)->get('tbl_m_pasien_poin')->row();
                $data['sql_dokter']         = $this->db->where('id', $data['sql_medc']->id_dokter)->get('tbl_m_karyawan')->row();
                $data['sql_poli']           = $this->db->where('id', $data['sql_medc']->id_poli)->get('tbl_m_poli')->row(); 
            }

            /* Sidebar Menu */
            $data['sidebar']    = 'admin-lte-3/includes/medcheck/sidebar_med';
            /* --- Sidebar Menu --- */

//            $this->load->view('admin-lte-3/1_atas', $data);
//            $this->load->view('admin-lte-3/2_header', $data);
//            $this->load->view('admin-lte-3/3_navbar', $data);
            $this->load->view('admin-lte-3/includes/medcheck/med_print_dm', $data);
//            $this->load->view('admin-lte-3/5_footer',$data);
//            $this->load->view('admin-lte-3/6_bawah',$data);
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }
    
    public function trans_medcheck_print_dm_ranap() {
        if (akses::aksesLogin() == TRUE) {                   
            $id                   = $this->input->get('id');
            $id_produk            = $this->input->get('id_produk');
            $status               = $this->input->get('status');
            $userid               = $this->ion_auth->user()->row()->id;

            if(!empty($id)){
                $data['setting']        = $this->db->get('tbl_pengaturan')->row();
                $data['sql_produk']     = $this->db->where('id', general::dekrip($id_produk))->get('tbl_m_produk')->row();
                $data['sql_medc']       = $this->db->where('id', general::dekrip($id))->get('tbl_trans_medcheck')->row();
                $data['sql_medc_sum']   = $this->db->select('SUM(diskon) AS diskon, SUM(potongan) AS potongan, SUM(potongan_poin) AS potongan_poin, SUM(subtotal) AS subtotal')->where('id_medcheck', $data['sql_medc']->id)->where('status_pkt', '0')->get('tbl_trans_medcheck_det')->row();       
                $data['sql_medc_det']   = $this->db->where('id_medcheck', general::dekrip($id))->where('status_pkt', '0')->group_by('id_item_kat')->get('tbl_trans_medcheck_det')->result();            
                $data['sql_medc_plat']  = $this->db->where('id_medcheck', general::dekrip($id))->get('v_medcheck_plat')->result();
                $data['sql_pasien']     = $this->db->where('id', $data['sql_medc']->id_pasien)->get('tbl_m_pasien')->row();
                $data['sql_pasien_poin']= $this->db->where('id_pasien', $data['sql_medc']->id_pasien)->get('tbl_m_pasien_poin')->row();
                $data['sql_dokter']     = $this->db->where('id', $data['sql_medc']->id_dokter)->get('tbl_m_karyawan')->row();
                $data['sql_poli']       = $this->db->where('id', $data['sql_medc']->id_poli)->get('tbl_m_poli')->row();              
            }

            /* Sidebar Menu */
            $data['sidebar']    = 'admin-lte-3/includes/medcheck/sidebar_med';
            /* --- Sidebar Menu --- */

//            $this->load->view('admin-lte-3/1_atas', $data);
//            $this->load->view('admin-lte-3/2_header', $data);
//            $this->load->view('admin-lte-3/3_navbar', $data);
            $this->load->view('admin-lte-3/includes/medcheck/med_print_dm', $data);
//            $this->load->view('admin-lte-3/5_footer',$data);
//            $this->load->view('admin-lte-3/6_bawah',$data);
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }
    
    public function trans_medcheck_tracer() {
        if (akses::aksesLogin() == TRUE) {                   
            $id                         = $this->input->get('id');
            $id_produk                  = $this->input->get('id_produk');
            $status                     = $this->input->get('status');
            $userid                     = $this->ion_auth->user()->row()->id;

            $data['setting']            = $this->db->get('tbl_pengaturan')->row();
            $data['sql_dft']            = $this->db->where('DATE(tgl_masuk)', date('Y-m-d'))->order_by('tgl_masuk', 'asc')->get('tbl_pendaftaran');
            $data['sql_medc_prks']      = $this->db->where('DATE(tgl_simpan)', date('Y-m-d'))->where('tipe !=', '3')->where('status_pos', '0')->where('status_hps', '0')->where('status_periksa', '0')->order_by('id', 'asc')->get('tbl_trans_medcheck');           
            $data['sql_medc_lab']       = $this->db
                                               ->select('tbl_trans_medcheck.id, tbl_trans_medcheck.pasien, tbl_trans_medcheck_lab.tgl_masuk, tbl_trans_medcheck_lab.tgl_modif')
                                               ->join('tbl_trans_medcheck', 'tbl_trans_medcheck.id=tbl_trans_medcheck_lab.id_medcheck')
                                               ->where('DATE(tbl_trans_medcheck.tgl_simpan)', date('Y-m-d'))
                                               ->where('tbl_trans_medcheck.tipe !=', '3')
                                               ->where('tbl_trans_medcheck.status_hps', '0')
//                                               ->where('tbl_trans_medcheck.status_bayar', '0')
                                               ->where('tbl_trans_medcheck_lab.status', '0')
                                               ->get('tbl_trans_medcheck_lab');           
            $data['sql_medc_rad']       = $this->db
                                               ->select('tbl_trans_medcheck.id, tbl_trans_medcheck.pasien, tbl_trans_medcheck_rad.tgl_masuk, tbl_trans_medcheck_rad.tgl_modif')
                                               ->join('tbl_trans_medcheck', 'tbl_trans_medcheck.id=tbl_trans_medcheck_rad.id_medcheck')
                                               ->where('DATE(tbl_trans_medcheck.tgl_simpan)', date('Y-m-d'))
                                               ->where('tbl_trans_medcheck.tipe !=', '3')
                                               ->where('tbl_trans_medcheck.status_hps', '0')
//                                               ->where('tbl_trans_medcheck.status_bayar', '0')
                                               ->where('tbl_trans_medcheck_rad.status', '0')
                                               ->get('tbl_trans_medcheck_rad');        
            $data['sql_medc_res']       = $this->db
                                               ->select('tbl_trans_medcheck.id, tbl_trans_medcheck.pasien, tbl_trans_medcheck_resep.tgl_masuk, tbl_trans_medcheck_resep.tgl_keluar')
                                               ->join('tbl_trans_medcheck', 'tbl_trans_medcheck.id=tbl_trans_medcheck_resep.id_medcheck')
                                               ->where('DATE(tbl_trans_medcheck.tgl_simpan)', date('Y-m-d'))
                                               ->where('tbl_trans_medcheck.tipe !=', '3')
                                               ->where('tbl_trans_medcheck.status_hps', '0')
//                                               ->where('tbl_trans_medcheck.status_bayar', '0')
                                               ->where('tbl_trans_medcheck_resep.status !=', '4')
                                               ->get('tbl_trans_medcheck_resep');
            $data['sql_medc_ksr']       = $this->db->where('DATE(tgl_simpan)', date('Y-m-d'))->where('tipe !=', '3')->where('status >=', '5')->where('status_hps', '0')->get('tbl_trans_medcheck');           
            

            /* Sidebar Menu */
            $data['sidebar']    = 'admin-lte-3/includes/medcheck/sidebar_med';
            /* --- Sidebar Menu --- */

            $this->load->view('admin-lte-3/1_atas', $data);
            $this->load->view('admin-lte-3/2_header', $data);
            $this->load->view('admin-lte-3/3_navbar', $data);
            $this->load->view('admin-lte-3/includes/medcheck/med_tracer', $data);
            $this->load->view('admin-lte-3/5_footer',$data);
            $this->load->view('admin-lte-3/6_bawah',$data);
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }
    

    public function trans_resep_tambah() {
        if (akses::aksesLogin() == TRUE) {
            $setting                = $this->db->get('tbl_pengaturan')->row();
            $id_medc                = $this->input->get('id_medc');
            $id                     = $this->input->get('id');
            $id_resep               = $this->input->get('id_resep');
            $id_item                = $this->input->get('id_item');
            $id_item_res            = $this->input->get('id_item_resep');
            $userid                 = $this->ion_auth->user()->row()->id;

            $data['sess_jual']      = $this->session->userdata('trans_medcheck');
            $data['kategori']       = $this->db->get('tbl_m_kategori')->result();
            $data['poli']           = $this->db->get('tbl_m_poli')->result();
            $data['sql_doc']        = $this->db->where('status', '2')->get('tbl_m_karyawan')->result();

            if(!empty($id)){
                $data['sql_sat_pake']       = $this->db->get('tbl_m_satuan_pakai')->result();
                $data['sql_medc']           = $this->db->where('id', general::dekrip($id))->get('tbl_trans_medcheck')->row();
                $data['sql_medc_det']       = $this->db->where('id_medcheck', $data['sql_medc']->id)->where('status', $status)->group_by('id_item_kat')->get('tbl_trans_medcheck_det')->result();
                $data['sql_medc_det_rw']    = $this->db->where('id', general::dekrip($id_item))->get('tbl_trans_medcheck_det')->row();
                $data['sql_medc_srt']       = $this->db->where('id_medcheck', $data['sql_medc']->id)->get('tbl_trans_medcheck_surat')->result();
                $data['sql_medc_res']       = $this->db->where('id_medcheck', $data['sql_medc']->id)->limit(5)->get('tbl_trans_medcheck_resep');
                $data['sql_medc_res_rw']    = $this->db->where('id', general::dekrip($id_resep))->get('tbl_trans_medcheck_resep')->row();
                $data['sql_medc_res_dt']    = $this->db->where('id_medcheck', $data['sql_medc']->id)->where('id_resep', general::dekrip($id_resep))->get('tbl_trans_medcheck_resep_det')->result();
                $data['sql_medc_res_dt_rw'] = $this->db->where('id', general::dekrip($id_item_res))->get('tbl_trans_medcheck_resep_det')->row();
                $data['sql_produk']         = $this->db->where('id', (!empty($id_item) ? general::dekrip($id_item) : $data['sql_medc_res_dt_rw']->id_item))->get('tbl_m_produk')->row();
                $data['sql_pasien']         = $this->db->where('id', $data['sql_medc']->id_pasien)->get('tbl_m_pasien')->row();
                $data['sql_dokter']         = $this->db->where('id_user', $data['sql_medc']->id_dokter)->get('tbl_m_karyawan')->row();
                $data['sql_poli']           = $this->db->where('id', $data['sql_medc']->id_poli)->get('tbl_m_poli')->row();
            }
            
            /* Sidebar Menu */
            $data['sidebar']    = 'admin-lte-3/includes/medcheck/sidebar_med';
            $data['sidebar']    = 'admin-lte-3/includes/medcheck/sidebar_med';
            /* --- Sidebar Menu --- */

            $this->load->view('admin-lte-3/1_atas', $data);
            $this->load->view('admin-lte-3/2_header', $data);
            $this->load->view('admin-lte-3/3_navbar', $data);
            $this->load->view('admin-lte-3/includes/medcheck/med_trans_resep', $data);
            $this->load->view('admin-lte-3/5_footer',$data);
            $this->load->view('admin-lte-3/6_bawah',$data);
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }

    public function trans_resep_detail() {
        if (akses::aksesLogin() == TRUE) {
            $setting              = $this->db->get('tbl_pengaturan')->row();
            $id_medc              = $this->input->get('id_medc');
            $id                   = $this->input->get('id');
            $userid               = $this->ion_auth->user()->row()->id;

            $data['sess_jual']    = $this->session->userdata('trans_medcheck');
            $data['kategori']     = $this->db->get('tbl_m_kategori')->result();
            $data['poli']         = $this->db->get('tbl_m_poli')->result();
            $data['sql_doc']      = $this->db->where('status', '2')->get('tbl_m_karyawan')->result();

            if(!empty($id)){
                $data['sql_medc']       = $this->db->where('id', general::dekrip($id_medc))->get('tbl_trans_medcheck')->row();
                $data['sql_medc_res_rw']= $this->db->where('id', general::dekrip($id))->get('tbl_trans_medcheck_resep')->row();
                $data['sql_dokter']     = $this->db->where('id', $data['sql_medc']->id_dokter)->get('tbl_m_karyawan')->row();
                $data['sql_poli']       = $this->db->where('id', $data['sql_medc']->id_poli)->get('tbl_m_poli')->row();
                $data['sql_pasien']     = $this->db->where('id', $data['sql_medc']->id_pasien)->get('tbl_m_pasien')->row();
            }
            
            /* Sidebar Menu */
            $data['sidebar']    = 'admin-lte-3/includes/medcheck/sidebar_med';
            /* --- Sidebar Menu --- */

            $this->load->view('admin-lte-3/1_atas', $data);
            $this->load->view('admin-lte-3/2_header', $data);
            $this->load->view('admin-lte-3/3_navbar', $data);
            $this->load->view('admin-lte-3/includes/medcheck/med_trans_resep_det', $data);
            $this->load->view('admin-lte-3/5_footer',$data);
            $this->load->view('admin-lte-3/6_bawah',$data);
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }

    public function trans_resep_konfirm() {
        if (akses::aksesLogin() == TRUE) {
            $setting              = $this->db->get('tbl_pengaturan')->row();
            $id_medc              = $this->input->get('id_medc');
            $id                   = $this->input->get('id');
            $userid               = $this->ion_auth->user()->row()->id;

            $data['sess_jual']    = $this->session->userdata('trans_medcheck');
            $data['kategori']     = $this->db->get('tbl_m_kategori')->result();
            $data['poli']         = $this->db->get('tbl_m_poli')->result();
            $data['sql_doc']      = $this->db->where('status', '2')->get('tbl_m_karyawan')->result();

            if(!empty($id)){
                $data['sql_medc']       = $this->db->where('id', general::dekrip($id))->get('tbl_trans_medcheck')->row();
                $data['sql_dokter']     = $this->db->where('id', $data['sql_medc']->id_dokter)->get('tbl_m_karyawan')->row();
                $data['sql_poli']       = $this->db->where('id', $data['sql_medc']->id_poli)->get('tbl_m_poli')->row();
                $data['sql_pasien']     = $this->db->where('id', $data['sql_medc']->id_pasien)->get('tbl_m_pasien')->row();
            }
            
            /* Sidebar Menu */
            $data['sidebar']    = 'admin-lte-3/includes/medcheck/sidebar_med';
            /* --- Sidebar Menu --- */

            $this->load->view('admin-lte-3/1_atas', $data);
            $this->load->view('admin-lte-3/2_header', $data);
            $this->load->view('admin-lte-3/3_navbar', $data);
            $this->load->view('admin-lte-3/includes/medcheck/med_trans_resep_konfirm', $data);
            $this->load->view('admin-lte-3/5_footer',$data);
            $this->load->view('admin-lte-3/6_bawah',$data);
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }
    


    public function medcheck_kasir_list() {
        if (akses::aksesLogin() == TRUE) {
            /* -- Grup hak akses -- */
            $role        = $this->input->get('role');
            $tipe        = $this->input->get('tipe');
            $grup        = $this->ion_auth->get_users_groups()->row();
            $id_user     = $this->ion_auth->user()->row()->id;
            $id_grup     = $this->ion_auth->get_users_groups()->row();
            $id_dokter   = $this->ion_auth->get_users_groups()->row();
            $pengaturan  = $this->db->get('tbl_pengaturan')->row();

            /* -- Blok Filter -- */
            $query   = $this->input->get('q');
            $hal     = $this->input->get('halaman');
            $nt      = $this->input->get('filter_nota');
            $fn      = explode('/', $nt);
            $tg      = $this->input->get('filter_tgl');
            $tb      = $this->input->get('filter_tgl_bayar');
            $tp      = $this->input->get('filter_tgl_tempo');
            $lk      = $this->input->get('filter_lokasi');
            $cs      = $this->input->get('filter_cust');
            $sn      = $this->input->get('filter_status');
            $sl      = $this->input->get('filter_sales');
            $stts    = $this->input->get('status');
            $jml     = $this->input->get('jml');
            $jml_sql = $this->db->select('id, id_app, id_user, id_dokter, id_nurse, id_analis, id_pasien, id_poli, no_nota, no_rm, tgl_simpan, TIME(tgl_simpan) AS waktu_masuk, DATE(tgl_bayar) as tgl_bayar, DATE(tgl_keluar) as tgl_keluar, TIME(tgl_keluar) AS waktu_keluar, jml_total, jml_gtotal, ppn, jml_ppn, tipe, status, status_nota')
                           ->where('status_hps', '0')
                           ->like('id_dokter', ($id_grup->name == 'dokter' ? $id_user : ''), ($id_grup->name == 'dokter' ? 'none' : ''))
                           ->order_by('id','desc')
                           ->get('tbl_trans_medcheck')->num_rows();

            if(!empty($jml)){
                $jml_hal = $jml_sql;
            }else{
                $jml_hal = $this->db->select('id, id_app, id_user, id_dokter, id_nurse, id_analis, id_pasien, id_poli, no_nota, no_rm, tgl_simpan, TIME(tgl_simpan) AS waktu_masuk, DATE(tgl_bayar) as tgl_bayar, DATE(tgl_keluar) as tgl_keluar, TIME(tgl_keluar) AS waktu_keluar, jml_total, jml_gtotal, ppn, jml_ppn, tipe, status, status_nota, tipe')
                                ->where('status_hps', '0')
                                ->like('id_dokter', ($id_grup->name == 'dokter' ? $id_user : ''), ($id_grup->name == 'dokter' ? 'none' : ''))
                                ->order_by('id','desc')
                                ->get('tbl_trans_medcheck')->num_rows();
            }
            /* -- End Blok Filter -- */

            /* -- Form Error -- */
            $data['hasError']                = $this->session->flashdata('form_error');

            /* -- Blok Pagination -- */
            $config['base_url']              = base_url('medcheck/data_medcheck.php?filter_nota='.$nt.'&filter_tgl='.$tg.'&filter_sales='.$sl.'&filter_status='.$sn.'&jml='.$jml);
            $config['total_rows']            = $jml_hal;

            $config['query_string_segment']  = 'halaman';
            $config['page_query_string']     = TRUE;
            $config['per_page']              = $pengaturan->jml_item;
            $config['num_links']             = 2;

            $config['first_tag_open']        = '<li class="page-item">';
            $config['first_tag_close']       = '</li>';

            $config['prev_tag_open']         = '<li class="page-item">';
            $config['prev_tag_close']        = '</li>';
            
            $config['num_tag_open']          = '<li class="page-item">';
            $config['num_tag_close']         = '</li>';

            $config['next_tag_open']         = '<li class="page-item">';
            $config['next_tag_close']        = '</li>';
            
            $config['last_tag_open']         = '<li class="page-item">';
            $config['last_tag_close']        = '</li>';
            
            $config['cur_tag_open']          = '<li class="page-item"><a href="#" class="page-link text-dark"><b>';
            $config['cur_tag_close']         = '</b></a></li>';
            
            $config['first_link']            = '&laquo;';
            $config['prev_link']             = '&lsaquo;';
            $config['next_link']             = '&rsaquo;';
            $config['last_link']             = '&raquo;';
            $config['anchor_class']          = 'class="page-link"';
            /* -- End Blok Pagination -- */

            if(!empty($hal)){
                   $data['penj'] = $this->db->select('id, id_app, id_user, id_dokter, id_nurse, id_analis, id_pasien, id_poli, no_nota, no_rm, tgl_simpan, TIME(tgl_simpan) AS waktu_masuk, DATE(tgl_bayar) as tgl_bayar, DATE(tgl_keluar) as tgl_keluar, TIME(tgl_keluar) AS waktu_keluar, jml_total, jml_gtotal, ppn, jml_ppn, tipe, status, status_nota, tipe')
                           ->where('status_hps', '0')
                           ->where('status_bayar !=', '1')
                           ->like('id_dokter', ($id_grup->name == 'dokter' ? $id_user : ''), ($id_grup->name == 'dokter' ? 'none' : ''))
                           ->limit($config['per_page'],$hal)
                           ->order_by('id','desc')
                           ->get('tbl_trans_medcheck')->result();
            }else{
                   $data['penj'] = $this->db->select('id, id_app, id_user, id_dokter, id_nurse, id_analis, id_pasien, id_poli, no_nota, no_rm, tgl_simpan, TIME(tgl_simpan) AS waktu_masuk, DATE(tgl_bayar) as tgl_bayar, DATE(tgl_keluar) as tgl_keluar, TIME(tgl_keluar) AS waktu_keluar, jml_total, jml_gtotal, ppn, jml_ppn, tipe, status, status_nota, tipe')
                           ->where('status_hps', '0')
                           ->where('status_bayar !=', '1')
                           ->like('id_dokter', ($id_grup->name == 'dokter' ? $id_user : ''), ($id_grup->name == 'dokter' ? 'none' : ''))
                           ->limit($config['per_page'])
                           ->order_by('id','desc')
                           ->get('tbl_trans_medcheck')->result();
            }
            
            $this->pagination->initialize($config);

            /* Blok pagination */
            $data['total_rows'] = $config['total_rows'];
            $data['PerPage']    = $config['per_page'];
            $data['pagination'] = $this->pagination->create_links();
            $data['cetak']      = '<button type="button" onclick="window.location.href = \''.base_url('transaksi/cetak_data_penj.php?'.(!empty($nt) ? 'filter_nota='.$nt : '').(!empty($tg) ? '&filter_tgl='.$tg : '').(!empty($tp) ? '&filter_tgl_tempo='.$tp : '').(!empty($cs) ? '&filter_cust='.$cs : '').(!empty($sl) ? '&filter_sales='.$sl : '').(!empty($jml) ? '&jml='.$jml : '')).'\'" class="btn btn-warning"><i class="fa fa-print"></i> Cetak</button>';
            /* --End Blok pagination-- */
            
            /* Sidebar Menu */
            $data['sidebar']    = 'admin-lte-3/includes/medcheck/sidebar_med';
            /* --- Sidebar Menu --- */
            
            /* Load view tampilan */
            $this->load->view('admin-lte-3/1_atas', $data);
            $this->load->view('admin-lte-3/2_header', $data);
            $this->load->view('admin-lte-3/3_navbar', $data);
            $this->load->view('admin-lte-3/includes/medcheck/index', $data);
            $this->load->view('admin-lte-3/5_footer', $data);
            $this->load->view('admin-lte-3/6_bawah', $data);
        }else{
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();            
        }
    }
    
    public function medcheck_pemb_list() {
        if (akses::aksesLogin() == TRUE) {
            /* -- Grup hak akses -- */
            $role        = $this->input->get('role');
            $tipe        = $this->input->get('tipe');
            $grup        = $this->ion_auth->get_users_groups()->row();
            $id_user     = $this->ion_auth->user()->row()->id;
            $id_grup     = $this->ion_auth->get_users_groups()->row();
            $pengaturan  = $this->db->get('tbl_pengaturan')->row();

            /* -- Blok Filter -- */
            $query   = $this->input->get('q');
            $hal     = $this->input->get('halaman');
            $nt      = $this->input->get('filter_nota');
            $fn      = explode('/', $nt);
            $tg      = $this->input->get('filter_tgl');
            $tb      = $this->input->get('filter_tgl_bayar');
            $tp      = $this->input->get('filter_tgl_tempo');
            $lk      = $this->input->get('filter_lokasi');
            $cs      = $this->input->get('filter_nama');
            $sn      = $this->input->get('filter_status');
            $sl      = $this->input->get('filter_sales');
            $stts    = $this->input->get('status');
            $jml     = $this->input->get('jml');

            if(!empty($jml)){
                $jml_hal = $jml;
            }else{
                $jml_hal = $this->db
//                                    ->where('status', '5')
                                    ->where('status_bayar !=', '1')
                                    ->like('pasien', $cs)
                                    ->group_by('tgl_masuk, pasien')
                                    ->order_by('tgl_simpan','desc')
                                    ->get('v_medcheck')->num_rows();
            }
            /* -- End Blok Filter -- */

            /* -- Form Error -- */
            $data['hasError']                = $this->session->flashdata('form_error');

            /* -- Blok Pagination -- */
            $config['base_url']              = base_url('medcheck/data_pemb.php?tipe=1'.(!empty($cs) ? '&filter_nama='.$cs : '').(!empty($tg) ? '&filter_tgl='.$tg : '').(!empty($sp) ? '&filter_periksa='.$sp : '').(isset($by) ? '&filter_bayar='.$by : '').(!empty($jml_hal) ? '&jml='.$jml_hal : ''));
            $config['total_rows']            = $jml_hal;

            $config['query_string_segment']  = 'halaman';
            $config['page_query_string']     = TRUE;
            $config['per_page']              = $pengaturan->jml_item;
            $config['num_links']             = 2;

            $config['first_tag_open']        = '<li class="page-item">';
            $config['first_tag_close']       = '</li>';

            $config['prev_tag_open']         = '<li class="page-item">';
            $config['prev_tag_close']        = '</li>';
            
            $config['num_tag_open']          = '<li class="page-item">';
            $config['num_tag_close']         = '</li>';

            $config['next_tag_open']         = '<li class="page-item">';
            $config['next_tag_close']        = '</li>';
            
            $config['last_tag_open']         = '<li class="page-item">';
            $config['last_tag_close']        = '</li>';
            
            $config['cur_tag_open']          = '<li class="page-item"><a href="#" class="page-link text-dark"><b>';
            $config['cur_tag_close']         = '</b></a></li>';
            
            $config['first_link']            = '&laquo;';
            $config['prev_link']             = '&lsaquo;';
            $config['next_link']             = '&rsaquo;';
            $config['last_link']             = '&raquo;';
            $config['anchor_class']          = 'class="page-link"';
            /* -- End Blok Pagination -- */

            if(!empty($hal)){
                   $data['penj'] = $this->db
                                        ->where('status', '5')
                                        ->where('status_bayar !=', '1')
                                        ->like('pasien', $cs)
                                        ->like('DATE(tgl_masuk)', $this->tanggalan->tgl_indo_sys($tg))
                                        ->limit($config['per_page'],$hal)
             //                           ->group_by('tgl_masuk, pasien')
                                        ->order_by('tgl_simpan','desc')
                                        ->get('v_medcheck')->result();
            }else{
                   $data['penj'] = $this->db
                                        ->where('status', '5')
                                        ->where('status_bayar !=', '1')
                                        ->like('pasien', $cs)
                                        ->like('DATE(tgl_masuk)', $this->tanggalan->tgl_indo_sys($tg))
                                        ->limit($config['per_page'])
//                                        ->group_by('tgl_simpan, tgl_masuk, keluhan, tipe, id_pasien, pasien')
                                        ->order_by('tgl_masuk','desc')
                                        ->get('v_medcheck')->result();
            }

            $this->pagination->initialize($config);

            /* Blok pagination */
            $data['total_rows'] = $config['total_rows'];
            $data['PerPage']    = $config['per_page'];
            $data['pagination'] = $this->pagination->create_links();
            $data['cetak']      = '<button type="button" onclick="window.location.href = \''.base_url('transaksi/cetak_data_penj.php?'.(!empty($nt) ? 'filter_nota='.$nt : '').(!empty($tg) ? '&filter_tgl='.$tg : '').(!empty($tp) ? '&filter_tgl_tempo='.$tp : '').(!empty($cs) ? '&filter_cust='.$cs : '').(!empty($sl) ? '&filter_sales='.$sl : '').(!empty($jml) ? '&jml='.$jml : '')).'\'" class="btn btn-warning"><i class="fa fa-print"></i> Cetak</button>';
            /* --End Blok pagination-- */
            
            /* Sidebar Menu */
            $data['sidebar']    = 'admin-lte-3/includes/medcheck/sidebar_med';
            /* --- Sidebar Menu --- */
            
            /* Load view tampilan */
            $this->load->view('admin-lte-3/1_atas', $data);
            $this->load->view('admin-lte-3/2_header', $data);
            $this->load->view('admin-lte-3/3_navbar', $data);
            $this->load->view('admin-lte-3/includes/medcheck/data_pemb', $data);
            $this->load->view('admin-lte-3/5_footer', $data);
            $this->load->view('admin-lte-3/6_bawah', $data);
        }else{
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();            
        }
    }
    
    public function medcheck_batal_list() {
        if (akses::aksesLogin() == TRUE) {
            /* -- Grup hak akses -- */
            $role        = $this->input->get('role');
            $tipe        = $this->input->get('tipe');
            $grup        = $this->ion_auth->get_users_groups()->row();
            $id_user     = $this->ion_auth->user()->row()->id;
            $id_grup     = $this->ion_auth->get_users_groups()->row();
            $id_dokter   = $this->ion_auth->get_users_groups()->row();
            $pengaturan  = $this->db->get('tbl_pengaturan')->row();

            /* -- Blok Filter -- */
            $hal     = $this->input->get('halaman');
            $id      = $this->input->get('id');
            $cs      = $this->input->get('filter_nama');
            $by      = $this->input->get('filter_bayar');
            $tp      = $this->input->get('filter_tipe');
            $tg      = $this->input->get('filter_tgl');
            $sp      = $this->input->get('filter_periksa');
            $jml     = $this->input->get('jml');
            

            $jml_sql = $this->db->like('DATE(tgl_simpan)', $this->tanggalan->tgl_indo_sys($tg))
                                ->like('pasien', $cs)
                                ->like('tipe', $tp)
                                ->get('v_medcheck_hapus')->num_rows();

            if (!empty($jml)) {
                $jml_hal = $jml;
            } else {
                $jml_hal = $jml_sql;
            }
            /* -- End Blok Filter -- */

            /* -- Form Error -- */
            $data['hasError']                = $this->session->flashdata('form_error');

            /* -- Blok Pagination -- */
            $config['base_url']              = base_url('medcheck/data_hapus.php?tipe=1'.(!empty($cs) ? '&filter_nama='.$cs : '').(!empty($tg) ? '&filter_tgl='.$tg : '').(!empty($tp) ? '&filter_tipe='.$tp : '').(!empty($sp) ? '&filter_periksa='.$sp : '').(isset($by) ? '&filter_bayar='.$by : '').(!empty($jml_hal) ? '&jml='.$jml_hal : ''));
            $config['total_rows']            = $jml_hal;

            $config['query_string_segment']  = 'halaman';
            $config['page_query_string']     = TRUE;
            $config['per_page']              = $pengaturan->jml_item;
            $config['num_links']             = 2;

            $config['first_tag_open']        = '<li class="page-item">';
            $config['first_tag_close']       = '</li>';

            $config['prev_tag_open']         = '<li class="page-item">';
            $config['prev_tag_close']        = '</li>';
            
            $config['num_tag_open']          = '<li class="page-item">';
            $config['num_tag_close']         = '</li>';

            $config['next_tag_open']         = '<li class="page-item">';
            $config['next_tag_close']        = '</li>';
            
            $config['last_tag_open']         = '<li class="page-item">';
            $config['last_tag_close']        = '</li>';
            
            $config['cur_tag_open']          = '<li class="page-item"><a href="#" class="page-link text-dark"><b>';
            $config['cur_tag_close']         = '</b></a></li>';
            
            $config['first_link']            = '&laquo;';
            $config['prev_link']             = '&lsaquo;';
            $config['next_link']             = '&rsaquo;';
            $config['last_link']             = '&raquo;';
            $config['anchor_class']          = 'class="page-link"';
            /* -- End Blok Pagination -- */

            // Jika User dokter, maka pilih rajal dan ranap
            if (!empty($hal)) {
                $data['penj'] = $this->db->like('DATE(tgl_simpan)', $this->tanggalan->tgl_indo_sys($tg))
                                         ->like('pasien', $cs)
                                         ->like('tipe', $tp)
                                         ->limit($config['per_page'], $hal)
                                         ->order_by('id', 'desc')
                                         ->get('v_medcheck_hapus')->result();
            } else {
                $data['penj'] = $this->db->like('DATE(tgl_simpan)', $this->tanggalan->tgl_indo_sys($tg))
                                         ->like('pasien', $cs)
                                         ->like('tipe', $tp)
                                         ->limit($config['per_page'])
                                         ->order_by('id', 'desc')
                                         ->get('v_medcheck_hapus')->result();
            }

            $this->pagination->initialize($config);

            /* Blok pagination */
            $data['total_rows'] = $config['total_rows'];
            $data['PerPage']    = $config['per_page'];
            $data['pagination'] = $this->pagination->create_links();
            $data['cetak']      = '<button type="button" onclick="window.location.href = \''.base_url('transaksi/cetak_data_penj.php?'.(!empty($nt) ? 'filter_nota='.$nt : '').(!empty($tg) ? '&filter_tgl='.$tg : '').(!empty($tp) ? '&filter_tgl_tempo='.$tp : '').(!empty($cs) ? '&filter_cust='.$cs : '').(!empty($sl) ? '&filter_sales='.$sl : '').(!empty($jml) ? '&jml='.$jml : '')).'\'" class="btn btn-warning"><i class="fa fa-print"></i> Cetak</button>';
            /* --End Blok pagination-- */
            
            /* Sidebar Menu */
            $data['sidebar']    = 'admin-lte-3/includes/medcheck/sidebar_med';
            /* --- Sidebar Menu --- */
            
            /* Load view tampilan */
            $this->load->view('admin-lte-3/1_atas', $data);
            $this->load->view('admin-lte-3/2_header', $data);
            $this->load->view('admin-lte-3/3_navbar', $data);
            $this->load->view('admin-lte-3/includes/medcheck/med_list_batal', $data);
            $this->load->view('admin-lte-3/5_footer', $data);
            $this->load->view('admin-lte-3/6_bawah', $data);
        }else{
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();            
        }
    }
    

    
    public function set_gc_simpan() {
        if (akses::aksesLogin() == TRUE) {
            $id         = $this->input->post('id');
            $nik        = $this->input->post('nik');
            $nama       = $this->input->post('nama');
            $no_hp      = $this->input->post('no_hp');
            $jns_klm    = $this->input->post('jns_klm');
            $tmp_lahir  = $this->input->post('tmp_lahir');
            $tgl_lahir  = $this->input->post('tgl_lahir');
            $alamat     = $this->input->post('alamat');
            $hubungan   = $this->input->post('hubungan');
            
            $this->form_validation->set_error_delimiters('<div class="alert alert-danger">', '</div>');

            $this->form_validation->set_rules('id', 'ID', 'required');

            if ($this->form_validation->run() == FALSE) {
                $msg_error = array(
                    'id'     => form_error('id'),
                );

                $this->session->set_flashdata('form_error', $msg_error);
                redirect(base_url('medcheck/data_pendaftaran.php'));
            } else {
                $sql_dft    = $this->db->where('id', general::dekrip($id))->get('tbl_pendaftaran')->row(); 
                
                $data_pas = array(
                    'id_pendaftaran'    => $sql_dft->id,
                    'id_user'           => $this->ion_auth->user()->row()->id,
                    'tgl_simpan'        => date('Y-m-d H:i:s'),
                    'tgl_masuk'         => date('Y-m-d'),
                    'nik'               => $nik,
                    'nama'              => $nama,
//                    'no_hp'             => $no_hp,
//                    'jns_klm'           => $jns_klm,
//                    'tmp_lahir'         => $tmp_lahir,
//                    'tgl_lahir'         => $this->tanggalan->tgl_indo_sys($tgl_lahir),
//                    'alamat'            => $alamat,
                    'status_hub'        => $hubungan,
                );
                
                $this->db->insert('tbl_pendaftaran_gc', $data_pas);
                $last_id = crud::last_id();
                
                if($this->db->affected_rows() > 0){
                    $this->db->where('id', $sql_dft->id)->update('tbl_pendaftaran', array('status_gc'=>'1'));
                    
                    $this->session->set_flashdata('medcheck_toast', 'toastr.success("Entri data persetujuan umum berhasil !");');
                }else{
                    $this->session->set_flashdata('medcheck_toast', 'toastr.error("Entri data persetujuan umum gagal !");');
                }
                
                redirect(base_url('medcheck/daftar_gc_ttd.php?dft='.$id.'&id_dft='.general::enkrip($last_id)));
            }
        }else{
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();            
        }
    }
    
    public function set_gc_update() {
        if (akses::aksesLogin() == TRUE) {
            $id         = $this->input->post('id');
            $id_dft     = $this->input->post('id_dft');
            $foto       = $this->input->post('foto');
            
            $this->form_validation->set_error_delimiters('<div class="alert alert-danger">', '</div>');

            $this->form_validation->set_rules('id', 'ID', 'required');

            if ($this->form_validation->run() == FALSE) {
                $msg_error = array(
                    'id'     => form_error('id'),
                );

                $this->session->set_flashdata('form_error', $msg_error);
                redirect(base_url('medcheck/data_pendaftaran.php'));
            } else {
                $sql_dft    = $this->db->where('id', general::dekrip($id_dft))->get('tbl_pendaftaran')->row(); 
                $sql_dft_gc = $this->db->where('id_pendaftaran', $sql_dft->id)->get('tbl_pendaftaran_gc')->row(); 
                
                # Config File Foto Pasien
                $path               = 'file/gc/'.$sql_dft->id.'/';
                
                # Buat Folder Untuk Foto Pasien
                if(!file_exists($path)){
                    mkdir($path, 0777, true);
                }

                # Simpan foto dari kamera ke dalam format file *.png dari base64
                if (!empty($foto)) {
                    $filename           = $path.'ttd_gc_'.$sql_dft->id.'.png';
                    general::base64_to_jpeg($foto, $filename);
                }
                                
                $data_pas = array(
                    'file_name' => $filename,
                );
                
                $this->db->where('id', $sql_dft_gc->id)->update('tbl_pendaftaran_gc', $data_pas);
                $last_id = $sql_dft_gc->id;
                
//                if($this->db->affected_rows() > 0){
//                    $this->session->set_flashdata('medcheck_toast', 'toastr.error("Entri data persetujuan umum gagal !");');
//                }else{
//                    $this->session->set_flashdata('medcheck_toast', 'toastr.success("Entri data persetujuan umum berhasil !");');
//                }
//                
//                redirect(base_url('medcheck/daftar_gc_ttd.php?dft='.$id.'&id_dft='.general::enkrip($last_id)));
            }
        }else{
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();            
        }
    }
    
    public function set_medcheck() {
        if (akses::aksesLogin() == TRUE) {
            $pasien     = $this->input->post('id_pasien');
            $dft_id     = $this->input->post('dft_id');
            $ant_id     = $this->input->post('ant_id');
            $dokter     = $this->input->post('dokter');
            $poli       = $this->input->post('poli');
            $keluhan    = $this->input->post('keluhan');
            $ttv        = $this->input->post('ttv');
            $ttv_st     = $this->input->post('ttv_st');
            $ttv_bb     = $this->input->post('ttv_bb');
            $ttv_tb     = $this->input->post('ttv_tb');
            $ttv_td     = $this->input->post('ttv_td');
            $ttv_sst    = $this->input->post('ttv_sistole');
            $ttv_dst    = $this->input->post('ttv_diastole');
            $ttv_ndi    = $this->input->post('ttv_nadi');
            $ttv_lju    = $this->input->post('ttv_laju');
            $ttv_sat    = $this->input->post('ttv_saturasi');
            $ttv_skl    = $this->input->post('ttv_skala');
            $alergi     = $this->input->post('alergi');
            $tipe       = $this->input->post('tipe');
            $kategori   = $this->input->post('kategori');
            $pengaturan = $this->db->get('tbl_pengaturan')->row();
            $pengaturan2= $this->db->where('id', $this->ion_auth->user()->row()->id_app)->get('tbl_pengaturan_cabang')->row();

            $this->form_validation->set_error_delimiters('<div class="alert alert-danger">', '</div>');

            $this->form_validation->set_rules('id_pasien', 'Nama Pasien', 'required');
            $this->form_validation->set_rules('tipe', 'Tipe', 'required');
            $this->form_validation->set_rules('poli', 'Klinik', 'required');
            $this->form_validation->set_rules('dokter', 'Dokter', 'required');
            $this->form_validation->set_rules('keluhan', 'Keluhan', 'required');
            $this->form_validation->set_rules('ttv_st', 'ID', 'required');
            $this->form_validation->set_rules('ttv_bb', 'ID', 'required');
            $this->form_validation->set_rules('ttv_tb', 'ID', 'required');
            $this->form_validation->set_rules('ttv_saturasi', 'ID', 'required');
            $this->form_validation->set_rules('ttv_sistole', 'ID', 'required');
            $this->form_validation->set_rules('ttv_diastole', 'ID', 'required');
            $this->form_validation->set_rules('ttv_nadi', 'ID', 'required');
            $this->form_validation->set_rules('ttv_laju', 'ID', 'required');
            $this->form_validation->set_rules('ttv_skala', 'ID', 'required');
            

            if ($this->form_validation->run() == FALSE) {
                $msg_error = array(
                    'tipe'          => form_error('tipe'),
                    'pasien'        => form_error('id_pasien'),
                    'poli'          => form_error('poli'),
                    'dokter'        => form_error('dokter'),
                    'keluhan'       => form_error('keluhan'),
                    'ttv_st'        => form_error('ttv_st'),
                    'ttv_bb'        => form_error('ttv_bb'),
                    'ttv_tb'        => form_error('ttv_tb'),
                    'ttv_saturasi'  => form_error('ttv_saturasi'),
                    'ttv_sistole'   => form_error('ttv_sistole'),
                    'ttv_diastole'  => form_error('ttv_diastole'),
                    'ttv_nadi'      => form_error('ttv_nadi'),
                    'ttv_laju'      => form_error('ttv_laju'),
                    'ttv_skala'     => form_error('ttv_skala'),
                );

                $this->session->set_flashdata('form_error', $msg_error);
                
                $this->session->set_flashdata('form_error', $msg_error);
                
                $this->session->set_flashdata('keluhan', $keluhan);
                $this->session->set_flashdata('ttv_st', $ttv_st);
                $this->session->set_flashdata('ttv_bb', $ttv_bb);
                $this->session->set_flashdata('ttv_tb', $ttv_tb);
                $this->session->set_flashdata('ttv_td', $ttv_td);
                $this->session->set_flashdata('ttv_sistole', $ttv_sst);
                $this->session->set_flashdata('ttv_diastole', $ttv_dst);
                $this->session->set_flashdata('ttv_nadi', $ttv_ndi);
                $this->session->set_flashdata('ttv_laju', $ttv_lju);
                $this->session->set_flashdata('ttv_saturasi', $ttv_sat);
                $this->session->set_flashdata('ttv_skala', $ttv_skl);

                redirect(base_url('medcheck/tambah.php'.(!empty($dft_id) ? '?dft_pas='.general::enkrip($pasien).'&dft_id='.general::enkrip($dft_id) : '')));
            } else {
                $sql_dft    = $this->db->where('id', (!empty($dft_id) ? $dft_id : '0'))->get('tbl_pendaftaran')->row();
                $sql_dft_gc = $this->db->where('id_pendaftaran', $sql_dft->id)->get('tbl_pendaftaran_gc');
                $sql_pas    = $this->db->where('id', $pasien)->get('tbl_m_pasien')->row();
                
                $sql_rm     = $this->db->where('MONTH(tgl_simpan)', date('m'))->where('YEAR(tgl_simpan)', date('Y'))->get('tbl_trans_medcheck');
                $str_rm     = $sql_rm->num_rows() + 1;
                $no_rm      = date('ymd').sprintf('%04d', $str_rm);
                
                $sql_no     = $this->db->select_max('id')->get('tbl_trans_medcheck')->row();
                $sql_akun   = $this->db->select('COUNT(id) AS jml')->where('DATE(tgl_simpan)', date('Y-m-d'))->get('tbl_trans_medcheck')->row();
                $str_akun   = $sql_akun->jml + 1;
                $no_akun    = strtoupper(date('Mdy').sprintf('%04d', $str_akun));
                $nomor_id   = $sql_no->id + 1;
                
                # Check Point
                $form_timestamp     = $this->input->post('timestamp');
                $stored_timestamp   = $this->session->userdata('form_timestamp');
//                $this->session->set_userdata('form_timestamp', $this->input->post('timestamp'));
                
                $data = array(
                    'id_app'       => $this->ion_auth->user()->row()->id_app,
                    'id_user'      => $this->ion_auth->user()->row()->id,
                    'id_nurse'     => $this->ion_auth->user()->row()->id,
                    'id_pasien'    => (!empty($pasien) ? $pasien : '0'),
                    'id_dokter'    => (!empty($dokter) ? $dokter : '0'),
                    'id_poli'      => (!empty($poli) ? $poli :'0'),
                    'id_dft'       => (!empty($dft_id) ? $dft_id : '0'),
                    'id_ant'       => (!empty($ant_id) ? $ant_id : '0'),
                    'tgl_simpan'   => date('Y-m-d H:i:s'),
                    'tgl_masuk'    => date('Y-m-d H:i:s'),
                    'pasien'       => $sql_pas->nama_pgl,
                    'keluhan'      => $keluhan,
                    'ttv'          => (!empty($ttv) ? $ttv : ''),
                    'ttv_st'       => $ttv_st,
                    'ttv_bb'       => $ttv_bb,
                    'ttv_tb'       => $ttv_tb,
                    'ttv_td'       => $ttv_td,
                    'ttv_sistole'  => $ttv_sst,
                    'ttv_diastole' => $ttv_dst,
                    'ttv_nadi'     => $ttv_ndi,
                    'ttv_laju'     => $ttv_lju,
                    'ttv_saturasi' => $ttv_sat,
                    'ttv_skala'    => $ttv_skl,
                    'alergi'       => $sql_dft->alergi,
                    'tipe'         => (!empty($tipe) ? $tipe : '0'),
                    'no_rm'        => $no_rm,
                    'no_akun'      => $no_akun,
                    'tipe_bayar'   => (!empty($sql_dft->tipe_bayar) ? $sql_dft->tipe_bayar : '0'),
                    'status'       => '1',
                    'status_nota'  => '1',
                );
                
                /* Transaksi Database */
                $this->db->query('SET autocommit = 0;');
                $this->db->trans_start();

                # Masukkan ke tabel medcheck
                $this->db->insert('tbl_trans_medcheck', $data);
                $last_id = crud::last_id();
                
                # Masukkan data dokter jadi satu di tabel raber
                $data_dokter = array(
                    'id_medcheck'   => $last_id,
                    'id_user'       => $this->ion_auth->user()->row()->id,
                    'id_pasien'     => (!empty($pasien) ? $pasien : '0'),
                    'id_dokter'     => (!empty($dokter) ? $dokter : '0'),
                    'tgl_simpan'    => date('Y-m-d H:i:s'),
                    'keterangan'    => '',
                    'status'        => '1'
                );
                
                $this->db->insert('tbl_trans_medcheck_dokter', $data_dokter);
                
                # Masukkan GC ke tabel riwayat berkas
                $data_file_gc = array(
                    'id_medcheck'       => $last_id,
                    'id_pasien'         => (!empty($pasien) ? $pasien : '0'),
                    'id_user'           => $this->ion_auth->user()->row()->id,
                    'tgl_simpan'        => date('Y-m-d H:i:s'),
                    'tgl_masuk'         => date('Y-m-d H:i'),
                    'judul'             => 'SURAT PERSETUJUAN UMUM',
                    'file_name'         => '/surat/print_pdf_gc.php?dft='.general::enkrip($sql_dft_gc->row()->id),
                    'file_ext'          => '.pdf',
                    'file_type'         => 'application/pdf',
                    'status'            => '2',
                );
                
                # Jika GC dibuat maka simpan berkas ke tabel berkas
                if($sql_dft_gc->num_rows() > 0){
                    $this->db->insert('tbl_trans_medcheck_file', $data_file_gc);
                }
                
                # Jika tipe medcheck lab atau radiologi
                if($tipe == '1'){                   
                    $nomer      = $this->db->where('MONTH(tgl_simpan)', date('m'))->get('tbl_trans_medcheck_lab')->num_rows() + 1;
                    $no_surat   = sprintf('%03d', $nomer).'/'.$pengaturan->kode_surat.'/'.date('m').'/'.date('Y');
                    $grup       = $this->ion_auth->get_users_groups()->row();
                    $is_farm    = ($grup->name == 'analis' ? '2' : '0');
                    $is_farm_id = ($grup->name == 'analis' ? $this->ion_auth->user()->row()->id : '0');
                    $is_doc_id  = ($grup->name == 'dokter' ? $this->ion_auth->user()->row()->id : '0');
                
                    $data_lab = array(
                        'tgl_simpan'    => date('Y-m-d H:i:s'),
                        'tgl_masuk'     => date('Y-m-d H:i:s'),
                        'id_medcheck'   => $last_id,
                        'id_pasien'     => $pasien,
                        'id_user'       => $this->ion_auth->user()->row()->id,
                        'id_analis'     => $is_farm_id,
                        'id_dokter'     => $is_doc_id,
                        'no_lab'        => $no_surat,
                        'status'        => '0',
                        'status_cvd'    => '0',
                    );
                    
                    # Simpan ke tabel lab
                    $this->db->insert('tbl_trans_medcheck_lab', $data_lab);                
                }elseif($tipe == '4'){
                    $nomer      = $this->db->where('MONTH(tgl_simpan)', date('m'))->get('tbl_trans_medcheck_rad')->num_rows() + 1;
                    $no_surat   = sprintf('%03d', $nomer).'/'.$pengaturan->kode_rad.'/'.date('m').'/'.date('Y');
                    $grup       = $this->ion_auth->get_users_groups()->row();
                    $is_rad     = ($grup->name == 'radiografer' ? '2' : '0');
                    $is_rad_id  = ($grup->name == 'radiografer' ? $this->ion_auth->user()->row()->id : '0');
                    $is_doc_id  = ($grup->name == 'dokter' ? $this->ion_auth->user()->row()->id : '0');
                   
                    $data_rad = array(
                        'tgl_simpan'    => date('Y-m-d H:i:s'),
                        'tgl_masuk'     => date('Y-m-d H:i:s'),
                        'id_medcheck'   => $last_id,
                        'id_pasien'     => $pasien,
                        'id_user'       => $this->ion_auth->user()->row()->id,
                        'id_radiografer'=> $is_rad_id,
                        'id_dokter'     => $is_doc_id,
                        'no_rad'        => $no_surat,
                        'no_sample'     => '-',
                        'status'        => '0',
                    );
                    
                    # Simpan ke tabel rad
                    $this->db->insert('tbl_trans_medcheck_rad', $data_rad);
                }

                # Update ke tabel pendaftaran
                $this->db->where('id', $dft_id)->update('tbl_pendaftaran', array('status_akt' => '2', 'file_base64'=>''));

                # Upload file foto
                $kode   = sprintf('%05d', $sql_pas->kode);
                $no_rm  = strtolower($pengaturan->kode_pasien).$kode;
                $path   = 'file/pasien/'.$no_rm.'/';
                $folder = realpath('./'.$path);

                if (!empty($_FILES['fupload']['name'])) {
                    $config['upload_path']      = $folder;
                    $config['allowed_types']    = 'jpg|png|pdf|jpeg|jfif';
                    $config['remove_spaces']    = TRUE;
                    $config['overwrite']        = TRUE;
                    $config['file_name']        = 'profile_'.$no_rm; // general::dekrip($id).sprintf('%05d', rand(1,256));
                    $this->load->library('upload', $config);

                    if (!$this->upload->do_upload('fupload')) {
                        $this->session->set_flashdata('medcheck', '<div class="alert alert-danger">Error : <b>' . $this->upload->display_errors() . '</b></div>');
//                        redirect(base_url('medcheck/tambah.php'.(!empty($dft_id) ? '?dft_pas='.general::enkrip($pasien).'&dft_id='.general::enkrip($dft_id) : '').'&err='.$this->upload->display_errors()));
                    } else {
                        $f      = $this->upload->data();
                        
                        # Data File
                        $data_file = array(
                            'file_name'     => $path.$f['orig_name'],
                            'file_type'     => $f['file_type'],
                            'file_ext'      => $f['file_ext'],
                        );

                        # Simpan File Gambar ke tabel
                        $this->db->where('id', $sql_pas->id)->update('tbl_m_pasien', $data_file);
                    }
                }
                
                # Cek status transact MySQL
                if ($this->db->trans_status() === FALSE) {
                    # Rollback jika gagal
                    $this->db->trans_rollback();

                    # Tampilkan pesan error
                    $this->session->set_flashdata('medcheck', '<div class="alert alert-danger">Data Medical Checkup gagal disimpan !!</div>');
                } else {
//                        $this->db->trans_commit();
                    $this->db->trans_complete();

                    # Buat session jika sudah berhasil commit
                    $this->session->set_userdata('trans_medcheck', $data);

                    # Tampilkan pesan sukses jika sudah berhasil commit
                    $this->session->set_flashdata('medcheck', '<div class="alert alert-success">Data Medical Checkup Sudah disimpan !!</div>');
                }

                redirect(base_url('medcheck/index.php?tipe='.$tipe));
            }
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }
    
    public function set_pasien() {
        if (akses::aksesLogin() == TRUE) {
            $id = $this->input->get('dft');

            $this->load->helper('file');
            
            if(!empty($id)){
                $pengaturan = $this->db->get('tbl_pengaturan')->row();
                $sql_dft    = $this->db->where('id', general::dekrip($id))->get('tbl_pendaftaran')->row();
                $sql_cek    = $this->db->where('nik', $sql_dft->nik)->where('nama', $sql_dft->nama)->where('alamat', $sql_dft->alamat)->get('tbl_m_pasien');
                $sql_num    = $this->db->order_by('id', 'DESC')->limit(1)->get('tbl_m_pasien')->row();
                $num        = $sql_num->id + 1;
                
                $data_pas = array(
                    'tgl_simpan'        => $sql_dft->tgl_simpan,
                    'tgl_modif'         => $sql_dft->tgl_simpan,
                    'id_gelar'          => $sql_dft->id_gelar,
                    'id_kategori'       => '1',
                    'id_pekerjaan'      => $sql_dft->id_pekerjaan,
                    'kode_dpn'          => $pengaturan->kode_pasien,
                    'nik'               => $sql_dft->nik,
                    'nama'              => $sql_dft->nama,
                    'nama_pgl'          => general::bersih($sql_dft->nama_pgl),
                    'tmp_lahir'         => $sql_dft->tmp_lahir,
                    'tgl_lahir'         => $sql_dft->tgl_lahir,
                    'jns_klm'           => $sql_dft->jns_klm,
                    'no_hp'             => $sql_dft->kontak,
                    'no_telp'           => $sql_dft->kontak_rmh,
                    'alamat'            => general::bersih($sql_dft->alamat),     // (!empty($sql_dft->alamat) || $sql_dft->alamat != 0 ? $sql_dft->alamat : ''),
                    'alamat_dom'        => $sql_dft->alamat_dom, // (!empty($sql_dft->alamat_dom) || $sql_dft->alamat_dom != 0 ? $sql_dft->alamat_dom : ''),
                    'instansi'          => (!empty($sql_dft->instansi) || $sql_dft->instansi !='-' ? $sql_dft->instansi : ''),
                    'instansi_alamat'   => (!empty($sql_dft->instansi_alamat) || $sql_dft->instansi_alamat !='-' ? $sql_dft->instansi_alamat : ''),                  
                    'alergi'            => $sql_dft->alergi,                  
                    'status'            => '1',
                    'status_pas'        => $sql_dft->status,
                );
                
                /* Transaksi Database */
                $this->db->query('SET autocommit = 0;');
                $this->db->trans_start();
                
                if($sql_dft->status == '2'){
                    // Nek kembar, wajib tendang su
                    if($sql_cek->num_rows() > 0){
                        $pasien_id  = $sql_cek->row()->id;
                        $sql_poin   = $this->db->where('id_pasien', $pasien_id)->get('tbl_m_pasien_poin');

                        # Update data pasien
                        $this->db->where('id', $pasien_id)->update('tbl_m_pasien', $data_pas);
                        
                        # cek udah ada param poin belum, kalo belum buat parameternya
                        if($sql_poin->num_rows() == 0){
                            $data_poin = array(
                                'id_pasien'     => $pasien_id,
                                'tgl_simpan'    => date('Y-m-d H:i:s'),
                                'jml_poin'      => 0,
                                'jml_poin_nom'  => 0,
                                'status'        => '1',
                            );

                            $this->db->insert('tbl_m_pasien_poin', $data_poin);
                        }

                        $last_id = $pasien_id;
                    }else{
                        $this->db->insert('tbl_m_pasien', $data_pas);
                        $last_id = crud::last_id();
                                        
                        $data_poin = array(
                            'id_pasien'     => $last_id,
                            'tgl_simpan'    => date('Y-m-d H:i:s'),
                            'jml_poin'      => 0,
                            'jml_poin_nom'  => 0,
                            'status'        => '1',
                        );
                        
                        $this->db->insert('tbl_m_pasien_poin', $data_poin);
                    }
                }else{
                    $sql_pas = $this->db->where('id', $sql_dft->id_pasien)->get('tbl_m_pasien')->row();                    
                    $this->db->where('id', $sql_pas->id)->update('tbl_m_pasien', $data_pas);
                    $last_id = $sql_pas->id;
                }
                
                # Config File Foto Pasien
                $kode               = sprintf('%05d', $last_id);
                $no_rm              = strtolower($pengaturan->kode_pasien).$kode;
                $path               = 'file/pasien/'.$no_rm.'/';
                
                # Buat Folder Untuk Foto Pasien
                if(!file_exists($path)){
                    mkdir($path, 0777, true);
                }
                
                # Simpan foto dari kamera ke dalam format file *.png dari base64
                if (!empty($sql_dft->file_base64)) {
                    $filename           = $path.'profile_'.$kode.'.png';
                    general::base64_to_jpeg($sql_dft->file_base64, $filename);
                }
                
                # Simpan foto dari kamera ke dalam format file *.png dari base64 KTP / ID PASIEN
                if (!empty($sql_dft->file_base64_id)) {
                    $filename_id        = $path.'ID_'.$kode.'.png';
                    general::base64_to_jpeg($sql_dft->file_base64_id, $filename_id);
                }
                
                # Integrasi data pasien untuk akses login pasien
                $sql_user       = $this->db->select('id, username')->where('username', $no_rm)->get('tbl_ion_users');
                $sql_user_rw    = $sql_user->row();
                $email          = $no_rm.'@'.$pengaturan->website; # Format Email
                $user           = $no_rm; # Format username pasien menggunakan no rm
                $pass2          = ($sql_dft->tgl_lahir == '0000-00-00' ? $user : $this->tanggalan->tgl_indo8($sql_dft->tgl_lahir)); # Format kata sandi pasien menggunakan tanggal lahir dd-mm-yyyy jika tanggal lahir kosong maka passwordnya sama dengan username
                
                # Cek username tersebut sudah pernah di pakai atau belum
                if($sql_user->num_rows() == 0){
                    $data_user = array(
                        'email'         => $email,
                        'first_name'    => $sql_dft->nama,
                        'nama'          => $sql_dft->nama_pgl,
                        'address'       => $sql_dft->alamat,
                        'phone'         => $sql_dft->kontak,
                        'birthdate'     => $sql_dft->tgl_lahir,
                        'file_name'     => (file_exists($filename) ? $filename : ''),
                        'username'      => $no_rm,
                        'tipe'          => '2',
                    );
                    
                    # Simpan ke modul user
                    $this->ion_auth->register($user, $pass2, $email, $data_user, array('15'));
                    
                    $sql_user_ck = $this->db->select('id, username')->where('username', $user)->get('tbl_ion_users')->row();
                    $id_user = $sql_user_ck->id;
                }else{
                    $data_user = array(
                        'email'         => $email,
                        'first_name'    => $sql_dft->nama,
                        'nama'          => $sql_dft->nama_pgl,
                        'address'       => $sql_dft->alamat,
                        'phone'         => $sql_dft->kontak,
                        'birthdate'     => $sql_dft->tgl_lahir,
                        'file_name'     => (file_exists($filename) ? $filename : ''),
                        'username'      => $no_rm,
                        'password'      => $pass2,
                        'tipe'          => '2',
                    );
                    
                    $this->ion_auth->update($id_user, $data_user);
                    $id_user = $sql_user_rw->id;                    
                }
                
                # Simpan ID User dari tabel ion_users ke tabel pasien
                $data_pas_upd = array(
                    'id_user' => $id_user,
                    'kode'    => $kode,
                );
                
                $this->db->where('id', $last_id)->update('tbl_m_pasien', $data_pas_upd); 

                    
                # Cek File Foto Pasien
                if (!empty($sql_dft->file_base64)) {
                    # Data File
                    $data_file = array(
                        'file_name'     => (file_exists($filename) ? $filename : ''),
                        'file_type'     => (file_exists($filename) || file_exists($filename_id) ? 'image/png' : ''),
                        'file_ext'      => (file_exists($filename) || file_exists($filename_id) ? '.png' : ''),
                    );

                    # Simpan File Gambar ke tabel
                    $this->db->where('id', $last_id)->update('tbl_m_pasien', $data_file);
                    
                    # Hapus gambar pada pendaftaran supaya tidak penuh
                    $this->db->where('id', $sql_dft->id)->update('tbl_pendaftaran', array('file_base64'=>''));
                }
                    
                # Cek File ID
                if (!empty($sql_dft->file_base64_id)) {
                    # Data File
                    $data_file_id = array(
                        'file_name_id'  => (file_exists($filename_id) ? $filename_id : ''),
                    );

                    # Simpan File Gambar ke tabel
                    $this->db->where('id', $last_id)->update('tbl_m_pasien', $data_file_id);
                    
                    # Hapus gambar pada pendaftaran supaya tidak penuh
                    $this->db->where('id', $sql_dft->id)->update('tbl_pendaftaran', array('file_base64_id'=>''));
                }
                
                # Cek status transact MySQL
                if ($this->db->trans_status() === FALSE) {
                    # Rollback jika gagal
                    $this->db->trans_rollback();

                    # Tampilkan pesan error
                    $this->session->set_flashdata('medcheck', '<div class="alert alert-danger">Data pasien gagal disimpan !!</div>');
                } else {
//                    $this->db->trans_commit();
                    $this->db->trans_complete();

                    # Tampilkan pesan sukses jika sudah berhasil commit
                    $this->session->set_flashdata('medcheck', '<div class="alert alert-success">Data pasien sudah disimpan !!</div>');
                }  

                $this->session->set_flashdata('member', '<div class="alert alert-success">Data member berhasil diubah</div>');
                redirect(base_url('medcheck/tambah.php?dft_pas='.general::enkrip($last_id).'&dft_id='.general::enkrip($sql_dft->id)));
            }
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }

    public function set_medcheck_update() {
        if (akses::aksesLogin() == TRUE) {
            $id         = $this->input->post('id');
            $tgl_periksa= $this->input->post('tgl_periksa');
            $anamnesa   = $this->input->post('anamnesa');
            $diagnosa   = $this->input->post('diagnosa');
            $periksa    = $this->input->post('pemeriksaan');
            $program    = $this->input->post('program');
            $icd        = $this->input->post('icd');
            $icd10      = $this->input->post('icd10');
            $status     = $this->input->post('status');
            $st_priksa  = $this->input->post('status_periksa');
            $keluhan    = $this->input->post('keluhan');
            $ttv        = $this->input->post('ttv');
            $ttv_st     = $this->input->post('ttv_st');
            $ttv_bb     = $this->input->post('ttv_bb');
            $ttv_tb     = $this->input->post('ttv_tb');
            $ttv_td     = $this->input->post('ttv_td');
            $ttv_sst    = $this->input->post('ttv_sistole');
            $ttv_dst    = $this->input->post('ttv_diastole');
            $ttv_ndi    = $this->input->post('ttv_nadi');
            $ttv_lju    = $this->input->post('ttv_laju');
            $ttv_sat    = $this->input->post('ttv_saturasi');
            $ttv_skl    = $this->input->post('ttv_skala');
            $alergi     = $this->input->post('alergi');
            $rute       = $this->input->post('route');
            $this->form_validation->set_error_delimiters('<div class="alert alert-danger">', '</div>');

            $this->form_validation->set_rules('id', 'ID', 'required');
//            $this->form_validation->set_rules('anamnesa', 'Tipe', 'required');
//            $this->form_validation->set_rules('status_periksa', 'Periksa', 'required');

            if ($this->form_validation->run() == FALSE) {
                $msg_error = array(
                    'id'                => form_error('id'),
//                    'status_periksa'    => form_error('status_periksa'),
                );

                $this->session->set_flashdata('form_error', $msg_error);

                $this->session->set_flashdata('medcheck_toast', 'toastr.error("Entri data pemeriksaan gagal !");');
                redirect(base_url('medcheck/tambah.php?id='.$id.$rute));
            } else {
                $sql_medc = $this->db->where('id', general::dekrip($id))->get('tbl_trans_medcheck')->row();
                        
                $data = array(
                    'tgl_modif'         => date('Y-m-d H:i:s'),
                    'tgl_periksa'       => (!empty($tgl_periksa) ? $tgl_periksa : '0000-00-00 00:00:00'),
                    'keluhan'           => $keluhan,
                    'ttv'               => (!empty($ttv) ? $ttv : ''),
                    'ttv_st'            => $ttv_st,
                    'ttv_bb'            => $ttv_bb,
                    'ttv_tb'            => $ttv_tb,
                    'ttv_td'            => $ttv_td,
                    'ttv_sistole'       => $ttv_sst,
                    'ttv_diastole'      => $ttv_dst,
                    'ttv_nadi'          => $ttv_ndi,
                    'ttv_laju'          => $ttv_lju,
                    'ttv_saturasi'      => $ttv_sat,
                    'ttv_skala'         => $ttv_skl,
                    'alergi'            => $alergi,
                    'anamnesa'          => $anamnesa,
                    'pemeriksaan'       => $periksa,
                    'diagnosa'          => $diagnosa,
                    'program'           => $program,
                    'id_icd'            => (!empty($icd) ? $icd : '0'),
                    'id_icd10'          => (!empty($icd10) ? $icd10 : '0'),
                    'status'            => $status,
                    'status_periksa'    => (!empty($st_priksa) ? $st_priksa : '0'),
                    'status_nota'       => '2',
                );
                
                $this->db->where('id', $sql_medc->id_pasien)->update('tbl_m_pasien', array('alergi' => $alergi));
                $this->db->where('id', general::dekrip($id))->update('tbl_trans_medcheck', $data);

                $this->session->set_flashdata('medcheck_toast', 'toastr.success("Entri data pemeriksaan berhasil !");');
                
                if(!empty($rute)){
                    redirect(base_url('medcheck/tambah.php?id='.$id.$rute));
                }else{
                    redirect(base_url('medcheck/index.php?tipe='.$sql_medc->tipe));
                }
                   
//                redirect(base_url('medcheck/index.php?tipe='.$sql_medc->tipe));
//                redirect(base_url('medcheck/tambah.php?id='.$id.'&status='.$status));
//                
//                echo '<pre>';
//                print_r($data);
            }
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }

    public function set_medcheck_update_penj() {
        if (akses::aksesLogin() == TRUE) {
            $id         = $this->input->post('id');
            $penjamin   = $this->input->post('platform');
            $this->form_validation->set_error_delimiters('<div class="alert alert-danger">', '</div>');

            $this->form_validation->set_rules('id', 'ID', 'required');

            if ($this->form_validation->run() == FALSE) {
                $msg_error = array(
                    'id'                => form_error('id'),
                );

                $this->session->set_flashdata('form_error', $msg_error);

                redirect(base_url('medcheck/tambah.php'));
            } else {
                $sql_medc           = $this->db->where('id', general::dekrip($id))->get('tbl_trans_medcheck')->row();
                $sql_medc_det       = $this->db->select('id, id_resep, id_item, kode, item, jml, jml_satuan, harga, disk1, disk2, disk3, potongan, subtotal')->where('id_medcheck', $sql_medc->id)->where('status', '4')->get('tbl_trans_medcheck_det');
                $sql_medc_res_det   = $this->db->where('id_medcheck', $sql_medc->id)->get('tbl_trans_medcheck_resep_det');
                $sql_pnjm           = $this->db->where('id', $penjamin)->get('tbl_m_penjamin')->row();
                
                $data = array(
                    'tgl_modif'         => date('Y-m-d H:i:s'),
                    'tipe_bayar'        => $penjamin,
                );
                
                # cek jika obat sudah di posting ke tabel det
                if($sql_medc_det->num_rows() > 0){
                    foreach ($sql_medc_det->result() as $det){
                        $sql_item       = $this->db->where('id', $det->id_item)->get('tbl_m_produk')->row();
                        $sql_res_det    = $this->db->where('id_resep', $det->id_resep)->where('id_item', $det->id_item)->get('tbl_trans_medcheck_resep_det')->row();
                        $sql_res_det_rc = $this->db->where('id_resep', $det->id_resep)->get('tbl_trans_medcheck_resep_det_rc')->result();
                    
                        $harga          = $sql_item->harga_jual;
                        $ass            = $harga * $sql_pnjm->persen;
                        $harga_pcs      = ($sql_pnjm->persen != 0 ? $ass : $harga); # Jika penjamin asuransi, maka harga obat di tambah sesuai setelan % pada database
                        $harga_tot      = ($sql_item->status_racikan == '1' ? $harga : $harga_pcs);
                        $potongan       = $det->potongan;
                        
                        $disk1          = $harga_tot - (($det->disk1 / 100) * $harga_tot);
                        $disk2          = $disk1 - (($det->disk2 / 100) * $disk1);
                        $disk3          = $disk2 - (($det->disk3 / 100) * $disk2);
                        $diskon         = $harga_tot - $disk3;
                        $subtotal       = ($disk3 - $potongan) * (int)$det->jml;
                        
                        $data_item = array(
                            'id_resep'  => $det->id_resep,
                            'id_item'   => $det->id_item,
                            'resep'     => '',
                            'item'      => $det->item,
                            'harga'     => ($sql_item->status_racikan == '1' ? $harga : $harga_tot),
                            'disk1'     => $det->disk1,
                            'disk2'     => $det->disk2,
                            'disk3'     => $det->disk3,
                            'potongan'  => $det->potongan,
                            'subtotal'  => $subtotal,
                        );
                        
                        foreach ($sql_res_det_rc as $racikan){
                            $sql_item_rc    = $this->db->where('id', $racikan->id_item)->get('tbl_m_produk')->row();
                            $harga_rc       = $sql_item_rc->harga_jual;
                            $ass_rc         = $harga_rc * $sql_pnjm->persen;
                            $harga_tot_rc   = ($sql_pnjm->persen != 0 ? $ass_rc : $harga_rc); # Jika penjamin asuransi, maka harga obat racikan di tambah sesuai setelan % pada database
                        
                            $subtotal_rc    = $harga_tot_rc * (int)$racikan->jml;
                            
                            $data_item_rc = array(
                                'harga'     => $harga_tot_rc,
                                'subtotal'  => $subtotal_rc,
                            );
                            
                                # Update isi data di tabel racikan detail beserta perubahan harganya jika ada asuransi
                                $this->db->where('id', $racikan->id)->update('tbl_trans_medcheck_resep_det_rc', $data_item_rc);
                        }
                        
                        # Ambil data detail json dari tabel racikan
                        $sql_res_det_rc2    = $this->db->where('id_resep', $det->id_resep)->get('tbl_trans_medcheck_resep_det_rc')->result();
                        $resep              = ($sql_item->status_racikan == '1' ? json_encode($sql_res_det_rc2) : '');
    
                        # Update isi data di tabel resep beserta perubahan harganya jika ada asuransi
                        $this->db->where('id', $sql_res_det->id)->update('tbl_trans_medcheck_resep_det', $data_item);
    
                        # Update isi data di tabel medcheck det beserta perubahan harganya jika ada asuransi
                        $this->db->where('id', $det->id)->update('tbl_trans_medcheck_det', $data_item);
    
//                        # Update isi data racikan di tabel resep dan nota
//                        $this->db->where('id', $sql_res_det->id)->update('tbl_trans_medcheck_resep_det', array('resep'=>$resep));
//                        $this->db->where('id', $det->id)->update('tbl_trans_medcheck_det', array('resep'=>$resep));
                    }                
                }else{
                    foreach ($sql_medc_res_det->result() as $det){
                        $sql_item       = $this->db->where('id', $det->id_item)->get('tbl_m_produk')->row();
                        $sql_res_det    = $this->db->where('id_resep', $det->id_resep)->where('id_item', $det->id_item)->get('tbl_trans_medcheck_resep_det')->row();
                        $sql_res_det_rc = $this->db->where('id_resep_det', $det->id)->get('tbl_trans_medcheck_resep_det_rc')->result();
                    
                        $harga          = $sql_item->harga_jual;
                        $ass            = $harga * $sql_pnjm->persen;
                        $harga_pcs      = ($sql_pnjm->persen != 0 ? $ass : $harga); # Jika penjamin asuransi, maka harga obat di tambah sesuai setelan % pada database
                        $harga_tot      = ($sql_item->status_racikan == '1' ? $harga : $harga_pcs);
                        $potongan       = $det->potongan;
                        
                        $disk1          = $harga_tot - (($det->disk1 / 100) * $harga_tot);
                        $disk2          = $disk1 - (($det->disk2 / 100) * $disk1);
                        $disk3          = $disk2 - (($det->disk3 / 100) * $disk2);
                        $diskon         = $harga_tot - $disk3;
                        $subtotal       = ($disk3 - $potongan) * (int)$det->jml;
                        $harga          = $sql_item->harga_jual;
                        $ass            = $harga * $sql_pnjm->persen;
                        $harga_pcs      = ($sql_pnjm->persen != 0 ? $ass : $harga); # Jika penjamin asuransi, maka harga obat di tambah sesuai setelan % pada database
                        $harga_tot      = ($sql_item->status_racikan == '1' ? $harga : $harga_pcs);
                        $potongan       = $det->potongan;
                        
                        $disk1          = $harga_tot - (($det->disk1 / 100) * $harga_tot);
                        $disk2          = $disk1 - (($det->disk2 / 100) * $disk1);
                        $disk3          = $disk2 - (($det->disk3 / 100) * $disk2);
                        $diskon         = $harga_tot - $disk3;
                        $subtotal       = ($disk3 - $potongan) * (int)$det->jml;
                        
                        $data_item = array(
                            'id_resep'  => $det->id_resep,
                            'id_item'   => $det->id_item,
                            'item'      => $det->item,
                            'harga'     => ($sql_item->status_racikan == '1' ? $harga : $harga_tot),
                            'disk1'     => $det->disk1,
                            'disk2'     => $det->disk2,
                            'disk3'     => $det->disk3,
                            'potongan'  => $det->potongan,
                            'subtotal'  => $subtotal,
                        );
                        
                        foreach ($sql_res_det_rc as $racikan){
                            $sql_item_rc    = $this->db->where('id', $racikan->id_item)->get('tbl_m_produk')->row();
                            $harga_rc       = $sql_item_rc->harga_jual;
                            $ass_rc         = $harga_rc * $sql_pnjm->persen;
                            $harga_tot_rc   = ($sql_pnjm->persen != 0 ? $ass_rc : $harga_rc); # Jika penjamin asuransi, maka harga obat racikan di tambah sesuai setelan % pada database
                        
                            $subtotal_rc    = $harga_tot_rc * (int)$racikan->jml;
                            
                            $data_item_rc = array(
                                'item'      => $sql_item_rc->produk,
                                'harga'     => $harga_tot_rc,
                                'subtotal'  => $subtotal_rc,
                            );
                            
//                            echo '<pre>';
//                            print_r($data_item_rc);
//                            echo '</pre>';
                            
                            # Update isi data di tabel racikan detail beserta perubahan harganya jika ada asuransi
                            $this->db->where('id', $racikan->id)->update('tbl_trans_medcheck_resep_det_rc', $data_item_rc);
                        }
                        
                        # Update isi data di tabel resep beserta perubahan harganya jika ada asuransi
                        $this->db->where('id', $racikan->id)->update('tbl_trans_medcheck_resep_det', $data_item);
                        
//                        echo '<pre>';
//                        print_r($data_item);
//                        echo '</pre>';
                    }
                }
                

                # Update pada tabel medcheck nya, ubah data sesuai penjamin
                $this->db->where('id', $sql_medc->id)->update('tbl_trans_medcheck', $data);
//                
                $this->session->set_flashdata('medcheck', '<div class="alert alert-success">Perubahan data penjamin berhasil !!</div>');
                redirect(base_url('medcheck/tindakan.php?id='.$id));
            }
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }

    public function set_medcheck_transfer() {
        if (akses::aksesLogin() == TRUE) {
            $id         = $this->input->post('id');
            $poli_asl   = $this->input->post('poli_asl');
            $poli_7an   = $this->input->post('poli_7an');
            $dokter     = $this->input->post('dokter');
            $tipe       = $this->input->post('tipe');
            $kamar      = $this->input->post('kamar');
            $kamar_nm   = $this->input->post('kamar_nm');
            $catatan    = $this->input->post('catatan');
            $status     = $this->input->post('status');
            $this->form_validation->set_error_delimiters('<div class="alert alert-danger">', '</div>');

            $this->form_validation->set_rules('id', 'ID', 'required');
            $this->form_validation->set_rules('tipe', 'tipe', 'required');
            
            if($tipe == '3'){
                $this->form_validation->set_rules('kamar', 'Kamar', 'required');
                $this->form_validation->set_rules('kamar_nm', 'Kamar', 'required');
            }

            if ($this->form_validation->run() == FALSE) {
                $msg_error = array(
                    'id'        => form_error('id'),
                    'tipe'      => form_error('tipe'),
                    'kamar'     => form_error('kamar'),
                    'kamar_nm'  => form_error('kamar_nm'),
                );
                
                $err_kamar      = form_error('kamar');
                $err_kamar_nm   = form_error('kamar_nm');
                if(!empty($err_kamar)){
                    $this->session->set_flashdata('medcheck_toast', 'toastr.error("Pilih kelas perawatan !");');
                }
                if(!empty($err_kamar_nm)){
                    $this->session->set_flashdata('medcheck_toast', 'toastr.error("Nama ruang / kamar harus diisi !");');
                }

                $this->session->set_flashdata('form_error', $msg_error);

                redirect(base_url('medcheck/transfer.php?id='.$id));
            } else {                
                $sql_medc       = $this->db->where('id', general::dekrip($id))->get('tbl_trans_medcheck')->row();
                $sql_medc_kmr   = $this->db->where('id_medcheck', $sql_medc->id)->get('tbl_trans_medcheck_kamar');
                
                # Hapus berkas transfer sebelumnya
                $this->db->where('id_medcheck', $sql_medc->id)->delete('tbl_trans_medcheck_trf');
                
                if($sql_medc_kmr->num_rows() > 0){
                    $kamar2     = $sql_medc_kmr->row()->id_kamar;
                    $sql_kamar2 = $this->db->where('id', $kamar2)->get('tbl_m_kamar')->row();
                    $jml2       = $sql_kamar2->jml - 1;
                    
                    # Update kamar
                    $this->db->where('id', $kamar2)->update('tbl_m_kamar', array('jml' => $jml2));
                    
                    # Hapus berkas kamar
                    $this->db->where('id_medcheck', $sql_medc->id)->delete('tbl_trans_medcheck_kamar');
                }
                
                $data = array(
                    'id_medcheck'           => $sql_medc->id,
                    'id_user'               => $this->ion_auth->user()->row()->id,
                    'id_pasien'             => $sql_medc->id_pasien,
                    'id_dokter'             => (!empty($dokter) ? $dokter : $sql_medc->id_dokter),
                    'id_poli_asal'          => (!empty($poli_asl) ? $poli_asl : 0),
                    'id_poli_tujuan'        => (!empty($poli_7an) ? $poli_7an : 0),
                    'tipe'                  => $tipe,
                    'tgl_simpan'            => date('Y-m-d H:i:s'),
                    'keterangan_perawat'    => $catatan,
                    'status'                => '0',
                );
                
                $data_medc = array(
                    'id_poli'   => (!empty($poli_7an) ? $poli_7an : $sql_medc->id_poli),
                    'id_dokter' => (!empty($dokter) ? $dokter : $sql_medc->id_dokter),
                    'tipe'      => $tipe,
                    'tgl_modif' => date('Y-m-d H:i:s'),
                    'tgl_ranap' => ($tipe == '3' ? date('Y-m-d H:i:s') : '0000-00-00 00:00:00'),
                );
                
                # Cek tipe rawat
                if($tipe == '3'){
                    $sql_kamar      = $this->db->where('id', $kamar)->get('tbl_m_kamar')->row();
                    $jml            = $sql_kamar->jml + 1;
                        
                    if($sql_kamar->jml <= $sql_kamar->jml_max){                                              
                        $data_kmr_master = array(
                            'tgl_modif' => date('Y-m-d H:i:s'),
                            'jml'       => $jml,
                        );
                        
                        $data_kmr = array(
                            'id_medcheck'=> $sql_medc->id,
                            'id_kamar'   => $sql_kamar->id,
                            'id_pasien'  => $sql_medc->id_pasien,
                            'id_user'    => $this->ion_auth->user()->row()->id,
                            'tgl_simpan' => date('Y-m-d H:i:s'),
                            'kamar'      => $kamar_nm,
                            'keterangan' => 'Transfer Pasien',
                            'status'     => '1',
                        );

                        $this->db->insert('tbl_trans_medcheck_kamar', $data_kmr);

                        # Update tabel kamar
                        $this->db->where('id', $sql_kamar->id)->update('tbl_m_kamar', $data_kmr_master);
                    }else{
                        $this->session->set_flashdata('medcheck_toast', 'toastr.error("Kamar sudah penuh !");');
                        redirect(base_url('medcheck/transfer.php?id='.general::enkrip($sql_medc->id)));
                    }                  
                }
                                
                # Masukkan data dokter
                $data_dokter = array(
                    'id_medcheck'   => $sql_medc->id,
                    'id_user'       => $this->ion_auth->user()->row()->id,
                    'id_pasien'     => (!empty($sql_medc->id_pasien) ? $sql_medc->id_pasien : '0'),
                    'id_dokter'     => (!empty($dokter) ? $dokter : '0'),
                    'tgl_simpan'    => date('Y-m-d H:i:s'),
                    'keterangan'    => '',
                    'status'        => '1'
                );
                
                $this->db->where('id_medcheck', $sql_medc->id)->where('status', '1')->update('tbl_trans_medcheck_dokter', $data_dokter);

                # Update data Medcheck
                $this->db->where('id', $sql_medc->id)->update('tbl_trans_medcheck', $data_medc);
                
                # Inputkan data catatan transfer
                $this->db->insert('tbl_trans_medcheck_trf', $data);
                $last_id = crud::last_id();

                $this->session->set_flashdata('medcheck_toast', 'toastr.success("Pasien berhasil di transfer !");');
                
                redirect(base_url('medcheck/transfer.php?id='.general::enkrip($sql_medc->id).'&trf_id='.general::enkrip($last_id)));
            }
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }

    public function set_medcheck_doc() {
        if (akses::aksesLogin() == TRUE) {
            $id         = $this->input->post('id');
            $dokter     = $this->input->post('dokter');
            $catatan    = $this->input->post('catatan');
            $status     = $this->input->post('status');
            $this->form_validation->set_error_delimiters('<div class="alert alert-danger">', '</div>');

            $this->form_validation->set_rules('id', 'ID', 'required');

            if ($this->form_validation->run() == FALSE) {
                $msg_error = array(
                    'id'        => form_error('id'),
                );

                $this->session->set_flashdata('anamnesa', $msg_error);

                redirect(base_url('medcheck/tambah.php?id='.$id.'&status='.$status));
            } else {
                $sql_medc   = $this->db->where('id', general::dekrip($id))->get('tbl_trans_medcheck')->row();
                $sql_cek    = $this->db->where('id_medcheck', $sql_medc->id)->where('id_dokter', $dokter)->get('tbl_trans_medcheck_dokter');
                
                $data = array(
                    'id_medcheck'   => $sql_medc->id,
                    'id_user'       => $this->ion_auth->user()->row()->id,
                    'id_pasien'     => $sql_medc->id_pasien,
                    'id_dokter'     => $dokter,
                    'tgl_simpan'    => date('Y-m-d H:i:s'),
                    'keterangan'    => $catatan
                );
                
                # Cek jika sudah ada nama dokter sama dengan dokter utama tendang
                if($sql_medc->id_dokter == $dokter){
                    # Tampilkan bahwa sudah ada value kembar
                    $this->session->set_flashdata('medcheck', '<div class="alert alert-danger"> <b>'.$this->ion_auth->user($sql_medc->id_dokter)->row()->first_name.'</b> sudah di atur sebagai dokter utama,<br/>silahkan memilih nama lain !!</div>');                    
                }else{
                    # Cek jika sudah ada id_medcheck dan nama dokter yang sama silahkan tendang
                    if ($sql_cek->num_rows() > 0) {
                        # Tampilkan bahwa sudah ada value kembar
                        $this->session->set_flashdata('medcheck', '<div class="alert alert-danger"><b>'.$this->ion_auth->user($dokter)->row()->first_name.'</b> sudah tersimpan sebelumnya, silahkan cek pada daftar dokter !!</div>');
                    } else {
                        # Transact SQL
                        $this->db->trans_start();

                        # Masukkan ke tabel medcheck_dokter
                        $this->db->insert('tbl_trans_medcheck_dokter', $data);

                        # Cek status transact MySQL
                        if ($this->db->trans_status() === FALSE) {
                            # Rollback jika gagal
                            $this->db->trans_rollback();

                            # Tampilkan pesan error
                            $this->session->set_flashdata('medcheck', '<div class="alert alert-danger">Data rawat bersama gagal disimpan !!</div>');
                        } else {
                            $this->db->trans_complete();

                            # Tampilkan pesan sukses jika sudah berhasil commit
                            $this->session->set_flashdata('medcheck', '<div class="alert alert-success">Data rawat bersama disimpan !!</div>');
                        }
                    }
                }
                
                redirect(base_url('medcheck/tambah.php?id='.general::enkrip($sql_medc->id).'&status='.$status));
            }
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }

    public function set_medcheck_doc_hapus() {
        if (akses::aksesLogin() == TRUE) {
            $id         = $this->input->get('id');
            $id_item    = $this->input->get('id_item');
            $status     = $this->input->get('status');
            
            if(!empty($id)){
                $this->session->set_flashdata('medcheck', '<div class="alert alert-success">Item berhasil di hapus</div>');
                crud::delete('tbl_trans_medcheck_dokter', 'id', general::dekrip($id_item));
            }
            
            redirect(base_url('medcheck/tambah.php?id='.$id.'&status='.$status));
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }

    public function set_medcheck_update_inv() {
        if (akses::aksesLogin() == TRUE) {
            $id         = $this->input->get('id');
            
            if(!empty($id)){
                $sql_medc         = $this->db->where('id', general::dekrip($id))->get('tbl_trans_medcheck')->row();
                $sql_medc_det     = $this->db->where('id_medcheck', $sql_medc->id)->get('tbl_trans_medcheck_det')->result();
                $sql_medc_det_sum = $this->db->select('SUM(subtotal) AS subtotal, SUM(diskon) AS diskon, SUM(potongan) AS potongan')->where('id_medcheck', $sql_medc->id)->get('tbl_trans_medcheck_det')->row();
                
                $jml_total  = $sql_medc_det_sum->subtotal + $sql_medc_det_sum->potongan;
                $jml_diskon =$sql_medc_det_sum->potongan;
                
                $data = array(
                    'jml_total'     => $jml_total,
                    'jml_diskon'    => $jml_diskon,
                    'jml_subtotal'  => $sql_medc_det_sum->subtotal,
                    'jml_gtotal'    => $sql_medc_det_sum->subtotal,
                );
                
                crud::update('tbl_trans_medcheck', 'id', $sql_medc->id, $data);
            }
            
                $this->session->set_flashdata('medcheck', '<div class="alert alert-success">Transaksi berhasil di proses !!</div>');
                redirect(base_url('medcheck/invoice/bayar.php?id='.$id));
//                           
//                echo '<pre>';
//                print_r($data);
//                echo '</pre>';
//                           
//                echo '<pre>';
//                print_r($sql_medc_det_sum);
//                echo '</pre>';
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }

    public function set_medcheck_proses(){
        if (akses::aksesLogin() == TRUE) {
            $id         = $this->input->post('id');
            $status     = $this->input->post('status');
            
            $this->form_validation->set_error_delimiters('<div class="alert alert-danger">', '</div>');

            $this->form_validation->set_rules('id', 'ID', 'required');

            if ($this->form_validation->run() == FALSE) {
                $msg_error = array(
                    'id'        => form_error('id'),
                );

                $this->session->set_flashdata('anamnesa', $msg_error);

                redirect(base_url('medcheck/tambah.php?id='.$id));
            } else {
                $sql_medc       = $this->db->where('id', general::dekrip($id))->get('tbl_trans_medcheck')->row();
                $sql_medc_det   = $this->db->select('SUM(potongan) AS potongan, SUM(diskon) AS diskon, SUM(subtotal) AS subtotal')->where('id_medcheck', $sql_medc->id)->where('status_pkt', '0')->get('tbl_trans_medcheck_det')->row();   
                $sql_medc_det2  = $this->db->where('id_medcheck', $sql_medc->id)->get('tbl_trans_medcheck_det')->result(); 
                $sql_poin       = $this->db->where('id_pasien', $sql_medc->id_pasien)->get('tbl_m_pasien_poin'); 
                $pengaturan     = $this->db->get('tbl_pengaturan')->row();
                

                $nomer          = $this->db->where('MONTH(tgl_simpan)', date('m'))->where('YEAR(tgl_simpan)', date('Y'))->get('tbl_trans_medcheck')->num_rows() + 1;
                $no_nota        = 'INV/'.date('Y').'/'.date('m').'/'.sprintf('%05d', $nomer);
                
                $jml_total      = $sql_medc_det->subtotal + $sql_medc_det->potongan + $sql_medc_det->diskon;
                $jml_pot        = $sql_medc_det->potongan;
                $jml_diskon     = $sql_medc_det->diskon;
                $diskon         = ($jml_diskon / $jml_total) * 100;
                $jml_subtotal   = $sql_medc_det->subtotal;
                $ppn            = $pengaturan->ppn;
                $jml_ppn        = $pengaturan->ppn;
                $jml_gtotal     = ceil($sql_medc_det->subtotal);
                
                $data = array(
                    'tgl_modif'     => date('Y-m-d H:i:s'),
                    'no_nota'       => $no_nota,
                    'jml_total'     => (float)$jml_total,
                    'jml_diskon'    => (float)$jml_diskon,
                    'diskon'        => ($diskon > 1 ? (float)round($diskon, 2) : '0'),
                    'jml_potongan'  => (float)$jml_pot,
                    'jml_subtotal'  => (float)$jml_subtotal,
                    'jml_gtotal'    => (float)$jml_subtotal,
                    'status'        => '5',
                );
                
                # Transactional Database
                $this->db->trans_off();
                $this->db->trans_start();
                
                # Kueri MySQL tulis disini
                if($sql_medc->status < 5){
                    # Update data nota dll
                    $this->db->where('id', general::dekrip($id))->update('tbl_trans_medcheck', $data);           
                      
                    foreach ($sql_medc_det2 as $medc_det){
                        $sql_item        = $this->db->where('id', $medc_det->id_item)->get('tbl_m_produk')->row();
                        $sql_item_ref    = $this->db->where('id_produk', $sql_item->id)->get('tbl_m_produk_ref');   
                        $sql_satuan      = $this->db->where('id', $sql_item->id_satuan)->get('tbl_m_satuan')->row();
                        $sql_gudang      = $this->db->where('status', '1')->get('tbl_m_gudang')->row();         # Cek gudang aktif dari gudang utama
    
                          
                        # Item racikan kumpulkan dahulu disini
                        if(!empty($medc_det->resep)){
                              foreach (json_decode($medc_det->resep) as $rc){
                                  $sql_item_rc          = $this->db->where('id', $rc->id_item)->get('tbl_m_produk')->row();
                                  $sql_gudang_stok_rc   = $this->db->where('id_gudang', $sql_gudang->id)->where('id_produk', $sql_item_rc->id)->get('tbl_m_produk_stok')->row();
                                  
                                  # Cek resep Item stockable atau tidak ? 
                                  if($sql_item_rc->status_subt == '1'){
                                      $jml_akhir_rc         = $sql_item_rc->jml - $rc->jml;
                                      $jml_akhir_rc_stk     = $sql_gudang_stok_rc->jml - $rc->jml;
                                      
                                      $data_item_rc = array(
                                          'tgl_modif'  => date('Y-m-d H:i:s'),
                                          'jml'        => $jml_akhir_rc, # ($jml_akhir_rc < 0 ? 0 : (int) $jml_akhir_rc)
                                      );
                                      
                                      $data_item_rc_stk = array(
                                          'tgl_modif'  => date('Y-m-d H:i:s'),
                                          'jml'        => $jml_akhir_rc_stk,
                                      );
                                      
                                      $data_stok_trace_rc = array(
                                          'tgl_simpan'        => date('Y-m-d H:i:s'),
                                          'tgl_masuk'         => $sql_medc->tgl_masuk,
                                          'id_medcheck'       => $sql_medc->id,
                                          'id_medcheck_det'   => $rc->id, 
                                          'id_gudang'         => $sql_gudang->id, 
                                          'id_item'           => $sql_item_rc->id,
                                          'item'              => $sql_item_rc->produk,
                                          'stok_awal'         => $sql_gudang_stok_rc->jml, 
                                          'jml'               => $rc->jml, 
                                          'stok_akhir'        => $jml_akhir_rc_stk, 
                                          'keterangan'        => 'Racikan',
                                          'status'            => $sql_item_rc->status,
                                      );
                                      
                                      $data_penj_hist_rc = array(
                                          'tgl_simpan'    => date('Y-m-d H:i:s'),
                                          'tgl_masuk'     => $sql_medc->tgl_masuk,
                                          'id_gudang'     => $sql_gudang->id,
                                          'id_pelanggan'  => $sql_medc->id_pasien,
                                          'id_produk'     => $sql_item_rc->id,
                                          'id_user'       => $this->ion_auth->user()->row()->id,
                                          'id_penjualan'  => $sql_medc->id,
                                          'no_nota'       => $no_nota,
                                          'kode'          => $sql_item_rc->kode,
                                          'produk'        => $sql_item_rc->produk,
                                          'keterangan'    => $sql_medc->pasien.' - RACIKAN',
                                          'jml'           => (int)$rc->jml,
                                          'jml_satuan'    => (int)$sql_satuan->jml,
                                          'satuan'        => $sql_satuan->satuanTerkecil,
                                          'nominal'       => (float)$rc->harga,
                                          'status'        => '4'
                                      );
                                      
//                                      # Kurangi stok di database item yang relate ke racikan
//                                      $this->db->where('id', $rc->id_item)->update('tbl_m_produk', $data_item_rc);
//                                      
//                                      # Kurangi stok sesuai gudang utama
//                                      $this->db->where('id_gudang', $sql_gudang->id)->where('id_produk', $sql_item_rc->id)->update('tbl_m_produk_stok', $jml_akhir_rc_stk);
//                                      
                                      # Simpan ke tabel riwayat produk
                                      $this->db->insert('tbl_m_produk_hist', $data_penj_hist_rc);
                                      
                                      # Simpan ke tabel stok produk trace
                                      $this->db->insert('tbl_trans_medcheck_stok', $data_stok_trace_rc);
                                  }
                              }
                          }                      
                        # -- END OF RACIKAN
                          
                        # Cek Item Produk non resep stockable
                        if($sql_item->status_subt == '1'){
//                                $sql_gudang_stok = $this->db->where('id_gudang', $sql_gudang->id)->where('id_produk', $sql_item->id)->get('tbl_m_produk_stok')->row();
                                $sql_gudang_stok = $this->db->select('SUM(jml) AS jml')->where('id_produk', $sql_item->id)->get('tbl_m_produk_stok')->row();
                                $jml_akhir       = $sql_item->jml - $medc_det->jml;
                                $jml_akhir_stk   = $sql_gudang_stok->jml - $medc_det->jml;
                                                    
                                $data_item = array(
                                    'tgl_modif'  => date('Y-m-d H:i:s'),
                                    'jml'        => $jml_akhir,     # ($jml_akhir < 0 ? 0 : (int) $jml_akhir)
                                );
                                                    
                                $data_item_stk = array(
                                    'tgl_modif'  => date('Y-m-d H:i:s'),
                                    'jml'        => $jml_akhir_stk, # ($jml_akhir < 0 ? 0 : (int) $jml_akhir)
                                );
                                                    
                                $data_stok_trace = array(
                                    'tgl_simpan'        => date('Y-m-d H:i:s'),
                                    'tgl_masuk'         => $sql_medc->tgl_masuk,
                                    'id_medcheck'       => $sql_medc->id,
                                    'id_medcheck_det'   => $medc_det->id, 
                                    'id_gudang'         => $sql_gudang->id, 
                                    'id_item'           => $sql_item->id, 
                                    'item'              => $sql_item->produk, 
                                    'stok_awal'         => $sql_gudang_stok->jml, 
                                    'jml'               => $medc_det->jml, 
                                    'stok_akhir'        => $jml_akhir_stk, 
                                    'status'            => $sql_item->status, 
                                );
                                
                                $data_penj_hist = array(
                                    'tgl_simpan'    => date('Y-m-d H:i:s'),
                                    'tgl_masuk'     => $sql_medc->tgl_masuk,
                                    'id_gudang'     => $sql_gudang->id,
                                    'id_pelanggan'  => $sql_medc->id_pasien,
                                    'id_produk'     => $sql_item->id,
                                    'id_user'       => $this->ion_auth->user()->row()->id,
                                    'id_penjualan'  => $sql_medc->id,
                                    'no_nota'       => $no_nota,
                                    'kode'          => $sql_item->kode,
                                    'produk'        => $sql_item->produk,
                                    'keterangan'    => $sql_medc->pasien,
                                    'jml'           => (int)$medc_det->jml,
                                    'jml_satuan'    => (int)$sql_satuan->jml,
                                    'satuan'        => $sql_satuan->satuanTerkecil,
                                    'nominal'       => (float)$medc_det->harga,
                                    'status'        => '4'
                                );
                                
//                                # Kurangi Stok Item Stockable Non Racikan
//                                $this->db->where('id', $sql_item->id)->update('tbl_m_produk', $data_item);
//                                
//                                # Kurangi Stok Item Stockable Non Racikan yang terdapat di gudang utama
//                                $this->db->where('id_gudang', $sql_gudang->id)->where('id_produk', $sql_item->id)->update('tbl_m_produk_stok', $data_item_stk);
                                
                                # Simpan ke tabel riwayat produk
                                $this->db->insert('tbl_m_produk_hist', $data_penj_hist);
                                
                                # Simpan ke tabel stok produk trace
                                $this->db->insert('tbl_trans_medcheck_stok', $data_stok_trace);
                          }                      
                        # -- END OF ITEM
                          
                        # Jika punya refrensi item, maka jabarkan dulu
                        if($sql_item_ref->num_rows() > 0){
                                foreach ($sql_item_ref->result() as $reff){
                                    $sql_item_rf        = $this->db->where('id', $reff->id_produk_item)->get('tbl_m_produk')->row();
                                    $sql_item_sat_rf    = $this->db->where('id', $reff->id_satuan)->get('tbl_m_satuan')->row();
                                    $sql_gudang_stok    = $this->db->where('id_gudang', $sql_gudang->id)->where('id_produk', $sql_item_rf->id)->get('tbl_m_produk_stok')->row();
                                    $rf_subtot          = $sql_item_rf->harga_jual * $reff->jml;
                                  
                                    # Cek apakah stockabel
                                    if($sql_item_rf->status_subt == '1'){
                                        $jml_akhir_reff     = $sql_item_rf->jml - ($reff->jml * $medc_det->jml);
                                        $jml_akhir_reff_stk = $sql_gudang_stok->jml - ($reff->jml * $medc_det->jml);
                                  
                                        $data_item_reff = array(
                                            'tgl_modif'  => date('Y-m-d H:i:s'),
                                            'jml'        => $jml_akhir_reff
                                        );
                                  
                                        $data_item_reff_stk = array(
                                            'tgl_modif'  => date('Y-m-d H:i:s'),
                                            'jml'        => $jml_akhir_reff_stk
                                        );
                                        
                                        $data_stok_trace_rf = array(
                                            'tgl_simpan'        => date('Y-m-d H:i:s'),
                                            'tgl_masuk'         => $sql_medc->tgl_masuk,
                                            'id_medcheck'       => $sql_medc->id,
                                            'id_medcheck_det'   => $medc_det->id, 
                                            'id_gudang'         => $sql_gudang_stok->id_gudang, 
                                            'id_item'           => $sql_item_rf->id,
                                            'item'              => $sql_item_rf->produk, 
                                            'stok_awal'         => $sql_gudang_stok->jml, 
                                            'jml'               => ($reff->jml * $medc_det->jml), 
                                            'stok_akhir'        => $jml_akhir_reff_stk,
                                            'keterangan'        => 'Reff',
                                            'status'            => $sql_item_rf->status,
                                        );
                                                                        
                                        $data_penj_hist_rf = array(
                                            'tgl_simpan'    => date('Y-m-d H:i:s'),
                                            'tgl_masuk'     => $sql_medc->tgl_masuk,
                                            'id_gudang'     => $sql_gudang->id,
                                            'id_pelanggan'  => $sql_medc->id_pasien,
                                            'id_produk'     => $sql_item_rf->id,
                                            'id_user'       => $this->ion_auth->user()->row()->id,
                                            'id_penjualan'  => $sql_medc->id,
                                            'no_nota'       => $no_nota,
                                            'kode'          => $sql_item_rf->kode,
                                            'produk'        => $sql_item_rf->produk,
                                            'keterangan'    => $sql_medc->pasien.' - REFERENCE ITEM',
                                            'jml'           => (int)($reff->jml * $medc_det->jml),
                                            'jml_satuan'    => (int)$sql_satuan->jml,
                                            'satuan'        => $sql_satuan->satuanTerkecil,
                                            'nominal'       => (float)$medc_det->harga,
                                            'status'        => '4'
                                        );
                                        
                                        $data_det = array(
                                            'tgl_simpan'    => date('Y-m-d H:i:s'),
                                            'tgl_modif'     => date('Y-m-d H:i:s'),
                                            'tgl_masuk'     => $sql_medc->tgl_masuk,
                                            'id_medcheck'   => (int)$sql_medc->id,
                                            'id_item'       => (int)$sql_item_rf->id,
                                            'id_item_kat'   => (int)$sql_item_rf->id_kategori,
                                            'id_item_sat'   => (int)$sql_item_rf->id_satuan,
                                            'id_user'       => (int)$this->ion_auth->user()->row()->id,
                                            'id_dokter'     => (int)$sql_medc->id_dokter,
                                            'kode'          => $sql_item_rf->kode,
                                            'item'          => $sql_item_rf->produk,
                                            'jml'           => (int)$reff->jml,
                                            'jml_satuan'    => $sql_item_sat_rf->jml, 
                                            'harga'         => $sql_item_rf->harga,
                                            'subtotal'      => $rf_subtot,
                                            'satuan'        => $sql_item_sat_rf->satuanBesar,
                                            'status'        => (!empty($status_itm) ? $status_itm : $sql_item->status),
                                            'status_pkt'    => '1',
                                        );  
                                                                            
//                                        # Kurangi stok, untuk item referensinya jika statusnya stockable
//                                        $this->db->where('id', $sql_item_rf->id)->update('tbl_m_produk', $data_item_reff);
//                                                                            
//                                        # Kurangi stok, untuk item referensinya jika statusnya stockable yang ada pada gudang utama
//                                        $this->db->where('id_produk', $sql_item_rf->id)->update('tbl_m_produk_stok', $data_item_reff_stk);
                                        
                                        # Simpan te tabel riwayat produk
                                        $this->db->insert('tbl_trans_medcheck_det', $data_det);
                                        
                                        # Simpan te tabel riwayat produk
                                        $this->db->insert('tbl_m_produk_hist', $data_penj_hist_rf);
                                
                                        # Simpan ke tabel stok produk trace
                                        $this->db->insert('tbl_trans_medcheck_stok', $data_stok_trace_rf);
                                    }
                                }
                            }
                          
                        # Kalau remun tidak kosong, maka lakukan simpan
                        # Remun untuk menghitung pendapatan dokter                        
                        if($sql_item->remun_tipe > 0){
                            # Cek Remun (lab atau radiologi)
                            if($sql_item->status == '5'){
                                $sql_rad    = $this->db->where('id', $medc_det->id_rad)->get('tbl_trans_medcheck_rad')->row();
                                $dokter     = (!empty($sql_rad->id_dokter) ? $sql_rad->id_dokter : $medc_det->id_dokter); 
                            }else{
                                $dokter     = $medc_det->id_dokter; 
                            }
                            
                            $sql_cek_remun = $this->db
                                                  ->where('id_medcheck', $sql_medc->id)
                                                  ->where('id_medcheck_det', $medc_det->id)
                                                  ->where('id_dokter', $medc_det->id_dokter)
                                                  ->where('id_item', $sql_item->id)
                                                  ->get('tbl_trans_medcheck_remun');
                            
                            # Tentukan remun tipenya dan hitung total remunnya
                            $remun      = ($sql_item->remun_tipe == '2' ? $sql_item->remun_nom : (($sql_item->remun_perc / 100) * $medc_det->harga));
                            $remun_tot  = $remun * $medc_det->jml;
                            
                            $data_remun = array(
                                'id_medcheck'       => (int)$sql_medc->id,
                                'id_medcheck_det'   => (int)$medc_det->id,
                                'id_dokter'         => (int)$dokter,
                                'id_item'           => (int)$sql_item->id,
                                'tgl_simpan'        => date('Y-m-d H:i:s'),
                                'item'              => $sql_item->produk,
                                'harga'             => (float)$medc_det->harga,
                                'jml'               => (float)$medc_det->jml,
                                'remun_perc'        => (float)$sql_item->remun_perc,
                                'remun_nom'         => (float)$sql_item->remun_nom,
                                'remun_tipe'        => (int)$sql_item->remun_tipe,
                                'remun_subtotal'    => (float)$remun_tot,
                            );

                            # Cek jika ada tidak ada value kembar
                            if($sql_cek_remun->num_rows() == 0){
                                # Simpan ke tabel Remun
                                $this->db->insert('tbl_trans_medcheck_remun', $data_remun);
                            }
                        }
                          
                        # Kalau apresiasi tidak kosong, maka lakukan simpan
                        # Apresiasi untuk menghitung pendapatan dari lab
                        if($sql_item->apres_tipe > 0){
                            # Cek Apresiasi asas (lab atau radiologi)
                            if(!empty($medc_det->id_rad)){
                                $sql_rad    = $this->db->where('id', $medc_det->id_rad)->get('tbl_trans_medcheck_rad')->row();
                                $dokter     = (!empty($sql_rad->id_dokter_kirim) ? $sql_rad->id_dokter_kirim : $medc_det->id_dokter); 
                            }elseif(!empty($medc_det->id_lab)){
                                $sql_lab    = $this->db->where('id', $medc_det->id_lab)->get('tbl_trans_medcheck_lab')->row();
                                $dokter     = (!empty($sql_lab->id_dokter) ? $sql_lab->id_dokter : $medc_det->id_dokter);                                
                            }else{
                                $dokter     = $medc_det->id_dokter; 
                            }
                            
                            
                            $sql_cek_apres = $this->db
                                                  ->where('id_medcheck', $sql_medc->id)
                                                  ->where('id_medcheck_det', $medc_det->id)
                                                  ->where('id_dokter', $medc_det->id_dokter)
                                                  ->where('id_item', $sql_item->id)
                                                  ->get('tbl_trans_medcheck_apres');
                            
                            # Tentukan apresiasi tipenya dan hitung total remunnya
                            $apres      = ($sql_item->apres_tipe == '2' ? $sql_item->apres_nom : (($sql_item->apres_perc / 100) * $medc_det->harga));
                            $apres_tot  = $apres * $medc_det->jml;
                            
                            $data_apres = array(
                                'id_medcheck'       => (int)$sql_medc->id,
                                'id_medcheck_det'   => (int)$medc_det->id,
                                'id_dokter'         => (int)$dokter,
                                'id_item'           => (int)$sql_item->id,
                                'tgl_simpan'        => date('Y-m-d H:i:s'),
                                'item'              => $sql_item->produk,
                                'harga'             => (float)$medc_det->harga,
                                'jml'               => (float)$medc_det->jml,
                                'apres_perc'        => (float)$sql_item->apres_perc,
                                'apres_nom'         => (float)$sql_item->apres_nom,
                                'apres_tipe'        => (int)$sql_item->apres_tipe,
                                'apres_subtotal'    => (float)$apres_tot,
                            );
                            
                            # Cek jika ada tidak ada value kembar
                            if($sql_cek_apres->num_rows() == 0){
                                # Simpan ke tabel Apres
                                $this->db->insert('tbl_trans_medcheck_apres', $data_apres);
                            }
                        }
                    }
                    
                    # Setelah semua proses tersimpan, saat nya mengurangi stok
                    # Ambil data dari tabel tracer stok sementara
                    $sql_medc_stok = $this->db->where('id_medcheck', $sql_medc->id)->get('tbl_trans_medcheck_stok')->result();
                    
                    foreach ($sql_medc_stok as $stok){
                        # Ambil data stok dari item dari gudang dan item terkait
                        $sql_gudang_stok    = $this->db->where('id_gudang', $stok->id_gudang)->where('id_produk', $stok->id_item)->get('tbl_m_produk_stok')->row();
                        
                        # Hitung ulang secara live, stok saat ini dikurangi stok yang keluar
                        $stok_akhir         = $sql_gudang_stok->jml - $stok->jml;
                        
                        # Kumpulkan informasi pengurangan stok disini
                        $data_stok = array(
                            'tgl_modif' => date('Y-m-d H:i:s'),
                            'jml'       => $stok_akhir
                        );
                        
                        # Simpan stok akhir ke tabel gudang,update stok nya
                        $this->db->where('id', $sql_gudang_stok->id)->update('tbl_m_produk_stok', $data_stok);
                        
                        # Kumpulkan informasi pengurangan stok pada tabel tracer stok disini
                        $data_stok_trace = array(
                            'stok_awal'     => $sql_gudang_stok->jml,
                            'stok_akhir'    => $stok_akhir
                        );
                        
                        # Update pada tabel tracer stok nya
                        $this->db->where('id', $stok->id)->update('tbl_trans_medcheck_stok', $data_stok_trace);
                        
                        # Sinkronkan stok atas dan bawah, kemudian jumlahkan dengan sum dan catat sementara
                        $stok_glob = $this->db->select_sum('jml')->where('id_produk', $stok->id_item)->get('tbl_m_produk_stok')->row();
                        
                        # Stok atas bawah yang sinkron, catat disini
                        $data_stok_glob = array(
                            'tgl_modif' => date('Y-m-d H:i:s'),
                            'jml'       => $stok_glob->jml
                        );
                        
                        # Simpan stok akhir global ke tabel master item utama
                        $this->db->where('id', $stok->id_item)->update('tbl_m_produk', $data_stok_glob);
                    }

                    $this->session->set_flashdata('medcheck', '<div class="alert alert-success">Transaksi berhasil di proses !!</div>');
                }else{
                    $this->session->set_flashdata('medcheck', '<div class="alert alert-danger">Transaksi sudah pernah di proses !!</div>');
                }
                
                # Poin Pasien
                if($sql_poin->num_rows() == 0){
                    $data_poin = array(
                        'id_pasien'     => $sql_medc->id_pasien,
                        'tgl_simpan'    => date('Y-m-d H:i:s'),
                        'tgl_modif'     => date('Y-m-d H:i:s'),
                        'jml_poin'      => 0,
                        'jml_poin_nom'  => 0,
                        'status'        => 1,
                    );
                    
                    $this->db->insert('tbl_m_pasien_poin', $data_poin);
                }
                
                $this->db->trans_complete();
                
                # Kirim pesan gagal atau sukses
                if ($this->db->trans_status() === FALSE) {
                    # Rollback
                    $this->db->trans_rollback();

                    $this->session->set_flashdata('medcheck', '<div class="alert alert-danger">Transaksi gagal di proses !!</div>');
                } else {
                    # Complete
                    $this->db->trans_commit();

                    $this->session->set_flashdata('medcheck', '<div class="alert alert-success">Transaksi berhasil di proses !!</div>');
                }
                
                redirect(base_url('medcheck/index.php?tipe='.$sql_medc->tipe));
            }
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }


    public function set_medcheck_proses_batal(){
        if (akses::aksesLogin() == TRUE) {
            $id         = $this->input->post('id');
            $status     = $this->input->post('status');
            
            $this->form_validation->set_error_delimiters('<div class="alert alert-danger">', '</div>');

            $this->form_validation->set_rules('id', 'ID', 'required');

            if ($this->form_validation->run() == FALSE) {
                $msg_error = array(
                    'id'        => form_error('id'),
                );

                $this->session->set_flashdata('anamnesa', $msg_error);

                redirect(base_url('medcheck/tambah.php?id='.$id));
            } else {
                $sql_medc       = $this->db->where('id', general::dekrip($id))->get('tbl_trans_medcheck')->row();
                $sql_medc_det   = $this->db->select('SUM(potongan) AS potongan, SUM(diskon) AS diskon, SUM(subtotal) AS subtotal')->where('id_medcheck', $sql_medc->id)->get('tbl_trans_medcheck_det')->row();   
                $sql_medc_det2  = $this->db->where('id_medcheck', $sql_medc->id)->get('tbl_trans_medcheck_det')->result(); 
                $pengaturan     = $this->db->get('tbl_pengaturan')->row();
                
                $jml_total      = $sql_medc_det->subtotal + $sql_medc_det->potongan + $sql_medc_det->diskon;
                
                $data = array(
                    'tgl_modif'     => date('Y-m-d H:i:s'),
                    'jml_total'     => $jml_total,
                    'jml_potongan'  => 0,
                    'jml_diskon'    => 0,
                    'diskon'        => 0,
                    'jml_subtotal'  => 0,
                    'jml_gtotal'    => 0,
                    'status'        => '2',
                );
                
                
                # Transactional Database
                // $this->db->query('SET autocommit = 0;');
                $this->db->trans_start();
                
                # Update data nota dll
                $this->db->where('id', general::dekrip($id))->update('tbl_trans_medcheck', $data);         
                  
                foreach ($sql_medc_det2 as $medc_det){
                      $sql_item        = $this->db->where('id', $medc_det->id_item)->get('tbl_m_produk')->row();
                      $sql_item_ref    = $this->db->where('id_produk', $sql_item->id)->get('tbl_m_produk_ref');   
                      $sql_satuan      = $this->db->where('id', $sql_item->id_satuan)->get('tbl_m_satuan')->row();
                      $sql_gudang      = $this->db->where('status', '1')->get('tbl_m_gudang')->row();    // Cek gudang aktif dari gudang utama

                      
                      # Item racikan kumpulkan dahulu disini
                      if(!empty($medc_det->resep)){                          
                          foreach (json_decode($medc_det->resep) as $rc){
                              $sql_item_rc          = $this->db->where('id', $rc->id_item)->get('tbl_m_produk')->row();
                              $sql_gudang_stok_rc   = $this->db->where('id_gudang', $sql_gudang->id)->where('id_produk', $sql_brg->id)->get('tbl_m_produk_stok')->row();
                              
                              # Cek resep Item stockable atau tidak ? 
                              if($sql_item_rc->status_subt == '1'){
                                  $jml_akhir_rc         = $sql_item_rc->jml + $rc->jml;
                                  $jml_akhir_stk        = $sql_gudang_stok_rc->jml + $rc->jml;
                                  
                                  $data_item_rc = array(
                                      'tgl_modif'  => date('Y-m-d H:i:s'),
                                      'jml'        => ($jml_akhir_rc < 0 ? 0 : (int) $jml_akhir_rc)
                                  );
                                  
//                                  # Balikin stok di database item yang relate ke racikan
//                                  $this->db->where('id', $rc->id_item)->update('tbl_m_produk', $data_item_rc);
                                  
                                  # Hapus ke tabel riwayat produk
                                  $this->db->where('id_penjualan', $sql_medc->id)->where('id_produk', $sql_item_rc->id)->delete('tbl_m_produk_hist');
                                  
                              }
                          }
                      }                      
                      # -- END OF RACIKAN
                      
                      # Cek Item Produk non resep stockable
                      if($sql_item->status_subt == '1'){
                            $sql_gudang_stok = $this->db->where('id_gudang', $sql_gudang->id)->where('id_produk', $sql_item->id)->get('tbl_m_produk_stok')->row();
                            $jml_akhir       = $sql_item->jml + $medc_det->jml;
                            $jml_akhir_stk   = $sql_gudang_stok->jml + $medc_det->jml;
                                                
                            $data_item = array(
                                'tgl_modif'  => date('Y-m-d H:i'),
                                'jml'        => ($jml_akhir < 0 ? 0 : (int) $jml_akhir)
                            );
                                                
                            $data_item_stk  = array(
                                'tgl_modif'  => date('Y-m-d H:i'),
                                'jml'        => ($jml_akhir_stk < 0 ? 0 : (int) $jml_akhir_stk)
                            );
                            
//                            # Balikin Stok Item Stockable Non Racikan
//                            $this->db->where('id', $sql_item->id)->update('tbl_m_produk', $data_item);
//                            
//                            # Balikin Stok Item Stockable Non Racikan sesuai gudang masing2
//                            $this->db->where('id_gudang', $sql_gudang->id)->where('id_produk', $sql_item->id)->update('tbl_m_produk_stok', $data_item_stk);
                            
                            # Hapus ke tabel riwayat produk
                            $this->db->where('id_penjualan', $sql_medc->id)->where('id_produk', $sql_item->id)->delete('tbl_m_produk_hist');
                      }                      
                      # -- END OF ITEM
                      
                      # Jika punya refrensi item, maka jabarkan dulu
                        if($sql_item_ref->num_rows() > 0){
                            foreach ($sql_item_ref->result() as $reff){
                                $sql_item_rf      = $this->db->where('id', $reff->id_produk_item)->get('tbl_m_produk')->row();
                                $sql_gudang_stok  = $this->db->where('id_gudang', $sql_gudang->id)->where('id_produk', $sql_item_rf->id)->get('tbl_m_produk_stok')->row();
                              
                                # Cek apakah stockabel
                                if($sql_item_rf->status_subt == '1'){
                                    $jml_akhir_reff   = $sql_item_rf->jml + ($reff->jml * $medc_det->jml);
                              
                                    $data_item_reff = array(
                                        'tgl_modif'  => date('Y-m-d H:i:s'),
                                        'jml'        => $jml_akhir_reff
                                    );
                                    
                                    $data_item_reff = array(
                                        'tgl_modif'  => date('Y-m-d H:i:s'),
                                        'jml'        => $jml_akhir_reff
                                    );                                    
                                                                                                            
//                                    # Balikin stok, untuk item referensinya jika statusnya stockable
//                                    $this->db->where('id', $reff->id_produk_item)->update('tbl_m_produk', $data_item_reff);
                                    
                                    # Hapus te tabel riwayat produk
                                    $this->db->where('id_penjualan', $sql_medc->id)->where('id_produk', $sql_item_rf->id)->delete('tbl_m_produk_hist');
                                }
                            }
                        }
                }
                
                # Ambil data dari tabel trace
                $sql_medc_stok = $this->db->where('id_medcheck', $sql_medc->id)->get('tbl_trans_medcheck_stok')->result();
                
                foreach ($sql_medc_stok as $stok){
                    $sql_gudang_stok    = $this->db->where('id_gudang', $stok->id_gudang)->where('id_produk', $stok->id_item)->get('tbl_m_produk_stok')->row();
                    $stok_akhir         = $sql_gudang_stok->jml + $stok->jml;
                    
                    $data_stok = array(
                        'tgl_modif' => date('Y-m-d H:i:s'),
                        'jml'       => $stok_akhir
                    );
                    
                    # Simpan stok akhir ke tabel gudang
                    $this->db->where('id', $sql_gudang_stok->id)->update('tbl_m_produk_stok', $data_stok);
                    $stok_glob = $this->db->select_sum('jml')->where('id_produk', $stok->id_item)->get('tbl_m_produk_stok')->row();
                    
                    $data_stok_glob = array(
                        'tgl_modif' => date('Y-m-d H:i:s'),
                        'jml'       => $stok_glob->jml
                    );
                    
                    # Simpan stok akhir global ke tabel master item
                    $this->db->where('id', $stok->id_item)->update('tbl_m_produk', $data_stok_glob);
                }
                
                # Hapus catatan riwayat stok
                $this->db->where('id_medcheck', $sql_medc->id)->delete('tbl_trans_medcheck_stok');
                
                # Hapus Remun
                $this->db->where('id_medcheck', $sql_medc->id)->delete('tbl_trans_medcheck_remun');
                
                # Hapus Apres
                $this->db->where('id_medcheck', $sql_medc->id)->delete('tbl_trans_medcheck_apres'); 
                
                # Hapus Paket
                $this->db->where('id_medcheck', $sql_medc->id)->where('status_pkt', '1')->delete('tbl_trans_medcheck_det'); 
                
                # Trans Complete
                $this->db->trans_complete();
                
                # Kirim pesan gagal atau sukses
                if ($this->db->trans_status() === FALSE) {
                    # Rollback
                    $this->db->trans_rollback();
                    
                    $this->session->set_flashdata('medcheck', '<div class="alert alert-danger">Transaksi gagal di proses !!</div>');
                }else{
                    # Complete
                    $this->db->trans_commit();
                     
                    $this->session->set_flashdata('medcheck', '<div class="alert alert-success">Transaksi berhasil di proses !!</div>');
                }
                
                redirect(base_url('medcheck/tindakan.php?id='.general::enkrip($sql_medc->id)));
            }
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }

    public function set_medcheck_proses_farm() {
        if (akses::aksesLogin() == TRUE) {
            $id         = $this->input->post('id');
            $id_resep   = $this->input->post('id_resep');
            $status     = $this->input->post('status');
            $this->form_validation->set_error_delimiters('<div class="alert alert-danger">', '</div>');

            $this->form_validation->set_rules('id', 'ID', 'required');

            if ($this->form_validation->run() == FALSE) {
                $msg_error = array(
                    'id'        => form_error('id'),
                );

                $this->session->set_flashdata('anamnesa', $msg_error);

                redirect(base_url('medcheck/tambah.php?id='.$id));
            } else {
                $sql_medc        = $this->db->where('id', general::dekrip($id))->get('tbl_trans_medcheck');
                $sql_medc_resep  = $this->db->where('id_medcheck', general::dekrip($id))->where('id_resep', general::dekrip($id_resep))->get('tbl_trans_medcheck_resep_det');
                
                // Cek Barang Form
                if($sql_medc_resep->num_rows() > 0){
                    # Transaksi Start
                    $this->db->trans_start();
                    
                    # Delete Resep
                    $this->db->where('id_resep', general::dekrip($id_resep))->delete('tbl_trans_medcheck_det');
                    
                    foreach ($sql_medc_resep->result() as $cart){
                        $sql_racikan    = $this->db->select('SUM(subtotal) AS harga')->where('id_resep_det', $cart->id)->get('tbl_trans_medcheck_resep_det_rc')->row();
                        $sql_racikan_det= $this->db->where('id_resep_det', $cart->id)->get('tbl_trans_medcheck_resep_det_rc');
                        $harga          = $cart->harga;
                        $subtotal       = ($cart->jml * $cart->harga);
                        
                        $data_res_det = array(
                            'id_medcheck'   => (int)$cart->id_medcheck,
                            'id_resep'      => (int)$cart->id_resep,
                            'id_item'       => (int)$cart->id_item,
                            'id_item_kat'   => (int)$cart->id_item_kat,
                            'id_item_sat'   => (int)$cart->id_item_sat,
                            'id_user'       => (int)$cart->id_user,
                            'tgl_simpan'    => $cart->tgl_simpan,
                            'tgl_modif'     => date('Y-m-d H:i:s'),
                            'kode'          => $cart->kode,
                            'item'          => $cart->item,
                            'dosis'         => $cart->dosis,
                            'dosis_ket'     => $cart->dosis_ket,
                            'keterangan'    => $cart->keterangan,
                            'harga'         => (float)$harga,
                            'jml'           => (float)$cart->jml,
                            'jml_satuan'    => (int)$cart->jml_satuan,
                            'subtotal'      => (float)$subtotal,
                            'satuan'        => $cart->satuan,
                            'status_pj'     => $cart->status_pj,
                            'status'        => '4',
                        );
                        
                        # Simpan Resep
                        $this->db->insert('tbl_trans_medcheck_det', $data_res_det);
                        
                        # Obat racikan
                        if($sql_racikan_det->num_rows() > 0){
                            foreach ($sql_racikan_det->result() as $rc){
                                $data_rc_det = array(
                                    'id_medcheck'       => (int)$rc->id_medcheck,
                                    'id_resep'          => (int)$rc->id_resep,
                                    'id_resep_det'      => (int)$cart->id,
                                    'id_resep_det_rc'   => (int)$rc->id,
                                    'id_item'           => (int)$rc->id_item,
                                    'id_item_kat'       => (int)$rc->id_item_kat,
                                    'id_item_sat'       => (int)$rc->id_item_sat,
                                    'id_user'           => (int)$rc->id_user,
                                    'tgl_simpan'        => $rc->tgl_simpan,
                                    'tgl_modif'         => date('Y-m-d H:i:s'),
                                    'kode'              => $rc->kode,
                                    'item'              => $rc->item,
                                    'dosis'             => $rc->dosis,
                                    'dosis_ket'         => $rc->dosis_ket,
                                    'resep'             => $rc->resep,
                                    'harga'             => (float)$rc->harga,
                                    'jml'               => (float)$rc->jml,
                                    'jml_satuan'        => (int)$rc->jml_satuan,
                                    'subtotal'          => (float)$rc->subtotal,
                                    'satuan'            => $rc->satuan,
                                    'status_pj'         => $rc->status_pj,
                                    'status'            => '4',
                                    'status_rc'         => '1',
                                );
                                
                                $this->db->insert('tbl_trans_medcheck_det', $data_rc_det);
                            }
                        }
                    }

                    # Update Resep
                    $this->db->where('id', general::dekrip($id_resep))->update('tbl_trans_medcheck_resep', array('tgl_keluar'=>date('Y-m-d H:i:s'),'status'=>'4'));
                    $this->db->where('id', $sql_medc->row()->id)->update('tbl_trans_medcheck', array('tgl_resep_klr'=>date('Y-m-d H:i:s')));
                    $this->session->set_flashdata('medcheck_toast', 'toastr.success("Resep berhasil di proses");');

                    # Trans Complete
                    $this->db->trans_complete();
                }
                
                redirect(base_url('medcheck/tambah.php?act=res_input&id='.$id.'&id_resep='.$id_resep.'&status='.$status));
            }
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }

    public function set_medcheck_proses_farm_batal() {
        if (akses::aksesLogin() == TRUE) {
            $id         = $this->input->post('id');
            $id_resep   = $this->input->post('id_resep');
            $status     = $this->input->post('status');
            $this->form_validation->set_error_delimiters('<div class="alert alert-danger">', '</div>');

            $this->form_validation->set_rules('id', 'ID', 'required');

            if ($this->form_validation->run() == FALSE) {
                $msg_error = array(
                    'id'        => form_error('id'),
                );

                $this->session->set_flashdata('anamnesa', $msg_error);

                redirect(base_url('medcheck/tambah.php?id='.$id));
            } else {
                $sql_medc_resep  = $this->db->where('id_medcheck', general::dekrip($id))->get('tbl_trans_medcheck_resep_det');
                
                // Cek Barang Form
                if($sql_medc_resep->num_rows() > 0){
                    crud::delete('tbl_trans_medcheck_det','id_resep', general::dekrip($id_resep));
//                    $del = $this->db->where('id_resep', general::dekrip($id_resep))->get('tbl_trans_medcheck_det');

                    crud::update('tbl_trans_medcheck_resep', 'id', general::dekrip($id_resep), array('tgl_keluar'=>'0000-00-00 00:00:00','status'=>'2'));
                    $this->session->set_flashdata('medcheck_toast', 'toastr.error("Resep berhasil di batalkan");');
                }
                
                redirect(base_url('medcheck/tambah.php?act=res_input&id='.$id.'&id_resep='.$id_resep.'&status='.$status));
            }
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }
    

    public function set_medcheck_bayar() {
        if (akses::aksesLogin() == TRUE) {
            $no_nota        = general::dekrip($this->input->post('no_nota'));
            $tgl_byr        = explode('/',$this->input->post('tgl_bayar'));
            $metode_byr     = $this->input->post('metode_bayar');
            $bank           = $this->input->post('bank');
            $no_kartu       = $this->input->post('no_kartu');
            $jm_gttl        = str_replace('.', '', $this->input->post('jml_gtotal'));
            $disc           = $this->input->post('diskon');
            $jml_diskon     = str_replace('.', '', $this->input->post('jml_diskon'));
            $jm_byr         = str_replace('.', '', $this->input->post('jml_bayar'));
            $jml_biaya      = str_replace('.', '', $this->input->post('jml_biaya'));
            $jml_dp         = str_replace('.', '', $this->input->post('jml_total_dp'));
            $jml_ongkir     = str_replace('.', '', $this->input->post('jml_ongkir'));
            $jml_ongkir     = str_replace('.', '', $this->input->post('jml_ongkir'));
//            $jml_tot_poin   = str_replace('.', '', $this->input->post('jml_total_poin'));
            $jml_pot_poin   = str_replace('.', '', $this->input->post('potongan_poin'));

            $pengaturan = $this->db->get('tbl_pengaturan')->row();
            $this->form_validation->set_error_delimiters('<div class="alert alert-danger">', '</div>');

            $this->form_validation->set_rules('no_nota', 'ID Transaksi', 'required');
            $this->form_validation->set_rules('jml_bayar', 'Jml Bayar', 'required');
            $this->form_validation->set_rules('metode_bayar', 'Metode Pembayaran', 'required');

            if ($this->form_validation->run() == FALSE) {
                $msg_error = array(
                    'no_nota' => form_error('no_nota'),
                    'bayar'   => form_error('jml_bayar'),
                    'metode'  => form_error('metode_bayar'),
                );

                $this->session->set_flashdata('form_error', $msg_error);

                redirect(base_url('medcheck/invoice/bayar.php?id='.general::enkrip($no_nota)));
            } else {
                $jml_bayar      = $jm_byr + $jml_dp;
                $jml_gtotal     = $jm_gttl + $jml_dp + $jml_ongkir;
                
                $tgl_bayar      = date('Y-m-d');
                $sql_cek        = $this->db->where('id', $no_nota)->get('tbl_trans_medcheck')->row();
                $sql_cek_plat   = $this->db->where('id_medcheck', $sql_cek->id)->get('v_medcheck_plat')->num_rows();
                $sql_plat       = $this->db->where('id', $metode_byr)->get('tbl_m_platform')->row();
                $sql_medc_det   = $this->db->where('id_medcheck', $sql_cek->id)->get('tbl_trans_medcheck_det');
                $sql_medc_det_sm= $this->db->select('SUM(potongan_poin) as potongan_poin')->where('id_medcheck', $sql_cek->id)->get('tbl_trans_medcheck_det')->row();
                $sql_poin       = $this->db->where('id_pasien', $sql_cek->id_pasien)->get('tbl_m_pasien_poin')->row();
                
                # Jml Sisa Poin
                $jml_gtot_poin  = $sql_poin->jml_poin_nom - $jml_pot_poin;
                
                $jml_kurang     = $jml_gtotal - $jml_bayar;
                $jml_kembali    = $jml_bayar - $jml_gtotal;
                $diskon         = number_format((($sql_cek->jml_total - $jml_gtotal) / $sql_cek->jml_total) * 100, 2);
                $jml_tot_disk   = $sql_cek->jml_total - $jml_gtotal;
                $ppn            = ($sql_cek->status_ppn == '1' ? $sql_cek->ppn : '0');
                $jml_ppn        = ($sql_cek->status_ppn == '1' ? ($sql_cek->ppn / 100) * $jml_gtotal : '0');
                $gtotal         = ($sql_cek->status_ppn == '1' ? $jml_gtotal + $jml_ppn : $jml_gtotal);
                
                # Jml Poin
                $jml_poin       = $jml_gtotal / $pengaturan->jml_poin_nom;
                $jml_poin_nom   = floor($jml_poin) * $pengaturan->jml_poin;
                
                // Simpan platform pembayaran
                $data_platform = array(
                    'tgl_simpan'  => $tgl_bayar.' '.date('H:i:s'),
                    'id_platform' => $metode_byr,
                    'id_medcheck' => $no_nota,
                    'no_nota'     => $sql_cek->no_nota,
                    'platform'    => (!empty($bank) ? $bank : '-'),
                    'keterangan'  => (!empty($no_kartu) ? $no_kartu : ''),
                    'nominal'     => (float)$jml_bayar,
                );
                
                # Ceking jika sudah pernah di posting, maka tidak bisa posting
//                if($sql_cek->status == 5){    
                    /* Kalo pembayaran kurang */
                    if($sql_cek->status_bayar > 1){
                        $jml_tot_bayar  = $sql_cek->jml_bayar + $jml_bayar;
                        $jml_tot_biaya  = $sql_cek->jml_biaya + $jml_biaya;
                        $jml_tot_gtot   = $sql_cek->jml_gtotal + $jml_biaya;
                        $jml_sisa_bayar = $sql_cek->jml_kurang - $jml_bayar;
                        $jml_sisa_kmbli = $jml_tot_bayar - $sql_cek->jml_gtotal;
    
                        if($jml_sisa_bayar <= 0){
                            $trans = array(
                                'id_kasir'          => $this->ion_auth->user()->row()->id,
                                'tgl_bayar'         => $tgl_bayar.' '.date('H:i:s'),
                                'tgl_modif'         => date('Y-m-d H:i:s'),
                                'jml_ongkir'        => (float)$jml_ongkir,
                                'jml_potongan_poin' => (float)$jml_pot_poin,
                                'jml_gtotal'        => (float)$jml_tot_gtot,
                                'jml_bayar'         => $jml_tot_bayar,
                                'jml_kurang'        => (int)($jml_sisa_bayar < 0 ? 0 : $jml_sisa_bayar),
                                'jml_kembali'       => (int)($jml_sisa_kmbli < 0 ? 0 : $jml_sisa_kmbli),
                                'jml_poin'          => floor($jml_poin),
                                'jml_poin_nom'      => (float)$jml_poin_nom,
                                'status_bayar'      => '1',
                                'status_nota'       => '3',
                                'metode'            => $metode_byr,
                            );
                            
                            # Update ketersediaan kamar jika rawat inap
                            if($sql_cek->tipe == '3'){
                                $sql_medc_kamar = $this->db->where('id_medcheck', $sql_cek->id)->get('tbl_trans_medcheck_kamar')->row();
                                $sql_kamar      = $this->db->where('id', $sql_medc_kamar->id_kamar)->get('tbl_m_kamar')->row();
                                $jml            = $sql_kamar->jml - 1;
                                
                                $trans_kamar = array(
                                    'tgl_modif' => date('Y-m-d H:i:s'),
                                    'jml'       => $jml
                                );
                                
                                # Update jumlah kamar terpakainya
                                $this->db->where('id', $sql_kamar->id)->update('tbl_m_kamar', $trans_kamar);
                                
                                # Update status kamar terpakai menjadi inaktif
                                $this->db->where('id_medcheck', $sql_cek->id)->update('tbl_trans_medcheck_kamar', array('status' => '0'));
                            }
    
                            # Update Nota Penjualan grand total perhitungan
                            $this->db->where('id', $no_nota)->update('tbl_trans_medcheck', $trans);
                            
                            # POIN AKAN BERTAMBAH KETIKA TIPE BAYAR UMUM
                            if($sql_cek->tipe_bayar == '1' OR $sql_cek->tipe_bayar == '0'){
                                # Hitung ulang data poin
                                $poin           = $jml_pot_poin / $pengaturan->jml_poin;
                                $poin_sisa      = ($sql_poin->jml_poin - floor($poin)) + floor($jml_poin);
                                $poin_sisa_tot  = $poin_sisa * $pengaturan->jml_poin;

                                $data_poin = array(
                                    'tgl_modif'     => date('Y-m-d H:i:s'),
                                    'jml_poin'      => floor($poin_sisa),
                                    'jml_poin_nom'  => (float)$poin_sisa_tot,                        
                                );

                                $this->db->where('id', $sql_poin->id)->update('tbl_m_pasien_poin', $data_poin);
                            }
                            
                            # Simpan ke platfom pembayaran
                            $this->db->insert('tbl_trans_medcheck_plat', $data_platform);
                            
                             
                            # Redirected
                            $this->session->set_flashdata('medcheck', '<div class="alert alert-success">Transaksi berhasil dibayar !!</div>');
                            redirect(base_url('medcheck/invoice/detail.php?id='.general::enkrip($no_nota).'#jml_bayar')); 
                        }else{
                            $trans = array(
                                'tgl_bayar'    => $tgl_bayar.' '.date('H:i:s'),
                                'tgl_modif'    => date('Y-m-d H:i:s'),
                                'jml_ongkir'   => (float)$jml_ongkir,
                                'jml_gtotal'   => (float)$jml_tot_gtot,
                                'jml_bayar'    => $jml_tot_bayar,
                                'jml_kurang'   => (int)$jml_sisa_bayar,
                                'jml_poin'     => floor($jml_poin),
                                'jml_poin_nom' => (float)$jml_poin_nom,
                                'metode'       => $metode_byr,
                             );
    
                             # update nota
                             $this->db->where('id', $no_nota)->update('tbl_trans_medcheck', $trans);
                            
                             # Simpan ke platfom pembayaran
                             $this->db->insert('tbl_trans_medcheck_plat', $data_platform);
                             
                             $this->session->set_flashdata('medcheck', '<div class="alert alert-success">Transaksi berhasil dibayar !!</div>');
                             redirect(base_url('medcheck/invoice/bayar.php?id='.general::enkrip($no_nota).'#jml_bayar'));
                        }
                    }else{
                        /* Cek Pembayaran jika kurang, otomatis menjadi DP */
                        if($jml_bayar < $jml_gtotal){
                            $trans = array(
                                'tgl_bayar'    => $tgl_bayar.' '.date('H:i:s'),
                                'tgl_modif'    => date('Y-m-d H:i:s'),
                                'jml_ongkir'   => (float)$jml_ongkir,
//                                'jml_subtotal' => (float)$jml_gtotal,
//                                'diskon'       => (float)$diskon,
//                                'jml_diskon'   => (float)$jml_tot_disk,
                                'jml_gtotal'   => (float)$gtotal,
                                'jml_bayar'    => (float)$jml_bayar,
                                'jml_kurang'   => (int)$jml_kurang,
                                'jml_poin'     => floor($jml_poin),
                                'jml_poin_nom' => (float)$jml_poin_nom,
                                'status_bayar' => '2',
                                'metode'	   => $metode_byr,
                             );
    
                             # update nota
                             $this->db->where('id', $no_nota)->update('tbl_trans_medcheck', $trans);
    
                             # Simpan ke platfom pembayaran
                             $this->db->insert('tbl_trans_medcheck_plat', $data_platform);
    
                             redirect(base_url('medcheck/invoice/bayar.php?id='.general::enkrip($no_nota).'#jml_bayar'));
                        }else{                            
                            /* Jika jumlah pembayaran lunas */
                            $trans = array(
                                'id_kasir'          => $this->ion_auth->user()->row()->id,
                                'tgl_bayar'         => $tgl_bayar.' '.date('H:i:s'),
                                'tgl_keluar'        => date('Y-m-d H:i:s'),
//                                'jml_ongkir'        => (float)$jml_ongkir,
                                'jml_potongan_poin' => (float)$jml_pot_poin,
                                'jml_subtotal'      => (float)$jml_gtotal,
                                'jml_gtotal'        => (float)$gtotal,
                                'jml_bayar'         => (float)$jml_bayar,
                                'jml_kembali'       => (float)$jml_kembali,
                                'jml_poin'          => floor($jml_poin),
                                'jml_poin_nom'      => (float)$jml_poin_nom,
                                'status_bayar'      => '1',
                                'status_nota'       => '3',
                                'metode' 	   => $metode_byr,
                             );
                            
                            # Update ketersediaan kamar jika rawat inap
                            if($sql_cek->tipe == '3'){
                                $sql_medc_kamar = $this->db->where('id_medcheck', $sql_cek->id)->get('tbl_trans_medcheck_kamar')->row();
                                $sql_kamar      = $this->db->where('id', $sql_medc_kamar->id_kamar)->get('tbl_m_kamar')->row();
                                $jml            = $sql_kamar->jml - 1;
                                
                                $trans_kamar = array(
                                    'tgl_modif' => date('Y-m-d H:i:s'),
                                    'jml'       => $jml
                                );
                                
                                # Update jumlah kamar terpakainya
                                $this->db->where('id', $sql_kamar->id)->update('tbl_m_kamar', $trans_kamar);
                                
                                # Update status kamar terpakai menjadi inaktif
                                $this->db->where('id_medcheck', $sql_cek->id)->update('tbl_trans_medcheck_kamar', array('status' => '0'));
                            }
                                
                            # Update nota
                            $this->db->where('id', $no_nota)->update('tbl_trans_medcheck', $trans);
    
                            # Simpan ke platfom pembayaran
                            $this->db->insert('tbl_trans_medcheck_plat', $data_platform);
                                                
                            # POIN AKAN BERTAMBAH KETIKA TIPE BAYAR UMUM
                            if($sql_cek->tipe_bayar == '1' OR $sql_cek->tipe_bayar == '0'){
                                # Hitung ulang data poin
                                $poin           = $jml_pot_poin / $pengaturan->jml_poin;
                                $poin_sisa      = ($sql_poin->jml_poin - floor($poin)) + floor($jml_poin);
                                $poin_sisa_tot  = $poin_sisa * $pengaturan->jml_poin;

                                $data_poin = array(
                                    'tgl_modif'     => date('Y-m-d H:i:s'),
                                    'jml_poin'      => floor($poin_sisa),
                                    'jml_poin_nom'  => (float)$poin_sisa_tot,                        
                                );

                                $this->db->where('id', $sql_poin->id)->update('tbl_m_pasien_poin', $data_poin);
                            }
                            
                            # Hitung poin ditiap item
                            $sql_medc_det_poin  = $this->db->where('id_medcheck', $sql_cek->id)->where('status_pkt', '0')->get('tbl_trans_medcheck_det');
                            $jml_item           = $sql_medc_det_poin->num_rows();
                            $poin_item          = $jml_pot_poin / $jml_item;
                            
                            foreach ($sql_medc_det_poin->result() as $det){
                                $subtotal = $det->subtotal - $poin_item;
                                
                                $data_det = array(
                                    'tgl_modif'     => date('Y-m-d H:i:s'),
                                    'potongan_poin' => $poin_item,
                                    'subtotal'      => $subtotal
                                );
                                
                                $this->db->where('id', $det->id)->update('tbl_trans_medcheck_det', $data_det);
                            }
                             
                            $this->session->set_flashdata('medcheck', '<div class="alert alert-success">Transaksi berhasil dibayar !!</div>');
                            redirect(base_url('medcheck/invoice/detail.php?id='.general::enkrip($no_nota)));
                        }
                    }
            }
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }

    public function set_medcheck_bayar_batal() {
        if (akses::aksesLogin() == TRUE) {
            $no_nota    = general::dekrip($this->input->post('no_nota'));
            $id         = $this->input->post('id');
            $tgl_byr    = explode('/',$this->input->post('tgl_bayar'));
            $metode_byr = $this->input->post('metode_bayar');
            $bank       = $this->input->post('bank');
            $no_kartu   = $this->input->post('no_kartu');

            $pengaturan = $this->db->get('tbl_pengaturan')->row();
            $this->form_validation->set_error_delimiters('<div class="alert alert-danger">', '</div>');

            $this->form_validation->set_rules('id', 'ID Transaksi', 'required');

            if ($this->form_validation->run() == FALSE) {
                $msg_error = array(
                    'id' => form_error('id'),
                );

                $this->session->set_flashdata('form_error', $msg_error);

                redirect(base_url('medcheck/tindakan.php?id='.$id));
            } else {
                $tgl_bayar      = date('Y-m-d');
                $sql_cek        = $this->db->where('id', general::dekrip($id))->get('tbl_trans_medcheck')->row();
                $sql_medc_det   = $this->db->where('id_medcheck', $sql_cek->id)->get('tbl_trans_medcheck_det');
                $sql_medc_file  = $this->db->where('id_medcheck', $sql_cek->id)->where('status', '3')->get('tbl_trans_medcheck_file');
                $sql_poin       = $this->db->where('id_pasien', $sql_cek->id_pasien)->get('tbl_m_pasien_poin')->row();
                
                // Simpan platform pembayaran
                $data = array(
                    'jml_ongkir'    => 0,
                    'jml_bayar'     => 0,
                    'jml_kurang'    => 0,
                    'jml_kembali'   => 0,
                    'status_bayar'  => '0',
                );
                
                # Transactional Database
                // $this->db->query('SET autocommit = 0;');
                $this->db->trans_start();
                
                # Hapus Platform Pembayaran
                $this->db->where('id_medcheck', $sql_cek->id)->delete('tbl_trans_medcheck_plat');
                
                # Hapus File Bukti Bayar
                foreach ($sql_medc_file->result() as $file){
                    if(file_exists($file->file_name)){
                        unlink($file->file_name);
                    }
                    
                    $this->db->where('id', $file->id)->delete('tbl_trans_medcheck_file');
                }
                                
                # Update jumlah bayar dll
                $this->db->where('id', $sql_cek->id)->update('tbl_trans_medcheck', $data);
                
                # Hitung ulang data poin
                $poin           = $sql_cek->jml_potongan_poin / $pengaturan->jml_poin;
                $poin_sisa      = ($sql_poin->jml_poin - floor($sql_cek->jml_poin)) + floor($poin);
                $poin_sisa_tot  = $poin_sisa * $pengaturan->jml_poin;

                $data_poin = array(
                    'tgl_modif'     => date('Y-m-d H:i:s'),
                    'jml_poin'      => floor($poin_sisa),
                    'jml_poin_nom'  => (float) $poin_sisa_tot,
                );

                $this->db->where('id', $sql_poin->id)->update('tbl_m_pasien_poin', $data_poin);
                
                foreach ($sql_medc_det->result() as $det) {
                    $disk1      = $det->harga - (($det->disk1 / 100) * $det->harga);
                    $disk2      = $disk1 - (($det->disk2 / 100) * $disk1);
                    $disk3      = $disk2 - (($det->disk3 / 100) * $disk2);
                    $diskon     = $det->harga - $disk3;
                    $subtotal   = ($disk3 - $det->potongan) * (int)$det->jml;

                    $data_det = array(
                        'potongan_poin' => 0,
                        'subtotal'      => $subtotal
                    );

                    $this->db->where('id', $det->id)->update('tbl_trans_medcheck_det', $data_det);
                }

                # Trans Complete
                $this->db->trans_complete();
                
                # Kirim pesan gagal atau sukses
                if ($this->db->trans_status() === FALSE) {
                    # Rollback
                    $this->db->trans_rollback();
                    
                    $this->session->set_flashdata('medcheck', '<div class="alert alert-danger">Transaksi gagal di proses !!</div>');
                }else{
                    # Complete
                    $this->db->trans_commit();
                     
                    $this->session->set_flashdata('medcheck', '<div class="alert alert-success">Transaksi berhasil di proses !!</div>');
                }

                redirect(base_url('medcheck/tindakan.php?id='.general::enkrip($sql_cek->id)));

//                    echo '<pre>';
//                    print_r($trans);
//                    echo '</pre>';
            }
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }

    public function set_medcheck_lab() {
        if (akses::aksesLogin() == TRUE) {
            $id     = $this->input->get('id');
            $status = $this->input->get('status');
            
            if(!empty($id)){
                $sql_medc   = $this->db->where('id', general::dekrip($id))->get('tbl_trans_medcheck'); 
                $pengaturan = $this->db->get('tbl_pengaturan')->row();
                   
                $nomer      = $this->db->where('MONTH(tgl_simpan)', date('m'))->get('tbl_trans_medcheck_lab')->num_rows() + 1;
                $no_surat   = sprintf('%03d', $nomer).'/'.$pengaturan->kode_surat.'/'.date('m').'/'.date('Y');
                $grup       = $this->ion_auth->get_users_groups()->row();
                $is_farm    = ($grup->name == 'analis' ? '2' : '0');
                $is_farm_id = ($grup->name == 'analis' ? $this->ion_auth->user()->row()->id : '0');
                $is_doc_id  = ($grup->name == 'dokter' ? $this->ion_auth->user()->row()->id : '0');
               
                $data = array(
                    'tgl_simpan'    => date('Y-m-d H:i:s'),
                    'tgl_masuk'     => date('Y-m-d H:i:s'),
                    'id_medcheck'   => $sql_medc->row()->id,
                    'id_pasien'     => $sql_medc->row()->id_pasien,
                    'id_user'       => $this->ion_auth->user()->row()->id,
                    'id_analis'     => $is_farm_id,
                    'id_dokter'     => $is_doc_id,
                    'no_lab'        => $no_surat,
                    'status'        => '0',
                    'status_cvd'    => '0',
                );
                
                if($sql_medc->num_rows() > 0){
                    $this->session->set_flashdata('medcheck', '<div class="alert alert-success">Data permintaan lab di buat</div>');
                    crud::simpan('tbl_trans_medcheck_lab', $data);
                    $last_id = crud::last_id();
                    
                    $this->db->where('id', $sql_medc->row()->id)->update('tbl_trans_medcheck', array('tgl_periksa_lab' => date('Y-m-d H:i:s')));
                    
                    redirect(base_url('medcheck/tambah.php?id='.general::enkrip($sql_medc->row()->id).'&id_lab='.general::enkrip($last_id).'&status='.$status));
                }else{
                    redirect(base_url('medcheck/tambah.php?id='.general::enkrip($sql_medc->row()->id).'&status='.$status));
                }
            }else{
                redirect(base_url('medcheck/tambah.php?id='.general::enkrip($sql_medc->row()->id).'&status='.$status));
            }
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }
    
    public function set_medcheck_lab_upd() {
        if (akses::aksesLogin() == TRUE) {
            $id         = $this->input->post('id');
            $id_lab     = $this->input->post('id_lab');
            $tgl_masuk  = $this->input->post('tgl_masuk');
            $no_sample  = $this->input->post('no_sampel');
            $dokter     = $this->input->post('dokter');
            $ket        = $this->input->post('keterangan');
            $status     = $this->input->post('status');
            $is_cvd     = $this->input->post('status_cvd');
            $is_normal  = $this->input->post('status_normal');
            $is_duplo   = $this->input->post('duplo');
            $act        = $this->input->post('act');
            
            $this->form_validation->set_error_delimiters('<div class="alert alert-danger">', '</div>');

            $this->form_validation->set_rules('id', 'ID', 'required');
            $this->form_validation->set_rules('no_sampel', 'No Sample', 'required');

            if ($this->form_validation->run() == FALSE) {
                $msg_error = array(
                    'id'        => form_error('id'),
                    'no_sampel' => form_error('no_sampel'),
                );

                $this->session->set_flashdata('form_error', $msg_error);

                redirect(base_url('medcheck/tambah.php?id='.$id.'&status='.$status.'&act='.$act.'&id_lab='.$id_lab));
            } else {
                $sql_medc       = $this->db->where('id', general::dekrip($id))->get('tbl_trans_medcheck')->row(); 
                $pengaturan     = $this->db->get('tbl_pengaturan')->row();
                
                $data = array(
                    'tgl_masuk'     => $this->tanggalan->tgl_indo_sys($tgl_masuk).' '.date('H:i:s'),
                    'tgl_modif'     => date('Y-m-d H:i:s'),
                    'id_dokter'     => $dokter,
                    'no_sample'     => $no_sample,
                    'status_cvd'    => $is_cvd,
                    'ket'           => $ket,
                    'status'        => '1',
                    'status_normal' => (!empty($is_normal) ? $is_normal : '0'),
                    'status_duplo'  => (!empty($is_duplo) ? $is_duplo : '0'),
                );
                
                
                crud::update('tbl_trans_medcheck_lab', 'id', general::dekrip($id_lab), $data);

                $this->session->set_flashdata('medcheck', '<div class="alert alert-success">Data berhasil di update</div>');
                redirect(base_url('medcheck/tambah.php?id='.$id.'&status='.$status));
            }
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }
    
    public function set_medcheck_lab_upd_hsl() {
        if (akses::aksesLogin() == TRUE) {
            $id         = $this->input->post('id');
            $status     = $this->input->post('status');
            $hasil      = $_POST['hasil_lab'];
            
            $this->form_validation->set_error_delimiters('<div class="alert alert-danger">', '</div>');

            $this->form_validation->set_rules('id', 'ID', 'required');

            if ($this->form_validation->run() == FALSE) {
                $msg_error = array(
                    'id'        => form_error('id'),
                );

                $this->session->set_flashdata('anamnesa', $msg_error);

                redirect(base_url('medcheck/tambah.php?id='.$id.'status='.$status));
            } else {
                $sql_medc       = $this->db->where('id', general::dekrip($id))->get('tbl_trans_medcheck')->row(); 
                $pengaturan     = $this->db->get('tbl_pengaturan')->row();
                
                $data = array(
                    'tgl_simpan'    => date('Y-m-d H:i:s'),
                    'tgl_masuk'     => (!empty($tgl_masuk) ? $this->tanggalan->tgl_indo_sys($tgl_masuk) : date('Y-m-d')),
                    'tgl_keluar'    => $this->tanggalan->tgl_indo_sys($tgl_keluar),
                    'tgl_kontrol'   => $this->tanggalan->tgl_indo_sys($tgl_kontrol),
                    'id_medcheck'   => $sql_medc->id,
                    'id_dokter'     => $sql_medc->id_dokter,
                    'id_pasien'     => $sql_medc->id_pasien,
                    'id_user'       => $this->ion_auth->user()->row()->id,
                    'no_surat'      => $no_surat,
                    'tb'            => (float)general::format_angka_db($tb),
                    'td'            => $td,
                    'bb'            => (float)general::format_angka_db($bb),
                    'bw'            => $bw,
                    'jml_hari'      => (float)$jml_hari,
                    'hasil'         => $hasil,
                    'tipe'          => $tipe_surat
                );
                
                foreach ($hasil as $key => $hsl){
                    $item_id    = general::dekrip($key);
                    $item_lab   = $hsl;
                    
                    $data_lab = array(
                        'id_analis'     => $this->ion_auth->user()->row()->id,
                        'tgl_modif'     => date('Y-m-d H:i:s'),
                        'hasil_lab'     => $item_lab,
                    );
                    
                    crud::update('tbl_trans_medcheck_det', 'id', $item_id, $data_lab);
                }
                
                $this->db->where('id', $sql_medc->id)->update('tbl_trans_medcheck', array('tgl_periksa_lab_keluar'=>date('Y-m-d H:i:s'))); 

                $this->session->set_flashdata('medcheck', '<div class="alert alert-success">Hasil lab berhasil di simpan</div>');
                redirect(base_url('medcheck/tambah.php?id='.$id.'&status='.$status));
            }
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }
    
    public function set_medcheck_lab_print() {
        if (akses::aksesLogin() == TRUE) {
            $id         = $this->input->post('id');
            $id_lab     = $this->input->post('id_lab');
            $status     = $this->input->post('status');
            $act        = $this->input->post('act');
            
            $this->form_validation->set_error_delimiters('<div class="alert alert-danger">', '</div>');

            $this->form_validation->set_rules('id', 'ID', 'required');

            if ($this->form_validation->run() == FALSE) {
                $msg_error = array(
                    'id'        => form_error('id'),
                );

                $this->session->set_flashdata('anamnesa', $msg_error);

                redirect(base_url('medcheck/tambah.php?id='.$id.'status='.$status));
            } else {
                $sql_medc       = $this->db->where('id', general::dekrip($id))->get('tbl_trans_medcheck')->row(); 
                $pengaturan     = $this->db->get('tbl_pengaturan')->row();
                
                $this->db->where('status', '3')->where('id_medcheck', $sql_medc->id)->update('tbl_trans_medcheck_det', array('status_ctk' => '0'));
                $this->session->unset_userdata('lab_print');
                
                foreach ($_POST['print'] as $key => $print){
                    $cetak[] = array(
                        'id'            => $key,
                        'id_lab'        => $_POST['print_lab'][$key],
                        'id_lab_hsl'    => $_POST['print_lab_hsl'][$key],
                        'id_kat'        => $_POST['print_kat'][$key],
                        'value'         => $_POST['print'][$key],
                    );
                    
                    $this->db->where('id', $key)->update('tbl_trans_medcheck_det', array('status_ctk' => $_POST['print'][$key]));
                }
                
//                echo '<pre>';
//                print_r($cetak);
//                echo '</pre>';
                
                $this->session->set_userdata('lab_print', $cetak);

                $this->session->set_flashdata('medcheck', '<div class="alert alert-success">Hasil lab berhasil di simpan</div>');
                redirect(base_url('medcheck/surat/cetak_pdf_lab.php?id='.$id.'&id_lab='.$id_lab));
            }
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }

    public function set_medcheck_lab_hapus() {
        if (akses::aksesLogin() == TRUE) {
            $id         = $this->input->get('id');
            $item_id    = $this->input->get('item_id');
            $status     = $this->input->get('status');
            $userid     = $this->ion_auth->user()->row()->id;
            
            $sql_medc = $this->db->where('id', general::dekrip($id))->get('tbl_trans_medcheck');
            
            if($sql_medc->num_rows() > 0){
                $this->session->set_flashdata('medcheck', '<div class="alert alert-success">Transaksi berhasil dihapus</div>');
//                crud::delete('tbl_trans_medcheck_det', 'id_lab', general::dekrip($item_id));
//                crud::delete('tbl_trans_medcheck_lab', 'id', general::dekrip($item_id));
                
                /* Transaksi Database */
                $this->db->trans_begin();

                # Hapus ke tabel medcheck det
                $this->db->where('id_lab', general::dekrip($item_id))->delete('tbl_trans_medcheck_det');
                $this->db->where('id_lab', general::dekrip($item_id))->delete('tbl_trans_medcheck_lab_hsl');
                
                # Hapus ke tabel medcheck lab
                $this->db->where('id', general::dekrip($item_id))->delete('tbl_trans_medcheck_lab');

                # Cek status transact MySQL
                if ($this->db->trans_status() === FALSE) {
                    # Rollback jika gagal
                    $this->db->trans_rollback();

                    # Tampilkan pesan error
                    $this->session->set_flashdata('medcheck', '<div class="alert alert-danger">Data lab gagal dihapus !!</div>');
                } else {
                    $this->db->trans_commit();

                    # Tampilkan pesan sukses jika sudah berhasil commit
                    $this->session->set_flashdata('medcheck', '<div class="alert alert-success">Data lab berhasil dihapus !!</div>');
                }
            }

            redirect(base_url('medcheck/tambah.php?id='.$id.'&status='.$status));
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }

    public function set_medcheck_lab_spiro() {
        if (akses::aksesLogin() == TRUE) {
            $id     = $this->input->get('id');
            $status = $this->input->get('status');
            
            if(!empty($id)){
                $sql_medc   = $this->db->where('id', general::dekrip($id))->get('tbl_trans_medcheck'); 
                $sql_pasien = $this->db->where('id', $sql_medc->row()->id_pasien)->get('tbl_m_pasien')->row(); 
                $pengaturan = $this->db->get('tbl_pengaturan')->row();
                   
                $nomer      = $this->db->where('MONTH(tgl_simpan)', date('m'))->get('tbl_trans_medcheck_lab_spiro')->num_rows() + 1;
                $no_surat   = sprintf('%03d', $nomer).'/'.$pengaturan->kode_surat.'/'.date('m').'/'.date('Y');
                $grup       = $this->ion_auth->get_users_groups()->row();
                $is_farm    = ($grup->name == 'analis' ? '2' : '0');
                $is_farm_id = ($grup->name == 'analis' ? $this->ion_auth->user()->row()->id : '0');
                $is_doc_id  = ($grup->name == 'dokter' ? $this->ion_auth->user()->row()->id : '0');
               
                $data = array(
                    'tgl_simpan'    => date('Y-m-d H:i:s'),
                    'tgl_masuk'     => date('Y-m-d H:i:s'),
                    'id_medcheck'   => $sql_medc->row()->id,
                    'id_pasien'     => $sql_medc->row()->id_pasien,
                    'id_user'       => $this->ion_auth->user()->row()->id,
                    'id_analis'     => $is_farm_id,
                    'id_dokter'     => $is_doc_id,
                    'no_lab'        => $no_surat,
                    'status'        => '0',
                );
                
                if($sql_medc->num_rows() > 0){
                    $this->db->insert('tbl_trans_medcheck_lab_spiro', $data);
                    $last_id = crud::last_id();
                    
                    # Masukkan EKG ke tabel riwayat berkas
                    $data_file_ekg = array(
                        'id_medcheck'       => $sql_medc->row()->id,
                        'id_pasien'         => $sql_medc->row()->id_pasien,
                        'id_user'           => $this->ion_auth->user()->row()->id,
                        'id_berkas'         => $last_id,
                        'tgl_simpan'        => date('Y-m-d H:i:s'),
                        'tgl_masuk'         => date('Y-m-d H:i'),
                        'judul'             => 'HASIL ANALISA SPIROGRAM ('.$no_surat.')',
                        'keterangan'        => $sql_pasien->nama_pgl,
                        'file_name'         => '/medcheck/surat/cetak_pdf_lab_spiro.php?id='.general::enkrip($sql_medc->row()->id).'&id_lab='.general::enkrip($last_id),
                        'file_ext'          => '.pdf',
                        'file_type'         => 'application/pdf',
                        'status'            => '2',
                    );
                    $this->db->insert('tbl_trans_medcheck_file', $data_file_ekg);
                    
                    $this->session->set_flashdata('medcheck_toast', 'toastr.success("Permintaan spirometri sudah dibuat !");');
                    redirect(base_url('medcheck/tambah.php?act=pen_spirometri&id='.general::enkrip($sql_medc->row()->id).'&id_lab='.general::enkrip($last_id).'&status='.$status));
                }else{
                    redirect(base_url('medcheck/tambah.php?act=pen_spirometri&id='.general::enkrip($sql_medc->row()->id).'&status='.$status));
                }
            }else{
                redirect(base_url('medcheck/tambah.php?id='.general::enkrip($sql_medc->row()->id).'&status='.$status));
            }
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }

    public function set_medcheck_lab_spiro_upd() {
        if (akses::aksesLogin() == TRUE) {
            $id         = $this->input->post('id');
            $id_lab     = $this->input->post('id_lab_spiro');
            $tgl_masuk  = $this->input->post('tgl_masuk');
            $no_sample  = $this->input->post('no_sampel');
            $dokter     = $this->input->post('dokter');
            $keluhan    = $this->input->post('keluhan');
            $riwayat    = $this->input->post('riwayat');
            $anjuran    = $this->input->post('anjuran');
            $ref        = $this->input->post('ref');
            $tb         = $this->input->post('tb');
            $bb         = $this->input->post('bb');
            $imt        = $this->input->post('imt');
            $status     = $this->input->post('status');
            $is_rokok   = $this->input->post('status_rokok');
            $act        = $this->input->post('act');
            
            $this->form_validation->set_error_delimiters('<div class="alert alert-danger">', '</div>');

            $this->form_validation->set_rules('id', 'ID', 'required');
            $this->form_validation->set_rules('no_sampel', 'No Sample', 'required');
            $this->form_validation->set_rules('dokter', 'dokter', 'required');
            $this->form_validation->set_rules('status_rokok', 'Rokok', 'required');
            $this->form_validation->set_rules('tb', 'TB', 'required');
            $this->form_validation->set_rules('bb', 'BB', 'required');
            $this->form_validation->set_rules('imt', 'IMT', 'required');

            if ($this->form_validation->run() == FALSE) {
                $msg_error = array(
                    'id'            => form_error('id'),
                    'no_sampel'     => form_error('no_sampel'),
                    'dokter'        => form_error('dokter'),
                    'status_rokok'  => form_error('status_rokok'),
                    'tb'            => form_error('tb'),
                    'bb'            => form_error('bb'),
                    'imt'           => form_error('imt'),
                );

                $this->session->set_flashdata('form_error', $msg_error);

                redirect(base_url('medcheck/tambah.php?id='.$id.'&status='.$status.'&act='.$act.'&id_lab='.$id_lab));
            } else {
                $sql_medc       = $this->db->where('id', general::dekrip($id))->get('tbl_trans_medcheck')->row(); 
                $pengaturan     = $this->db->get('tbl_pengaturan')->row();
                
                $data = array(
                    'tgl_masuk'     => $this->tanggalan->tgl_indo_sys($tgl_masuk).' '.date('H:i:s'),
                    'tgl_modif'     => date('Y-m-d H:i:s'),
                    'id_dokter'     => $dokter,
                    'no_sample'     => $no_sample,
                    'keluhan'       => $keluhan,
                    'riwayat'       => $riwayat,
                    'ref'           => $ref,
                    'tb'            => $tb,
                    'bb'            => $bb,
                    'imt'           => $imt,
                    'anjuran'       => (!empty($anjuran) ? $anjuran : ''),
                    'status'        => '1',
                    'status_rokok'  => $is_rokok
                );
                
                # Masukkan ke tabel lab spirometri
                $this->db->where('id', general::dekrip($id_lab))->update('tbl_trans_medcheck_lab_spiro', $data);
                $last_id = crud::last_id();
                
                # Tampilkan pesan sukses jika sudah berhasil commit
                $this->session->set_flashdata('medcheck_toast', 'toastr.success("Spirometri berhasil disimpan !");');
                
                redirect(base_url('medcheck/tambah.php?act=pen_spirometri_surat&id='.$id.'&status='.$status.'&id_lab='.$id_lab));
            }
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }

    public function set_medcheck_lab_spiro_upd_hsl() {
        if (akses::aksesLogin() == TRUE) {
            $id         = $this->input->post('id');
            $id_spiro   = $this->input->post('id_spiro');
            $tgl_masuk  = $this->input->post('tgl_masuk');
            $ket        = $this->input->post('ket');
            $status     = $this->input->post('status');
            $act        = $this->input->post('act');
            
            $this->form_validation->set_error_delimiters('<div class="alert alert-danger">', '</div>');

            $this->form_validation->set_rules('id', 'ID', 'required');
            $this->form_validation->set_rules('id_spiro', 'ID Spiro', 'required');

            if ($this->form_validation->run() == FALSE) {
                $msg_error = array(
                    'id'       => form_error('id'),
                    'id_spiro' => form_error('id_spiro'),
                );

                $this->session->set_flashdata('form_error', $msg_error);

                redirect(base_url('medcheck/tambah.php?act='.$act.'&id='.$id.'&status='.$status.'&id_lab='.$id_spiro.'&err='));
            } else { 
                $sql_medc       = $this->db->where('id', general::dekrip($id))->get('tbl_trans_medcheck')->row(); 
                $sql_medc_spiro = $this->db->where('id_medcheck', $sql_medc->id)->get('tbl_trans_medcheck_lab_spiro')->row(); 
                $sql_cek        = $this->db->where('id_lab_spiro', $sql_medc_spiro->id)->get('tbl_trans_medcheck_lab_spiro_hsl'); 
                $pengaturan     = $this->db->get('tbl_pengaturan')->row();                
                $hasil          = $_POST['hsl_ukur'];
                
                
                /* Transaksi Database */
                $this->db->query('SET autocommit = 0;');
                $this->db->trans_start();
                
                $data_spiro = array(
                    'tgl_modif'   => date('Y-m-d H:i:s'),
                    'ket'         => $ket,
                );
                
                # Update masukkan hasil pemeriksaan
                $this->db->where('id', $sql_medc_spiro->id)->update('tbl_trans_medcheck_lab_spiro', $data_spiro);
                
                # Hapus dahulu data yang sudah ada di tabel hasil
                $this->db->where('id_lab_spiro', $sql_medc_spiro->id)->delete('tbl_trans_medcheck_lab_spiro_hsl');
                
                # Ambil data kategori spirometri
                foreach ($hasil as $key => $spiro){
                    $spiro_id   = general::dekrip($key);
                    $sql_spiro  = $this->db->where('id', $spiro_id)->get('tbl_m_kategori_spiro')->row();
                    
                    $data = array(
                        'tgl_simpan'        => $sql_medc_spiro->tgl_masuk,
                        'tgl_modif'         => date('Y-m-d H:i:s'),
                        'id_medcheck'       => $sql_medc->id,
                        'id_lab_spiro'      => $sql_medc_spiro->id,
                        'id_lab_spiro_kat'  => $sql_spiro->id,
                        'id_user'           => $this->ion_auth->user()->row()->id,
                        'item_name'         => $sql_spiro->kategori,
                        'item_value'        => $hasil[$key],
                        'item_value2'       => $_POST['hsl_pred'][$key],
                        'item_value3'       => $_POST['hsl_pred2'][$key],
                    );

                    # Masukkan ke tabel hasil spirometri
                    $this->db->insert('tbl_trans_medcheck_lab_spiro_hsl', $data);
                }
                
                # Cek status transact MySQL
                if ($this->db->trans_status() === FALSE) {
                    # Rollback jika gagal
                    $this->db->trans_rollback();

                    # Tampilkan pesan error
                    $this->session->set_flashdata('medcheck_toast', 'toastr.error("Spirometri gagal disimpan !");');
                } else {
                    $this->db->trans_complete();
                    
                    # Tampilkan pesan sukses jika sudah berhasil commit
                    $this->session->set_flashdata('medcheck_toast', 'toastr.success("Spirometri berhasil disimpan !");');
                }
                
                $this->db->query('SET autocommit = 1;');
                
                redirect(base_url('medcheck/tambah.php?act=pen_spirometri_input&id='.$id.'&status='.$status.'&id_lab='.$id_spiro));
            }
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }

    public function set_medcheck_lab_spiro_hps_hsl() {
        if (akses::aksesLogin() == TRUE) {
            $id         = $this->input->get('id');
            $id_lab     = $this->input->get('id_lab');
            $id_item    = $this->input->get('item_id');
            $status     = $this->input->get('status');
            $act        = $this->input->get('act');
            
            if(!empty($id_item)){                
                $this->db->where('id', general::dekrip($id_item))->delete('tbl_trans_medcheck_lab_spiro_hsl');
                $this->session->set_flashdata('medcheck_toast', 'toastr.warning("Spirometri berhasil dihapus !");');
            }
            
            redirect(base_url('medcheck/tambah.php?act='.$act.'&id='.$id.'&status='.$status.'&id_lab='.$id_lab));
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    } 

    public function set_medcheck_lab_hapus_spiro() {
        if (akses::aksesLogin() == TRUE) {
            $id         = $this->input->get('id');
            $act        = $this->input->get('act');
            $item_id    = $this->input->get('item_id');
            $status     = $this->input->get('status');
            $userid     = $this->ion_auth->user()->row()->id;
            
            $sql_medc       = $this->db->where('id', general::dekrip($id))->get('tbl_trans_medcheck');
            $sql_medc_spiro = $this->db->where('id', general::dekrip($item_id))->get('tbl_trans_medcheck_lab_spiro')->row();
            
            if($sql_medc->num_rows() > 0){
                /* Transaksi Database */
                $this->db->trans_begin();
                
                # Hapus ke tabel medcheck berkas spiro
                $this->db->where('id_berkas', $sql_medc_spiro->id)->delete('tbl_trans_medcheck_file');
                
                # Hapus ke tabel medcheck spiro
                $this->db->where('id', general::dekrip($item_id))->delete('tbl_trans_medcheck_lab_spiro');

                # Cek status transact MySQL
                if ($this->db->trans_status() === FALSE) {
                    # Rollback jika gagal
                    $this->db->trans_rollback();

                    # Tampilkan pesan error
                    $this->session->set_flashdata('medcheck_toast', 'toastr.error("Spirometri gagal dihapus !");');
                } else {
                    $this->db->trans_commit();

                    # Tampilkan pesan sukses jika sudah berhasil commit
                    $this->session->set_flashdata('medcheck_toast', 'toastr.warning("Spirometri sudah dihapus !");');
                }
            }

            redirect(base_url('medcheck/tambah.php?act='.$act.'&id='.$id.'&status='.$status));
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }

    public function set_medcheck_lab_ekg() {
        if (akses::aksesLogin() == TRUE) {
            $id     = $this->input->get('id');
            $status = $this->input->get('status');
            
            if(!empty($id)){
                $sql_medc   = $this->db->where('id', general::dekrip($id))->get('tbl_trans_medcheck'); 
                $sql_pasien = $this->db->where('id', $sql_medc->row()->id_pasien)->get('tbl_m_pasien')->row(); 
                $pengaturan = $this->db->get('tbl_pengaturan')->row();
                   
                $nomer      = $this->db->where('MONTH(tgl_simpan)', date('m'))->get('tbl_trans_medcheck_lab_ekg')->num_rows() + 1;
                $no_surat   = sprintf('%03d', $nomer).'/'.$pengaturan->kode_surat.'/'.date('m').'/'.date('Y');
                $grup       = $this->ion_auth->get_users_groups()->row();
                $is_farm    = ($grup->name == 'analis' ? '2' : '0');
                $is_farm_id = ($grup->name == 'analis' ? $this->ion_auth->user()->row()->id : '0');
                $is_doc_id  = ($grup->name == 'dokter' ? $this->ion_auth->user()->row()->id : '0');
               
                $data = array(
                    'tgl_simpan'    => date('Y-m-d H:i:s'),
                    'tgl_masuk'     => date('Y-m-d H:i:s'),
                    'id_medcheck'   => $sql_medc->row()->id,
                    'id_pasien'     => $sql_medc->row()->id_pasien,
                    'id_user'       => $this->ion_auth->user()->row()->id,
                    'id_analis'     => $is_farm_id,
                    'id_dokter'     => $is_doc_id,
                    'no_lab'        => $no_surat,
                    'status'        => '0',
                );
                
                if($sql_medc->num_rows() > 0){
                    $this->db->insert('tbl_trans_medcheck_lab_ekg', $data);
                    $last_id = crud::last_id();
                    
                    # Masukkan EKG ke tabel riwayat berkas
                    $data_file_ekg = array(
                        'id_medcheck'       => $sql_medc->row()->id,
                        'id_pasien'         => $sql_medc->row()->id_pasien,
                        'id_user'           => $this->ion_auth->user()->row()->id,
                        'id_berkas'         => $last_id,
                        'tgl_simpan'        => date('Y-m-d H:i:s'),
                        'tgl_masuk'         => date('Y-m-d H:i'),
                        'judul'             => 'HASIL PEMBACAAN EKG',
                        'keterangan'        => $sql_pasien->nama_pgl,
                        'file_name'         => '/medcheck/surat/cetak_pdf_lab_ekg.php?id='.general::enkrip($sql_medc->row()->id).'&id_lab='.general::enkrip($last_id).'&status='.$status,
                        'file_ext'          => '.pdf',
                        'file_type'         => 'application/pdf',
                        'status'            => '2',
                    );
                    $this->db->insert('tbl_trans_medcheck_file', $data_file_ekg);
                    
                    $this->session->set_flashdata('medcheck_toast', 'toastr.success("Permintaan EKG sudah dibuat !");');
                    
                    redirect(base_url('medcheck/tambah.php?act=pen_ekg&id='.general::enkrip($sql_medc->row()->id).'&id_lab='.general::enkrip($last_id).'&status='.$status));
                }else{
                    redirect(base_url('medcheck/tambah.php?act=pen_ekg&id='.general::enkrip($sql_medc->row()->id).'&status='.$status));
                }
            }else{
                redirect(base_url('medcheck/tambah.php?id='.general::enkrip($sql_medc->row()->id).'&status='.$status));
            }
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }

    public function set_medcheck_lab_ekg_upd() {
        if (akses::aksesLogin() == TRUE) {
            $id         = $this->input->post('id');
            $id_lab     = $this->input->post('id_lab_spiro');
            $tgl_masuk  = $this->input->post('tgl_masuk');
            $no_sample  = $this->input->post('no_sampel');
            $dokter     = $this->input->post('dokter');
            $hsl_irama  = $this->input->post('hsl_irama');
            $hsl_frek   = $this->input->post('hsl_frek');
            $hsl_axis   = $this->input->post('hsl_axis');
            $hsl_pos    = $this->input->post('hsl_pos');
            $hsl_zona   = $this->input->post('hsl_zona');
            $hsl_gelp   = $this->input->post('hsl_gelp');
            $hsl_int    = $this->input->post('hsl_int');
            $hsl_qrs    = $this->input->post('hsl_qrs');
            $hsl_st     = $this->input->post('hsl_st');
            $hsl_gelt   = $this->input->post('hsl_gelt');
            $hsl_gelu   = $this->input->post('hsl_gelu');
            $hsl_lain   = $this->input->post('hsl_lain');
            $kesimpulan = $this->input->post('kesimpulan');
            $status     = $this->input->post('status');
            $act        = $this->input->post('act');
            
            $this->form_validation->set_error_delimiters('<div class="alert alert-danger">', '</div>');

            $this->form_validation->set_rules('id', 'ID', 'required');
//            $this->form_validation->set_rules('no_sampel', 'No Sample', 'required');

            if ($this->form_validation->run() == FALSE) {
                $msg_error = array(
                    'id'        => form_error('id'),
                );

                $this->session->set_flashdata('form_error', $msg_error);

                redirect(base_url('medcheck/tambah.php?id='.$id.'&status='.$status.'&act='.$act.'&id_lab='.$id_lab));
            } else {
                $sql_medc       = $this->db->where('id', general::dekrip($id))->get('tbl_trans_medcheck')->row(); 
                $pengaturan     = $this->db->get('tbl_pengaturan')->row();
                
                $data = array(
                    'tgl_masuk'     => (!empty($tgl_simpan) ? $this->tanggalan->tgl_indo_sys($tgl_masuk) : date('Y-m-d')).' '.date('H:i:s'),
                    'tgl_modif'     => date('Y-m-d H:i:s'),
                    'id_dokter'     => $dokter,
                    'hsl_irama'     => $hsl_irama,
                    'hsl_frek'      => $hsl_frek,
                    'hsl_axis'      => $hsl_axis,
                    'hsl_pos'       => $hsl_pos,
                    'hsl_zona'      => $hsl_zona,
                    'hsl_gelp'      => $hsl_gelp,
                    'hsl_int'       => $hsl_int,
                    'hsl_qrs'       => $hsl_qrs,
                    'hsl_st'        => $hsl_st,
                    'hsl_gelt'      => $hsl_gelt,
                    'hsl_gelu'      => $hsl_gelu,
                    'hsl_lain'      => $hsl_lain,
                    'kesimpulan'    => $kesimpulan,
                    'status'        => '1'
                );
                
                # Masukkan ke tabel lab spirometri
                $this->db->where('id', general::dekrip($id_lab))->update('tbl_trans_medcheck_lab_ekg', $data);
                
                # Tampilkan pesan sukses jika sudah berhasil commit
                $this->session->set_flashdata('medcheck_toast', 'toastr.success("EKG berhasil disimpan !");');
                
                redirect(base_url('medcheck/tambah.php?act=pen_ekg_input&id='.$id.'&status='.$status.'&id_lab='.$id_lab));
                
                
//                echo '<pre>';
//                print_r($data);
            }
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }

    public function set_medcheck_lab_ekg_file() {
        if (akses::aksesLogin() == TRUE) {
            $id         = $this->input->post('id');
            $id_lab     = $this->input->post('id_lab_ekg');
            $tgl_masuk  = $this->input->post('tgl_masuk');
            $no_sample  = $this->input->post('no_sampel');
            $dokter     = $this->input->post('dokter');
            $judul      = $this->input->post('judul');
            $status     = $this->input->post('status');
            $act        = $this->input->post('act');
            
            $this->form_validation->set_error_delimiters('<div class="alert alert-danger">', '</div>');

            $this->form_validation->set_rules('id', 'ID', 'required');
//            $this->form_validation->set_rules('no_sampel', 'No Sample', 'required');

            if ($this->form_validation->run() == FALSE) {
                $msg_error = array(
                    'id'        => form_error('id'),
                );

                $this->session->set_flashdata('form_error', $msg_error);

                redirect(base_url('medcheck/tambah.php?act=pen_ekg_upload&id='.$id.'&status='.$status.'&id_lab='.$id_lab));
            } else {
                $pengaturan     = $this->db->get('tbl_pengaturan')->row();
                $sql_medc       = $this->db->where('id', general::dekrip($id))->get('tbl_trans_medcheck')->row();
                $sql_pasien     = $this->db->where('id', $sql_medc->id_pasien)->get('tbl_m_pasien')->row();
                $no_rm          = strtolower($sql_pasien->kode_dpn).$sql_pasien->kode;
                $folder         = realpath('./file/pasien/'.$no_rm);
                
                if (!empty($_FILES['fupload']['name'])) {
                    $config['upload_path']      = $folder;
                    $config['allowed_types']    = 'jpg|png|jpeg';
                    $config['remove_spaces']    = TRUE;
                    $config['overwrite']        = TRUE;
                    $config['file_name']        = 'medc_'.$sql_medc->no_rm.'_ekg'.sprintf('%05d', rand(1,256));
                    $this->load->library('upload', $config);
                    
                    if (!$this->upload->do_upload('fupload')) {
                        $this->session->set_flashdata('medcheck', '<div class="alert alert-danger">Error : <b>' . $this->upload->display_errors() . '</b></div>');
                        redirect(base_url('medcheck/tambah.php?act=pen_ekg_upload&id='.$id.'&status='.$status.'&id_lab='.$id_lab));
                    } else {
                        $f      = $this->upload->data();
                        
                        $this->load->library('image_lib');
                        $configer =  array(
                          'image_library'   => 'gd2',
                          'source_image'    =>  $f['full_path'],
//                          'maintain_ratio'  =>  TRUE,
                          'width'           =>  2048,
//                          'height'          =>  1010,
//                          'rotation_angle'  =>  180,
                        );
                        
                        $this->image_lib->clear();
                        $this->image_lib->initialize($configer);
                        $this->image_lib->resize();
                        $this->image_lib->rotate();
                    }
                    
//                    $file_tmp   = $_FILES['fupload']['tmp_name'];
//                    $file_ext   = $_FILES['fupload']['type']; //pathinfo($_FILES['fupload']['type'], PATHINFO_EXTENSION);
//                    $file_data  = file_get_contents($file_tmp);
//                    $file       = 'data:' . $file_ext . ';base64,' . base64_encode($file_data);
                }
                
                $data_ekg = array(
                    'id_medcheck'       => $sql_medc->id,
                    'id_lab_ekg'        => general::dekrip($id_lab),
                    'id_user'           => $this->ion_auth->user()->row()->id,
                    'tgl_simpan'        => date('Y-m-d H:i:s'),
                    'tgl_modif'         => date('Y-m-d H:i:s'),
                    'judul'             => $judul,
                    'file_name'         => $f['orig_name'],
                    'file_name_orig'    => $f['client_name'],
                    'file_ext'          => $f['file_ext'],
                    'file_type'         => $f['file_type'],
                );
                
                crud::simpan('tbl_trans_medcheck_lab_ekg_file', $data_ekg);
                
                
                # Masukkan ke tabel lab ekg file
                $this->db->insert('tbl_trans_medcheck_lab_ekg_file', $data);
                
                # Tampilkan pesan sukses jika sudah berhasil commit
                $this->session->set_flashdata('medcheck_toast', 'toastr.success("EKG berhasil diupload !");');
                
                redirect(base_url('medcheck/tambah.php?act=pen_ekg_upload&id='.$id.'&status='.$status.'&id_lab='.$id_lab));
                
                
//                echo '<pre>';
//                print_r($data);
            }
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }
    
    public function set_medcheck_lab_hapus_ekg() {
        if (akses::aksesLogin() == TRUE) {
            $id         = $this->input->get('id');
            $act        = $this->input->get('act');
            $item_id    = $this->input->get('item_id');
            $status     = $this->input->get('status');
            $userid     = $this->ion_auth->user()->row()->id;

            $sql_medc       = $this->db->where('id', general::dekrip($id))->get('tbl_trans_medcheck');
            $sql_medc_ekg   = $this->db->where('id', general::dekrip($item_id))->get('tbl_trans_medcheck_lab_ekg')->row();
            
            if($sql_medc->num_rows() > 0){
                /* Transaksi Database */
                $this->db->trans_begin();
                
                # Hapus ke tabel medcheck berkas ekg
                $this->db->where('id_berkas', $sql_medc_ekg->id)->delete('tbl_trans_medcheck_file');
                
                # Hapus ke tabel medcheck ekg
                $this->db->where('id', general::dekrip($item_id))->delete('tbl_trans_medcheck_lab_ekg');

                # Cek status transact MySQL
                if ($this->db->trans_status() === FALSE) {
                    # Rollback jika gagal
                    $this->db->trans_rollback();

                    # Tampilkan pesan error
                    $this->session->set_flashdata('medcheck_toast', 'toastr.error("Permintaan ekg gagal dihapus !");');
                } else {
                    $this->db->trans_commit();

                    # Tampilkan pesan sukses jika sudah berhasil commit
                    $this->session->set_flashdata('medcheck_toast', 'toastr.warning("Permintaan ekg sudah dihapus !");');
                }
            }

            redirect(base_url('medcheck/tambah.php?act='.$act.'&id='.$id.'&status='.$status));
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }

    public function set_medcheck_lab_finish() {
        if (akses::aksesLogin() == TRUE) {
            $id         = $this->input->get('id');
            $act        = $this->input->get('act');
            $item_id    = $this->input->get('item_id');
            $status     = $this->input->get('status');
            $userid     = $this->ion_auth->user()->row()->id;
            
            $sql_medc = $this->db->where('id', general::dekrip($id))->get('tbl_trans_medcheck');
            
            if($sql_medc->num_rows() > 0){
                /* Transaksi Database */
                $this->db->trans_begin();
                
                # Update data lab
                $this->db->where('id', general::dekrip($item_id))->update('tbl_trans_medcheck_lab', array('tgl_modif' => date('Y-m-d H:i:s'),'tgl_keluar' => date('Y-m-d H:i:s'),'status'  => '2'));
                $this->db->where('id', $sql_medc->row()->id)->update('tbl_trans_medcheck', array('tgl_periksa_lab_keluar' => date('Y-m-d H:i:s')));

                # Cek status transact MySQL
                if ($this->db->trans_status() === FALSE) {
                    # Rollback jika gagal
                    $this->db->trans_rollback();

                    # Tampilkan pesan error
                    $this->session->set_flashdata('medcheck_toast', 'toastr.error("Pemeriksaan laboratorium gagal diselesaikan !");');
                } else {
                    $this->db->trans_commit();

                    # Tampilkan pesan sukses jika sudah berhasil commit
                    $this->session->set_flashdata('medcheck_toast', 'toastr.warning("Pemeriksaan laboratorium berhasil diselesaikan !");');
                }
            }

            redirect(base_url('medcheck/tambah.php?act='.$act.'&id='.$id.'&id_lab='.$item_id.'&status='.$status));
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }

    public function set_medcheck_lab_batal() {
        if (akses::aksesLogin() == TRUE) {
            $id         = $this->input->get('id');
            $act        = $this->input->get('act');
            $item_id    = $this->input->get('item_id');
            $status     = $this->input->get('status');
            $userid     = $this->ion_auth->user()->row()->id;
            
            $sql_medc = $this->db->where('id', general::dekrip($id))->get('tbl_trans_medcheck');
            
            if($sql_medc->num_rows() > 0){
                /* Transaksi Database */
                $this->db->trans_begin();
                
                # Update data lab
                $this->db->where('id', general::dekrip($item_id))->update('tbl_trans_medcheck_lab', array('tgl_keluar'=>'0000-00-00 00:00:00','status'  => '0'));

                # Cek status transact MySQL
                if ($this->db->trans_status() === FALSE) {
                    # Rollback jika gagal
                    $this->db->trans_rollback();

                    # Tampilkan pesan error
                    $this->session->set_flashdata('medcheck_toast', 'toastr.error("Pemeriksaan laboratorium gagal dibatalkan !");');
                } else {
                    $this->db->trans_commit();

                    # Tampilkan pesan sukses jika sudah berhasil commit
                    $this->session->set_flashdata('medcheck_toast', 'toastr.success("Pemeriksaan laboratorium berhasil dibatalkan !");');
                }
            }

            redirect(base_url('medcheck/tambah.php?act='.$act.'&id='.$id.'&id_lab='.$item_id.'&status='.$status));
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }
    
    public function set_medcheck_rad() {
        if (akses::aksesLogin() == TRUE) {
            $id     = $this->input->get('id');
            $status = $this->input->get('status');
            
            if(!empty($id)){
                $sql_doc_rad= $this->db->where('id', '271')->get('v_master_dokter')->row(); 
                $sql_medc   = $this->db->where('id', general::dekrip($id))->get('tbl_trans_medcheck'); 
                $pengaturan = $this->db->get('tbl_pengaturan')->row();
                   
                $nomer      = $this->db->where('MONTH(tgl_simpan)', date('m'))->get('tbl_trans_medcheck_rad')->num_rows() + 1;
                $no_surat   = sprintf('%03d', $nomer).'/'.$pengaturan->kode_rad.'/'.date('m').'/'.date('Y');
                $grup       = $this->ion_auth->get_users_groups()->row();
                $is_rad     = ($grup->name == 'radiografer' ? '2' : '0');
                $is_rad_id  = ($grup->name == 'radiografer' ? $this->ion_auth->user()->row()->id : '0');
                $is_doc_id  = ($grup->name == 'dokter' ? $this->ion_auth->user()->row()->id : $sql_doc_rad->id_user);
               
                $data = array(
                    'tgl_simpan'    => date('Y-m-d H:i:s'),
                    'tgl_masuk'     => date('Y-m-d H:i:s'),
                    'id_medcheck'   => $sql_medc->row()->id,
                    'id_pasien'     => $sql_medc->row()->id_pasien,
                    'id_user'       => $this->ion_auth->user()->row()->id,
                    'id_radiografer'=> $is_rad_id,
                    'id_dokter'     => $is_doc_id,
                    'no_rad'        => $no_surat,
                    'no_sample'     => '-',
                    'status'        => '0',
                );
                
                if($sql_medc->num_rows() > 0){
                    $this->session->set_flashdata('medcheck', '<div class="alert alert-success">Data permintaan radiologi di buat</div>');
                    crud::simpan('tbl_trans_medcheck_rad', $data);
                    $last_id = crud::last_id();
                    
                    $this->db->where('id', general::dekrip($id))->update('tbl_trans_medcheck', array('tgl_periksa_rad'=>date('Y-m-d H:i:s')));
                    
                    redirect(base_url('medcheck/tambah.php?act='.($grup->name == 'dokter' ? 'rad_input' : 'rad_surat').'&id='.general::enkrip($sql_medc->row()->id).'&id_rad='.general::enkrip($last_id).'&status='.$status));
                }else{
                    redirect(base_url('medcheck/tambah.php?id='.general::enkrip($sql_medc->row()->id).'&status='.$status));
                }
                
//                echo '<pre>';
//                print_r($data);
//                
//                if($sql_medc->num_rows() > 0){
//                    $this->session->set_flashdata('medcheck', '<div class="alert alert-success">Data permintaan lab di buat</div>');
//                    crud::simpan('tbl_trans_medcheck_lab', $data);
//                    $last_id = crud::last_id();
//                    
//                    redirect(base_url('medcheck/tambah.php?id='.general::enkrip($sql_medc->row()->id).'&id_lab='.general::enkrip($last_id).'&status='.$status));
//                }else{
//                    redirect(base_url('medcheck/tambah.php?id='.general::enkrip($sql_medc->row()->id).'&status='.$status));
//                }
            }else{
//                redirect(base_url('medcheck/tambah.php?id='.general::enkrip($sql_medc->row()->id).'&status='.$status));
            }
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }
    
    public function set_medcheck_rad_upd() {
        if (akses::aksesLogin() == TRUE) {
            $id         = $this->input->post('id');
            $id_rad     = $this->input->post('id_rad');
            $id_user    = $this->input->post('id_user');
            $status     = $this->input->post('status');
            $status_rad = $this->input->post('status_rad');
            $no_sample  = $this->input->post('no_sampel');
            $dokter     = $this->input->post('dokter');
            $dokter_rad = $this->input->post('dokter_kirim');
            $dokter_nm  = $this->input->post('dokter_kirim_nm');
            $tipe_dr    = $this->input->post('tipe_dokter');
            $kesan      = $this->input->post('kesan');
            $route      = $this->input->post('route');
            $act        = $this->input->post('act');
            
            $this->form_validation->set_error_delimiters('<div class="alert alert-danger">', '</div>');

            $this->form_validation->set_rules('id', 'ID', 'required');
//            $this->form_validation->set_rules('tipe_dokter', 'Tipe Dokter', 'required');

            if ($this->form_validation->run() == FALSE) {
                $msg_error = array(
                    'id'            => form_error('id'),
//                    'tipe_dokter'   => form_error('tipe_dokter'),
                );

                $this->session->set_flashdata('form_error', $msg_error);

                redirect(base_url('medcheck/tambah.php?act=rad_surat&id='.$id.'&id_rad='.$id_rad.'&status='.$status));
            } else {
                $sql_medc       = $this->db->where('id', general::dekrip($id))->get('tbl_trans_medcheck')->row();
                $sql_medc_rad   = $this->db->where('id', general::dekrip($id_rad))->get('tbl_trans_medcheck_rad')->row();

                $data = array(
                    'tgl_modif'         => date('Y-m-d H:i:s'),
                    'tgl_keluar'        => ($status_rad == '4' ? date('Y-m-d H:i:s') : '0000-00-00 00:00:00'),
                    'id_dokter'         => $dokter,
                    'id_dokter_kirim'   => $dokter_rad,
                    'id_radiografer'    => (!empty($id_user) ? $id_user : $this->ion_auth->user()->row()->id),
                    'dokter_kirim'      => $dokter_nm,
                    'no_sample'         => $no_sample,
                    'ket'               => $kesan,
                    'status'            => $status_rad,
                    'status_dokter_krm' => $tipe_dr,
                );
                
                $this->session->set_flashdata('medcheck', '<div class="alert alert-success">Data radiologi berhasil disimpan</div>');
                crud::update('tbl_trans_medcheck_rad', 'id', $sql_medc_rad->id, $data);
                
                if($status_rad == '4'){
                    $this->db->where('id', $sql_medc->id)->update('tbl_trans_medcheck', array('tgl_periksa_rad_keluar'=>date('Y-m-d H:i:s')));
                }
                                
                redirect(base_url('medcheck/tambah.php?act=rad_surat&id='.$id.'&id_rad='.general::enkrip($sql_medc_rad->id).'&status='.$status.(!empty($route) ? '&route='.$route : '')));                
            }
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }
    
    public function set_medcheck_rad_hapus() {
        if (akses::aksesLogin() == TRUE) {
            $id         = $this->input->get('id');
            $item_id    = $this->input->get('item_id');
            $status     = $this->input->get('status');
            $userid     = $this->ion_auth->user()->row()->id;
            
            $sql_medc = $this->db->where('id', general::dekrip($id))->get('tbl_trans_medcheck');
            
            if($sql_medc->num_rows() > 0){
                $this->session->set_flashdata('medcheck', '<div class="alert alert-success">Transaksi berhasil dihapus</div>');
                
                /* Transaksi Database */
                $this->db->trans_begin();

                # Hapus ke tabel medcheck det
                $this->db->where('id_rad', general::dekrip($item_id))->delete('tbl_trans_medcheck_det');
                $this->db->where('id_rad', general::dekrip($item_id))->delete('tbl_trans_medcheck_rad_det');
                $this->db->where('id_rad', general::dekrip($item_id))->delete('tbl_trans_medcheck_rad_file');
                
                # Hapus ke tabel medcheck lab
                $this->db->where('id', general::dekrip($item_id))->delete('tbl_trans_medcheck_rad');

                # Cek status transact MySQL
                if ($this->db->trans_status() === FALSE) {
                    # Rollback jika gagal
                    $this->db->trans_rollback();

                    # Tampilkan pesan error
                    $this->session->set_flashdata('medcheck', '<div class="alert alert-danger">Data lab gagal dihapus !!</div>');
                } else {
                    $this->db->trans_commit();

                    # Tampilkan pesan sukses jika sudah berhasil commit
                    $this->session->set_flashdata('medcheck', '<div class="alert alert-success">Data lab berhasil dihapus !!</div>');
                }
            }

            redirect(base_url('medcheck/tambah.php?id='.$id.'&status='.$status));
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }

    public function set_medcheck_mcu() {
        if (akses::aksesLogin() == TRUE) {
            $id     = $this->input->get('id');
            $status = $this->input->get('status');
            
            if(!empty($id)){
                $sql_medc   = $this->db->where('id', general::dekrip($id))->get('tbl_trans_medcheck'); 
                $pengaturan = $this->db->get('tbl_pengaturan')->row();
                   
                $nomer      = $this->db->where('MONTH(tgl_simpan)', date('m'))->get('tbl_trans_medcheck_mcu')->num_rows() + 1;
                $no_surat   = sprintf('%03d', $nomer).'/MCU/'.date('m').'/'.date('Y');
                $grup       = $this->ion_auth->get_users_groups()->row();
                $is_doc_id  = ($grup->name == 'dokter' ? $this->ion_auth->user()->row()->id : '0');
               
                $data = array(
                    'tgl_simpan'    => date('Y-m-d H:i:s'),
                    'tgl_masuk'     => date('Y-m-d H:i:s'),
                    'id_medcheck'   => $sql_medc->row()->id,
                    'id_pasien'     => $sql_medc->row()->id_pasien,
                    'id_user'       => $this->ion_auth->user()->row()->id,
                    'id_dokter'     => $is_doc_id,
                    'no_mcu'        => $no_surat,
                    'no_sample'     => '-',
                    'status'        => '0',
                );
                
                if($sql_medc->num_rows() > 0){
                    $this->session->set_flashdata('medcheck', '<div class="alert alert-success">Data permintaan mcu di buat</div>');
                    crud::simpan('tbl_trans_medcheck_mcu', $data);
                    $last_id = crud::last_id();
                    
                    redirect(base_url('medcheck/tambah.php?act='.($grup->name == 'dokter' ? 'mcu_input' : 'mcu_surat').'&id='.general::enkrip($sql_medc->row()->id).'&id_mcu='.general::enkrip($last_id).'&status='.$status));
                }else{
                    redirect(base_url('medcheck/tambah.php?id='.general::enkrip($sql_medc->row()->id).'&status='.$status));
                }
                
//                echo '<pre>';
//                print_r($data);
//                echo '</pre>';
            }else{
//                redirect(base_url('medcheck/tambah.php?id='.general::enkrip($sql_medc->row()->id).'&status='.$status));
            }
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }
    
    public function set_medcheck_mcu_upd() {
        if (akses::aksesLogin() == TRUE) {
            $id         = $this->input->post('id');
            $id_mcu     = $this->input->post('id_mcu');
            $id_user    = $this->input->post('id_user');
            $status     = $this->input->post('status');
            $status_mcu = $this->input->post('status_mcu');
            $no_sample  = $this->input->post('no_sampel');
            $dokter     = $this->input->post('dokter');
            $dokter_mcu = $this->input->post('dokter_kirim');
            $dokter_nm  = $this->input->post('dokter_kirim_nm');
            $tipe_dr    = $this->input->post('tipe_dokter');
            $kesan      = $this->input->post('kesan');
            $route      = $this->input->post('route');
            $act        = $this->input->post('act');
            
            $this->form_validation->set_error_delimiters('<div class="alert alert-danger">', '</div>');

            $this->form_validation->set_rules('id', 'ID', 'required');
//            $this->form_validation->set_rules('tipe_dokter', 'Tipe Dokter', 'required');

            if ($this->form_validation->run() == FALSE) {
                $msg_error = array(
                    'id'            => form_error('id'),
//                    'tipe_dokter'   => form_error('tipe_dokter'),
                );

                $this->session->set_flashdata('form_error', $msg_error);

                redirect(base_url('medcheck/tambah.php?act=mcu_surat&id='.$id.'&id_mcu='.$id_mcu.'&status='.$status));
            } else {
                $sql_medc_mcu = $this->db->where('id_medcheck', general::dekrip($id))->get('tbl_trans_medcheck_mcu')->row();

                $data = array(
                    'tgl_modif'         => date('Y-m-d H:i:s'),
                    'id_dokter'         => $dokter,
                    'id_dokter_kirim'   => $dokter_mcu,
                    'id_mcuiografer'    => (!empty($id_user) ? $id_user : $this->ion_auth->user()->row()->id),
                    'dokter_kirim'      => $dokter_nm,
                    'no_sample'         => $no_sample,
                    'ket'               => $kesan,
                    'status'            => $status_mcu,
                    'status_dokter_krm' => $tipe_dr,
                );
                
                $this->session->set_flashdata('medcheck', '<div class="alert alert-success">Data mcuiologi berhasil disimpan</div>');
                crud::update('tbl_trans_medcheck_mcu', 'id', $sql_medc_mcu->id, $data);
                
                redirect(base_url('medcheck/tambah.php?act=mcu_surat&id='.$id.'&id_mcu='.general::enkrip($sql_medc_mcu->id).'&status='.$status.(!empty($route) ? '&route='.$route : '')));                
            }
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }
    
    public function set_medcheck_mcu_hapus() {
        if (akses::aksesLogin() == TRUE) {
            $id         = $this->input->get('id');
            $item_id    = $this->input->get('item_id');
            $status     = $this->input->get('status');
            $userid     = $this->ion_auth->user()->row()->id;
            
            $sql_medc = $this->db->where('id', general::dekrip($id))->get('tbl_trans_medcheck');
            
            if($sql_medc->num_rows() > 0){
                $this->session->set_flashdata('medcheck', '<div class="alert alert-success">Transaksi berhasil dihapus</div>');
                
                /* Transaksi Database */
                $this->db->trans_begin();

                # Hapus ke tabel medcheck det
//                $this->db->where('id_mcu', general::dekrip($item_id))->delete('tbl_trans_medcheck_det');
                $this->db->where('id_mcu', general::dekrip($item_id))->delete('tbl_trans_medcheck_mcu_det');
                
                # Hapus ke tabel medcheck lab
                $this->db->where('id', general::dekrip($item_id))->delete('tbl_trans_medcheck_mcu');

                # Cek status transact MySQL
                if ($this->db->trans_status() === FALSE) {
                    # Rollback jika gagal
                    $this->db->trans_rollback();

                    # Tampilkan pesan error
                    $this->session->set_flashdata('medcheck', '<div class="alert alert-danger">Data lab gagal dihapus !!</div>');
                } else {
                    $this->db->trans_commit();

                    # Tampilkan pesan sukses jika sudah berhasil commit
                    $this->session->set_flashdata('medcheck', '<div class="alert alert-success">Data lab berhasil dihapus !!</div>');
                }
            }

            redirect(base_url('medcheck/tambah.php?id='.$id.'&status='.$status));
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }

    public function set_medcheck_resep() {
        if (akses::aksesLogin() == TRUE) {
            $id     = $this->input->get('id');
            $status = $this->input->get('status');
            
            if(!empty($id)){
                $sql_medc   = $this->db->where('id', general::dekrip($id))->get('tbl_trans_medcheck'); 
                $pengaturan = $this->db->get('tbl_pengaturan')->row();
    
                $nomer      = $this->db->where('MONTH(tgl_simpan)', date('m'))->get('tbl_trans_medcheck_resep')->num_rows() + 1;
                $no_surat   = sprintf('%03d', $nomer).'/'.$pengaturan->kode_resep.'/'.date('m').'/'.date('Y');
                $grup       = $this->ion_auth->get_users_groups()->row();
                $is_farm    = ($grup->name == 'farmasi' ? '2' : '0');
                $is_farm_id = ($grup->name == 'farmasi' ? $this->ion_auth->user()->row()->id : '0');                
                $is_doc_id  = ($grup->name == 'dokter' ? $this->ion_auth->user()->row()->id : $sql_medc->id_dokter);
               
                $data = array(
                    'tgl_simpan'    => date('Y-m-d H:i:s'),
                    'id_medcheck'   => $sql_medc->row()->id,
                    'id_pasien'     => $sql_medc->row()->id_pasien,
                    'id_user'       => $this->ion_auth->user()->row()->id,
                    'id_farmasi'    => $is_farm_id,
                    'id_dokter'     => $is_doc_id,
                    'no_resep'      => $no_surat,
                    'status'        => $is_farm,
                );
                
                if($sql_medc->num_rows() > 0){
                    $this->session->set_flashdata('medcheck', '<div class="alert alert-success">Data surat berhasil disimpan</div>');
                    crud::simpan('tbl_trans_medcheck_resep', $data);
                    $last_id = crud::last_id();
                        
                    $this->db->where('id', $sql_medc->row()->id)->update('tbl_trans_medcheck', array('tgl_resep_msk'=>date('Y-m-d H:i:s')));
                    
                    redirect(base_url('medcheck/tambah.php?act=res_input&id='.general::enkrip($sql_medc->row()->id).'&id_resep='.general::enkrip($last_id).'&status='.$status));
                }else{
                    redirect(base_url('medcheck/tambah.php?id='.general::enkrip($sql_medc->row()->id).'&status='.$status));
                }
            }else{
                redirect(base_url('medcheck/tambah.php?id='.general::enkrip($sql_medc->row()->id).'&status='.$status));
            }
//
//           $this->session->set_flashdata('medcheck', '<div class="alert alert-success">Data surat berhasil disimpan</div>');
//           crud::simpan('tbl_trans_medcheck_resep', $data);
//           $last_id = crud::last_id();
//           
//           redirect(base_url('medcheck/tambah.php?id='.general::enkrip($sql_medc->id).'&status='.$status.'&id_resep='.general::enkrip($last_id)));
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }
    
    public function set_medcheck_resep_copy() {
        if (akses::aksesLogin() == TRUE) {
            $id         = $this->input->post('id');
            $id_medc    = $this->input->post('id_medc');
            $id_resep   = $this->input->post('id_resep');
            $petugas    = $this->input->post('petugas');
            $foto       = $this->input->post('foto');
            $status     = $this->input->post('status');
            
            $this->form_validation->set_error_delimiters('<div class="alert alert-danger">', '</div>');

            $this->form_validation->set_rules('id', 'ID', 'required');

            if ($this->form_validation->run() == FALSE) {
                $msg_error = array(
                    'id'        => form_error('id'),
                );

                $this->session->set_flashdata('id', $msg_error);

                redirect(base_url('medcheck/tambah.php?id='.$id.'status='.$status));
            } else {
                $sql_medc       = $this->db->where('id', general::dekrip($id_medc))->get('tbl_trans_medcheck')->row(); 
                $sql_medc_rsp   = $this->db->where('id', general::dekrip($id_resep))->get('tbl_trans_medcheck_resep')->row(); 
                $sql_pas        = $this->db->where('id', $sql_medc->id_pasien)->get('tbl_m_pasien')->row();
                $pengaturan     = $this->db->get('tbl_pengaturan')->row();
    
                $nomer          = $this->db->where('MONTH(tgl_simpan)', date('m'))->get('tbl_trans_medcheck_resep')->num_rows() + 1;
                $no_surat       = sprintf('%03d', $nomer).'/'.$pengaturan->kode_resep.'/'.date('m').'/'.date('Y');
                
                $data = array(
                    'tgl_simpan'    => date('Y-m-d H:i:s'),
                    'id_medcheck'   => $sql_medc->id,
                    'id_pasien'     => $sql_medc->id_pasien,
                    'id_user'       => $this->ion_auth->user()->row()->id,
                    'id_farmasi'    => $this->ion_auth->user()->row()->id,
                    'id_dokter'     => $sql_medc->id_dokter,
                    'no_resep'      => $no_surat,
                    'status'        => $is_farm,
                );
                
                crud::simpan('tbl_trans_medcheck_resep', $data);
                $last_id = crud::last_id();
                
//                echo '<pre>';
//                print_r($data);
//                echo '</pre>';
                
                $this->session->set_flashdata('medcheck_toast', 'toastr.success("Resep berhasil di copy !");');
                redirect(base_url('medcheck/tambah.php?act=res_input_copy&id='.$id.'&id_resep='.$id_resep.'&status='.$status));  
            }
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }

    # Menandai resep obat pulang rawat inap
    public function set_medcheck_resep_upd() {
        if (akses::aksesLogin() == TRUE) {
            $id         = $this->input->get('id');
            $id_rsp     = $this->input->get('id_resep');
            $status     = $this->input->get('status');
            $status_plg = $this->input->get('status_plg');
            
            if(!empty($id) AND !empty($id_rsp)){
                $sql_res_ck = $this->db->where('id_medcheck', general::dekrip($id))->where('status_plg', '1')->get('tbl_trans_medcheck_resep'); 
                $sql_res    = $this->db->where('id', general::dekrip($id_rsp))->get('tbl_trans_medcheck_resep')->row(); 
                $pengaturan = $this->db->get('tbl_pengaturan')->row();
               
                $data = array(
                    'tgl_modif'  => date('Y-m-d H:i:s'),
                    'status_plg' => $status_plg,
                );
                
                if($sql_res_ck->num_rows() == 1 AND $sql_res_ck->row()->status_plg == $status_plg){
                    $res = $sql_res_ck->row();
                    $this->session->set_flashdata('medcheck_toast', 'toastr.error("Resep pulang hanya bisa di simpan 1 kali, silahkan batalkan resep sebelumnya !");');
                }else{                
                    # Simpan data ke dalam database
                    $this->db->where('id', $sql_res->id)->update('tbl_trans_medcheck_resep', $data);
                    
                    # Simpan data ke dalam database
                    $this->db->where('id', general::dekrip($id))->update('tbl_trans_medcheck', array('tgl_ranap_keluar'=>date('Y-m-d H:i:s')));
                
                    if($status_plg == '0'){
                        $this->session->set_flashdata('medcheck_toast', 'toastr.warning("Resep ['.$sql_res->no_resep.'] sudah dibatalkan sebagai resep pulang.");');
                    }else{
                        $this->session->set_flashdata('medcheck_toast', 'toastr.success("Resep ['.$sql_res->no_resep.'] sudah set sebagai resep pulang dan akan tampil pada resume medis pasien.");');
                    }
                }
                
                redirect(base_url('medcheck/tambah.php?act=res_input&id='.$id.'&id_resep='.general::enkrip($sql_res->id).'&status='.$status));
            }else{
                redirect(base_url('medcheck/tambah.php?id='.general::enkrip($sql_medc->row()->id).'&status='.$status));
            }
//
//           $this->session->set_flashdata('medcheck', '<div class="alert alert-success">Data surat berhasil disimpan</div>');
//           crud::simpan('tbl_trans_medcheck_resep', $data);
//           $last_id = crud::last_id();
//           
//           redirect(base_url('medcheck/tambah.php?id='.general::enkrip($sql_medc->id).'&status='.$status.'&id_resep='.general::enkrip($last_id)));
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }

    public function set_medcheck_resep_upd_ttd() {
        if (akses::aksesLogin() == TRUE) {
            $id         = $this->input->post('id');
            $id_resep   = $this->input->post('id_resep');
            $petugas    = $this->input->post('petugas');
            $foto       = $this->input->post('foto');
            $status     = $this->input->post('status');
            
            $this->form_validation->set_error_delimiters('<div class="alert alert-danger">', '</div>');

            $this->form_validation->set_rules('id', 'ID', 'required');

            if ($this->form_validation->run() == FALSE) {
                $msg_error = array(
                    'id'        => form_error('id'),
                );

                $this->session->set_flashdata('id', $msg_error);

                redirect(base_url('medcheck/tambah.php?id='.$id.'status='.$status));
            } else {
                $sql_medc       = $this->db->where('id', general::dekrip($id))->get('tbl_trans_medcheck')->row(); 
                $sql_pas        = $this->db->where('id', $sql_medc->id_pasien)->get('tbl_m_pasien')->row();
                $pengaturan     = $this->db->get('tbl_pengaturan')->row();
                
                # Config File Foto Pasien
                $kode               = sprintf('%05d', $sql_pas->kode);
                $no_rm              = strtolower($sql_pas->kode_dpn.$sql_pas->kode);
                $path               = 'file/pasien/'.$no_rm.'/';
                
                # Simpan foto dari kamera ke dalam format file *.png dari base64
                if (!empty($foto)) {
                    $filename           = $path.'ttd_resep_'.$kode.'.png';
                    general::base64_to_jpeg($foto, $filename);
                }
                
                $data = array(
                    'tgl_ttd'       => date('Y-m-d H:i:s'),
                    'tgl_resep_trm' => date('Y-m-d H:i:s'),
                    'id_farmasi'    => $petugas,
                    'ttd_obat'      => $filename,
                    'status_resep'  => $status,
                );
                
                # Simpan data ke dalam database
                $this->db->where('id', $sql_medc->id)->update('tbl_trans_medcheck', $data);
                
                # Balikin ke halaman semula
                redirect(base_url('medcheck/resep/konfirm.php?id='.general::enkrip($sql_medc->id)));

//                echo '<pre>';
//                print_r(json_decode($item));
//                echo '</pre>';
//                
//                echo '<pre>';
//                print_r($this->cart->contents());
//                echo '</pre>';    
            }
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }

    public function set_medcheck_resep_proses() {
        if (akses::aksesLogin() == TRUE) {
            $id         = $this->input->post('id');
            $id_resep   = $this->input->post('id_resep');
            $status     = $this->input->post('status');
            
            $this->form_validation->set_error_delimiters('<div class="alert alert-danger">', '</div>');

            $this->form_validation->set_rules('id', 'ID', 'required');

            if ($this->form_validation->run() == FALSE) {
                $msg_error = array(
                    'id'        => form_error('id'),
                );

                $this->session->set_flashdata('id', $msg_error);

                redirect(base_url('medcheck/tambah.php?id='.$id.'status='.$status));
            } else {
                $sql_medc       = $this->db->where('id', general::dekrip($id))->get('tbl_trans_medcheck')->row(); 
                $sql_medc_res   = $this->db->where('id', general::dekrip($id_resep))->get('tbl_trans_medcheck_resep')->row();  
                $pengaturan     = $this->db->get('tbl_pengaturan')->row();
                
                foreach ($this->cart->contents() as $cart){
                    $sql_item       = $this->db->where('id', $cart['options']['id_item'])->get('tbl_m_produk')->row();
                                       
                    $data[] = array(
                        'id_medcheck'   => (int)$sql_medc->id,
                        'id_resep'      => (int)general::dekrip($id_resep),
                        'id_item'       => (int)$cart['options']['id_item'],
                        'id_item_kat'   => (int)$cart['options']['id_item_kat'],
                        'id_item_sat'   => (int)$cart['options']['id_item_sat'],
                        'kode'          => $sql_item->kode,
                        'item'          => $sql_item->produk,
                        'dosis'         => $cart['options']['dos_jml1'].' '.$cart['options']['dos_sat'].' Tiap '.$cart['options']['dos_jml2'].' '.$cart['options']['dos_wkt'],
                        'dosis_ket'     => $cart['options']['dos_ket'],
                        'harga'         => $cart['options']['harga'],
                        'jml'           => (int)$cart['qty'],
                        'jml_satuan'    => '1',
                        'satuan'        => $cart['options']['satuan'],
                        'status'        => (int)$status,
                    );
                    
                    $data_resep = array(
                        'id_medcheck'   => (int)$sql_medc->id,
                        'id_resep'      => (int)general::dekrip($id_resep),
                        'id_item'       => (int)$cart['options']['id_item'],
                        'id_item_kat'   => (int)$cart['options']['id_item_kat'],
                        'id_item_sat'   => (int)$cart['options']['id_item_sat'],
                        'id_user'       => $this->ion_auth->user()->row()->id,
                        'tgl_simpan'    => $cart['options']['tgl_simpan'],
                        'tgl_modif'     => date('Y-m-d H:i:s'),
                        'kode'          => $sql_item->kode,
                        'item'          => $sql_item->produk,
                        'dosis'         => $cart['options']['dos_jml1'].' '.$cart['options']['dos_sat'].' Tiap '.$cart['options']['dos_jml2'].' '.$cart['options']['dos_wkt'],
                        'dosis_ket'     => $cart['options']['dos_ket'],
                        'harga'         => $cart['options']['harga'],
                        'jml'           => (int)$cart['qty'],
                        'jml_satuan'    => '1',
                        'satuan'        => $cart['options']['satuan'],
                        'status'        => (int)$status,
                        'status_resep'  => '',
                    );
                    
                    // Simpan ke tabel resep
                    crud::simpan('tbl_trans_medcheck_resep_det', $data_resep);
                }
                
                // Convert ke json biar gampang
                $item = json_encode($data);
                
                // Simpan ke database
                crud::update('tbl_trans_medcheck_resep', 'id', $sql_medc_res->id, array('item'=>$item, 'status'=>'1'));
                
                // Hapus cart session ci
                $this->cart->destroy();
                
                // Balikin ke halaman semula
                redirect(base_url('medcheck/tambah.php?id='.general::enkrip($sql_medc->id).'&status='.$status));
                
//                echo '<pre>';
//                print_r(json_decode($item));
//                echo '</pre>';
//                
//                echo '<pre>';
//                print_r($this->cart->contents());
//                echo '</pre>';    
            }
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }

    public function set_medcheck_resep_status() {
        if (akses::aksesLogin() == TRUE) {
            $id         = $this->input->post('id');
            $id_resep   = $this->input->post('id_resep');
            $id_farmasi = $this->input->post('id_farmasi');
            $msg        = $this->input->post('msg');
            $status     = $this->input->post('status');
            $status_res = $this->input->post('status_res');
            
            $this->form_validation->set_error_delimiters('<div class="alert alert-danger">', '</div>');

            $this->form_validation->set_rules('id', 'ID', 'required');
            $this->form_validation->set_rules('id_resep', 'ID Resep', 'required');

            if ($this->form_validation->run() == FALSE) {
                $msg_error = array(
                    'id'        => form_error('id'),
                    'id_resep'  => form_error('id_resep'),
                );

                $this->session->set_flashdata('resep', $msg_error);

                redirect(base_url('medcheck/tambah.php?act=res_input&id='.$id.'&id_resep='.$id_resep.'&status='.$status));
            } else {
                // Set status diproses oleh farmasi atau tidak
                $data = array(
                    'tgl_modif'   => date('Y-m-d H:i:s'),
                    'tgl_masuk'   => ($status_res == '2' ? date('Y-m-d H:i:s') : '0000-00-00 00:00:00'),
                    'id_farmasi'  => general::dekrip($id_farmasi),
                    'status'      => $status_res,
                );
                
                crud::update('tbl_trans_medcheck_resep', 'id', general::dekrip($id_resep), $data);
                
                $this->session->set_flashdata('medcheck_toast', 'toastr.success("'.$msg.'")');
                redirect(base_url('medcheck/tambah.php?act=res_input&id='.$id.'&id_resep='.$id_resep.'&status='.$status));
                
//                if($status_res == '2'){
//                    // Jika proses redirect ke input page
//                    redirect(base_url('medcheck/tambah.php?id='.$id.'&id_resep='.$id_resep.'&status='.$status));
//                }else{
//                    redirect(base_url('medcheck/tambah.php?id='.$id.'&status='.$status));
//                }
                
//                echo '<pre>';
//                print_r($data);
//                echo '</pre>';
            }
            
//            if(!empty($id_resep)){
//                crud::update('tbl_trans_medcheck_resep', 'id', general::dekrip($id_resep), $data);
//                
//                
//                if($status_res == '2'){
//                    // Jika proses redirect ke input page
//                    redirect(base_url('medcheck/tambah.php?id='.$id.'&id_resep='.$id_resep.'&status='.$status));
//                }else{
//                    redirect(base_url('medcheck/tambah.php?id='.$id.'&status='.$status));
//                }
//            }
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }

    public function set_medcheck_resep_farm() {
        if (akses::aksesLogin() == TRUE) {
            $id         = $this->input->post('id');
            $id_resep   = $this->input->post('id_resep');
            $id_produk  = $this->input->post('id_produk');
            $status     = $this->input->post('status');
            $status_res = $this->input->post('status_res');
            
            if(!empty($id_resep)){
                $sql_resep      = $this->db->where('id', general::dekrip($id_resep))->get('tbl_trans_medcheck_resep')->row();
                $sql_resep_det  = $this->db->where('id_resep', general::dekrip($id_resep))->get('tbl_trans_medcheck_resep_det')->result();
                $item           = json_decode($sql_resep->item);
                
                foreach ($sql_resep_det as $cart){
                    $id_item = general::dekrip($id_produk);

                    $subtotal       = $cart->jml * $cart->harga;                    
                    $data_res_det = array(
                        'id_medcheck'   => (int)$cart->id_medcheck,
                        'id_resep'      => (int)general::dekrip($id_resep),
                        'id_item'       => (int)$cart->id_item,
                        'id_item_kat'   => (int)$cart->id_item_kat,
                        'id_item_sat'   => (int)$cart->id_item_sat,
                        'id_user'       => (int)$cart->id_user,
                        'tgl_simpan'    => $cart->tgl_simpan,
                        'tgl_modif'     => date('Y-m-d H:i:s'),
                        'kode'          => $cart->kode,
                        'item'          => $cart->item,
                        'dosis'         => $cart->dosis,
                        'dosis_ket'     => $cart->dosis_ket,
                        'keterangan'    => $cart->keterangan,
                        'harga'         => (float)$cart->harga,
                        'jml'           => (int)$cart->jml,
                        'jml_satuan'    => (int)$cart->jml_satuan,
                        'subtotal'      => (float)$subtotal,
                        'satuan'        => $cart->satuan,
                        'status'        => '4',
//                        'status'        => (int)$cart->status,
                    );
                    
                    crud::simpan('tbl_trans_medcheck_det', $data_res_det);
     
                    if($cart->id_item == $id_item){
                        crud::simpan('tbl_trans_medcheck_det', (array)$cart);
                        $last_id = crud::last_id();
                    }
                    
                    $farmasi = array(
                        'tgl_modif'     => date('Y-m-d H:i:s'),
                        'tgl_keluar'    => ($status == '4' ? date('Y-m-d H:i:s') : '0000-00-00 00:00:00'),
                        'id_farmasi'    => $this->ion_auth->user()->row()->id,
                        'status'        => $status
                    );
                    
                    crud::update('tbl_trans_medcheck_resep', 'id', (int)general::dekrip($id_resep), $farmasi);
                }
                
                redirect(base_url('medcheck/resep/tambah.php?id='.$id.'&id_resep='.general::enkrip($sql_resep->id).'&status='.$status));
            }
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }

    public function set_medcheck_resep_hapus() {
        if (akses::aksesLogin() == TRUE) {
            $id         = $this->input->get('id');
            $item_id    = $this->input->get('item_id');
            $status     = $this->input->get('status');
            $userid     = $this->ion_auth->user()->row()->id;
            
            $sql_medc = $this->db->where('id', general::dekrip($id))->get('tbl_trans_medcheck');
            
            if($sql_medc->num_rows() > 0){
                $this->session->set_flashdata('medcheck', '<div class="alert alert-success">Transaksi berhasil dihapus</div>');
                
                /* Transaksi Database */
                $this->db->trans_start();

                # Update ke tabel resep
                $this->db->where('id_resep', general::dekrip($item_id))->delete('tbl_trans_medcheck_resep_det');
                $this->db->where('id_resep', general::dekrip($item_id))->delete('tbl_trans_medcheck_det');
                $this->db->where('id', general::dekrip($item_id))->delete('tbl_trans_medcheck_resep');
                
                $this->db->trans_complete();
            }
            
            redirect(base_url('medcheck/tambah.php?id='.$id.'&status='.$status));
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }    

    # Pemeriksaan Penunjang
    public function set_medcheck_pen_hrv() {
        if (akses::aksesLogin() == TRUE) {
            $id     = $this->input->get('id');
            $status = $this->input->get('status');
            
            if(!empty($id)){
                $sql_medc   = $this->db->where('id', general::dekrip($id))->get('tbl_trans_medcheck'); 
                $sql_pasien = $this->db->where('id', $sql_medc->row()->id_pasien)->get('tbl_m_pasien')->row(); 
                $pengaturan = $this->db->get('tbl_pengaturan')->row();
                   
                $nomer      = $this->db->where('MONTH(tgl_simpan)', date('m'))->get('tbl_trans_medcheck_pen_hrv')->num_rows() + 1;
                $no_surat   = sprintf('%03d', $nomer).'/'.$pengaturan->kode_surat.'/'.date('m').'/'.date('Y');
                $grup       = $this->ion_auth->get_users_groups()->row();
                $is_farm    = ($grup->name == 'analis' ? '2' : '0');
                $is_farm_id = ($grup->name == 'analis' ? $this->ion_auth->user()->row()->id : '0');
                $is_doc_id  = ($grup->name == 'dokter' ? $this->ion_auth->user()->row()->id : '0');
               
                $data = array(
                    'tgl_simpan'    => date('Y-m-d H:i:s'),
                    'tgl_masuk'     => date('Y-m-d H:i:s'),
                    'id_medcheck'   => $sql_medc->row()->id,
                    'id_pasien'     => $sql_medc->row()->id_pasien,
                    'id_user'       => $this->ion_auth->user()->row()->id,
                    'id_analis'     => $is_farm_id,
                    'id_dokter'     => $is_doc_id,
                    'no_lab'        => $no_surat,
                    'status'        => '0',
                );
                
                if($sql_medc->num_rows() > 0){
                    $this->db->insert('tbl_trans_medcheck_pen_hrv', $data);
                    $last_id = crud::last_id();
                    
                    # Masukkan HRV ke tabel riwayat berkas
                    $data_file_ekg = array(
                        'id_medcheck'       => $sql_medc->row()->id,
                        'id_pasien'         => $sql_medc->row()->id_pasien,
                        'id_user'           => $this->ion_auth->user()->row()->id,
                        'id_berkas'         => $last_id,
                        'tgl_simpan'        => date('Y-m-d H:i:s'),
                        'tgl_masuk'         => date('Y-m-d H:i'),
                        'judul'             => 'HASIL PEMBACAAN HRV',
                        'keterangan'        => $sql_pasien->nama_pgl,
                        'file_name'         => '/medcheck/surat/cetak_pdf_pen_hrv.php?id='.general::enkrip($sql_medc->row()->id).'&id_pen='.general::enkrip($last_id).'&status='.$status,
                        'file_ext'          => '.pdf',
                        'file_type'         => 'application/pdf',
                        'status'            => '2',
                    );
                    $this->db->insert('tbl_trans_medcheck_file', $data_file_ekg);
                    
                    $this->session->set_flashdata('medcheck_toast', 'toastr.success("Permintaan HRV sudah dibuat !");');
                    
                    redirect(base_url('medcheck/tambah.php?act=pen_hrv&id='.general::enkrip($sql_medc->row()->id).'&id_pen='.general::enkrip($last_id).'&status='.$status));
                }else{
                    redirect(base_url('medcheck/tambah.php?act=pen_hrv&id='.general::enkrip($sql_medc->row()->id).'&status='.$status));
                }
            }else{
                redirect(base_url('medcheck/tambah.php?id='.general::enkrip($sql_medc->row()->id).'&status='.$status));
            }
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }

    public function set_medcheck_pen_hrv_upd() {
        if (akses::aksesLogin() == TRUE) {
            $id         = $this->input->post('id');
            $id_pen     = $this->input->post('id_pen');
            $tgl_masuk  = $this->input->post('tgl_masuk');
            $no_sample  = $this->input->post('no_sampel');
            $dokter     = $this->input->post('dokter');
            $hsl_mhr    = $this->input->post('hsl_mhr');
            $hsl_sdnn   = $this->input->post('hsl_sdnn');
            $hsl_rmssd  = $this->input->post('hsl_rmssd');
            $hsl_psi    = $this->input->post('hsl_psi');
            $hsl_lhhf   = $this->input->post('hsl_lhhf');
            $hsl_eb     = $this->input->post('hsl_eb');
            $hsl_ans    = $this->input->post('hsl_ans');
            $hsl_pi     = $this->input->post('hsl_pi');
            $hsl_es     = $this->input->post('hsl_es');
            $hsl_rrv    = $this->input->post('hsl_rrv');
            $ket        = $this->input->post('ket');
            $status     = $this->input->post('status');
            $act        = $this->input->post('act');
            
            $this->form_validation->set_error_delimiters('<div class="alert alert-danger">', '</div>');

            $this->form_validation->set_rules('id', 'ID', 'required');
//            $this->form_validation->set_rules('no_sampel', 'No Sample', 'required');

            if ($this->form_validation->run() == FALSE) {
                $msg_error = array(
                    'id'        => form_error('id'),
                );

                $this->session->set_flashdata('form_error', $msg_error);

                redirect(base_url('medcheck/tambah.php?id='.$id.'&status='.$status.'&act='.$act.'&id_lab='.$id_lab));
            } else {
                $sql_medc       = $this->db->where('id', general::dekrip($id))->get('tbl_trans_medcheck')->row(); 
                $pengaturan     = $this->db->get('tbl_pengaturan')->row();
                
                $data = array(
                    'tgl_masuk'     => (!empty($tgl_simpan) ? $this->tanggalan->tgl_indo_sys($tgl_masuk) : date('Y-m-d')).' '.date('H:i:s'),
                    'tgl_modif'     => date('Y-m-d H:i:s'),
                    'id_dokter'     => $dokter,
                    'hsl_mhr'       => $hsl_mhr,
                    'hsl_sdnn'      => $hsl_sdnn,
                    'hsl_rmssd'     => $hsl_rmssd,
                    'hsl_psi'       => $hsl_psi,
                    'hsl_lhhf'      => $hsl_lhhf,
                    'hsl_eb'        => $hsl_eb,
                    'hsl_ans'       => $hsl_ans,
                    'hsl_pi'        => $hsl_pi,
                    'hsl_es'        => $hsl_es,
                    'hsl_rrv'       => $hsl_rrv,
                    'keterangan'    => $ket,
                    'status'        => '1'
                );
                
                # Masukkan ke tabel hrv
                $this->db->where('id', general::dekrip($id_pen))->update('tbl_trans_medcheck_pen_hrv', $data);
//                
                # Tampilkan pesan sukses jika sudah berhasil commit
                $this->session->set_flashdata('medcheck_toast', 'toastr.success("Penunjang HRV berhasil disimpan !");');
                
                redirect(base_url('medcheck/tambah.php?act=pen_hrv_input&id='.$id.'&status='.$status.'&id_pen='.$id_pen));
                
                
                echo '<pre>';
                print_r($data);
            }
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }
    
    public function set_medcheck_pen_hrv_hapus() {
        if (akses::aksesLogin() == TRUE) {
            $id         = $this->input->get('id');
            $act        = $this->input->get('act');
            $item_id    = $this->input->get('item_id');
            $status     = $this->input->get('status');
            $userid     = $this->ion_auth->user()->row()->id;

            $sql_medc       = $this->db->where('id', general::dekrip($id))->get('tbl_trans_medcheck');
            $sql_medc_hrv   = $this->db->where('id', general::dekrip($item_id))->get('tbl_trans_medcheck_pen_hrv')->row();
            
            if($sql_medc->num_rows() > 0){
                /* Transaksi Database */
                $this->db->trans_begin();
                
                # Hapus ke tabel medcheck berkas ekg
//                $this->db->where('id_berkas', $sql_medc_hrv->id)->delete('tbl_trans_medcheck_file');
                
                # Hapus ke tabel medcheck ekg
                $this->db->where('id', general::dekrip($item_id))->delete('tbl_trans_medcheck_pen_hrv');

                # Cek status transact MySQL
                if ($this->db->trans_status() === FALSE) {
                    # Rollback jika gagal
                    $this->db->trans_rollback();

                    # Tampilkan pesan error
                    $this->session->set_flashdata('medcheck_toast', 'toastr.error("Permintaan hrv gagal dihapus !");');
                } else {
                    $this->db->trans_commit();

                    # Tampilkan pesan sukses jika sudah berhasil commit
                    $this->session->set_flashdata('medcheck_toast', 'toastr.warning("Permintaan hrv sudah dihapus !");');
                }
            }

            redirect(base_url('medcheck/tambah.php?act='.$act.'&id='.$id.'&status='.$status));
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }

    public function set_medcheck_surat() {
        if (akses::aksesLogin() == TRUE) {
            $id             = $this->input->post('id');
            $status         = $this->input->post('status');
            $tgl_masuk      = $this->input->post('tgl_masuk');
            $tgl_keluar     = $this->input->post('tgl_keluar');
            $tgl_kontrol    = $this->input->post('tgl_kontrol');
            $tgl_lahir      = $this->input->post('tgl_lahir');
            $wkt_lahir      = $this->input->post('wkt_lahir');
            $nm_lahir       = $this->input->post('nm_lahir');
            $nm_ayah        = $this->input->post('nm_ayah');
            $nm_ibu         = $this->input->post('nm_ibu');
            $jns_klm        = $this->input->post('jns_klm');
            $hasil          = $this->input->post('hasil');
            $dokter         = $this->input->post('dokter');
            $tb             = $this->input->post('tb');
            $td             = $this->input->post('td');
            $bb             = $this->input->post('bb');
            $bw             = $this->input->post('bw');
            $bw_ket         = $this->input->post('bw_ket');
            $tipe_surat     = $this->input->post('tipe_surat');
            $sembuh         = $this->input->post('sembuh');
            $mati_tgl       = $this->input->post('mati_tgl');
            $mati_wkt       = $this->input->post('mati_wkt');
            $mati_tmp       = $this->input->post('mati_tmp');
            $mati_pny       = $this->input->post('mati_penyebab');
            $ruj_dokter     = $this->input->post('ruj_dokter');
            $ruj_faskes     = $this->input->post('ruj_faskes');
            $ruj_keluhan    = $this->input->post('ruj_keluhan');
            $ruj_diagnos    = $this->input->post('ruj_diagnosa');
            $ruj_terapi     = $this->input->post('ruj_terapi');
            $cvd_tg_prks    = $this->input->post('cvd_tgl_periksa');
            $cvd_tg_awal    = $this->input->post('cvd_tgl_awal');
            $cvd_tg_akhr    = $this->input->post('cvd_tgl_akhir');
            $vks_nama       = $this->input->post('vks_nama');
            $vks_tg_prks    = $this->input->post('vks_tgl_periksa');
            $nza_tg_prks    = $this->input->post('napza_tgl_periksa');
            $nza_hasil      = $this->input->post('napza_hasil');
            $hml_tipe       = $this->input->post('hml_tipe');
            $hml_tipe_flt   = $this->input->post('hml_tipe_terbang');
            $hml_periksa    = $this->input->post('hml_periksa');
            $hml_tgl_awal   = $this->input->post('hml_tgl_awal');
            $hml_tgl_akhir  = $this->input->post('hml_tgl_akhir');
            $trb_tipe_flt   = $this->input->post('trb_tipe_terbang');
            $trb_periksa    = $this->input->post('trb_periksa');
            $trb_tgl_awal   = $this->input->post('trb_tgl_awal');
            $trb_tgl_akhir  = $this->input->post('trb_tgl_akhir');
            $tht_tgl                = $this->input->post('tht_tgl');
            $tht_lt_kanan           = $this->input->post('tht_lt_kanan');
            $tht_lt_kiri            = $this->input->post('tht_lt_kiri');
            $tht_membran_kanan      = $this->input->post('tht_membran_kanan');
            $tht_membran_kiri       = $this->input->post('tht_membran_kiri');
            $tht_mukosa_kanan       = $this->input->post('tht_mukosa_kanan');
            $tht_mukosa_kiri        = $this->input->post('tht_mukosa_kiri');
            $tht_konka_kanan        = $this->input->post('tht_konka_kanan');
            $tht_konka_kiri         = $this->input->post('tht_konka_kiri');
            $tht_timpa_kanan        = $this->input->post('tht_timpa_kanan');
            $tht_timpa_kiri         = $this->input->post('tht_timpa_kiri');
            $tht_tonsil_tg          = $this->input->post('tht_tonsil_tg');
            $tht_mukosa_tg          = $this->input->post('tht_mukosa_tg');
            $tht_faring_tg          = $this->input->post('tht_faring_tg');
            $tht_kesimpulan         = $this->input->post('tht_kesimpulan');
            $tht_audio              = $this->input->post('tht_audio');
            
            $this->form_validation->set_error_delimiters('<div class="alert alert-danger">', '</div>');

            $this->form_validation->set_rules('id', 'ID', 'required');

            if ($this->form_validation->run() == FALSE) {
                $msg_error = array(
                    'id'        => form_error('id'),
                );

                $this->session->set_flashdata('anamnesa', $msg_error);

                redirect(base_url('medcheck/tambah.php?id='.$id.'status='.$status));
            } else {
                $sql_medc       = $this->db->where('id', general::dekrip($id))->get('tbl_trans_medcheck')->row(); 
                $pengaturan     = $this->db->get('tbl_pengaturan')->row();
                
                switch ($tipe_surat){
                    case '1';
                        $str_tipe   = $pengaturan->kode_surat_sht;
                        break;
                    
                    case '2';
                        $str_tipe   = $pengaturan->kode_surat_skt;
                        break;
                    
                    case '3';
                        $str_tipe   = $pengaturan->kode_surat_rnp;
                        break;
                    
                    case '4';
                        $str_tipe   = $pengaturan->kode_surat_kntrl;
                        break;
                    
                    case '5';
                        $str_tipe   = $pengaturan->kode_surat_lahir;
                        break;
                    
                    case '6';
                        $str_tipe   = $pengaturan->kode_surat_mati;
                        break;
                    
                    case '7';
                        $str_tipe   = $pengaturan->kode_surat_covid;
                        break;
                    
                    case '8';
                        $str_tipe   = $pengaturan->kode_surat_rujukan;
                        break;
                    
                    case '9';
                        $str_tipe   = $pengaturan->kode_surat;
                        break;
                    
                    case '10';
                        $str_tipe   = $pengaturan->kode_surat_hamil;
                        break;
                    
                    case '11';
                        $str_tipe   = $pengaturan->kode_surat_cvd;
                        break;
                    
                    case '12';
                        $str_tipe   = $pengaturan->kode_surat_cvd;
                        break;
                    
                    case '13';
                        $str_tipe   = $pengaturan->kode_periksa;
                        break;
                    
                    case '15';
                        $str_tipe   = $pengaturan->kode_surat_tht;
                        break;
                }
                
                $nomer          = $this->db->where('tipe', $tipe_surat)->where('MONTH(tgl_simpan)', date('m'))->where('YEAR(tgl_simpan)', date('Y'))->get('tbl_trans_medcheck_surat')->num_rows() + 1;
                $no_surat       = sprintf('%03d', $nomer).'/'.$str_tipe.'/'.date('m').'/'.date('Y');
                $tgl_awal       = date_create($this->tanggalan->tgl_indo_sys($tgl_masuk));
                $tgl_akhir      = date_create($this->tanggalan->tgl_indo_sys($tgl_keluar));
                $diff           = date_diff($tgl_awal, $tgl_akhir);
                $hari           = $diff->format("%d%");
                $jml_hari       = ($tgl_awal == $tgl_akhir ? '1' : ($hari > 1 ? $hari + 1 : '2'));
                
                $data = array(
                    'tgl_simpan'        => date('Y-m-d H:i:s'),
                    'tgl_masuk'         => (!empty($tgl_masuk) ? $this->tanggalan->tgl_indo_sys($tgl_masuk) : date('Y-m-d')),
                    'tgl_keluar'        => (!empty($tgl_keluar) ? $this->tanggalan->tgl_indo_sys($tgl_keluar) : '0000-00-00'),
                    'tgl_kontrol'       => (!empty($tgl_kontrol) ? $this->tanggalan->tgl_indo_sys($tgl_kontrol) : '0000-00-00'),
                    'id_medcheck'       => $sql_medc->id,
                    'id_dokter'         => (!empty($dokter) ? $dokter : $sql_medc->id_dokter),
                    'id_pasien'         => $sql_medc->id_pasien,
                    'id_user'           => $this->ion_auth->user()->row()->id,
                    'no_surat'          => $no_surat,
                    'lahir_tgl'         => (!empty($tgl_lahir) ? $this->tanggalan->tgl_indo_sys($tgl_lahir).' '.$wkt_lahir : '0000-00-00'),
                    'lahir_nm'          => $nm_lahir,
                    'lahir_nm_ayah'     => $nm_ayah,
                    'lahir_nm_ibu'      => $nm_ibu,
                    'jns_klm'           => (!empty($jns_klm) ? $jns_klm : 'L'),
                    'mati_tgl'          => (!empty($mati_tgl) ? $this->tanggalan->tgl_indo_sys($mati_tgl).' '.$mati_wkt : '0000-00-00 00:00:00'),
                    'mati_tmp'          => $mati_tmp,
                    'mati_penyebab'     => $mati_pny,
                    'ruj_dokter'        => $ruj_dokter,
                    'ruj_faskes'        => $ruj_faskes,
                    'ruj_keluhan'       => $ruj_keluhan,
                    'ruj_diagnosa'      => $ruj_diagnos,
                    'ruj_terapi'        => $ruj_terapi,
                    'cvd_tgl_periksa'   => (!empty($cvd_tg_akhr) ? $this->tanggalan->tgl_indo_sys($cvd_tg_akhr) : '0000-00-00'),
                    'cvd_tgl_awal'      => (!empty($cvd_tg_awal) ? $this->tanggalan->tgl_indo_sys($cvd_tg_awal) : '0000-00-00'),
                    'cvd_tgl_akhir'     => (!empty($cvd_tg_akhr) ? $this->tanggalan->tgl_indo_sys($cvd_tg_akhr) : '0000-00-00'),
                    'vks_tgl_periksa'   => (!empty($vks_tg_prks) ? $this->tanggalan->tgl_indo_sys($vks_tg_prks) : '0000-00-00'),
                    'nza_tgl_periksa'   => (!empty($nza_tg_prks) ? $this->tanggalan->tgl_indo_sys($nza_tg_prks) : '0000-00-00'),
                    'nza_status'        => (!empty($nza_hasil) ? $nza_hasil : '0'),
                    'hml_periksa'       => (!empty($hml_periksa) ? $hml_periksa : '0'),
                    'hml_tipe_ijin'     => (!empty($hml_tipe) ? $hml_tipe : '0'),
                    'hml_tipe_terbang'  => (!empty($hml_tipe_flt) ? $hml_tipe_flt : '0'),
                    'hml_tgl_awal'      => (!empty($hml_tgl_awal) ? $this->tanggalan->tgl_indo_sys($hml_tgl_awal) : '0000-00-00'),
                    'hml_tgl_akhir'     => (!empty($hml_tgl_akhir) ? $this->tanggalan->tgl_indo_sys($hml_tgl_akhir) : '0000-00-00'),
                    'trb_periksa'       => (!empty($trb_periksa) ? $trb_periksa : '0'),
                    'trb_tipe_terbang'  => (!empty($trb_tipe_flt) ? $trb_tipe_flt : '0'),
                    'trb_tgl_awal'      => (!empty($trb_tgl_awal) ? $this->tanggalan->tgl_indo_sys($trb_tgl_awal) : '0000-00-00'),
                    'trb_tgl_akhir'     => (!empty($trb_tgl_akhir) ? $this->tanggalan->tgl_indo_sys($trb_tgl_akhir) : '0000-00-00'),
                    'tht_lt_kanan'      => $tht_lt_kanan,
                    'tht_lt_kiri'       => $tht_lt_kiri,
                    'tht_membran_kanan'     => $tht_membran_kanan,
                    'tht_membran_kiri'      => $tht_membran_kiri,
                    'tht_mukosa_kanan'      => $tht_mukosa_kanan,
                    'tht_mukosa_kiri'       => $tht_mukosa_kiri,
                    'tht_konka_kanan'       => $tht_konka_kanan,
                    'tht_konka_kiri'        => $tht_konka_kiri,
                    'tht_timpa_kanan'       => $tht_timpa_kanan,
                    'tht_timpa_kiri'        => $tht_timpa_kiri,
                    'tht_tonsil_tg'         => $tht_tonsil_tg,
                    'tht_mukosa_tg'         => $tht_mukosa_tg,
                    'tht_faring_tg'         => $tht_faring_tg,
                    'tht_kesimpulan'        => $tht_kesimpulan,
                    'tht_audio'             => $tht_audio,
                    'tb'                => (float)general::format_angka_db($tb),
                    'td'                => $td,
                    'bb'                => (float)general::format_angka_db($bb),
                    'bw'                => ($bw == '+' ? '+' : '-'),
                    'bw_ket'            => (!empty($bw_ket) ? $bw_ket : ''),
                    'jml_hari'          => (float)$jml_hari,
                    'hasil'             => (!empty($hasil) ? $hasil : '0'),
                    'keterangan'        => (!empty($vks_nama) ? $vks_nama : ''),
                    'tipe'              => $tipe_surat,
                    'status_sembuh'     => (!empty($sembuh) ? $sembuh : '0'),
                );
                
                # Simpan data surat kedalam tabel
                $this->db->insert('tbl_trans_medcheck_surat', $data);
                
                if ($this->db->affected_rows() > 0) {
                    $this->session->set_flashdata('medcheck_toast', 'toastr.success("Surat '.general::tipe_surat($tipe_surat).' berhasil disimpan !");');
                }
                
                redirect(base_url('medcheck/tambah.php?id='.general::enkrip($sql_medc->id).'&status='.$status));
                
//                echo '<pre>';
//                print_r($data);
//                echo '</pre>';
//
//                $this->session->set_flashdata('medcheck', '<div class="alert alert-success">Data surat berhasil disimpan</div>');
//                crud::simpan('tbl_trans_medcheck_surat', $data);             
//                redirect(base_url('medcheck/tambah.php?id='.general::enkrip($sql_medc->id).'&status='.$status));
            }
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }

    public function set_medcheck_surat_update() {
        if (akses::aksesLogin() == TRUE) {
            $id             = $this->input->post('id');
            $id_surat       = $this->input->post('id_surat');
            $status         = $this->input->post('status');
            $tgl_masuk      = $this->input->post('tgl_masuk');
            $tgl_keluar     = $this->input->post('tgl_keluar');
            $tgl_kontrol    = $this->input->post('tgl_kontrol');
            $tgl_lahir      = $this->input->post('tgl_lahir');
            $wkt_lahir      = $this->input->post('wkt_lahir');
            $nm_lahir       = $this->input->post('nm_lahir');
            $nm_ayah        = $this->input->post('nm_ayah');
            $nm_ibu         = $this->input->post('nm_ibu');
            $jns_klm        = $this->input->post('jns_klm');
            $hasil          = $this->input->post('hasil');
            $dokter         = $this->input->post('dokter');
            $tb             = $this->input->post('tb');
            $td             = $this->input->post('td');
            $bb             = $this->input->post('bb');
            $bw             = $this->input->post('bw');
            $bw_ket         = $this->input->post('bw_ket');
            $tipe_surat     = $this->input->post('tipe_surat');
            $sembuh         = $this->input->post('sembuh');
            $mati_tgl       = $this->input->post('mati_tgl');
            $mati_wkt       = $this->input->post('mati_wkt');
            $mati_tmp       = $this->input->post('mati_tmp');
            $mati_pny       = $this->input->post('mati_penyebab');
            $ruj_dokter     = $this->input->post('ruj_dokter');
            $ruj_faskes     = $this->input->post('ruj_faskes');
            $ruj_keluhan    = $this->input->post('ruj_keluhan');
            $ruj_diagnos    = $this->input->post('ruj_diagnosa');
            $ruj_terapi     = $this->input->post('ruj_terapi');
            $cvd_tg_prks    = $this->input->post('cvd_tgl_periksa');
            $cvd_tg_awal    = $this->input->post('cvd_tgl_awal');
            $cvd_tg_akhr    = $this->input->post('cvd_tgl_akhir');
            $vks_nama       = $this->input->post('vks_nama');
            $vks_tg_prks    = $this->input->post('vks_tgl_periksa');
            $nza_tg_prks    = $this->input->post('napza_tgl_periksa');
            $nza_hasil      = $this->input->post('napza_hasil');
            $hml_tipe       = $this->input->post('hml_tipe');
            $hml_tipe_flt   = $this->input->post('hml_tipe_terbang');
            $hml_periksa    = $this->input->post('hml_periksa');
            $hml_tgl_awal   = $this->input->post('hml_tgl_awal');
            $hml_tgl_akhir  = $this->input->post('hml_tgl_akhir');
            
            $this->form_validation->set_error_delimiters('<div class="alert alert-danger">', '</div>');

            $this->form_validation->set_rules('id', 'ID', 'required');

            if ($this->form_validation->run() == FALSE) {
                $msg_error = array(
                    'id'        => form_error('id'),
                );

                $this->session->set_flashdata('anamnesa', $msg_error);

                redirect(base_url('medcheck/tambah.php?id='.$id.'status='.$status));
            } else {
                $sql_medc       = $this->db->where('id', general::dekrip($id))->get('tbl_trans_medcheck')->row(); 
                $pengaturan     = $this->db->get('tbl_pengaturan')->row();
                
                switch ($tipe_surat){
                    case '1';
                        $str_tipe   = $pengaturan->kode_surat_sht;
                        break;
                    
                    case '2';
                        $str_tipe   = $pengaturan->kode_surat_skt;
                        break;
                    
                    case '3';
                        $str_tipe   = $pengaturan->kode_surat_rnp;
                        break;
                    
                    case '4';
                        $str_tipe   = $pengaturan->kode_surat_kntrl;
                        break;
                    
                    case '5';
                        $str_tipe   = $pengaturan->kode_surat_lahir;
                        break;
                    
                    case '6';
                        $str_tipe   = $pengaturan->kode_surat_mati;
                        break;
                    
                    case '7';
                        $str_tipe   = $pengaturan->kode_surat_covid;
                        break;
                    
                    case '8';
                        $str_tipe   = $pengaturan->kode_surat_rujukan;
                        break;
                    
                    case '9';
                        $str_tipe   = $pengaturan->kode_surat;
                        break;
                    
                    case '10';
                        $str_tipe   = $pengaturan->kode_surat_hamil;
                        break;
                    
                    case '11';
                        $str_tipe   = $pengaturan->kode_surat_cvd;
                        break;
                    
                    case '12';
                        $str_tipe   = $pengaturan->kode_surat_cvd;
                        break;
                    
                    case '13';
                        $str_tipe   = $pengaturan->kode_periksa;
                        break;
                }
                                
                $nomer          = $this->db->where('tipe', $tipe_surat)->where('MONTH(tgl_simpan)', date('m'))->where('YEAR(tgl_simpan)', date('Y'))->get('tbl_trans_medcheck_surat')->num_rows() + 1;
                $no_surat       = sprintf('%03d', $nomer).'/'.$str_tipe.'/'.date('m').'/'.date('Y');
                $tgl_awal       = date_create($this->tanggalan->tgl_indo_sys($tgl_masuk));
                $tgl_akhir      = date_create($this->tanggalan->tgl_indo_sys($tgl_keluar));
                $diff           = date_diff($tgl_awal, $tgl_akhir);
                $hari           = $diff->format("%d%");
                $jml_hari       = ($tgl_awal == $tgl_akhir ? '1' : ($hari > 1 ? $hari + 1 : '2'));
                
                $data = array(
                    'tgl_simpan'        => date('Y-m-d H:i:s'),
                    'tgl_masuk'         => (!empty($tgl_masuk) ? $this->tanggalan->tgl_indo_sys($tgl_masuk) : date('Y-m-d')),
                    'tgl_keluar'        => (!empty($tgl_keluar) ? $this->tanggalan->tgl_indo_sys($tgl_keluar) : '0000-00-00'),
                    'tgl_kontrol'       => (!empty($tgl_kontrol) ? $this->tanggalan->tgl_indo_sys($tgl_kontrol) : '0000-00-00'),
                    'id_medcheck'       => $sql_medc->id,
                    'id_dokter'         => $sql_medc->id_dokter,
                    'id_pasien'         => $sql_medc->id_pasien,
                    'id_user'           => $this->ion_auth->user()->row()->id,
                    'no_surat'          => $no_surat,
                    'lahir_tgl'         => (!empty($tgl_lahir) ? $this->tanggalan->tgl_indo_sys($tgl_lahir).' '.$wkt_lahir : '0000-00-00'),
                    'lahir_nm'          => $nm_lahir,
                    'lahir_nm_ayah'     => $nm_ayah,
                    'lahir_nm_ibu'      => $nm_ibu,
                    'jns_klm'           => (!empty($jns_klm) ? $jns_klm : 'L'),
                    'mati_tgl'          => (!empty($mati_tgl) ? $this->tanggalan->tgl_indo_sys($mati_tgl).' '.$mati_wkt : '0000-00-00 00:00:00'),
                    'mati_tmp'          => $mati_tmp,
                    'mati_penyebab'     => $mati_pny,
                    'ruj_dokter'        => $ruj_dokter,
                    'ruj_faskes'        => $ruj_faskes,
                    'ruj_keluhan'       => $ruj_keluhan,
                    'ruj_diagnosa'      => $ruj_diagnos,
                    'ruj_terapi'        => $ruj_terapi,
                    'cvd_tgl_periksa'   => (!empty($cvd_tg_akhr) ? $this->tanggalan->tgl_indo_sys($cvd_tg_akhr) : '0000-00-00'),
                    'cvd_tgl_awal'      => (!empty($cvd_tg_awal) ? $this->tanggalan->tgl_indo_sys($cvd_tg_awal) : '0000-00-00'),
                    'cvd_tgl_akhir'     => (!empty($cvd_tg_akhr) ? $this->tanggalan->tgl_indo_sys($cvd_tg_akhr) : '0000-00-00'),
                    'vks_tgl_periksa'   => (!empty($vks_tg_prks) ? $this->tanggalan->tgl_indo_sys($vks_tg_prks) : '0000-00-00'),
                    'nza_tgl_periksa'   => (!empty($nza_tg_prks) ? $this->tanggalan->tgl_indo_sys($nza_tg_prks) : '0000-00-00'),
                    'nza_status'        => (!empty($nza_hasil) ? $nza_hasil : '0'),
                    'hml_periksa'       => (!empty($hml_periksa) ? $hml_periksa : '0'),
                    'hml_tipe_ijin'     => (!empty($hml_tipe) ? $hml_tipe : '0'),
                    'hml_tipe_terbang'  => (!empty($hml_tipe_flt) ? $hml_tipe_flt : '0'),
                    'hml_tgl_awal'      => (!empty($hml_tgl_awal) ? $this->tanggalan->tgl_indo_sys($hml_tgl_awal) : '0000-00-00'),
                    'hml_tgl_akhir'     => (!empty($hml_tgl_akhir) ? $this->tanggalan->tgl_indo_sys($hml_tgl_akhir) : '0000-00-00'),
                    'tb'                => (float)general::format_angka_db($tb),
                    'td'                => $td,
                    'bb'                => (float)general::format_angka_db($bb),
                    'bw'                => ($bw == '+' ? '+' : '-'),
                    'bw_ket'            => (!empty($bw_ket) ? $bw_ket : ''),
                    'jml_hari'          => (float)$jml_hari,
                    'hasil'             => (!empty($hasil) ? $hasil : '0'),
                    'keterangan'        => (!empty($vks_nama) ? $vks_nama : ''),
                    'tipe'              => $tipe_surat,
                    'status_sembuh'     => (!empty($sembuh) ? $sembuh : '0'),
                );
                
                # Simpan data surat kedalam tabel
                $this->db->where('id', general::dekrip($id_surat))->update('tbl_trans_medcheck_surat', $data);
                
                if ($this->db->affected_rows() > 0) {
                    $this->session->set_flashdata('medcheck_toast', 'toastr.success("Surat '.general::tipe_surat($tipe_surat).' berhasil dirubah !");');
                }
                
                redirect(base_url('medcheck/tambah.php?id='.general::enkrip($sql_medc->id).'&status='.$status));
                
//                echo '<pre>';
//                print_r($data);
//                echo '</pre>';
            }
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }

    public function set_medcheck_inform() {
        if (akses::aksesLogin() == TRUE) {
            $id         = $this->input->post('id');
            $status     = $this->input->post('status');
            $tgl_masuk  = $this->input->post('tgl_masuk');
            $tipe_surat = $this->input->post('tipe_surat');
            $nama       = $this->input->post('nama');
            $jns_klm    = $this->input->post('jns_klm');
            $tgl_lahir  = $this->input->post('tgl_lahir');
            $alamat     = $this->input->post('alamat');
            $hubungan   = $this->input->post('hubungan');
            $ruang      = $this->input->post('kamar');
            $ruang_nm   = $this->input->post('ruang');
            $saksi1     = $this->input->post('saksi1');
            $saksi2     = $this->input->post('saksi2');
            $dokter     = $this->input->post('dokter');
            $penjamin   = $this->input->post('penjamin');
            $penanggung = $this->input->post('penanggung');
            $tindakan   = $this->input->post('tindakan');
            $setuju     = $this->input->post('status_stj');
            
            $this->form_validation->set_error_delimiters('<div class="alert alert-danger">', '</div>');

            $this->form_validation->set_rules('id', 'ID', 'required');

            if ($this->form_validation->run() == FALSE) {
                $msg_error = array(
                    'id' => form_error('id'),
                );

                $this->session->set_flashdata('form_error', $msg_error);

                redirect(base_url('medcheck/tambah.php?id='.$id.'status='.$status));
            } else {
                $sql_medc       = $this->db->where('id', general::dekrip($id))->get('tbl_trans_medcheck')->row();
                $sql_dft_gc     = $this->db->where('id_pendaftaran', $sql_medc->id_dft)->get('tbl_pendaftaran_gc')->row();
                $sql_kamar      = $this->db->where('id', $ruang)->get('tbl_m_kamar')->row(); 
                $pengaturan     = $this->db->get('tbl_pengaturan')->row();
                $jml            = $sql_kamar->jml + 1;
                
                switch ($tipe_surat){
                    case '1';
                        $str_tipe   = $pengaturan->kode_surat;
                        break;
                    
                    case '2';
                        $str_tipe   = $pengaturan->kode_surat;
                        break;
                }
                
                $nomer          = $this->db->where('tipe', $tipe_surat)->where('MONTH(tgl_simpan)', date('m'))->where('YEAR(tgl_simpan)', date('Y'))->get('tbl_trans_medcheck_surat_inform')->num_rows() + 1;
                $no_surat       = sprintf('%03d', $nomer).'/'.$str_tipe.'/'.date('m').'/'.date('Y');
                $tgl_awal       = date_create($this->tanggalan->tgl_indo_sys($tgl_masuk));
                $tgl_akhir      = date_create($this->tanggalan->tgl_indo_sys($tgl_keluar));
                $diff           = date_diff($tgl_awal, $tgl_akhir);
                $hari           = $diff->format("%d%");
                
                $data = array(
                    'tgl_simpan'    => date('Y-m-d H:i:s'),
                    'tgl_masuk'     => (!empty($tgl_masuk) ? $this->tanggalan->tgl_indo_sys($tgl_masuk) : date('Y-m-d')),
                    'tgl_lahir'     => (!empty($tgl_lahir) ? $this->tanggalan->tgl_indo_sys($tgl_lahir) : date('Y-m-d')),
                    'id_medcheck'   => $sql_medc->id,
                    'id_dokter'     => $dokter,
                    'id_pasien'     => $sql_medc->id_pasien,
                    'id_user'       => $this->ion_auth->user()->row()->id,
                    'id_ruang'      => (!empty($ruang) ? $ruang : '0'),
                    'no_surat'      => $no_surat,
                    'nama'          => $nama,
                    'jns_klm'       => $jns_klm,
                    'alamat'        => $alamat,
                    'penjamin'      => $penjamin,
                    'penanggung'    => $penanggung,
                    'ruang'         => $ruang_nm,
                    'nama_saksi1'   => $saksi1,
                    'nama_saksi2'   => $saksi2,
                    'tindakan'      => $tindakan,
                    'status_hub'    => (!empty($hubungan) ? $hubungan : '0'),
                    'status_stj'    => (!empty($setuju) ? $setuju : '0'),
                    'status_ttd'    => '0',
                    'tipe'          => (!empty($tipe_surat) ? $tipe_surat : '0'),
                );
                
                $data_kmr_master = array(
                    'tgl_modif' => date('Y-m-d H:i:s'),
                    'jml'       => $jml,
                );
                
                /* Transaksi Database */
                $this->db->trans_begin();
                
                # Simpan ke tabel medcheck Inform
                $this->db->insert('tbl_trans_medcheck_surat_inform', $data);
                $last_id = crud::last_id();
                
                # Masukkan Informed Consent ke tabel riwayat berkas
                $data_file_ifc = array(
                    'id_medcheck'       => $sql_medc->id,
                    'id_pasien'         => $sql_medc->id_pasien,
                    'id_user'           => $this->ion_auth->user()->row()->id,
                    'tgl_simpan'        => date('Y-m-d H:i:s'),
                    'tgl_masuk'         => date('Y-m-d H:i'),
                    'judul'             => 'SURAT '.strtoupper(general::tipe_surat_inf($tipe_surat)),
                    'file_name'         => 'medcheck/surat/cetak_pdf_inf.php?id='.general::enkrip($last_id).'&no_nota='.general::enkrip($sql_medc->id),
                    'file_ext'          => '.pdf',
                    'file_type'         => 'application/pdf',
                    'status'            => '2',
                );
                
                $this->db->insert('tbl_trans_medcheck_file', $data_file_ifc);
                
                # Cek Tipe kamar, jika rawat inap set secara otomatis
                if($tipe_surat == 1 AND $sql_medc->tipe == '3'){
                    $data_kmr = array(
                        'id_medcheck'=> $sql_medc->id,
                        'id_inform'  => $last_id,
                        'id_kamar'   => $sql_kamar->id,
                        'id_pasien'  => $sql_medc->id_pasien,
                        'id_user'    => $this->ion_auth->user()->row()->id,
                        'tgl_simpan' => date('Y-m-d H:i:s'),
                        'keterangan' => 'Inform Consent '.$no_surat,
                        'status'     => '1',
                    );
                
//                    # Simpan ke tabel trans medcheck kamar
//                    $this->db->insert('tbl_trans_medcheck_kamar', $data_kmr);
//                
//                    # Update tabel kamar
//                    $this->db->where('id', $sql_kamar->id)->update('tbl_m_kamar', $data_kmr_master);
                }
                    
                # Cek status transact MySQL
                if ($this->db->trans_status() === FALSE) {
                    # Rollback jika gagal
                    $this->db->trans_rollback();

                    # Tampilkan pesan error
                    $this->session->set_flashdata('medcheck_toast', 'toastr.error("Inform Consent gagal disimpan !");');
                } else {
                    $this->db->trans_commit();

                    # Tampilkan pesan sukses jika sudah berhasil commit
                    $this->session->set_flashdata('medcheck_toast', 'toastr.success("Inform Consent Berhasil disimpan !");');
                }
                
                redirect(base_url('medcheck/tambah.php?id='.general::enkrip($sql_medc->id).'&status='.$status.(!empty($last_id) ? '&form_id='.general::enkrip($last_id) : '')));

//                echo '<pre>';
//                print_r($data_file_gc);
//                echo '</pre>';
//                echo '<pre>';
//                print_r($_POST);
//                echo '</pre>';

//                $this->session->set_flashdata('medcheck', '<div class="alert alert-success">Data surat berhasil disimpan</div>');
//                crud::simpan('tbl_trans_medcheck_surat_inform', $data);
//                $last_id = crud::last_id();
//              
            }
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }

    public function set_medcheck_inform_upd() {
        if (akses::aksesLogin() == TRUE) {
            $id         = $this->input->post('id');
            $id_form    = $this->input->post('id_form');
            $status     = $this->input->post('status');
            $tgl_masuk  = $this->input->post('tgl_masuk');
            $tipe_surat = $this->input->post('tipe_surat');
            $nama       = $this->input->post('nama');
            $jns_klm    = $this->input->post('jns_klm');
            $tgl_lahir  = $this->input->post('tgl_lahir');
            $alamat     = $this->input->post('alamat');
            $hubungan   = $this->input->post('hubungan');
            $ruang      = $this->input->post('kamar');
            $ruang_nm   = $this->input->post('ruang');
            $saksi1     = $this->input->post('saksi1');
            $saksi2     = $this->input->post('saksi2');
            $dokter     = $this->input->post('dokter');
            $penjamin   = $this->input->post('penjamin');
            $penanggung = $this->input->post('penanggung');
            $tindakan   = $this->input->post('tindakan');
            $setuju     = $this->input->post('status_stj');
            
            $this->form_validation->set_error_delimiters('<div class="alert alert-danger">', '</div>');

            $this->form_validation->set_rules('id', 'ID', 'required');

            if ($this->form_validation->run() == FALSE) {
                $msg_error = array(
                    'id' => form_error('id'),
                );

                $this->session->set_flashdata('form_error', $msg_error);

                redirect(base_url('medcheck/tambah.php?id='.$id.'status='.$status));
            } else {
                $sql_medc       = $this->db->where('id', general::dekrip($id))->get('tbl_trans_medcheck')->row();
                $sql_dft_gc     = $this->db->where('id_pendaftaran', $sql_medc->id_dft)->get('tbl_pendaftaran_gc')->row();
                $sql_kamar      = $this->db->where('id', $ruang)->get('tbl_m_kamar')->row(); 
                $pengaturan     = $this->db->get('tbl_pengaturan')->row();
                $jml            = $sql_kamar->jml + 1;
                
                switch ($tipe_surat){
                    case '1';
                        $str_tipe   = $pengaturan->kode_surat;
                        break;
                    
                    case '2';
                        $str_tipe   = $pengaturan->kode_surat;
                        break;
                }
                
                $nomer          = $this->db->where('tipe', $tipe_surat)->where('MONTH(tgl_simpan)', date('m'))->where('YEAR(tgl_simpan)', date('Y'))->get('tbl_trans_medcheck_surat_inform')->num_rows() + 1;
                $no_surat       = sprintf('%03d', $nomer).'/'.$str_tipe.'/'.date('m').'/'.date('Y');
                $tgl_awal       = date_create($this->tanggalan->tgl_indo_sys($tgl_masuk));
                $tgl_akhir      = date_create($this->tanggalan->tgl_indo_sys($tgl_keluar));
                $diff           = date_diff($tgl_awal, $tgl_akhir);
                $hari           = $diff->format("%d%");
                
                $data = array(
                    'tgl_simpan'    => date('Y-m-d H:i:s'),
                    'tgl_masuk'     => (!empty($tgl_masuk) ? $this->tanggalan->tgl_indo_sys($tgl_masuk) : date('Y-m-d')),
                    'tgl_lahir'     => (!empty($tgl_lahir) ? $this->tanggalan->tgl_indo_sys($tgl_lahir) : date('Y-m-d')),
                    'id_medcheck'   => $sql_medc->id,
                    'id_dokter'     => $dokter,
                    'id_pasien'     => $sql_medc->id_pasien,
                    'id_user'       => $this->ion_auth->user()->row()->id,
                    'id_ruang'      => (!empty($ruang) ? $ruang : '0'),
                    'no_surat'      => $no_surat,
                    'nama'          => $nama,
                    'jns_klm'       => $jns_klm,
                    'alamat'        => $alamat,
                    'penjamin'      => $penjamin,
                    'penanggung'    => $penanggung,
                    'ruang'         => $ruang_nm,
                    'nama_saksi1'   => $saksi1,
                    'nama_saksi2'   => $saksi2,
                    'tindakan'      => $tindakan,
                    'status_hub'    => (!empty($hubungan) ? $hubungan : '0'),
                    'status_stj'    => (!empty($setuju) ? $setuju : '0'),
                    'status_ttd'    => '0',
                    'tipe'          => (!empty($tipe_surat) ? $tipe_surat : '0'),
                );
                
                $data_kmr_master = array(
                    'tgl_modif' => date('Y-m-d H:i:s'),
                    'jml'       => $jml,
                );
                
                /* Transaksi Database */
                $this->db->trans_begin();
                
                # Simpan ke tabel medcheck Inform
                $this->db->where('id', general::dekrip($id_form))->update('tbl_trans_medcheck_surat_inform', $data);
                $last_id = $id;
                
                # Masukkan Informed Consent ke tabel riwayat berkas
                $data_file_ifc = array(
                    'id_medcheck'       => $sql_medc->id,
                    'id_pasien'         => $sql_medc->id_pasien,
                    'id_user'           => $this->ion_auth->user()->row()->id,
                    'tgl_simpan'        => date('Y-m-d H:i:s'),
                    'tgl_masuk'         => date('Y-m-d H:i'),
                    'judul'             => 'SURAT '.strtoupper(general::tipe_surat_inf($tipe_surat)),
                    'file_name'         => 'medcheck/surat/cetak_pdf_inf.php?id='.general::enkrip($last_id).'&no_nota='.general::enkrip($sql_medc->id),
                    'file_ext'          => '.pdf',
                    'file_type'         => 'application/pdf',
                    'status'            => '2',
                );
                
//                $this->db->insert('tbl_trans_medcheck_file', $data_file_ifc);
                
                # Cek Tipe kamar, jika rawat inap set secara otomatis
                if($tipe_surat == 1 AND $sql_medc->tipe == '3'){
                    $data_kmr = array(
                        'id_medcheck'=> $sql_medc->id,
                        'id_inform'  => $last_id,
                        'id_kamar'   => $sql_kamar->id,
                        'id_pasien'  => $sql_medc->id_pasien,
                        'id_user'    => $this->ion_auth->user()->row()->id,
                        'tgl_simpan' => date('Y-m-d H:i:s'),
                        'keterangan' => 'Inform Consent '.$no_surat,
                        'status'     => '1',
                    );
                
//                    # Simpan ke tabel trans medcheck kamar
//                    $this->db->insert('tbl_trans_medcheck_kamar', $data_kmr);
//                
//                    # Update tabel kamar
//                    $this->db->where('id', $sql_kamar->id)->update('tbl_m_kamar', $data_kmr_master);
                }
                    
                # Cek status transact MySQL
                if ($this->db->trans_status() === FALSE) {
                    # Rollback jika gagal
                    $this->db->trans_rollback();

                    # Tampilkan pesan error
                    $this->session->set_flashdata('medcheck_toast', 'toastr.error("Inform Consent gagal disimpan !");');
                } else {
                    $this->db->trans_commit();

                    # Tampilkan pesan sukses jika sudah berhasil commit
                    $this->session->set_flashdata('medcheck_toast', 'toastr.success("Inform Consent Berhasil disimpan !");');
                }
                
                redirect(base_url('medcheck/tambah.php?id='.general::enkrip($sql_medc->id).'&status='.$status.(!empty($last_id) ? '&form_id='.general::enkrip($last_id) : '')));

//                echo '<pre>';
//                print_r($data_file_gc);
//                echo '</pre>';
//                echo '<pre>';
//                print_r($_POST);
//                echo '</pre>';

//                $this->session->set_flashdata('medcheck', '<div class="alert alert-success">Data surat berhasil disimpan</div>');
//                crud::simpan('tbl_trans_medcheck_surat_inform', $data);
//                $last_id = crud::last_id();
//              
            }
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }

    public function set_medcheck_inform_upd_ttd() {
        if (akses::aksesLogin() == TRUE) {
            $id         = $this->input->post('id');
            $id_form    = $this->input->post('id_form');
            $foto       = $this->input->post('foto');
            $status     = $this->input->post('status');
            
            $this->form_validation->set_error_delimiters('<div class="alert alert-danger">', '</div>');

            $this->form_validation->set_rules('id', 'ID', 'required');

            if ($this->form_validation->run() == FALSE) {
                $msg_error = array(
                    'id' => form_error('id'),
                );

                $this->session->set_flashdata('form_error', $msg_error);

                redirect(base_url('medcheck/tambah.php?id='.$id.'status='.$status));
            } else {
                $sql_medc       = $this->db->where('id', general::dekrip($id))->get('tbl_trans_medcheck')->row();
                $sql_pas        = $this->db->where('id', $sql_medc->id_pasien)->get('tbl_m_pasien')->row();
                $pengaturan     = $this->db->get('tbl_pengaturan')->row();
                
                switch ($tipe_surat){
                    case '1';
                        $str_tipe   = $pengaturan->kode_surat;
                        break;
                    
                    case '2';
                        $str_tipe   = $pengaturan->kode_surat;
                        break;
                }
                
                $nomer          = $this->db->where('tipe', $tipe_surat)->where('MONTH(tgl_simpan)', date('m'))->get('tbl_trans_medcheck_surat_inform')->num_rows() + 1;
                $no_surat       = sprintf('%03d', $nomer).'/'.$str_tipe.'/'.date('m').'/'.date('Y');
                $tgl_awal       = date_create($this->tanggalan->tgl_indo_sys($tgl_masuk));
                $tgl_akhir      = date_create($this->tanggalan->tgl_indo_sys($tgl_keluar));
                $diff           = date_diff($tgl_awal, $tgl_akhir);
                $hari           = $diff->format("%d%");
                
                # Config File Foto Pasien
                $kode               = sprintf('%05d', $sql_pas->kode);
                $no_rm              = strtolower($sql_pas->kode_dpn.$sql_pas->kode);
                $path               = 'file/pasien/'.$no_rm.'/';
                
                # Simpan foto dari kamera ke dalam format file *.png dari base64
                if (!empty($foto)) {
                    $filename           = $path.'ttd_pernyt_'.$kode.'.png';
                    general::base64_to_jpeg($foto, $filename);
                }
                
                $data = array(
                    'file_name1'     => $filename,
                    'status_ttd'    => (!empty($foto) ? '1' : '0'),
                );

//                echo '<pre>';
//                print_r($data);
//                echo '</pre>';
//                echo '<pre>';
//                print_r($_POST);
//                echo '</pre>';
//
                $this->session->set_flashdata('medcheck', '<div class="alert alert-success">Data surat berhasil disimpan</div>');
                crud::update('tbl_trans_medcheck_surat_inform', 'id', general::dekrip($id_form), $data);
                $last_id = crud::last_id();
                
                redirect(base_url('medcheck/tambah.php?id='.general::enkrip($sql_medc->id).'&status='.$status.(!empty($last_id) ? '&form_id='.general::enkrip($last_id) : '')));
            }
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }
    


    public function set_medcheck_resume() {
        if (akses::aksesLogin() == TRUE) {
            $id     = $this->input->get('id');
            $status = $this->input->get('status');
            
            if(!empty($id)){
                $sql_medc   = $this->db->where('id', general::dekrip($id))->get('tbl_trans_medcheck');
                $sql_pasien = $this->db->where('id', $sql_medc->row()->id_pasien)->get('tbl_m_pasien')->row();
                $pengaturan = $this->db->get('tbl_pengaturan')->row();
                   
                $nomer      = $this->db->where('MONTH(tgl_simpan)', date('m'))->get('tbl_trans_medcheck_resume')->num_rows() + 1;
                $no_surat   = sprintf('%03d', $nomer).'/'.$pengaturan->kode_surat.'/'.date('m').'/'.date('Y');
                $grup       = $this->ion_auth->get_users_groups()->row();
                $is_rad     = ($grup->name == 'radiografer' ? '2' : '0');
                $is_rad_id  = ($grup->name == 'radiografer' ? $this->ion_auth->user()->row()->id : '0');
                $is_doc_id  = ($grup->name == 'dokter' ? $this->ion_auth->user()->row()->id : '0');
               
                $data = array(
                    'tgl_simpan'    => date('Y-m-d H:i:s'),
                    'tgl_masuk'     => date('Y-m-d'),
                    'id_medcheck'   => $sql_medc->row()->id,
                    'id_pasien'     => $sql_medc->row()->id_pasien,
                    'id_user'       => $this->ion_auth->user()->row()->id,
                    'id_dokter'     => $is_doc_id,
                    'no_surat'      => $no_surat,
                    'pasien'        => $sql_medc->row()->pasien,
                    'status'        => '0',
                    'status_rsm'    => '0',
                );
                
                if($sql_medc->num_rows() > 0){
                    crud::simpan('tbl_trans_medcheck_resume', $data);
                    $last_id = crud::last_id();
                    
                    # Masukkan Resume ke tabel riwayat berkas
                    $data_file_resm = array(
                        'id_medcheck'       => $sql_medc->row()->id,
                        'id_pasien'         => $sql_medc->row()->id_pasien,
                        'id_user'           => $this->ion_auth->user()->row()->id,
                        'id_berkas'         => $last_id,
                        'tgl_simpan'        => date('Y-m-d H:i:s'),
                        'tgl_masuk'         => date('Y-m-d H:i'),
                        'judul'             => 'RESUME MEDIS PASIEN ('.$no_surat.')',
                        'keterangan'        => $sql_pasien->nama_pgl,
                        'file_name'         => '/medcheck/surat/cetak_pdf_rsm_lab.php?id='.general::enkrip($sql_medc->row()->id).'&id_resm='.general::enkrip($last_id).'&status='.$status,
                        'file_ext'          => '.pdf',
                        'file_type'         => 'application/pdf',
                        'status'            => '2',
                    );

                    $this->db->insert('tbl_trans_medcheck_file', $data_file_resm);
                    
                    $this->session->set_flashdata('medcheck', '<div class="alert alert-success">Data permintaan resume medis di buat</div>');
                    redirect(base_url('medcheck/tambah.php?act='.($grup->name == 'dokter' ? 'resm_input' : 'resm_surat').'&id='.general::enkrip($sql_medc->row()->id).'&id_resm='.general::enkrip($last_id).'&status='.$status));
                }else{
                    redirect(base_url('medcheck/tambah.php?id='.general::enkrip($sql_medc->row()->id).'&status='.$status));
                }
            }else{
//                redirect(base_url('medcheck/tambah.php?id='.general::enkrip($sql_medc->row()->id).'&status='.$status));
            }
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }    
    
    public function set_medcheck_resume_upd() {
        if (akses::aksesLogin() == TRUE) {
            $id         = $this->input->post('id');
            $id_rsm     = $this->input->post('id_resume');
            $id_user    = $this->input->post('id_user');
            $status     = $this->input->post('status');
            $dokter_rsm = $this->input->post('dokter_kirim');
            $no_sample  = $this->input->post('no_sample');
            $saran      = $this->input->post('saran');
            $kesimpulan = $this->input->post('kesimpulan');
            $route      = $this->input->post('route');
            $act        = $this->input->post('act');
            
            $this->form_validation->set_error_delimiters('<div class="alert alert-danger">', '</div>');

            $this->form_validation->set_rules('id', 'ID', 'required');

            if ($this->form_validation->run() == FALSE) {
                $msg_error = array(
                    'id'            => form_error('id'),
                );

                $this->session->set_flashdata('form_error', $msg_error);

                redirect(base_url('medcheck/tambah.php?act=resm_surat&id='.$id.'&id_resm='.$id_rsm.'&status='.$status));
            } else {
                $sql_medc_resm = $this->db->where('id', general::dekrip($id_rsm))->get('tbl_trans_medcheck_resume')->row();

                $data = array(
                    'tgl_modif'   => date('Y-m-d H:i:s'),
                    'id_dokter'   => $dokter_rsm,
                    'no_sample'   => $no_sample,
                    'saran'       => $saran,
                    'kesimpulan'  => $kesimpulan,
                );
                
                $this->session->set_flashdata('medcheck', '<div class="alert alert-success">Data resume berhasil disimpan</div>');
                crud::update('tbl_trans_medcheck_resume', 'id', $sql_medc_resm->id, $data);
                
                redirect(base_url('medcheck/tambah.php?act=resm_surat&id='.$id.'&id_resm='.general::enkrip($sql_medc_resm->id).'&status='.$status.(!empty($route) ? '&route='.$route : '')));                
            }
        } else {
            $errors = $this->ion_auth->messages(); 
           $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }
    
    public function set_medcheck_resume_hsl() {
        if (akses::aksesLogin() == TRUE) {
            $id         = $this->input->post('id');
            $id_rsm     = $this->input->post('id_resume');
            $status     = $this->input->post('status');
            $periksa    = $this->input->post('pemeriksaan');
            $hasil      = $this->input->post('hasil');
            $route      = $this->input->post('route');
            $act        = $this->input->post('act');
            
            $this->form_validation->set_error_delimiters('<div class="alert alert-danger">', '</div>');

            $this->form_validation->set_rules('id', 'ID', 'required');

            if ($this->form_validation->run() == FALSE) {
                $msg_error = array(
                    'id'            => form_error('id'),
                );

                $this->session->set_flashdata('form_error', $msg_error);

                redirect(base_url('medcheck/tambah.php?act=resm_surat&id='.$id.'&id_resm='.$id_rsm.'&status='.$status));
            } else {
                $sql_medc_resm = $this->db->where('id', general::dekrip($id_rsm))->get('tbl_trans_medcheck_resume')->row();

                $data = array(
                    'id_medcheck' => general::dekrip($id),
                    'id_resume'   => general::dekrip($id_rsm),
                    'id_user'     => $this->ion_auth->user()->row()->id,
                    'tgl_simpan'  => date('Y-m-d H:i:s'),
                    'param'       => $periksa,
                    'param_nilai' => $hasil,
                    'status_rnp'  => '0',
                    'status_trp'  => '0',
                );
                
                $this->session->set_flashdata('medcheck', '<div class="alert alert-success">Data pemeriksaan resume berhasil disimpan</div>');
                $this->db->insert('tbl_trans_medcheck_resume_det', $data);
                
                redirect(base_url('medcheck/tambah.php?act=resm_input&id='.$id.'&id_resm='.general::enkrip($sql_medc_resm->id).'&status='.$status.(!empty($route) ? '&route='.$route : '')));                
            }
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }
    
    public function set_medcheck_resume_hsl_upd() {
        if (akses::aksesLogin() == TRUE) {
            $id         = $this->input->post('id');
            $id_rsm     = $this->input->post('id_resume');
            $id_rsm_hsl = $this->input->post('id_resume_hsl');
            $status     = $this->input->post('status');
            $periksa    = $this->input->post('pemeriksaan');
            $hasil      = $this->input->post('hasil');
            $route      = $this->input->post('route');
            $act        = $this->input->post('act');
            
            $this->form_validation->set_error_delimiters('<div class="alert alert-danger">', '</div>');

            $this->form_validation->set_rules('id', 'ID', 'required');

            if ($this->form_validation->run() == FALSE) {
                $msg_error = array(
                    'id'            => form_error('id'),
                );

                $this->session->set_flashdata('form_error', $msg_error);

                redirect(base_url('medcheck/tambah.php?act=resm_surat&id='.$id.'&id_resm='.$id_rsm.'&status='.$status));
            } else {
                $sql_medc_resm = $this->db->where('id', general::dekrip($id_rsm))->get('tbl_trans_medcheck_resume')->row();

                $data = array(
                    'id_user'     => $this->ion_auth->user()->row()->id,
                    'param'       => $periksa,
                    'param_nilai' => $hasil,
                );
                
                $this->session->set_flashdata('medcheck', '<div class="alert alert-success">Data pemeriksaan resume berhasil disimpan</div>');
                $this->db->where('id', general::dekrip($id_rsm_hsl))->update('tbl_trans_medcheck_resume_det', $data);
                
                redirect(base_url('medcheck/tambah.php?act=resm_input&id='.$id.'&id_resm='.general::enkrip($sql_medc_resm->id).'&status='.$status.(!empty($route) ? '&route='.$route : '')));                
            }
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }
    
    public function set_medcheck_resume_hsl2() {
        if (akses::aksesLogin() == TRUE) {
            $id         = $this->input->post('id');
            $id_rsm     = $this->input->post('id_resume');
            $status     = $this->input->post('status');
            $periksa    = $this->input->post('pemeriksaan');
            $hasil      = $this->input->post('hasil');
            $route      = $this->input->post('route');
            $act        = $this->input->post('act');
            
            $this->form_validation->set_error_delimiters('<div class="alert alert-danger">', '</div>');

            $this->form_validation->set_rules('id', 'ID', 'required');

            if ($this->form_validation->run() == FALSE) {
                $msg_error = array(
                    'id'            => form_error('id'),
                );

                $this->session->set_flashdata('form_error', $msg_error);

                redirect(base_url('medcheck/tambah.php?act=resm_input&id='.$id.'&id_resm='.$id_rsm.'&status='.$status));
            } else {
                $sql_medc_resm = $this->db->where('id', general::dekrip($id_rsm))->get('tbl_trans_medcheck_resume')->row();
                
                /* Transaksi Database */
                $this->db->query('SET autocommit = 0;');
                $this->db->trans_begin();
                
                for($n = 1; $n <= 13; $n++){
                    $data = array(
                        'id_medcheck' => general::dekrip($id),
                        'id_resume'   => general::dekrip($id_rsm),
                        'id_user'     => $this->ion_auth->user()->row()->id,
                        'tgl_simpan'  => date('Y-m-d H:i:s'),
                        'param'       => htmlentities($this->input->post('pemeriksaan'.$n)),
                        'param_nilai' => htmlentities($this->input->post('hasil'.$n)),
                        'status_rnp'  => '1',
                        'status_trp'  => '0'
                    );
                    
                    $this->db->insert('tbl_trans_medcheck_resume_det', $data);
                }
                
                $this->db->trans_complete();
                $this->db->query('SET autocommit = 1;');
                
                $this->session->set_flashdata('medcheck', '<div class="alert alert-success">Data pemeriksaan resume berhasil disimpan</div>');
                redirect(base_url('medcheck/tambah.php?act=resm_input_rnp&id='.$id.'&id_resm='.general::enkrip($sql_medc_resm->id).'&status='.$status.(!empty($route) ? '&route='.$route : '')));                
            }
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }
    
    public function set_medcheck_resume_hsl2_upd() {
        if (akses::aksesLogin() == TRUE) {
            $id         = $this->input->post('id');
            $id_rsm     = $this->input->post('id_resume');
            $status     = $this->input->post('status');
            $periksa    = $this->input->post('pemeriksaan');
            $hasil      = $this->input->post('hasil');
            $route      = $this->input->post('route');
            $act        = $this->input->post('act');
            
            $this->form_validation->set_error_delimiters('<div class="alert alert-danger">', '</div>');

            $this->form_validation->set_rules('id', 'ID', 'required');

            if ($this->form_validation->run() == FALSE) {
                $msg_error = array(
                    'id'            => form_error('id'),
                );

                $this->session->set_flashdata('form_error', $msg_error);

                redirect(base_url('medcheck/tambah.php?act=resm_input&id='.$id.'&id_resm='.$id_rsm.'&status='.$status));
            } else {
                $sql_medc_resm = $this->db->where('id', general::dekrip($id_rsm))->get('tbl_trans_medcheck_resume')->row();                

                /* Transaksi Database */
                $this->db->query('SET autocommit = 0;');
                $this->db->trans_begin();
                
                # Hapus dahulu
                $this->db->where('id_resume', $sql_medc_resm->id)->delete('tbl_trans_medcheck_resume_det');
                
                for($n = 1; $n <= 13; $n++){
                    $data = array(
                        'id_medcheck' => general::dekrip($id),
                        'id_resume'   => general::dekrip($id_rsm),
                        'id_user'     => $this->ion_auth->user()->row()->id,
                        'tgl_simpan'  => date('Y-m-d H:i:s'),
                        'param'       => htmlentities($this->input->post('pemeriksaan'.$n)),
                        'param_nilai' => htmlentities($this->input->post('hasil'.$n)),
                        'status_rnp'  => '1',
                        'status_trp'  => '0'
                    );
                    
                    $this->db->insert('tbl_trans_medcheck_resume_det', $data);
                }
                
                $this->db->trans_complete();
                $this->db->query('SET autocommit = 1;');
                
                $this->session->set_flashdata('medcheck', '<div class="alert alert-success">Data pemeriksaan resume berhasil disimpan !!</div>');
                redirect(base_url('medcheck/tambah.php?act=resm_input_rnp&id='.$id.'&id_resm='.general::enkrip($sql_medc_resm->id).'&status='.$status.(!empty($route) ? '&route='.$route : '')));                
            }
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }
    
    public function set_medcheck_resume_hsl3() {
        if (akses::aksesLogin() == TRUE) {
            $id         = $this->input->post('id');
            $id_rsm     = $this->input->post('id_resume');
            $status     = $this->input->post('status');
            $periksa    = $this->input->post('pemeriksaan');
            $hasil1     = $this->input->post('hasil1');
            $hasil2     = $this->input->post('hasil2');
            $hasil3     = $this->input->post('hasil3');
            $route      = $this->input->post('route');
            $act        = $this->input->post('act');
            
            $this->form_validation->set_error_delimiters('<div class="alert alert-danger">', '</div>');

            $this->form_validation->set_rules('id', 'ID', 'required');

            if ($this->form_validation->run() == FALSE) {
                $msg_error = array(
                    'id'            => form_error('id'),
                );

                $this->session->set_flashdata('form_error', $msg_error);

                redirect(base_url('medcheck/tambah.php?act=resm_surat&id='.$id.'&id_resm='.$id_rsm.'&status='.$status));
            } else {
                $sql_medc_resm = $this->db->where('id', general::dekrip($id_rsm))->get('tbl_trans_medcheck_resume')->row();

                $data = array(
                    'id_medcheck' => general::dekrip($id),
                    'id_resume'   => general::dekrip($id_rsm),
                    'id_user'     => $this->ion_auth->user()->row()->id,
                    'tgl_simpan'  => date('Y-m-d H:i:s'),
                    'param'       => $periksa,
                    'param_nilai' => (!empty($hasil1) ? $hasil1 : '').(!empty($hasil2) ? '#('.$hasil2.')' : '').(!empty($hasil3) ? '#/ '.$hasil3.'' : ''),
                    'status_rnp'  => '0',
                    'status_trp'  => '1',
                );
                
                $this->session->set_flashdata('medcheck', '<div class="alert alert-success">Data pemeriksaan resume berhasil disimpan</div>');
                crud::simpan('tbl_trans_medcheck_resume_det', $data);
                
                redirect(base_url('medcheck/tambah.php?act=resm_input_trp&id='.$id.'&id_resm='.general::enkrip($sql_medc_resm->id).'&status='.$status.(!empty($route) ? '&route='.$route : '')));                
            }
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }
    
    public function set_medcheck_resume_hsl3_upd() {
        if (akses::aksesLogin() == TRUE) {
            $id         = $this->input->post('id');
            $id_rsm     = $this->input->post('id_resume');
            $id_item    = $this->input->post('id_resume_det');
            $status     = $this->input->post('status');
            $periksa    = $this->input->post('pemeriksaan');
            $hasil1     = $this->input->post('hasil1');
            $hasil2     = $this->input->post('hasil2');
            $hasil3     = $this->input->post('hasil3');
            $route      = $this->input->post('route');
            $act        = $this->input->post('act');
            
            $this->form_validation->set_error_delimiters('<div class="alert alert-danger">', '</div>');

            $this->form_validation->set_rules('id', 'ID', 'required');

            if ($this->form_validation->run() == FALSE) {
                $msg_error = array(
                    'id'            => form_error('id'),
                );

                $this->session->set_flashdata('form_error', $msg_error);

                redirect(base_url('medcheck/tambah.php?act=resm_surat&id='.$id.'&id_resm='.$id_rsm.'&status='.$status));
            } else {
                $sql_medc_resm = $this->db->where('id', general::dekrip($id_rsm))->get('tbl_trans_medcheck_resume')->row();

                $data = array(
                    'id_user'     => $this->ion_auth->user()->row()->id,
                    'tgl_simpan'  => date('Y-m-d H:i:s'),
                    'param'       => $periksa,
                    'param_nilai' => (!empty($hasil1) ? $hasil1 : '').(!empty($hasil2) ? '#('.$hasil2.')' : '').(!empty($hasil3) ? '#/ '.$hasil3.'' : ''),
                );
                
                $this->session->set_flashdata('medcheck', '<div class="alert alert-success">Data pemeriksaan resume berhasil disimpan</div>');
                $this->db->where('id', general::dekrip($id_item))->update('tbl_trans_medcheck_resume_det', $data);
                
                redirect(base_url('medcheck/tambah.php?act=resm_input_trp&id='.$id.'&id_resm='.general::enkrip($sql_medc_resm->id).'&status='.$status.(!empty($route) ? '&route='.$route : '')));                
            }
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }
    
    public function set_medcheck_resume_ctk() {
        if (akses::aksesLogin() == TRUE) {
            $id         = $this->input->get('id');
            $id_rsm     = $this->input->get('id_resm');
            $status     = $this->input->post('status');
            $periksa    = $this->input->post('pemeriksaan');
            $hasil1     = $this->input->post('hasil1');
            $hasil2     = $this->input->post('hasil2');
            $hasil3     = $this->input->post('hasil3');
            $route      = $this->input->post('route');
            $act        = $this->input->post('act');
            
//            $this->form_validation->set_error_delimiters('<div class="alert alert-danger">', '</div>');
//
//            $this->form_validation->set_rules('id', 'ID', 'required');
//
//            if ($this->form_validation->run() == FALSE) {
//                $msg_error = array(
//                    'id'            => form_error('id'),
//                );
//
//                $this->session->set_flashdata('form_error', $msg_error);
//
//                redirect(base_url('medcheck/tambah.php?act=resm_surat&id='.$id.'&id_resm='.$id_rsm.'&status='.$status));
//            } else {
                $sql_medc      = $this->db->where('id', general::dekrip($id))->get('tbl_trans_medcheck')->row();
                $sql_medc_resm = $this->db->where('id', general::dekrip($id_rsm))->get('tbl_trans_medcheck_resume')->row();
                $sql_medc_file = $this->db->where('id_medcheck_rsm', $sql_medc_resm->id)->get('tbl_trans_medcheck_file');

                $data_file = array(
                    'id_medcheck'       => $sql_medc->id,
                    'id_medcheck_rsm'   => $sql_medc_resm->id,
                    'id_pasien'         => $sql_medc->id_pasien,
                    'id_user'           => $this->ion_auth->user()->row()->id,
                    'tgl_simpan'        => date('Y-m-d H:i:s'),
                    'tgl_masuk'         => date('Y-m-d H:i'),
                    'judul'             => 'RESUME MEDIS RAWAT INAP '.$sql_medc_resm->no_surat,
                    'file_name'         => '/medcheck/surat/cetak_pdf_rsm_rnp.php?id='.$id.'&id_resm='.$id_rsm,
                    'file_ext'          => '.pdf',
                    'file_type'         => 'application/pdf',
                    'status'            => '2',
                );
                
                if($sql_medc_file->num_rows() == 0){
                    crud::simpan('tbl_trans_medcheck_file', $data_file);
                }else{
                    crud::update('tbl_trans_medcheck_file', 'id', $sql_medc_resm->id, $data_file);
                }
                
                $this->session->set_flashdata('medcheck', '<div class="alert alert-success">Data pemeriksaan resume berhasil disimpan</div>');
  
                redirect(base_url('medcheck/surat/cetak_pdf_rsm_rnp.php?id='.$id.'&id_resm='.$id_rsm));  
                
//                echo '<pre>';
//                print_r($data_file);
//                echo '</pre>';              
//            }
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }
    
    public function set_medcheck_resume_hapus() {
        if (akses::aksesLogin() == TRUE) {
            $id         = $this->input->get('id');
            $item_id    = $this->input->get('item_id');
            $status     = $this->input->get('status');
            $userid     = $this->ion_auth->user()->row()->id;
            
            $sql_medc = $this->db->where('id', general::dekrip($id))->get('tbl_trans_medcheck');
            
            if($sql_medc->num_rows() > 0){
                $this->session->set_flashdata('medcheck', '<div class="alert alert-success">Transaksi berhasil dihapus</div>');
                
                /* Transaksi Database */
                $this->db->trans_begin();
                
                # Hapus ke tabel medcheck lab
                $this->db->where('id', general::dekrip($item_id))->delete('tbl_trans_medcheck_resume');

                # Cek status transact MySQL
                if ($this->db->trans_status() === FALSE) {
                    # Rollback jika gagal
                    $this->db->trans_rollback();

                    # Tampilkan pesan error
                    $this->session->set_flashdata('medcheck', '<div class="alert alert-danger">Data resume medis gagal dihapus !!</div>');
                } else {
                    $this->db->trans_commit();

                    # Tampilkan pesan sukses jika sudah berhasil commit
                    $this->session->set_flashdata('medcheck', '<div class="alert alert-success">Data resume medis berhasil dihapus !!</div>');
                }
            }

            redirect(base_url('medcheck/tambah.php?id='.$id.'&status='.$status));
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }
    
    public function set_medcheck_resume_hapus_hsl() {
        if (akses::aksesLogin() == TRUE) {
            $id         = $this->input->get('id');
            $id_resm    = $this->input->get('id_resm');
            $item_id    = $this->input->get('item_id');
            $status     = $this->input->get('status');
            $act        = $this->input->get('act');
            $userid     = $this->ion_auth->user()->row()->id;
            
            $sql_medc = $this->db->where('id', general::dekrip($id))->get('tbl_trans_medcheck');
            
            if($sql_medc->num_rows() > 0){
                $this->session->set_flashdata('medcheck', '<div class="alert alert-success">Transaksi berhasil dihapus</div>');
                
                /* Transaksi Database */
                $this->db->trans_begin();
                
                # Hapus ke tabel medcheck lab
                $this->db->where('id', general::dekrip($item_id))->delete('tbl_trans_medcheck_resume_det');

                # Cek status transact MySQL
                if ($this->db->trans_status() === FALSE) {
                    # Rollback jika gagal
                    $this->db->trans_rollback();

                    # Tampilkan pesan error
                    $this->session->set_flashdata('medcheck', '<div class="alert alert-danger">Data resume medis gagal dihapus !!</div>');
                } else {
                    $this->db->trans_commit();

                    # Tampilkan pesan sukses jika sudah berhasil commit
                    $this->session->set_flashdata('medcheck', '<div class="alert alert-success">Data resume medis berhasil dihapus !!</div>');
                }
            }

            redirect(base_url('medcheck/tambah.php?act='.$act.'&id='.$id.'&id_resm='.$id_resm.'&status='.$status));
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }
    
    public function set_medcheck_resume_hapus_hsl_rnp() {
        if (akses::aksesLogin() == TRUE) {
            $id         = $this->input->get('id');
            $id_resm    = $this->input->get('id_resm');
            $item_id    = $this->input->get('item_id');
            $status     = $this->input->get('status');
            $userid     = $this->ion_auth->user()->row()->id;
            
            $sql_medc = $this->db->where('id', general::dekrip($id))->get('tbl_trans_medcheck');
            
            if($sql_medc->num_rows() > 0){                
                /* Transaksi Database */
                $this->db->trans_begin();
                
                # Hapus ke tabel medcheck lab
                $this->db->where('id_resume', general::dekrip($id_resm))->delete('tbl_trans_medcheck_resume_det');

                # Cek status transact MySQL
                if ($this->db->trans_status() === FALSE) {
                    # Rollback jika gagal
                    $this->db->trans_rollback();

                    # Tampilkan pesan error
                    $this->session->set_flashdata('medcheck', '<div class="alert alert-danger">Data resume medis gagal dihapus !!</div>');
                } else {
                    $this->db->trans_commit();

                    # Tampilkan pesan sukses jika sudah berhasil commit
                    $this->session->set_flashdata('medcheck', '<div class="alert alert-success">Data resume medis berhasil dihapus !!</div>');
                }
            }

            redirect(base_url('medcheck/tambah.php?act=resm_input_rnp&id='.$id.'&id_resm='.$id_resm.'&status='.$status));
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }

    public function set_medcheck_upload() {
        if (akses::aksesLogin() == TRUE) {
            $this->load->helper('file');
            
            $id         = $this->input->post('id');
            $judul      = $this->input->post('judul');
            $ket        = $this->input->post('ket');
            $status     = $this->input->post('status');
            $status_fl  = $this->input->post('status_file');
            $foto       = $this->input->post('file_foto');
            $rute       = $this->input->post('route');

            $this->form_validation->set_error_delimiters('<div class="alert alert-danger">', '</div>');

            $this->form_validation->set_rules('id', 'ID', 'required');
            $this->form_validation->set_rules('judul', 'Judul', 'required');
            $this->form_validation->set_rules('tipe_ft', 'Tipe', 'required');

            if ($this->form_validation->run() == FALSE) {
                $msg_error = array(
                    'id'        => form_error('id'),
                    'judul'     => form_error('judul'),
                    'tipe'      => form_error('tipe_ft'),
                );

                $this->session->set_flashdata('form_error', $msg_error);

                redirect(base_url('medcheck/tambah.php?id='.$id.'&status=8'));
            } else {
               $sql_medc    = $this->db->where('id', general::dekrip($id))->get('tbl_trans_medcheck')->row();
               $sql_pasien  = $this->db->where('id', $sql_medc->id_pasien)->get('tbl_m_pasien')->row();
               $no_rm       = strtolower($sql_pasien->kode_dpn).$sql_pasien->kode;
               $folder      = realpath('./file/pasien/'.$no_rm);
               
                if (!empty($_FILES['fupload']['name'])) {
                    $config['upload_path']      = $folder;
                    $config['allowed_types']    = 'jpg|png|pdf|jpeg|jfif';
                    $config['remove_spaces']    = TRUE;
                    $config['overwrite']        = TRUE;
                    $config['file_name']        = 'medc_'.$sql_medc->no_rm.'_upl'.sprintf('%05d', rand(1,256)).'_'.strtolower(str_replace(' ', '_', $judul)); // general::dekrip($id).sprintf('%05d', rand(1,256));
                    $this->load->library('upload', $config);

                    if (!$this->upload->do_upload('fupload')) {
                        $this->session->set_flashdata('medcheck', '<div class="alert alert-danger">Error : <b>' . $this->upload->display_errors() . '</b></div>');
                        redirect(base_url('medcheck/tambah.php?id='.$id.'&status=8&err='.$this->upload->display_errors()));
                    } else {
                        $f      = $this->upload->data();
                        $path   = $folder . '/';
                        $file   = file_get_contents($f['full_path']);
                        $file64 = 'data:'.$f['file_type'].';base64,'.base64_encode($file);

                        $data_file = array(
                            'id_medcheck'   => $sql_medc->id,
                            'id_pasien'     => $sql_medc->id_pasien,
                            'id_user'       => $this->ion_auth->user()->row()->id,
                            'tgl_simpan'    => date('Y-m-d H:i:s'),
                            'tgl_masuk'     => date('Y-m-d H:i'),
                            'judul'         => $judul,
                            'keterangan'    => $ket,
                            'file_name_ori' => $f['client_name'],
                            'file_name'     => '/file/pasien/'.$no_rm.'/'.$f['file_name'],
                            'file_ext'      => $f['file_ext'],
                            'file_type'     => $f['file_type'],
//                            'file_base64'   => $file64,
                            'status'        => $status_fl,
                        );
                        
                        crud::simpan('tbl_trans_medcheck_file', $data_file);
                        $last_id = crud::last_id();
                        
                        if(!empty($last_id)){
                            $this->session->set_flashdata('medcheck', '<div class="alert alert-success">Berkas berhasil diunggah !!</div>');
                        }
                        
                        redirect(base_url((!empty($rute) ? $rute.'?id='.$id : 'medcheck/tambah.php?id='.$id.'&status=8')));
                    }
                }else{
                    $filename   = 'medc_'.$sql_medc->no_rm.'_upl'.sprintf('%05d', rand(1,256)).'_cam.png';
                    $path       = $folder.'/'.$filename;
                    
                    $data_file = array(
                        'id_medcheck'   => $sql_medc->id,
                        'id_pasien'     => $sql_medc->id_pasien,
                        'id_user'       => $this->ion_auth->user()->row()->id,
                        'tgl_simpan'    => date('Y-m-d H:i:s'),
                        'tgl_masuk'     => date('Y-m-d H:i'),
                        'judul'         => $judul,
                        'keterangan'    => $ket,
                        'file_base64'   => $foto,
                        'file_name'     => '/file/pasien/'.$no_rm.'/'.$filename,
                        'file_ext'      => '.png',
                        'file_type'     => 'image/png',
                        'status'        => '1',
                    );
                    
                    # Pastikan terdapat foto tidak kosong
                    if(!empty($foto)){                    
                        # Buat File Dari kamera
                        general::base64_to_jpeg($foto, $path);
                        
                        # Simpan ke database
                        crud::simpan('tbl_trans_medcheck_file', $data_file);
                        $last_id = crud::last_id(); 

                        if (!empty($last_id)) {
                            $this->session->set_flashdata('medcheck', '<div class="alert alert-success">Berkas berhasil diunggah !!</div>');
                        }                     
                    }else{
                        $this->session->set_flashdata('medcheck', '<div class="alert alert-danger">Tidak ada berkas atau foto yang disimpan !!</div>');
                    }
                        


                    redirect(base_url('medcheck/tambah.php?id=' . $id . '&status=8'));
                }
            }
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }

    public function set_medcheck_upload_hapus() {
        if (akses::aksesLogin() == TRUE) {
            $id         = $this->input->get('id');
            $id_item    = $this->input->get('item_id');
            $file       = $this->input->get('file');
            $status     = $this->input->get('status');
            
            if(!empty($id_item)){
                $sql_medc    = $this->db->where('id', general::dekrip($id))->get('tbl_trans_medcheck')->row();
                $sql_pasien  = $this->db->where('id', $sql_medc->id_pasien)->get('tbl_m_pasien')->row();
                $no_rm       = strtolower($sql_pasien->kode_dpn).$sql_pasien->kode;
                $folder      = realpath('./'.$file);
               
                $path   = $folder.'/';
                $berkas = $file;
                
                if(file_exists($berkas)){
                    unlink($berkas);
                }
                
                crud::delete('tbl_trans_medcheck_file', 'id', general::dekrip($id_item));                
                $this->session->set_flashdata('medcheck', '<div class="alert alert-success">Berkas berhasil di hapus</div>');
            }
            
            redirect(base_url('medcheck/tambah.php?id='.$this->input->get('id').'&status='.$this->input->get('status')));
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    } 
    
    public function set_medcheck_diskon_item() {
        if (akses::aksesLogin() == TRUE) {
            $id         = $this->input->post('id');
            $status     = $this->input->post('status');
            $tgl_resep  = $this->input->post('tgl_resep');
            $nm_resep   = $this->input->post('nm_resep');
            $ket        = $this->input->post('ket');
            $act        = $this->input->post('act');
            
            $this->form_validation->set_error_delimiters('<div class="alert alert-danger">', '</div>');

            $this->form_validation->set_rules('id', 'ID', 'required');

            if ($this->form_validation->run() == FALSE) {
                $msg_error = array(
                    'id'        => form_error('id'),
                );

                $this->session->set_flashdata('anamnesa', $msg_error);

                redirect(base_url('medcheck/tambah.php?id='.$id.'status='.$status));
            } else {
                $sql_medc       = $this->db->where('id', general::dekrip($id))->get('tbl_trans_medcheck')->row(); 
                $pengaturan     = $this->db->get('tbl_pengaturan')->row();
                
                $nomer          = $this->db->where('MONTH(tgl_simpan)', date('m'))->get('tbl_trans_medcheck_resep')->num_rows() + 1;
                $no_surat       = sprintf('%03d', $nomer).'/'.$pengaturan->kode_resep.'/'.date('m').'/'.date('Y');
                
                $data = array(
                    'tgl_simpan'     => (!empty($tgl_masuk) ? $this->tanggalan->tgl_indo_sys($tgl_resep) : date('Y-m-d')).' '.date('H:i:s'),
                    'id_medcheck'   => $sql_medc->id,
                    'id_pasien'     => $sql_medc->id_pasien,
                    'id_user'       => $this->ion_auth->user()->row()->id,
                    'no_resep'      => $no_surat,
                    'status'        => '0',
                );

                $this->session->set_flashdata('medcheck', '<div class="alert alert-success">Data surat berhasil disimpan</div>');
                crud::simpan('tbl_trans_medcheck_resep', $data);
                $last_id = crud::last_id();
                
                redirect(base_url('medcheck/tambah.php?id='.general::enkrip($sql_medc->id).'&status='.$status.'&id_resep='.general::enkrip($last_id)));
                
            }
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }

    public function set_medcheck_retur() {
        if (akses::aksesLogin() == TRUE) {
            $id         = $this->input->post('id');
            $pasien     = $this->input->post('id_pasien');
            $tgl        = $this->input->post('tgl');
            $ket        = $this->input->post('ket');
            $this->form_validation->set_error_delimiters('<div class="alert alert-danger">', '</div>');

            $this->form_validation->set_rules('id', 'ID', 'required');

            if ($this->form_validation->run() == FALSE) {
                $msg_error = array(
                    'id' => form_error('id'),
                );

                $this->session->set_flashdata('form_error', $msg_error);

                redirect(base_url('medcheck/retur/retur.php'));
            } else {                        
                $data = array(
                    'id'         => general::dekrip($id),
                    'tgl'        => $this->tanggalan->tgl_indo_sys($tgl),
                    'keterangan' => $ket,
                );
                
                $this->session->set_userdata('trans_medcheck_retur', $data);
                redirect(base_url('medcheck/retur/retur.php?act=retur_input&id='.$id));

                
//                $this->session->set_userdata('trans_medcheck_retur', $data);
//                redirect(base_url('medcheck/retur.php?id='.general::enkrip(rand(1,256))));
                
//                $this->session->set_flashdata('medcheck', '<div class="alert alert-success">Transaksi berhasil diselesaikan</div>');
//                crud::update('tbl_trans_medcheck', 'id', general::dekrip($id), $data);             
//                redirect(base_url('medcheck/index.php?tipe='.$sql_medc->tipe));
//                redirect(base_url('medcheck/tambah.php?id='.$id.'&status='.$status));
            }
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }
    
    public function set_medcheck_kwi() {
        if (akses::aksesLogin() == TRUE) {
            $id         = $this->input->post('id');
            $status     = $this->input->post('status');
            $status_kwi = $this->input->post('status_kwi');
            $dari       = $this->input->post('dari');
            $nominal    = $this->input->post('nominal');
            $ket        = $this->input->post('keterangan');
            $diag       = $this->input->post('diagnosa');
            
            $this->form_validation->set_error_delimiters('<div class="alert alert-danger">', '</div>');

            $this->form_validation->set_rules('id', 'ID', 'required');
            $this->form_validation->set_rules('dari', 'Dari', 'required');
            $this->form_validation->set_rules('nominal', 'Sejumlah', 'required');

            if ($this->form_validation->run() == FALSE) {
                $msg_error = array(
                    'id'       => form_error('id'),
                    'dari'     => form_error('dari'),
                    'nominal'  => form_error('nominal'),
                );

                $this->session->set_flashdata('form_error', $msg_error);

                redirect(base_url('medcheck/tambah.php?id='.$id.'&status='.$status));
            } else {
                $sql_medc               = $this->db->where('id', general::dekrip($id))->get('tbl_trans_medcheck')->row();
                $sql_jml_dp             = $this->db->select_sum('nominal')->where('id_medcheck', general::dekrip($id))->get('tbl_trans_medcheck_kwi')->row();
                $tot_dp                 = $sql_jml_dp->nominal + general::format_angka_db($nominal);

                $data = array(
                    'tgl_simpan'        => date('Y-m-d H:i:s'),
                    'tgl_masuk'         => $sql_medc->tgl_masuk,
                    'id_medcheck'       => general::dekrip($id),
                    'id_user'           => $this->ion_auth->user()->row()->id,
                    'dari'              => $dari,
                    'nominal'           => general::format_angka_db($nominal),
                    'ket'               => (!empty($ket) ? $ket : ''),
                    'diagnosa'          => (!empty($diag) ? $diag : ''),
                    'status_kwi'        => $status_kwi,
                );
                
                $this->db->insert('tbl_trans_medcheck_kwi', $data);
                
//                if($status_kwi == '2'){
//                    $data_medc = array(
//                        'tgl_modif' => date('Y-m-d H:i:s'),
//                        'jml_dp'    => $tot_dp,
//                    );
//                    
//                    $this->db->where('id', general::dekrip($id))->update('tbl_trans_medcheck', $data_medc);
//                }

                if ($this->db->affected_rows() > 0) {
                    $this->session->set_flashdata('medcheck_toast', 'toastr.success("Entri DP berhasil disimpan !");');
                } else {
                    $this->session->set_flashdata('medcheck_toast', 'toastr.error("Entri DP gagal disimpan !");');
                }
                
                redirect(base_url('medcheck/tambah.php?id='.$id.'&status='.$status.(!empty($route) ? '&route='.$route : '')));

//                echo '<pre>';
//                print_r($data);
//                
//                $this->session->set_flashdata('medcheck', '<div class="alert alert-success">Data kwitansi berhasil disimpan</div>');
//                crud::simpan('tbl_trans_medcheck_kwi', $data);
//                
//                redirect(base_url('medcheck/tambah.php?id='.$id.'&status='.$status.(!empty($route) ? '&route='.$route : '')));                
            }
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }

    public function set_medcheck_kwi_hapus() {
        if (akses::aksesLogin() == TRUE) {
            $id         = $this->input->get('id');
            $id_kwi     = $this->input->get('id_kwi');
            $status     = $this->input->get('status');
            $act        = $this->input->get('act');
            $rute       = $this->input->get('route');
            
            if(!empty($id)){
                $this->session->set_flashdata('medcheck', '<div class="alert alert-success">Item berhasil di hapus</div>');
                crud::delete('tbl_trans_medcheck_kwi', 'id', general::dekrip($id_kwi));
            }
            
            redirect(base_url((!empty($rute) ? $rute : 'medcheck/tambah.php?'.(!empty($act) ? 'act='.$act.'&' : '').'id='.$id.(!empty($id_kwi) ? '&id_kwi='.$id_kwi.'&' : '').'&status='.$status)));
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }
    
    public function set_medcheck_icd() {
        if (akses::aksesLogin() == TRUE) {
            $id         = $this->input->post('id');
            $id_rm      = $this->input->post('id_rm');
            $icd        = $this->input->post('icd');
            $status     = $this->input->post('status');
            $st_icd     = $this->input->post('status_icd');
            $rute       = $this->input->post('route');
            $this->form_validation->set_error_delimiters('<div class="alert alert-danger">', '</div>');

            $this->form_validation->set_rules('id', 'ID', 'required');
            $this->form_validation->set_rules('icd', 'ICD', 'required');

            if ($this->form_validation->run() == FALSE) {
                $msg_error = array(
                    'id'                => form_error('id'),
                    'icd'               => form_error('icd'),
                );

                $this->session->set_flashdata('form_error', $msg_error);

                redirect(base_url('medcheck/tambah.php?id='.$id.'&status='.$status));
            } else {
                $sql_medc = $this->db->where('id', general::dekrip($id))->get('tbl_trans_medcheck')->row();
                $sql_icd  = $this->db->where('id', $icd)->get('tbl_m_icd')->row();
                
                $is_doc_id  = ($grup->name == 'dokter' ? $this->ion_auth->user()->row()->id : '0');
                        
                $data = array(
                    'tgl_simpan'        => date('Y-m-d H:i:s'),
                    'id_medcheck'       => (int)$sql_medc->id,
                    'id_medcheck_rm'    => (int)(!empty($id_rm) ? general::dekrip($id_rm) : '0'),
                    'id_icd'            => (int)(!empty($icd) ? $icd : '0'),
                    'id_user'           => (int)$this->ion_auth->user()->row()->id,
                    'id_dokter'         => (int)$is_doc_id,
                    'kode'              => $sql_icd->kode,
                    'icd'               => $sql_icd->icd,
//                    'diagnosa'          => $sql_icd->icd,
                    'diagnosa_en'       => $sql_icd->icd,
                    'status_icd'        => (!empty($st_icd) ? $st_icd : '0'),
                );
                
                # Simpan ke tabel ICD
                $this->db->insert('tbl_trans_medcheck_icd', $data);
                
                $this->session->set_flashdata('medcheck_toast', 'toastr.success("ICD berhasil di tambahkan !");');
                redirect(base_url((!empty($rute) ? $rute : 'medcheck/tambah.php?id='.$id.'&status='.$status)));
//               
//                echo '<pre>';
//                print_r($data);
//                echo '</pre>';
            }
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }
    
    public function set_medcheck_icd_hapus() {
        if (akses::aksesLogin() == TRUE) {
            $id         = $this->input->get('id');
            $id_resm    = $this->input->get('id_resm');
            $item_id    = $this->input->get('id_item');
            $status     = $this->input->get('status');
            $act        = $this->input->get('act');
            $userid     = $this->ion_auth->user()->row()->id;
            
            $sql_medc = $this->db->where('id', general::dekrip($item_id))->get('tbl_trans_medcheck_icd');
            
            if($sql_medc->num_rows() > 0){
                /* Transaksi Database */
                $this->db->trans_begin();
                
                # Hapus ke tabel medcheck lab
                $this->db->where('id', general::dekrip($item_id))->delete('tbl_trans_medcheck_icd');

                # Cek status transact MySQL
                if ($this->db->trans_status() === FALSE) {
                    # Rollback jika gagal
                    $this->db->trans_rollback();

                    # Tampilkan pesan error
                    $this->session->set_flashdata('medcheck_toast', 'toastr.error("ICD gagal dihapus !");');
                } else {
                    $this->db->trans_commit();

                    # Tampilkan pesan sukses jika sudah berhasil commit
                    $this->session->set_flashdata('medcheck_toast', 'toastr.success("ICD Berhasil dihapus !");');
                }
            }

            redirect(base_url('medcheck/tambah.php?id='.$id.'&status='.$status));
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }



    public function set_medcheck_kamar() {
        if (akses::aksesLogin() == TRUE) {
            $id         = $this->input->post('id');
            $idk        = $this->input->post('id_kamar');
            $idp        = $this->input->post('id_pasien');
            $tipe       = $this->input->post('tipe');
            $catatan    = $this->input->post('catatan');
            $status     = $this->input->post('status');
            $this->form_validation->set_error_delimiters('<div class="alert alert-danger">', '</div>');

            $this->form_validation->set_rules('id', 'ID', 'required');

            if ($this->form_validation->run() == FALSE) {
                $msg_error = array(
                    'id'        => form_error('id'),
                );

                $this->session->set_flashdata('form_error', $msg_error);

                redirect(base_url('medcheck/tambah.php?id='.$id.'&status=14'));
            } else {
                $sql_kamar      = $this->db->where('id', general::dekrip($idk))->get('tbl_m_kamar')->row();
                $sql_medc       = $this->db->where('id', general::dekrip($id))->get('tbl_trans_medcheck')->row();
                $jml            = $sql_kamar->jml + 1;
                
                $data = array(
                    'id_medcheck'=> $sql_medc->id,
                    'id_kamar'   => $sql_kamar->id,
                    'id_pasien'  => $sql_medc->id_pasien,
                    'id_user'    => $this->ion_auth->user()->row()->id,
                    'tgl_simpan' => date('Y-m-d H:i:s'),
                    'keterangan' => $catatan,
                    'status'     => '1',
                );
                
                $data_kamar = array(
                    'tgl_modif' => date('Y-m-d H:i:s'),
                    'jml'       => $jml,
                );
                
                /* Transaksi Database */
                $this->db->query('SET autocommit = 0;');
                $this->db->trans_start();

                # Simpan ke tabel trans medcheck kamar
                $this->db->insert('tbl_trans_medcheck_kamar', $data);
                
                # Update tabel kamar
                $this->db->where('id', $sql_kamar->id)->update('tbl_m_kamar', $data_kamar);

                # Cek status transact MySQL
                if ($this->db->trans_status() === FALSE) {
                    # Rollback jika gagal
                    $this->db->trans_rollback();

                    # Tampilkan pesan error
                    $this->session->set_flashdata('medcheck_toast', 'toastr.error("Data kamar tidak bisa diinput !")');
                } else {
                    $this->db->trans_complete();

                    # Tampilkan pesan sukses jika sudah berhasil commit
                    $this->session->set_flashdata('medcheck_toast', 'toastr.success("Data kamar berhasil diinput !")');
                }

                redirect(base_url('medcheck/tambah.php?id='.$id.'&status=14'));
                
//                echo '<pre>';
//                print_r($data);
//                echo '</pre>';
                
                
//                crud::simpan('tbl_trans_medcheck_trf', $data);
//                $last_id = crud::last_id();                
//                crud::update('tbl_trans_medcheck', 'id', $sql_medc->id, $data_medc);
//                
//                $this->session->set_flashdata('medcheck', '<div class="alert alert-success">Transfer Pasien Berhasil !!</div>');
//                redirect(base_url('medcheck/transfer.php?id='.general::enkrip($sql_medc->id).'&trf_id='.general::enkrip($last_id).'&status='.$sql_medc->status));
            }
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }
    
    public function set_medcheck_kamar_hapus() {
        if (akses::aksesLogin() == TRUE) {
            $id         = $this->input->get('id');
            $item_id    = $this->input->get('item_id');
            $status     = $this->input->get('status');
            $act        = $this->input->get('act');
            $userid     = $this->ion_auth->user()->row()->id;
            
            $sql_medc   = $this->db->where('id', general::dekrip($item_id))->get('tbl_trans_medcheck_kamar');
            $sql_kmr    = $this->db->where('id', $sql_medc->row()->id_kamar)->get('tbl_m_kamar')->row();
            
            if($sql_medc->num_rows() > 0){
                /* Transaksi Database */
                $this->db->trans_begin();
                
                # Reset ke tabel kamar
                $jml = $sql_kmr->jml - 1;
                $this->db->where('id', $sql_kmr->id)->update('tbl_m_kamar', array('tgl_modif' => date('Y-m-d H:i:s'),'jml' => $jml));
                
                # Hapus ke tabel medcheck kamar
                $this->db->where('id', general::dekrip($item_id))->delete('tbl_trans_medcheck_kamar');

                # Cek status transact MySQL
                if ($this->db->trans_status() === FALSE) {
                    # Rollback jika gagal
                    $this->db->trans_rollback();

                    # Tampilkan pesan error
                    $this->session->set_flashdata('medcheck_toast', 'toastr.error("Kamar gagal dihapus !");');
                } else {
                    $this->db->trans_commit();

                    # Tampilkan pesan sukses jika sudah berhasil commit
                    $this->session->set_flashdata('medcheck_toast', 'toastr.success("Kamar Berhasil dihapus !");');
                }
            }else{
                # Tampilkan pesan error
                $this->session->set_flashdata('medcheck_toast', 'toastr.error("Data tidak ditemukan !");');
            }

            redirect(base_url('medcheck/tambah.php?id='.$id.'&status='.$status));
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }
    

    
    public function set_medcheck_ass_fisik() {
        if (akses::aksesLogin() == TRUE) {
            $id     = $this->input->get('id');
            $act    = $this->input->get('act');
            $status = $this->input->get('status');
            
            if(!empty($id)){
                $sql_medc   = $this->db->where('id', general::dekrip($id))->get('tbl_trans_medcheck');
                $sql_pasien = $this->db->where('id', $sql_medc->row()->id_pasien)->get('tbl_m_pasien')->row();
                $sql_pny    = $this->db->order_by('id', 'asc')->get('tbl_m_ass_pny')->result(); 
                $pengaturan = $this->db->get('tbl_pengaturan')->row();
                   
                $nomer      = $this->db->where('MONTH(tgl_simpan)', date('m'))->get('tbl_trans_medcheck_ass_fisik')->num_rows() + 1;
                $no_surat   = sprintf('%03d', $nomer).'/'.$pengaturan->kode_surat.'/'.date('m').'/'.date('Y');
                $grup       = $this->ion_auth->get_users_groups()->row();
                $is_anal    = ($grup->name == 'analis' ? '2' : '0');
                $is_anal_id = ($grup->name == 'analis' ? $this->ion_auth->user()->row()->id : '0');
                $is_doc_id  = ($grup->name == 'dokter' ? $this->ion_auth->user()->row()->id : '0');
               
                $data = array(
                    'tgl_simpan'    => date('Y-m-d H:i:s'),
                    'tgl_masuk'     => date('Y-m-d H:i:s'),
                    'id_medcheck'   => $sql_medc->row()->id,
                    'id_pasien'     => $sql_medc->row()->id_pasien,
                    'id_user'       => $this->ion_auth->user()->row()->id,
                    'id_analis'     => $is_anal_id,
                    'id_dokter'     => $is_doc_id,
                    'no_lab'        => $no_surat,
                    'status'        => '0',
                );
                
                if($sql_medc->num_rows() > 0){
                    $this->db->insert('tbl_trans_medcheck_ass_fisik', $data);
                    $last_id = crud::last_id();
                    
                    foreach ($sql_pny as $pny) {//                    
                        $data_pny = array(
                            'tgl_simpan'        => date('Y-m-d H:i:s'),
                            'id_medcheck'       => $sql_medc->row()->id,
                            'id_medcheck_ass'   => $last_id,
                            'id_item'           => $pny->id,
                            'id_user'           => $this->ion_auth->user()->row()->id,
                            'item_name'         => $pny->penyakit,
                            'item_value2'       => $pny->nilai,
                            'tipe'              => $pny->tipe,
                            'status_posisi'     => $pny->status_posisi,
                        );
                        
                        $this->db->insert('tbl_trans_medcheck_ass_fisik_hsl', $data_pny);
                    }
                                        
                    # Masukkan FISIK ke tabel riwayat berkas
                    $data_file_fisik = array(
                        'id_medcheck'       => $sql_medc->row()->id,
                        'id_pasien'         => $sql_medc->row()->id_pasien,
                        'id_user'           => $this->ion_auth->user()->row()->id,
                        'id_berkas'         => $last_id,
                        'tgl_simpan'        => date('Y-m-d H:i:s'),
                        'tgl_masuk'         => date('Y-m-d H:i'),
                        'judul'             => 'ASSESMENT PEMERIKSAAN ('.$no_surat.')',
                        'keterangan'        => $sql_pasien->nama_pgl,
                        'file_name'         => '/medcheck/surat/cetak_pdf_ass_fisik.php?id='.general::enkrip($sql_medc->row()->id).'&id_ass='.general::enkrip($last_id).'&status='.$status,
                        'file_ext'          => '.pdf',
                        'file_type'         => 'application/pdf',
                        'status'            => '2',
                    );
                    $this->db->insert('tbl_trans_medcheck_file', $data_file_fisik);
                    
                    if ($this->db->affected_rows() > 0) {
                        $this->session->set_flashdata('medcheck_toast', 'toastr.success("Entri assesment berhasil ditambahkan !");');
                    } else {
                        $this->session->set_flashdata('medcheck_toast', 'toastr.error("Entri assesment gagal disimpan !");');
                    }
                    
                    redirect(base_url('medcheck/tambah.php?'.(!empty($act) ? 'act='.$act.'&' : '').'id='.general::enkrip($sql_medc->row()->id).'&status='.$status));
                }else{
                    redirect(base_url('medcheck/tambah.php?'.(!empty($act) ? 'act='.$act.'&' : '').'id='.general::enkrip($sql_medc->row()->id).'&status='.$status));
                }
//                
//                echo '<pre>';
//                print_r($data);
//                echo '</pre>';
            }else{
                redirect(base_url('medcheck/tambah.php?id='.general::enkrip($sql_medc->row()->id).'&status='.$status));
            }
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }
    
    public function set_medcheck_ass_fisik_upd() {
        if (akses::aksesLogin() == TRUE) {
            $id         = $this->input->post('id');
            $id_ass     = $this->input->post('id_ass');
            $tgl_masuk  = $this->input->post('tgl_masuk');
            $no_sample  = $this->input->post('no_sampel');
            $dokter     = $this->input->post('dokter');
            $ket        = $this->input->post('keterangan');
            $status     = $this->input->post('status');
            $act         = $this->input->post('act');
            
            $this->form_validation->set_error_delimiters('<div class="alert alert-danger">', '</div>');

            $this->form_validation->set_rules('id', 'ID', 'required');
            $this->form_validation->set_rules('no_sampel', 'No Sample', 'required');

            if ($this->form_validation->run() == FALSE) {
                $msg_error = array(
                    'id'        => form_error('id'),
                    'no_sampel' => form_error('no_sampel'),
                );

                $this->session->set_flashdata('form_error', $msg_error);

                redirect(base_url('medcheck/tambah.php?id='.$id.'&status='.$status.'&act='.$act.'&id_lab='.$id_lab));
            } else {
                $sql_medc       = $this->db->where('id', general::dekrip($id))->get('tbl_trans_medcheck')->row(); 
                $pengaturan     = $this->db->get('tbl_pengaturan')->row();
                
                $data = array(
                    'tgl_masuk'     => $this->tanggalan->tgl_indo_sys($tgl_masuk).' '.date('H:i:s'),
                    'tgl_modif'     => date('Y-m-d H:i:s'),
                    'id_dokter'     => $dokter,
                    'id_analis'     => general::dekrip($id_analis),
                    'no_sample'     => $no_sample,
                    'ket'           => $ket,
                    'status'        => '1',
                );
                
                crud::update('tbl_trans_medcheck_ass_fisik', 'id', general::dekrip($id_ass), $data);

                $this->session->set_flashdata('medcheck_toast', 'toastr.success("Entri hasil assesment berhasil disimpan !");');
                redirect(base_url('medcheck/tambah.php?act=resm_fisik&id='.$id.'&status=9'));
                
//                echo '<pre>';
//                print_r($data);
//                echo '</pre>';
            }
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }

    public function set_medcheck_ass_fisik_hsl() {
        if (akses::aksesLogin() == TRUE) {
            $id         = $this->input->post('id');
            $id_ass     = $this->input->post('id_ass');
            $status     = $this->input->post('status');
            $act        = $this->input->post('act');
            
            $this->form_validation->set_error_delimiters('<div class="alert alert-danger">', '</div>');

            $this->form_validation->set_rules('id', 'ID', 'required');

            if ($this->form_validation->run() == FALSE) {
                $msg_error = array(
                    'id'            => form_error('id'),
                );

                $this->session->set_flashdata('form_error', $msg_error);

                redirect(base_url('medcheck/tambah.php?id='.$id.'&status='.$status.'&act='.$act));
            } else {
                $sql_ass_pny        = $this->db->where('status', '1')->where('tipe', '1')->get('tbl_m_ass_pny')->result();
                $sql_ass_pny2       = $this->db->where('status', '1')->where('tipe', '15')->get('tbl_m_ass_pny')->result();
                $sql_ass_pny3       = $this->db->where('status', '1')->where('tipe', '16')->get('tbl_m_ass_pny')->result();
                $sql_medc           = $this->db->where('id', general::dekrip($id))->get('tbl_trans_medcheck')->row(); 
                $sql_medc_ass       = $this->db->where('id', general::dekrip($id_ass))->get('tbl_trans_medcheck_ass_fisik')->row(); 
                $sql_medc_ass_ck    = $this->db->where('id_medcheck', $sql_medc->id)->where('tipe', '1')->get('tbl_trans_medcheck_ass_fisik_hsl'); 
                $sql_medc_ass_ck2   = $this->db->where('id_medcheck', $sql_medc->id)->where('tipe', '15')->get('tbl_trans_medcheck_ass_fisik_hsl'); 
                $sql_medc_ass_ck3   = $this->db->where('id_medcheck', $sql_medc->id)->where('tipe', '16')->get('tbl_trans_medcheck_ass_fisik_hsl'); 
                $pengaturan         = $this->db->get('tbl_pengaturan')->row();

                foreach ($sql_ass_pny as $pny){
                    $data_pny = array(
                        'tgl_simpan'        => date('Y-m-d H:i:s'),
                        'id_medcheck'       => $sql_medc->id,
                        'id_medcheck_ass'   => $sql_medc_ass->id,
                        'id_item'           => $pny->id,
                        'id_user'           => $this->ion_auth->user()->row()->id,
                        'item_name'         => $pny->penyakit,
                        'item_value'        => (!empty($_POST['rk'][$pny->id]) ? $_POST['rk'][$pny->id] : '0'),
                        'tipe'              => 1,
                        'status_posisi'     => $pny->status_posisi,
                    );
                    
                    # cek bila sudah ada datanya silahkan hapus
                    if($sql_medc_ass_ck->num_rows() == 0){
                        # Simpan ke tabel ass hasil
                        $this->db->insert('tbl_trans_medcheck_ass_fisik_hsl', $data_pny);
                    }else{
                        $this->db->where('id_medcheck', $sql_medc->id)->where('id_medcheck_ass', $sql_medc_ass->id)->where('id_item', $pny->id)->where('tipe', '1')->update('tbl_trans_medcheck_ass_fisik_hsl', $data_pny);
                    }
                    
//                    echo '<pre>';
//                    print_r($data_pny);
//                    echo '</pre>';
                }

                # Riwayat pingsan
                foreach ($sql_ass_pny2 as $pny2){
                    $data_pny2 = array(
                        'tgl_simpan'        => date('Y-m-d H:i:s'),
                        'id_medcheck'       => $sql_medc->id,
                        'id_medcheck_ass'   => $sql_medc_ass->id,
                        'id_item'           => $pny2->id,
                        'id_user'           => $this->ion_auth->user()->row()->id,
                        'item_name'         => $pny2->penyakit,
                        'item_value2'       => (!empty($_POST['riw1_jwb'][$pny2->id]) ? $_POST['riw1_jwb'][$pny2->id] : ''),
                        'tipe'              => 15,
                        'status_posisi'     => $pny2->status_posisi,
                    );
                    
                    # cek bila sudah ada datanya silahkan hapus
                    if($sql_medc_ass_ck2->num_rows() == 0){
                        # Simpan ke tabel ass hasil
                        $this->db->insert('tbl_trans_medcheck_ass_fisik_hsl', $data_pny2);
                    }else{
                        $this->db->where('id_medcheck', $sql_medc->id)->where('id_medcheck_ass', $sql_medc_ass->id)->where('id_item', $pny2->id)->where('tipe', '15')->update('tbl_trans_medcheck_ass_fisik_hsl', $data_pny2);
                    }
                    
//                    echo '<pre>';
//                    print_r($data_pny2);
//                    echo '</pre>';
                }

                # Riwayat kebiasaan sehari hari
                foreach ($sql_ass_pny3 as $pny3){
                    $data_pny3 = array(
                        'tgl_simpan'        => date('Y-m-d H:i:s'),
                        'id_medcheck'       => $sql_medc->id,
                        'id_medcheck_ass'   => $sql_medc_ass->id,
                        'id_item'           => $pny3->id,
                        'id_user'           => $this->ion_auth->user()->row()->id,
                        'item_name'         => $pny3->penyakit,
                        'item_value'        => (!empty($_POST['riw2'][$pny3->id]) ? $_POST['riw2'][$pny3->id] : '0'),
                        'item_value2'       => (!empty($_POST['riw2_jwb'][$pny3->id]) ? $_POST['riw2_jwb'][$pny3->id] : ''),
                        'tipe'              => 16,
                        'status_posisi'     => $pny3->status_posisi,
                    );
                    
                    # cek bila sudah ada datanya silahkan hapus
                    if($sql_medc_ass_ck3->num_rows() == 0){
                        # Simpan ke tabel ass hasil
                        $this->db->insert('tbl_trans_medcheck_ass_fisik_hsl', $data_pny3);
                    }else{
                        $this->db->where('id_medcheck', $sql_medc->id)->where('id_medcheck_ass', $sql_medc_ass->id)->where('id_item', $pny3->id)->where('tipe', '16')->update('tbl_trans_medcheck_ass_fisik_hsl', $data_pny3);
                    }
                    
//                    echo '<pre>';
//                    print_r($data_pny3);
//                    echo '</pre>';
                }
                
                if ($this->db->affected_rows() > 0) {
                    $this->session->set_flashdata('medcheck_toast', 'toastr.success("Entri hasil assesment berhasil ditambahkan !");');
                } else {
                    $this->session->set_flashdata('medcheck_toast', 'toastr.error("Entri hasil assesment gagal disimpan !");');
                }
                
                redirect(base_url('medcheck/tambah.php?act=ass_fisik&id='.$id.'&id_ass='.$id_ass.'&status='.$status));
            }
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }

    public function set_medcheck_ass_fisik_hsl2() {
        if (akses::aksesLogin() == TRUE) {
            $id         = $this->input->post('id');
            $id_ass     = $this->input->post('id_ass');
            $status     = $this->input->post('status');
            $act        = $this->input->post('act');
            
            $this->form_validation->set_error_delimiters('<div class="alert alert-danger">', '</div>');

            $this->form_validation->set_rules('id', 'ID', 'required');

            if ($this->form_validation->run() == FALSE) {
                $msg_error = array(
                    'id'            => form_error('id'),
                );

                $this->session->set_flashdata('form_error', $msg_error);

                redirect(base_url('medcheck/tambah.php?id='.$id.'&status='.$status.'&act='.$act));
            } else {
                $sql_ass_pny        = $this->db->where('status', '1')->where('tipe', '2')->get('tbl_m_ass_pny')->result();
                $sql_medc           = $this->db->where('id', general::dekrip($id))->get('tbl_trans_medcheck')->row(); 
                $sql_medc_ass       = $this->db->where('id', general::dekrip($id_ass))->get('tbl_trans_medcheck_ass_fisik')->row(); 
                $sql_medc_ass_ck    = $this->db->where('id_medcheck', $sql_medc->id)->where('tipe', '2')->get('tbl_trans_medcheck_ass_fisik_hsl'); 
                $pengaturan         = $this->db->get('tbl_pengaturan')->row();
                               
                foreach ($sql_ass_pny as $pny){
                    $data_pny = array(
                        'tgl_simpan'        => date('Y-m-d H:i:s'),
                        'id_medcheck'       => $sql_medc->id,
                        'id_medcheck_ass'   => $sql_medc_ass->id,
                        'id_item'           => $pny->id,
                        'id_user'           => $this->ion_auth->user()->row()->id,
                        'item_name'         => $pny->penyakit,
                        'item_value'        => (!empty($_POST['ro'][$pny->id]) ? $_POST['ro'][$pny->id] : '0'),
                        'item_value2'       => (!empty($_POST['ro_jwb'][$pny->id]) ? $_POST['ro_jwb'][$pny->id] : ''),
                        'tipe'              => 2,
                        'status_posisi'     => $pny->status_posisi,
                    );
                    
                    # cek bila sudah ada datanya silahkan hapus
                    if($sql_medc_ass_ck->num_rows() == 0){
                        # Simpan ke tabel ass hasil
                        $this->db->insert('tbl_trans_medcheck_ass_fisik_hsl', $data_pny);
                    }else{
                        $this->db->where('id_medcheck', $sql_medc->id)->where('id_medcheck_ass', $sql_medc_ass->id)->where('id_item', $pny->id)->where('tipe', '2')->update('tbl_trans_medcheck_ass_fisik_hsl', $data_pny);
                    }
                    
//                    echo '<pre>';
//                    print_r($data_pny);
//                    echo '</pre>';
                }
                
                if ($this->db->affected_rows() > 0) {
                    $this->session->set_flashdata('medcheck_toast', 'toastr.success("Entri hasil assesment berhasil ditambahkan !");');
                } else {
                    $this->session->set_flashdata('medcheck_toast', 'toastr.error("Entri hasil assesment riwayat gagal disimpan !");');
                }
                
                redirect(base_url('medcheck/tambah.php?act='.$act.'&id='.$id.'&id_ass='.$id_ass.'&status='.$status));
            }
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }

    public function set_medcheck_ass_fisik_hsl3() {
        if (akses::aksesLogin() == TRUE) {
            $id         = $this->input->post('id');
            $id_ass     = $this->input->post('id_ass');
            $status     = $this->input->post('status');
            $act        = $this->input->post('act');
            
            $this->form_validation->set_error_delimiters('<div class="alert alert-danger">', '</div>');

            $this->form_validation->set_rules('id', 'ID', 'required');

            if ($this->form_validation->run() == FALSE) {
                $msg_error = array(
                    'id'            => form_error('id'),
                );

                $this->session->set_flashdata('form_error', $msg_error);

                redirect(base_url('medcheck/tambah.php?id='.$id.'&status='.$status.'&act='.$act));
            } else {
                $sql_ass_pny        = $this->db->where('status', '1')->where('tipe', '3')->get('tbl_m_ass_pny')->result();
                $sql_medc           = $this->db->where('id', general::dekrip($id))->get('tbl_trans_medcheck')->row(); 
                $sql_medc_ass       = $this->db->where('id', general::dekrip($id_ass))->get('tbl_trans_medcheck_ass_fisik')->row(); 
                $sql_medc_ass_ck    = $this->db->where('id_medcheck', $sql_medc->id)->where('tipe', '3')->get('tbl_trans_medcheck_ass_fisik_hsl'); 
                $pengaturan         = $this->db->get('tbl_pengaturan')->row();
                               
                foreach ($sql_ass_pny as $pny){                    
                    $data_pny = array(
                        'tgl_simpan'        => date('Y-m-d H:i:s'),
                        'id_medcheck'       => $sql_medc->id,
                        'id_medcheck_ass'   => $sql_medc_ass->id,
                        'id_item'           => $pny->id,
                        'id_user'           => $this->ion_auth->user()->row()->id,
                        'item_name'         => $pny->penyakit,
                        'item_value2'       => (!empty($_POST['fs_jwb'][$pny->id]) ? $_POST['fs_jwb'][$pny->id] : ''),
                        'item_value3'       => $pny->satuan,
                        'tipe'              => 3,
                        'status_posisi'     => $pny->status_posisi,
                    );
                    
                    # cek bila sudah ada datanya silahkan hapus
                    if($sql_medc_ass_ck->num_rows() == 0){
                        # Simpan ke tabel ass hasil
                        $this->db->insert('tbl_trans_medcheck_ass_fisik_hsl', $data_pny);
                    }else{
                        $this->db->where('id_medcheck', $sql_medc->id)->where('id_medcheck_ass', $sql_medc_ass->id)->where('id_item', $pny->id)->where('tipe', '3')->update('tbl_trans_medcheck_ass_fisik_hsl', $data_pny);
                    }
                    
//                    echo '<pre>';
//                    print_r($data_pny);
//                    echo '</pre>';
                }
                
                if ($this->db->affected_rows() > 0) {
                    $this->session->set_flashdata('medcheck_toast', 'toastr.success("Entri hasil assesment pemeriksaan fisik berhasil ditambahkan !");');
                } else {
                    $this->session->set_flashdata('medcheck_toast', 'toastr.error("Entri hasil assesment gagal disimpan !");');
                }
                
                redirect(base_url('medcheck/tambah.php?act='.$act.'&id='.$id.'&id_ass='.$id_ass.'&status='.$status));
            }
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }

    public function set_medcheck_ass_fisik_hsl4() {
        if (akses::aksesLogin() == TRUE) {
            $id         = $this->input->post('id');
            $id_ass     = $this->input->post('id_ass');
            $status     = $this->input->post('status');
            $act        = $this->input->post('act');
            
            $this->form_validation->set_error_delimiters('<div class="alert alert-danger">', '</div>');

            $this->form_validation->set_rules('id', 'ID', 'required');

            if ($this->form_validation->run() == FALSE) {
                $msg_error = array(
                    'id'            => form_error('id'),
                );

                $this->session->set_flashdata('form_error', $msg_error);

                redirect(base_url('medcheck/tambah.php?id='.$id.'&status='.$status.'&act='.$act));
            } else {
                $sql_ass_pny        = $this->db->where('status', '1')->where('tipe', '4')->get('tbl_m_ass_pny')->result();
                $sql_medc           = $this->db->where('id', general::dekrip($id))->get('tbl_trans_medcheck')->row(); 
                $sql_medc_ass       = $this->db->where('id', general::dekrip($id_ass))->get('tbl_trans_medcheck_ass_fisik')->row(); 
                $sql_medc_ass_ck    = $this->db->where('id_medcheck', $sql_medc->id)->where('tipe', '4')->get('tbl_trans_medcheck_ass_fisik_hsl'); 
                $pengaturan         = $this->db->get('tbl_pengaturan')->row();
                               
                foreach ($sql_ass_pny as $pny){
                    $data_pny = array(
                        'tgl_simpan'        => date('Y-m-d H:i:s'),
                        'id_medcheck'       => $sql_medc->id,
                        'id_medcheck_ass'   => $sql_medc_ass->id,
                        'id_item'           => $pny->id,
                        'id_user'           => $this->ion_auth->user()->row()->id,
                        'item_name'         => $pny->penyakit,
                        'item_value'        => (!empty($_POST['fs'][$pny->id]) ? $_POST['fs'][$pny->id] : '0'),
                        'item_value2'       => (!empty($_POST['fs_jwb'][$pny->id]) ? $_POST['fs_jwb'][$pny->id] : ''),
                        'tipe'              => 4,
                        'status_posisi'     => $pny->status_posisi,
                    );
                    
                    # cek bila sudah ada datanya silahkan hapus
                    if($sql_medc_ass_ck->num_rows() == 0){
                        # Simpan ke tabel ass hasil
                        $this->db->insert('tbl_trans_medcheck_ass_fisik_hsl', $data_pny);
                    }else{
                        $this->db->where('id_medcheck', $sql_medc->id)->where('id_medcheck_ass', $sql_medc_ass->id)->where('id_item', $pny->id)->where('tipe', '4')->update('tbl_trans_medcheck_ass_fisik_hsl', $data_pny);
                    }
                    
//                    echo '<pre>';
//                    print_r($data_pny);
//                    echo '</pre>';
                }
                
                if ($this->db->affected_rows() > 0) {
                    $this->session->set_flashdata('medcheck_toast', 'toastr.success("Entri hasil assesment pemeriksaan mata berhasil ditambahkan !");');
                } else {
                    $this->session->set_flashdata('medcheck_toast', 'toastr.error("Entri hasil assesment gagal disimpan !");');
                }
                
                redirect(base_url('medcheck/tambah.php?act='.$act.'&id='.$id.'&id_ass='.$id_ass.'&status='.$status));
            }
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }

    public function set_medcheck_ass_fisik_hsl5() {
        if (akses::aksesLogin() == TRUE) {
            $id         = $this->input->post('id');
            $id_ass     = $this->input->post('id_ass');
            $status     = $this->input->post('status');
            $act        = $this->input->post('act');
            
            $this->form_validation->set_error_delimiters('<div class="alert alert-danger">', '</div>');

            $this->form_validation->set_rules('id', 'ID', 'required');

            if ($this->form_validation->run() == FALSE) {
                $msg_error = array(
                    'id'            => form_error('id'),
                );

                $this->session->set_flashdata('form_error', $msg_error);

                redirect(base_url('medcheck/tambah.php?id='.$id.'&status='.$status.'&act='.$act));
            } else {
                $sql_ass_pny        = $this->db->where('status', '1')->where('tipe', '5')->get('tbl_m_ass_pny')->result();
                $sql_medc           = $this->db->where('id', general::dekrip($id))->get('tbl_trans_medcheck')->row(); 
                $sql_medc_ass       = $this->db->where('id', general::dekrip($id_ass))->get('tbl_trans_medcheck_ass_fisik')->row(); 
                $sql_medc_ass_ck    = $this->db->where('id_medcheck', $sql_medc->id)->where('tipe', '5')->get('tbl_trans_medcheck_ass_fisik_hsl'); 
                $pengaturan         = $this->db->get('tbl_pengaturan')->row();
                               
                foreach ($sql_ass_pny as $pny){
                    $data_pny = array(
                        'tgl_simpan'        => date('Y-m-d H:i:s'),
                        'id_medcheck'       => $sql_medc->id,
                        'id_medcheck_ass'   => $sql_medc_ass->id,
                        'id_item'           => $pny->id,
                        'id_user'           => $this->ion_auth->user()->row()->id,
                        'item_name'         => $pny->penyakit,
                        'item_value2'       => (!empty($_POST['tht_jwb'][$pny->id]) ? $_POST['tht_jwb'][$pny->id] : ''),
                        'tipe'              => 5,
                        'status_posisi'     => $pny->status_posisi,
                    );
                    
                    # cek bila sudah ada datanya silahkan hapus
                    if($sql_medc_ass_ck->num_rows() == 0){
                        # Simpan ke tabel ass hasil
                        $this->db->insert('tbl_trans_medcheck_ass_fisik_hsl', $data_pny);
                    }else{
                        $this->db->where('id_medcheck', $sql_medc->id)->where('id_medcheck_ass', $sql_medc_ass->id)->where('id_item', $pny->id)->where('tipe', '5')->update('tbl_trans_medcheck_ass_fisik_hsl', $data_pny);
                    }
                    
//                    echo '<pre>';
//                    print_r($data_pny);
//                    echo '</pre>';
                }
                
                if ($this->db->affected_rows() > 0) {
                    $this->session->set_flashdata('medcheck_toast', 'toastr.success("Entri hasil assesment pemeriksaan fisik berhasil ditambahkan !");');
                } else {
                    $this->session->set_flashdata('medcheck_toast', 'toastr.error("Entri hasil assesment gagal disimpan !");');
                }
                
                redirect(base_url('medcheck/tambah.php?act='.$act.'&id='.$id.'&id_ass='.$id_ass.'&status='.$status));
            }
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }

    public function set_medcheck_ass_fisik_hsl6() {
        if (akses::aksesLogin() == TRUE) {
            $id         = $this->input->post('id');
            $id_ass     = $this->input->post('id_ass');
            $status     = $this->input->post('status');
            $act        = $this->input->post('act');
            
            $this->form_validation->set_error_delimiters('<div class="alert alert-danger">', '</div>');

            $this->form_validation->set_rules('id', 'ID', 'required');

            if ($this->form_validation->run() == FALSE) {
                $msg_error = array(
                    'id'            => form_error('id'),
                );

                $this->session->set_flashdata('form_error', $msg_error);

                redirect(base_url('medcheck/tambah.php?id='.$id.'&status='.$status.'&act='.$act));
            } else {
                $sql_ass_pny        = $this->db->where('status', '1')->where('tipe', '6')->get('tbl_m_ass_pny')->result();
                $sql_medc           = $this->db->where('id', general::dekrip($id))->get('tbl_trans_medcheck')->row(); 
                $sql_medc_ass       = $this->db->where('id', general::dekrip($id_ass))->get('tbl_trans_medcheck_ass_fisik')->row(); 
                $sql_medc_ass_ck    = $this->db->where('id_medcheck', $sql_medc->id)->where('tipe', '6')->get('tbl_trans_medcheck_ass_fisik_hsl'); 
                $pengaturan         = $this->db->get('tbl_pengaturan')->row();
                               
                foreach ($sql_ass_pny as $pny){
                    $data_pny = array(
                        'tgl_simpan'        => date('Y-m-d H:i:s'),
                        'id_medcheck'       => $sql_medc->id,
                        'id_medcheck_ass'   => $sql_medc_ass->id,
                        'id_item'           => $pny->id,
                        'id_user'           => $this->ion_auth->user()->row()->id,
                        'item_name'         => $pny->penyakit,
                        'item_value2'       => (!empty($_POST['thrx_jwb'][$pny->id]) ? $_POST['thrx_jwb'][$pny->id] : ''),
                        'tipe'              => 6,
                        'status_posisi'     => $pny->status_posisi,
                    );
                    
                    # cek bila sudah ada datanya silahkan hapus
                    if($sql_medc_ass_ck->num_rows() == 0){
                        # Simpan ke tabel ass hasil
                        $this->db->insert('tbl_trans_medcheck_ass_fisik_hsl', $data_pny);
                    }else{
                        $this->db->where('id_medcheck', $sql_medc->id)->where('id_medcheck_ass', $sql_medc_ass->id)->where('id_item', $pny->id)->where('tipe', '6')->update('tbl_trans_medcheck_ass_fisik_hsl', $data_pny);
                    }
                    
//                    echo '<pre>';
//                    print_r($data_pny);
//                    echo '</pre>';
                }
                
                if ($this->db->affected_rows() > 0) {
                    $this->session->set_flashdata('medcheck_toast', 'toastr.success("Entri hasil assesment pemeriksaan fisik berhasil ditambahkan !");');
                } else {
                    $this->session->set_flashdata('medcheck_toast', 'toastr.error("Entri hasil assesment gagal disimpan !");');
                }
                
                redirect(base_url('medcheck/tambah.php?act='.$act.'&id='.$id.'&id_ass='.$id_ass.'&status='.$status));
            }
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }

    public function set_medcheck_ass_fisik_hsl7() {
        if (akses::aksesLogin() == TRUE) {
            $id         = $this->input->post('id');
            $id_ass     = $this->input->post('id_ass');
            $status     = $this->input->post('status');
            $act        = $this->input->post('act');
            
            $this->form_validation->set_error_delimiters('<div class="alert alert-danger">', '</div>');

            $this->form_validation->set_rules('id', 'ID', 'required');

            if ($this->form_validation->run() == FALSE) {
                $msg_error = array(
                    'id'            => form_error('id'),
                );

                $this->session->set_flashdata('form_error', $msg_error);

                redirect(base_url('medcheck/tambah.php?id='.$id.'&status='.$status.'&act='.$act));
            } else {
                $sql_ass_pny        = $this->db->where('status', '1')->where('tipe', '7')->get('tbl_m_ass_pny')->result();
                $sql_medc           = $this->db->where('id', general::dekrip($id))->get('tbl_trans_medcheck')->row(); 
                $sql_medc_ass       = $this->db->where('id', general::dekrip($id_ass))->get('tbl_trans_medcheck_ass_fisik')->row(); 
                $sql_medc_ass_ck    = $this->db->where('id_medcheck', $sql_medc->id)->where('tipe', '7')->get('tbl_trans_medcheck_ass_fisik_hsl'); 
                $pengaturan         = $this->db->get('tbl_pengaturan')->row();
                               
                foreach ($sql_ass_pny as $pny){
                    $data_pny = array(
                        'tgl_simpan'        => date('Y-m-d H:i:s'),
                        'id_medcheck'       => $sql_medc->id,
                        'id_medcheck_ass'   => $sql_medc_ass->id,
                        'id_item'           => $pny->id,
                        'id_user'           => $this->ion_auth->user()->row()->id,
                        'item_name'         => $pny->penyakit,
                        'item_value2'       => (!empty($_POST['paru_jwb'][$pny->id]) ? $_POST['paru_jwb'][$pny->id] : ''),
                        'tipe'              => 7,
                        'status_posisi'     => $pny->status_posisi,
                    );
                    
                    # cek bila sudah ada datanya silahkan hapus
                    if($sql_medc_ass_ck->num_rows() == 0){
                        # Simpan ke tabel ass hasil
                        $this->db->insert('tbl_trans_medcheck_ass_fisik_hsl', $data_pny);
                    }else{
                        $this->db->where('id_medcheck', $sql_medc->id)->where('id_medcheck_ass', $sql_medc_ass->id)->where('id_item', $pny->id)->where('tipe', '7')->update('tbl_trans_medcheck_ass_fisik_hsl', $data_pny);
                    }
                    
//                    echo '<pre>';
//                    print_r($data_pny);
//                    echo '</pre>';
                }
                
                if ($this->db->affected_rows() > 0) {
                    $this->session->set_flashdata('medcheck_toast', 'toastr.success("Entri hasil assesment pemeriksaan fisik berhasil ditambahkan !");');
                } else {
                    $this->session->set_flashdata('medcheck_toast', 'toastr.error("Entri hasil assesment gagal disimpan !");');
                }
                
                redirect(base_url('medcheck/tambah.php?act='.$act.'&id='.$id.'&id_ass='.$id_ass.'&status='.$status));
            }
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }

    public function set_medcheck_ass_fisik_hsl8() {
        if (akses::aksesLogin() == TRUE) {
            $id         = $this->input->post('id');
            $id_ass     = $this->input->post('id_ass');
            $status     = $this->input->post('status');
            $act        = $this->input->post('act');
            
            $this->form_validation->set_error_delimiters('<div class="alert alert-danger">', '</div>');

            $this->form_validation->set_rules('id', 'ID', 'required');

            if ($this->form_validation->run() == FALSE) {
                $msg_error = array(
                    'id'            => form_error('id'),
                );

                $this->session->set_flashdata('form_error', $msg_error);

                redirect(base_url('medcheck/tambah.php?id='.$id.'&status='.$status.'&act='.$act));
            } else {
                $sql_ass_pny        = $this->db->where('status', '1')->where('tipe', '8')->get('tbl_m_ass_pny')->result();
                $sql_medc           = $this->db->where('id', general::dekrip($id))->get('tbl_trans_medcheck')->row(); 
                $sql_medc_ass       = $this->db->where('id', general::dekrip($id_ass))->get('tbl_trans_medcheck_ass_fisik')->row(); 
                $sql_medc_ass_ck    = $this->db->where('id_medcheck', $sql_medc->id)->where('tipe', '8')->get('tbl_trans_medcheck_ass_fisik_hsl'); 
                $pengaturan         = $this->db->get('tbl_pengaturan')->row();
                               
                foreach ($sql_ass_pny as $pny){
                    $data_pny = array(
                        'tgl_simpan'        => date('Y-m-d H:i:s'),
                        'id_medcheck'       => $sql_medc->id,
                        'id_medcheck_ass'   => $sql_medc_ass->id,
                        'id_item'           => $pny->id,
                        'id_user'           => $this->ion_auth->user()->row()->id,
                        'item_name'         => $pny->penyakit,
                        'item_value2'       => (!empty($_POST['jntg_jwb'][$pny->id]) ? $_POST['jntg_jwb'][$pny->id] : ''),
                        'tipe'              => 8,
                        'status_posisi'     => $pny->status_posisi,
                    );
                    
                    # cek bila sudah ada datanya silahkan hapus
                    if($sql_medc_ass_ck->num_rows() == 0){
                        # Simpan ke tabel ass hasil
                        $this->db->insert('tbl_trans_medcheck_ass_fisik_hsl', $data_pny);
                    }else{
                        $this->db->where('id_medcheck', $sql_medc->id)->where('id_medcheck_ass', $sql_medc_ass->id)->where('id_item', $pny->id)->where('tipe', '8')->update('tbl_trans_medcheck_ass_fisik_hsl', $data_pny);
                    }
                    
//                    echo '<pre>';
//                    print_r($data_pny);
//                    echo '</pre>';
                }
                
                if ($this->db->affected_rows() > 0) {
                    $this->session->set_flashdata('medcheck_toast', 'toastr.success("Entri hasil assesment pemeriksaan fisik berhasil ditambahkan !");');
                } else {
                    $this->session->set_flashdata('medcheck_toast', 'toastr.error("Entri hasil assesment gagal disimpan !");');
                }
                
                redirect(base_url('medcheck/tambah.php?act='.$act.'&id='.$id.'&id_ass='.$id_ass.'&status='.$status));
            }
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }

    public function set_medcheck_ass_fisik_hsl9() {
        if (akses::aksesLogin() == TRUE) {
            $id         = $this->input->post('id');
            $id_ass     = $this->input->post('id_ass');
            $status     = $this->input->post('status');
            $act        = $this->input->post('act');
            
            $this->form_validation->set_error_delimiters('<div class="alert alert-danger">', '</div>');

            $this->form_validation->set_rules('id', 'ID', 'required');

            if ($this->form_validation->run() == FALSE) {
                $msg_error = array(
                    'id'            => form_error('id'),
                );

                $this->session->set_flashdata('form_error', $msg_error);

                redirect(base_url('medcheck/tambah.php?id='.$id.'&status='.$status.'&act='.$act));
            } else {
                $sql_ass_pny        = $this->db->where('status', '1')->where('tipe', '9')->get('tbl_m_ass_pny')->result();
                $sql_medc           = $this->db->where('id', general::dekrip($id))->get('tbl_trans_medcheck')->row(); 
                $sql_medc_ass       = $this->db->where('id', general::dekrip($id_ass))->get('tbl_trans_medcheck_ass_fisik')->row(); 
                $sql_medc_ass_ck    = $this->db->where('id_medcheck', $sql_medc->id)->where('tipe', '9')->get('tbl_trans_medcheck_ass_fisik_hsl'); 
                $pengaturan         = $this->db->get('tbl_pengaturan')->row();
                               
                foreach ($sql_ass_pny as $pny){
                    $data_pny = array(
                        'tgl_simpan'        => date('Y-m-d H:i:s'),
                        'id_medcheck'       => $sql_medc->id,
                        'id_medcheck_ass'   => $sql_medc_ass->id,
                        'id_item'           => $pny->id,
                        'id_user'           => $this->ion_auth->user()->row()->id,
                        'item_name'         => $pny->penyakit,
                        'item_value2'       => (!empty($_POST['jntg_jwb'][$pny->id]) ? $_POST['jntg_jwb'][$pny->id] : ''),
                        'tipe'              => 9,
                        'status_posisi'     => $pny->status_posisi,
                    );
                    
                    # cek bila sudah ada datanya silahkan hapus
                    if($sql_medc_ass_ck->num_rows() == 0){
                        # Simpan ke tabel ass hasil
                        $this->db->insert('tbl_trans_medcheck_ass_fisik_hsl', $data_pny);
                    }else{
                        $this->db->where('id_medcheck', $sql_medc->id)->where('id_medcheck_ass', $sql_medc_ass->id)->where('id_item', $pny->id)->where('tipe', '9')->update('tbl_trans_medcheck_ass_fisik_hsl', $data_pny);
                    }
                    
//                    echo '<pre>';
//                    print_r($data_pny);
//                    echo '</pre>';
                }
                
                if ($this->db->affected_rows() > 0) {
                    $this->session->set_flashdata('medcheck_toast', 'toastr.success("Entri hasil assesment pemeriksaan fisik berhasil ditambahkan !");');
                } else {
                    $this->session->set_flashdata('medcheck_toast', 'toastr.error("Entri hasil assesment gagal disimpan !");');
                }
                
                redirect(base_url('medcheck/tambah.php?act='.$act.'&id='.$id.'&id_ass='.$id_ass.'&status='.$status));
            }
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }

    public function set_medcheck_ass_fisik_hsl10() {
        if (akses::aksesLogin() == TRUE) {
            $id         = $this->input->post('id');
            $id_ass     = $this->input->post('id_ass');
            $status     = $this->input->post('status');
            $act        = $this->input->post('act');
            
            $this->form_validation->set_error_delimiters('<div class="alert alert-danger">', '</div>');

            $this->form_validation->set_rules('id', 'ID', 'required');

            if ($this->form_validation->run() == FALSE) {
                $msg_error = array(
                    'id'            => form_error('id'),
                );

                $this->session->set_flashdata('form_error', $msg_error);

                redirect(base_url('medcheck/tambah.php?id='.$id.'&status='.$status.'&act='.$act));
            } else {
                $sql_ass_pny        = $this->db->where('status', '1')->where('tipe', '10')->get('tbl_m_ass_pny')->result();
                $sql_medc           = $this->db->where('id', general::dekrip($id))->get('tbl_trans_medcheck')->row(); 
                $sql_medc_ass       = $this->db->where('id', general::dekrip($id_ass))->get('tbl_trans_medcheck_ass_fisik')->row(); 
                $sql_medc_ass_ck    = $this->db->where('id_medcheck', $sql_medc->id)->where('tipe', '10')->get('tbl_trans_medcheck_ass_fisik_hsl'); 
                $pengaturan         = $this->db->get('tbl_pengaturan')->row();
                               
                foreach ($sql_ass_pny as $pny){
                    $data_pny = array(
                        'tgl_simpan'        => date('Y-m-d H:i:s'),
                        'id_medcheck'       => $sql_medc->id,
                        'id_medcheck_ass'   => $sql_medc_ass->id,
                        'id_item'           => $pny->id,
                        'id_user'           => $this->ion_auth->user()->row()->id,
                        'item_name'         => $pny->penyakit,
                        'item_value2'       => (!empty($_POST['jntg_jwb'][$pny->id]) ? $_POST['jntg_jwb'][$pny->id] : ''),
                        'tipe'              => 10,
                        'status_posisi'     => $pny->status_posisi,
                    );
                    
                    # cek bila sudah ada datanya silahkan hapus
                    if($sql_medc_ass_ck->num_rows() == 0){
                        # Simpan ke tabel ass hasil
                        $this->db->insert('tbl_trans_medcheck_ass_fisik_hsl', $data_pny);
                    }else{
                        $this->db->where('id_medcheck', $sql_medc->id)->where('id_medcheck_ass', $sql_medc_ass->id)->where('id_item', $pny->id)->where('tipe', '10')->update('tbl_trans_medcheck_ass_fisik_hsl', $data_pny);
                    }
                    
//                    echo '<pre>';
//                    print_r($data_pny);
//                    echo '</pre>';
                }
                
                if ($this->db->affected_rows() > 0) {
                    $this->session->set_flashdata('medcheck_toast', 'toastr.success("Entri hasil assesment pemeriksaan fisik berhasil ditambahkan !");');
                } else {
                    $this->session->set_flashdata('medcheck_toast', 'toastr.error("Entri hasil assesment gagal disimpan !");');
                }
                
                redirect(base_url('medcheck/tambah.php?act='.$act.'&id='.$id.'&id_ass='.$id_ass.'&status='.$status));
            }
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }

    public function set_medcheck_ass_fisik_hsl11() {
        if (akses::aksesLogin() == TRUE) {
            $id         = $this->input->post('id');
            $id_ass     = $this->input->post('id_ass');
            $status     = $this->input->post('status');
            $act        = $this->input->post('act');
            
            $this->form_validation->set_error_delimiters('<div class="alert alert-danger">', '</div>');

            $this->form_validation->set_rules('id', 'ID', 'required');

            if ($this->form_validation->run() == FALSE) {
                $msg_error = array(
                    'id'            => form_error('id'),
                );

                $this->session->set_flashdata('form_error', $msg_error);

                redirect(base_url('medcheck/tambah.php?id='.$id.'&status='.$status.'&act='.$act));
            } else {
                $sql_ass_pny        = $this->db->where('status', '1')->where('tipe', '11')->get('tbl_m_ass_pny')->result();
                $sql_medc           = $this->db->where('id', general::dekrip($id))->get('tbl_trans_medcheck')->row(); 
                $sql_medc_ass       = $this->db->where('id', general::dekrip($id_ass))->get('tbl_trans_medcheck_ass_fisik')->row(); 
                $sql_medc_ass_ck    = $this->db->where('id_medcheck', $sql_medc->id)->where('tipe', '11')->get('tbl_trans_medcheck_ass_fisik_hsl'); 
                $pengaturan         = $this->db->get('tbl_pengaturan')->row();
                               
                foreach ($sql_ass_pny as $pny){
                    $data_pny = array(
                        'tgl_simpan'        => date('Y-m-d H:i:s'),
                        'id_medcheck'       => $sql_medc->id,
                        'id_medcheck_ass'   => $sql_medc_ass->id,
                        'id_item'           => $pny->id,
                        'id_user'           => $this->ion_auth->user()->row()->id,
                        'item_name'         => $pny->penyakit,
                        'item_value2'       => (!empty($_POST['eks_jwb'][$pny->id]) ? $_POST['eks_jwb'][$pny->id] : ''),
                        'tipe'              => 11,
                        'status_posisi'     => $pny->status_posisi,
                    );
                    
                    # cek bila sudah ada datanya silahkan hapus
                    if($sql_medc_ass_ck->num_rows() == 0){
                        # Simpan ke tabel ass hasil
                        $this->db->insert('tbl_trans_medcheck_ass_fisik_hsl', $data_pny);
                    }else{
                        $this->db->where('id_medcheck', $sql_medc->id)->where('id_medcheck_ass', $sql_medc_ass->id)->where('id_item', $pny->id)->where('tipe', '11')->update('tbl_trans_medcheck_ass_fisik_hsl', $data_pny);
                    }
                    
//                    echo '<pre>';
//                    print_r($data_pny);
//                    echo '</pre>';
                }
                
                if ($this->db->affected_rows() > 0) {
                    $this->session->set_flashdata('medcheck_toast', 'toastr.success("Entri hasil assesment pemeriksaan fisik berhasil ditambahkan !");');
                } else {
                    $this->session->set_flashdata('medcheck_toast', 'toastr.error("Entri hasil assesment gagal disimpan !");');
                }
                
                redirect(base_url('medcheck/tambah.php?act='.$act.'&id='.$id.'&id_ass='.$id_ass.'&status='.$status));
            }
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }

    public function set_medcheck_ass_fisik_hsl12() {
        if (akses::aksesLogin() == TRUE) {
            $id         = $this->input->post('id');
            $id_ass     = $this->input->post('id_ass');
            $status     = $this->input->post('status');
            $act        = $this->input->post('act');
            
            $this->form_validation->set_error_delimiters('<div class="alert alert-danger">', '</div>');

            $this->form_validation->set_rules('id', 'ID', 'required');

            if ($this->form_validation->run() == FALSE) {
                $msg_error = array(
                    'id'            => form_error('id'),
                );

                $this->session->set_flashdata('form_error', $msg_error);

                redirect(base_url('medcheck/tambah.php?id='.$id.'&status='.$status.'&act='.$act));
            } else {
                $sql_ass_pny        = $this->db->where('status', '1')->where('tipe', '12')->get('tbl_m_ass_pny')->result();
                $sql_medc           = $this->db->where('id', general::dekrip($id))->get('tbl_trans_medcheck')->row(); 
                $sql_medc_ass       = $this->db->where('id', general::dekrip($id_ass))->get('tbl_trans_medcheck_ass_fisik')->row(); 
                $sql_medc_ass_ck    = $this->db->where('id_medcheck', $sql_medc->id)->where('tipe', '12')->get('tbl_trans_medcheck_ass_fisik_hsl'); 
                $pengaturan         = $this->db->get('tbl_pengaturan')->row();
                               
                foreach ($sql_ass_pny as $pny){
                    $data_pny = array(
                        'tgl_simpan'        => date('Y-m-d H:i:s'),
                        'id_medcheck'       => $sql_medc->id,
                        'id_medcheck_ass'   => $sql_medc_ass->id,
                        'id_item'           => $pny->id,
                        'id_user'           => $this->ion_auth->user()->row()->id,
                        'item_name'         => $pny->penyakit,
                        'item_value2'       => (!empty($_POST['psi_jwb'][$pny->id]) ? $_POST['psi_jwb'][$pny->id] : ''),
                        'tipe'              => 12,
                        'status_posisi'     => $pny->status_posisi,
                    );
                    
                    # cek bila sudah ada datanya silahkan hapus
                    if($sql_medc_ass_ck->num_rows() == 0){
                        # Simpan ke tabel ass hasil
                        $this->db->insert('tbl_trans_medcheck_ass_fisik_hsl', $data_pny);
                    }else{
                        $this->db->where('id_medcheck', $sql_medc->id)->where('id_medcheck_ass', $sql_medc_ass->id)->where('id_item', $pny->id)->where('tipe', '12')->update('tbl_trans_medcheck_ass_fisik_hsl', $data_pny);
                    }
                    
//                    echo '<pre>';
//                    print_r($data_pny);
//                    echo '</pre>';
                }
                
                if ($this->db->affected_rows() > 0) {
                    $this->session->set_flashdata('medcheck_toast', 'toastr.success("Entri hasil assesment pemeriksaan fisik berhasil ditambahkan !");');
                } else {
                    $this->session->set_flashdata('medcheck_toast', 'toastr.error("Entri hasil assesment gagal disimpan !");');
                }
                
                redirect(base_url('medcheck/tambah.php?act='.$act.'&id='.$id.'&id_ass='.$id_ass.'&status='.$status));
            }
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }

    public function set_medcheck_ass_fisik_hsl13() {
        if (akses::aksesLogin() == TRUE) {
            $id         = $this->input->post('id');
            $id_ass     = $this->input->post('id_ass');
            $status     = $this->input->post('status');
            $act        = $this->input->post('act');
            
            $this->form_validation->set_error_delimiters('<div class="alert alert-danger">', '</div>');

            $this->form_validation->set_rules('id', 'ID', 'required');

            if ($this->form_validation->run() == FALSE) {
                $msg_error = array(
                    'id'            => form_error('id'),
                );

                $this->session->set_flashdata('form_error', $msg_error);

                redirect(base_url('medcheck/tambah.php?id='.$id.'&status='.$status.'&act='.$act));
            } else {
                $sql_ass_pny        = $this->db->where('status', '1')->where('tipe', '13')->get('tbl_m_ass_pny')->result();
                $sql_medc           = $this->db->where('id', general::dekrip($id))->get('tbl_trans_medcheck')->row(); 
                $sql_medc_ass       = $this->db->where('id', general::dekrip($id_ass))->get('tbl_trans_medcheck_ass_fisik')->row(); 
                $sql_medc_ass_ck    = $this->db->where('id_medcheck', $sql_medc->id)->where('tipe', '13')->get('tbl_trans_medcheck_ass_fisik_hsl'); 
                $pengaturan         = $this->db->get('tbl_pengaturan')->row();
                               
                foreach ($sql_ass_pny as $pny){
                    $data_pny = array(
                        'tgl_simpan'        => date('Y-m-d H:i:s'),
                        'id_medcheck'       => $sql_medc->id,
                        'id_medcheck_ass'   => $sql_medc_ass->id,
                        'id_item'           => $pny->id,
                        'id_user'           => $this->ion_auth->user()->row()->id,
                        'item_name'         => $pny->penyakit,
                        'item_value2'       => (!empty($_POST['gigi_jwb'][$pny->id]) ? $_POST['gigi_jwb'][$pny->id] : ''),
                        'tipe'              => 13,
                        'status_posisi'     => $pny->status_posisi,
                    );
                    
                    # cek bila sudah ada datanya silahkan hapus
                    if($sql_medc_ass_ck->num_rows() == 0){
                        # Simpan ke tabel ass hasil
                        $this->db->insert('tbl_trans_medcheck_ass_fisik_hsl', $data_pny);
                    }else{
                        $this->db->where('id_medcheck', $sql_medc->id)->where('id_medcheck_ass', $sql_medc_ass->id)->where('id_item', $pny->id)->where('tipe', '13')->update('tbl_trans_medcheck_ass_fisik_hsl', $data_pny);
                    }
                    
//                    echo '<pre>';
//                    print_r($data_pny);
//                    echo '</pre>';
                }
                
                if ($this->db->affected_rows() > 0) {
                    $this->session->set_flashdata('medcheck_toast', 'toastr.success("Entri hasil assesment pemeriksaan fisik berhasil ditambahkan !");');
                } else {
                    $this->session->set_flashdata('medcheck_toast', 'toastr.error("Entri hasil assesment gagal disimpan !");');
                }
                
                redirect(base_url('medcheck/tambah.php?act='.$act.'&id='.$id.'&id_ass='.$id_ass.'&status='.$status));
            }
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }

    public function set_medcheck_ass_fisik_hsl14() {
        if (akses::aksesLogin() == TRUE) {
            $id         = $this->input->post('id');
            $id_ass     = $this->input->post('id_ass');
            $status     = $this->input->post('status');
            $act        = $this->input->post('act');
            
            $this->form_validation->set_error_delimiters('<div class="alert alert-danger">', '</div>');

            $this->form_validation->set_rules('id', 'ID', 'required');

            if ($this->form_validation->run() == FALSE) {
                $msg_error = array(
                    'id'            => form_error('id'),
                );

                $this->session->set_flashdata('form_error', $msg_error);

                redirect(base_url('medcheck/tambah.php?id='.$id.'&status='.$status.'&act='.$act));
            } else {
                $sql_ass_pny        = $this->db->where('status', '1')->where('tipe', '14')->get('tbl_m_ass_pny')->result();
                $sql_medc           = $this->db->where('id', general::dekrip($id))->get('tbl_trans_medcheck')->row(); 
                $sql_medc_ass       = $this->db->where('id', general::dekrip($id_ass))->get('tbl_trans_medcheck_ass_fisik')->row(); 
                $sql_medc_ass_ck    = $this->db->where('id_medcheck', $sql_medc->id)->where('tipe', '14')->get('tbl_trans_medcheck_ass_fisik_hsl'); 
                $pengaturan         = $this->db->get('tbl_pengaturan')->row();
                               
                foreach ($sql_ass_pny as $pny){
                    $data_pny = array(
                        'tgl_simpan'        => date('Y-m-d H:i:s'),
                        'id_medcheck'       => $sql_medc->id,
                        'id_medcheck_ass'   => $sql_medc_ass->id,
                        'id_item'           => $pny->id,
                        'id_user'           => $this->ion_auth->user()->row()->id,
                        'item_name'         => $pny->penyakit,
                        'item_value2'       => (!empty($_POST['syrf_jwb'][$pny->id]) ? $_POST['syrf_jwb'][$pny->id] : ''),
                        'tipe'              => 14,
                        'status_posisi'     => $pny->status_posisi,
                    );
                    
                    # cek bila sudah ada datanya silahkan hapus
                    if($sql_medc_ass_ck->num_rows() == 0){
                        # Simpan ke tabel ass hasil
                        $this->db->insert('tbl_trans_medcheck_ass_fisik_hsl', $data_pny);
                    }else{
                        $this->db->where('id_medcheck', $sql_medc->id)->where('id_medcheck_ass', $sql_medc_ass->id)->where('id_item', $pny->id)->where('tipe', '14')->update('tbl_trans_medcheck_ass_fisik_hsl', $data_pny);
                    }
                    
//                    echo '<pre>';
//                    print_r($data_pny);
//                    echo '</pre>';
                }
                
                if ($this->db->affected_rows() > 0) {
                    $this->session->set_flashdata('medcheck_toast', 'toastr.success("Entri hasil assesment pemeriksaan fisik berhasil ditambahkan !");');
                } else {
                    $this->session->set_flashdata('medcheck_toast', 'toastr.error("Entri hasil assesment gagal disimpan !");');
                }
                
                redirect(base_url('medcheck/tambah.php?act='.$act.'&id='.$id.'&id_ass='.$id_ass.'&status='.$status));
            }
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }
    
    # Modul Asessment Fisik Hapus
    public function set_medcheck_ass_fisik_hapus() {
        if (akses::aksesLogin() == TRUE) {
            $id         = $this->input->get('id');
            $item_id    = $this->input->get('item_id');
            $act        = $this->input->get('act');
            $rute       = $this->input->get('route');
            $status     = $this->input->get('status');
            
            $sql_medc_fisik = $this->db->where('id', general::dekrip($item_id))->get('tbl_trans_medcheck_ass_fisik')->row();
            $sql_medc_file  = $this->db->where('id_berkas', $sql_medc_fisik->id)->get('tbl_trans_medcheck_file')->row();
            
            if(!empty($id)){            
                $this->db->where('id_berkas', $sql_medc_fisik->id)->delete('tbl_trans_medcheck_file');
                $this->db->where('id', $sql_medc_fisik->id)->delete('tbl_trans_medcheck_ass_fisik');
                
                $this->session->set_flashdata('medcheck_toast', 'toastr.success("Entri assesment berhasil dihapus !");');
            }
            
            redirect(base_url('medcheck/tambah.php?'.(!empty($act) ? 'act='.$act.'&' : '').'id='.$id.'&status='.$status));
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }
    

    # Modul Asessment Rawat Inap
    public function set_medcheck_ass_ranap() {
        if (akses::aksesLogin() == TRUE) {
            $id             = $this->input->post('id');
            $id_ass         = $this->input->post('id_ass');
            $tgl_masuk      = $this->input->post('tgl_masuk');
            $keluhan        = $this->input->post('keluhan');
            $riwayat_skg    = $this->input->post('riwayat_skg');
            $riwayat_klg    = $this->input->post('riwayat_klg');
            $penyakit       = $this->input->post('penyakit');
            $skala_nyeri    = $this->input->post('skala_nyeri');
            $askep_mslh     = $this->input->post('askep_mslh');
            $askep_7an      = $this->input->post('askep_7an');
            $status         = $this->input->post('status');
            $status_rnp     = $this->input->post('status_rnp');
            $act            = $this->input->post('act');
            
            $this->form_validation->set_error_delimiters('<div class="alert alert-danger">', '</div>');

            $this->form_validation->set_rules('id', 'ID', 'required');

            if ($this->form_validation->run() == FALSE) {
                $msg_error = array(
                    'id'        => form_error('id'),
                );

                $this->session->set_flashdata('form_error', $msg_error);

                redirect(base_url('medcheck/tambah.php?id='.$id.'&status='.$status.'&act='.$act));
            } else {
                $sql_medc       = $this->db->where('id', general::dekrip($id))->get('tbl_trans_medcheck')->row(); 
                $sql_medc_ass   = $this->db->where('id_medcheck', $sql_medc->id)->get('tbl_trans_medcheck_ass_ranap'); 
                $pengaturan     = $this->db->get('tbl_pengaturan')->row();
                
                $data = array(
                    'tgl_simpan'    => date('Y-m-d H:i:s'),
                    'tgl_modif'     => date('Y-m-d H:i:s'),
                    'tgl_masuk'     => $sql_medc->tgl_masuk,
                    'id_medcheck'   => $sql_medc->id,
                    'id_pasien'     => $sql_medc->id_pasien,
                    'id_dokter'     => $sql_medc->id_dokter,
                    'keluhan'       => $keluhan,
                    'riwayat_skg'   => $riwayat_skg,
                    'riwayat_klg'   => $riwayat_klg,
                    'penyakit'      => $penyakit,
                    'skala_nyeri'   => $skala_nyeri,
                    'askep_masalah' => $askep_mslh,
                    'askep_tujuan'  => $askep_7an,
                    'status_rnp'    => (!empty($status_rnp) ? $status_rnp : '0'),
                    'status'        => '1',
                );
                
                if($sql_medc_ass->num_rows() > 0){
                    $ass_id = $sql_medc_ass->row()->id;
                    $this->db->where('id', $ass_id)->update('tbl_trans_medcheck_ass_ranap', $data);
                }else{
                    $this->db->insert('tbl_trans_medcheck_ass_ranap', $data);
                }
                
                if ($this->db->affected_rows() > 0) {
                    $this->session->set_flashdata('medcheck_toast', 'toastr.success("Entri hasil assesment rawat inap berhasil ditambahkan !");');
                } else {
                    $this->session->set_flashdata('medcheck_toast', 'toastr.error("Entri hasil assesment gagal disimpan !");');
                }
                

                $this->session->set_flashdata('medcheck', '<div class="alert alert-success">Data berhasil di update</div>');
                redirect(base_url('medcheck/tambah.php?id='.$id.'&status=16'.$status));
            }
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }

    # Modul Asessment Rawat Inap Riwayat Obat
    public function set_medcheck_ass_ranap_obt() {
        if (akses::aksesLogin() == TRUE) {
            $id             = $this->input->post('id');
            $id_ass         = $this->input->post('id_ass');
            $param          = $this->input->post('param');
            $param_nilai    = $this->input->post('param_nilai');
            $act            = $this->input->post('act');
            
            $this->form_validation->set_error_delimiters('<div class="alert alert-danger">', '</div>');

            $this->form_validation->set_rules('id', 'ID', 'required');

            if ($this->form_validation->run() == FALSE) {
                $msg_error = array(
                    'id'        => form_error('id'),
                );

                $this->session->set_flashdata('form_error', $msg_error);

                redirect(base_url('medcheck/tambah.php?id='.$id.'&status='.$status.'&act='.$act));
            } else {
                $sql_medc       = $this->db->where('id', general::dekrip($id))->get('tbl_trans_medcheck')->row(); 
                $sql_medc_ass   = $this->db->where('id_medcheck', $sql_medc->id)->get('tbl_trans_medcheck_ass_ranap')->row(); 
                $pengaturan     = $this->db->get('tbl_pengaturan')->row();
                
                $data = array(
                    'tgl_simpan'    => date('Y-m-d H:i:s'),
                    'id_ass_ranap'  => $sql_medc_ass->id,
                    'id_user'       => $this->ion_auth->user()->row()->id,
                    'param'         => $param,
                    'param_nilai'   => $param_nilai,
                );
                
                $this->db->insert('tbl_trans_medcheck_ass_ranap_obat', $data);
                
                if ($this->db->affected_rows() > 0) {
                    $this->session->set_flashdata('medcheck_toast', 'toastr.success("Entri hasil assesment rawat inap berhasil ditambahkan !");');
                } else {
                    $this->session->set_flashdata('medcheck_toast', 'toastr.error("Entri hasil assesment gagal disimpan !");');
                }
                
                redirect(base_url('medcheck/tambah.php?id='.$id.'&status=16'.$status));
                
//                echo $id;
//                echo '<pre>';
//                print_r($data);
//                echo '</pre>';
            }
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }
    
    # Modul Asessment Rawat Inap Riwayat Obat Hapus
    public function set_medcheck_ass_ranap_obt_hapus() {
        if (akses::aksesLogin() == TRUE) {
            $id         = $this->input->get('id');
            $id_medc    = $this->input->get('id_medc');
            $act        = $this->input->get('act');
            $rute       = $this->input->get('route');
            $status     = $this->input->get('status');
            
            if(!empty($id)){
                $this->db->where('id',general::dekrip($id))->delete('tbl_trans_medcheck_ass_ranap_obat');
                $this->session->set_flashdata('medcheck_toast', 'toastr.success("Entri riwayat minum obat berhasil dihapus !");');
            }
            
            redirect(base_url((!empty($rute) ? $rute : 'medcheck/tambah.php?'.(!empty($act) ? 'act='.$act.'&' : '').'id='.$id_medc.'&status='.$status)));
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }
    
    # Modul Konsul Antar dokter
    public function set_konsul() {
        if (akses::aksesLogin() == TRUE) {
            $id         = $this->input->post('id_medc');
            $dokter     = $this->input->post('dokter');
            $judul      = $this->input->post('judul');
            $post       = $this->input->post('posting');
            $status     = $this->input->post('status');
            $this->form_validation->set_error_delimiters('<div class="alert alert-danger">', '</div>');

            $this->form_validation->set_rules('id_medc', 'ID', 'required');
            $this->form_validation->set_rules('posting', 'ID', 'required');

            if ($this->form_validation->run() == FALSE) {
                $msg_error = array(
                    'id_medc' => form_error('id_medc'),
                    'posting' => form_error('posting'),
                    'judul'   => form_error('judul'),
                );

                $this->session->set_flashdata('form_error', $msg_error);

                redirect(base_url('medcheck/data_konsul_post.php'));
            } else {
                $sql_medc       = $this->db->where('id', general::dekrip($id))->get('tbl_trans_medcheck')->row();
                $jml            = $sql_kamar->jml + 1;
                
                $data = array(
                    'id_medcheck'   => $sql_medc->id,
                    'id_pasien'     => $sql_medc->id_pasien,
                    'id_dokter'     => $dokter,
                    'id_user'       => $this->ion_auth->user()->row()->id,
                    'tgl_simpan'    => date('Y-m-d H:i:s'),
                    'judul'         => $judul,
                    'posting'       => htmlentities($post),
                );
                
                $data_raber = array(
                    'id_medcheck'   => $sql_medc->id,
                    'id_user'       => $this->ion_auth->user()->row()->id,
                    'id_pasien'     => $sql_medc->id_pasien,
                    'id_dokter'     => $dokter,
                    'tgl_simpan'    => date('Y-m-d H:i:s'),
                    'keterangan'    => 'Dari konsul dengan topik '.$judul
                );
                
                /* Transaksi Database */
                $this->db->query('SET autocommit = 0;');
                $this->db->trans_start();

                # Simpan ke tabel konsul
                $this->db->insert('tbl_trans_konsul', $data);
                $last_id = crud::last_id();

                $data_dokter = array(
                    'id_konsul'     => $last_id,
                    'id_dokter'     => $dokter,
                    'tgl_simpan'    => date('Y-m-d H:i:s')
                );

                # Simpan ke tabel konsul data dokter
                $this->db->insert('tbl_trans_konsul_dokter', $data_dokter);
                
                # Simpan ke tabel raber
                $this->db->insert('tbl_trans_medcheck_dokter', $data_raber);
                
                # Cek status transact MySQL
                if ($this->db->trans_status() === FALSE) {
                    # Rollback jika gagal
                    $this->db->trans_rollback();

                    # Tampilkan pesan error
                    $this->session->set_flashdata('medcheck_toast', 'toastr.error("Thread gagal di posting  !")');
                } else {
                    $this->db->trans_complete();

                    # Tampilkan pesan sukses jika sudah berhasil commit
                    $this->session->set_flashdata('medcheck_toast', 'toastr.success("Thread berhasil di posting !")');
                }

                redirect(base_url('medcheck/data_konsul.php'));
                
//                echo '<pre>';
//                print_r($data_raber);
//                echo '</pre>';
//
//                crud::simpan('tbl_trans_medcheck_trf', $data);
//                $last_id = crud::last_id();                
//                crud::update('tbl_trans_medcheck', 'id', $sql_medc->id, $data_medc);
//                
//                $this->session->set_flashdata('medcheck', '<div class="alert alert-success">Transfer Pasien Berhasil !!</div>');
//                redirect(base_url('medcheck/transfer.php?id='.general::enkrip($sql_medc->id).'&trf_id='.general::enkrip($last_id).'&status='.$sql_medc->status));
            }
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }
    
    public function set_konsul_balas() {
        if (akses::aksesLogin() == TRUE) {
            $id         = $this->input->post('id');
            $dokter     = $this->input->post('dokter');
            $post       = $this->input->post('posting');
            $anamnesa   = $this->input->post('anamnesa');
            $diagnosa   = $this->input->post('diagnosa');
            $pemeriksaan= $this->input->post('pemeriksaan');
            $program    = $this->input->post('program');
            $status     = $this->input->post('status');
            $this->form_validation->set_error_delimiters('<div class="alert alert-danger">', '</div>');

            $this->form_validation->set_rules('id', 'ID', 'required');
            $this->form_validation->set_rules('posting', 'ID', 'required');

            if ($this->form_validation->run() == FALSE) {
                $msg_error = array(
                    'id'        => form_error('id'),
                    'posting'   => form_error('posting'),
                );

                $this->session->set_flashdata('form_error', $msg_error);

                redirect(base_url('medcheck/data_konsul_post.php'));
            } else {
                $sql_konsul     = $this->db->where('id', general::dekrip($id))->get('tbl_trans_konsul')->row();
                $sql_medc       = $this->db->where('id', $sql_konsul->id_medcheck)->get('tbl_trans_medcheck')->row();
                $jml            = $sql_kamar->jml + 1;
                
                $data = array(
                    'id_parent'     => $sql_konsul->id,
                    'id_medcheck'   => $sql_medc->id_dokter,
                    'id_pasien'     => $sql_medc->id_dokter,
                    'id_dokter'     => $this->ion_auth->user()->row()->id,
                    'id_user'       => $this->ion_auth->user()->row()->id,
                    'tgl_simpan'    => date('Y-m-d H:i:s'),
                    'posting'       => htmlentities($post),
                    'anamnesa'      => htmlentities($anamnesa),
                    'diagnosa'      => htmlentities($diagnosa),
                    'pemeriksaan'   => htmlentities($pemeriksaan),
                    'program'       => htmlentities($program),
                );
                
                /* Transaksi Database */
                $this->db->query('SET autocommit = 0;');
                $this->db->trans_start();

                # Simpan ke tabel konsul
                $this->db->insert('tbl_trans_konsul', $data);


                $data_dokter = array(
                    'id_konsul'     => $sql_konsul->id,
                    'id_dokter'     => $this->ion_auth->user()->row()->id,
                    'tgl_simpan'    => date('Y-m-d H:i:s')
                );

                # Simpan ke tabel konsul data dokter
                $this->db->insert('tbl_trans_konsul_dokter', $data_dokter);
                
                # Cek status transact MySQL
                if ($this->db->trans_status() === FALSE) {
                    # Rollback jika gagal
                    $this->db->trans_rollback();

                    # Tampilkan pesan error
                    $this->session->set_flashdata('medcheck_toast', 'toastr.error("Thread gagal di posting  !")');
                } else {
                    $this->db->trans_complete();

                    # Tampilkan pesan sukses jika sudah berhasil commit
                    $this->session->set_flashdata('medcheck_toast', 'toastr.success("Thread balasan berhasil di posting !")');
                }

                redirect(base_url('medcheck/data_konsul_balas.php?id='.$id));
//                
//                echo '<pre>';
//                print_r($data);
//                echo '</pre>';
//                echo '<pre>';
//                print_r($data_dokter);
//                echo '</pre>';
//                echo '<pre>';
//                print_r($sql_konsul);
//                echo '</pre>';
            }
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }
        
    public function set_konsul_hapus() {
        if (akses::aksesLogin() == TRUE) {
            $id         = $this->input->get('id');
            $status     = $this->input->get('status');
            $act        = $this->input->get('act');
            $userid     = $this->ion_auth->user()->row()->id;
            
            $sql_konsul = $this->db->where('id', general::dekrip($id))->get('tbl_trans_konsul');
            
            if($sql_konsul->num_rows() > 0){
                /* Transaksi Database */
                $this->db->trans_begin();
                
                # Hapus ke tabel konsultasi
                $this->db->where('id_parent', general::dekrip($id))->delete('tbl_trans_konsul');
                $this->db->where('id', general::dekrip($id))->delete('tbl_trans_konsul');

                # Cek status transact MySQL
                if ($this->db->trans_status() === FALSE) {
                    # Rollback jika gagal
                    $this->db->trans_rollback();

                    # Tampilkan pesan error
                    $this->session->set_flashdata('medcheck_toast', 'toastr.error("Thread gagal dihapus !");');
                } else {
                    $this->db->trans_commit();

                    # Tampilkan pesan sukses jika sudah berhasil commit
                    $this->session->set_flashdata('medcheck_toast', 'toastr.success("Thread berhasil dihapus !");');
                }
            }else{
                # Tampilkan pesan error
                $this->session->set_flashdata('medcheck_toast', 'toastr.error("Thread tidak ditemukan !");');
            }

            redirect(base_url('medcheck/data_konsul.php'));
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }

    public function cart_medcheck_simpan() {
        if (akses::aksesLogin() == TRUE) {
            $id         = $this->input->post('id');
            $id_lab     = $this->input->post('id_lab');
            $id_lab_kat = $this->input->post('id_lab_kat');
            $id_rad     = $this->input->post('id_rad');
            $id_item    = $this->input->post('id_item');
            $id_dokter  = $this->input->post('id_dokter');
            $id_resep   = $this->input->post('id_resep');
            $tgl_masuk  = $this->input->post('tgl_masuk');
            $hrg        = $this->input->post('harga');
            $jml        = $this->input->post('jml');
            $diskon1    = $this->input->post('disk1');
            $diskon2    = $this->input->post('disk2');
            $diskon3    = $this->input->post('disk3');
            $pot        = $this->input->post('potongan');
            $keterangan = $this->input->post('keterangan');
            $hasil      = $this->input->post('hasil_lab');
            $status     = $this->input->post('status');
            $status_hsl = $this->input->post('status_hsl');
            $status_itm = $this->input->post('status_item');
            $act        = $this->input->post('act');
            $rute       = $this->input->post('route');
            
            $this->form_validation->set_error_delimiters('<div class="alert alert-danger">', '</div>');

            $this->form_validation->set_rules('id', 'ID', 'required');
            $this->form_validation->set_rules('id_item', 'Kode', 'required');
            $this->form_validation->set_rules('harga', 'Harga', 'required');
            $this->form_validation->set_rules('jml', 'Jml', 'required|greater_than[0]');
            
            $this->form_validation->set_message('greater_than', 'Harap gunakan menu retur. Kolom %s harus lebih besar dari 0');        
            
            if ($this->form_validation->run() == FALSE) {
                $msg_error = array(
                    'id'        => form_error('id'),
                    'kode'      => form_error('id_item'),
                    'harga'     => form_error('harga'),
                    'jml'       => form_error('jml'),
                );

                $this->session->set_flashdata('form_error', $msg_error);
                $this->session->set_flashdata('jml', $jml);
                
                redirect(base_url('medcheck/tambah.php?id='.$id.'&status='.$status.'&id_produk='.$id_item.'&harga='.(float)$hrg));
            } else {
                $sql_medc   = $this->db->where('id', general::dekrip($id))->get('tbl_trans_medcheck')->row();
                $sql_item   = $this->db->where('id', general::dekrip($id_item))->get('tbl_m_produk')->row();
                $sql_medc_ck= $this->db->where('id_medcheck', general::dekrip($id))->where('id_item', general::dekrip($id_item))->get('tbl_trans_medcheck_det');
                $sql_radg_ck= $this->db->where('id_medcheck', general::dekrip($id))->get('tbl_trans_medcheck_rad');
                $sql_sat    = $this->db->where('id', $sql_item->id_satuan)->get('tbl_m_satuan')->row();
                $harga      = general::format_angka_db($hrg);
                $potongan   = general::format_angka_db($pot);
                $jml_pot    = $potongan * $jml;
                $dokter     = (!empty($id_dokter) ? $id_dokter : $sql_medc->id_dokter);
                
                $disk1      = $harga - (($diskon1 / 100) * $harga);
                $disk2      = $disk1 - (($diskon2 / 100) * $disk1);
                $disk3      = $disk2 - (($diskon3 / 100) * $disk2);
                $diskon     = $harga - $disk3;
                $subtotal   = ($disk3 - $potongan) * (int)$jml;

                $data = array(
                    'tgl_simpan'    => (!empty($tgl_masuk) ? $this->tanggalan->tgl_indo_sys($tgl_masuk).' '.date('H:i:s') : date('Y-m-d H:i:s')),
                    'tgl_modif'     => date('Y-m-d H:i:s'),
                    'tgl_masuk'     => (!empty($tgl_masuk) ? $this->tanggalan->tgl_indo_sys($tgl_masuk).' '.date('H:i:s') : date('Y-m-d H:i:s')),
                    'id_medcheck'   => (int)$sql_medc->id,
                    'id_item'       => (int)$sql_item->id,
                    'id_item_kat'   => (int)$sql_item->id_kategori,
                    'id_item_sat'   => (int)$sql_item->id_satuan,
                    'id_user'       => (int)$this->ion_auth->user()->row()->id,
                    'id_dokter'     => (int)$dokter,
                    'id_lab'        => (int)general::dekrip($id_lab),
                    'id_lab_kat'    => (int)general::dekrip($id_lab_kat),
                    'id_rad'        => (int)general::dekrip($id_rad),
                    'kode'          => $sql_item->kode,
                    'item'          => $sql_item->produk,
                    'keterangan'    => $keterangan,
                    'hasil_lab'     => $hasil,
                    'harga'         => $harga,
                    'jml'           => (int)$jml,
                    'jml_satuan'    => '1',
                    'satuan'        => $sql_sat->satuanTerkecil,
                    'disk1'         => (float)$diskon1,
                    'disk2'         => (float)$diskon2,
                    'disk3'         => (float)$diskon3,
                    'diskon'        => (float)$diskon,
                    'potongan'      => (float)general::format_angka_db($jml_pot),
                    'subtotal'      => (float)$subtotal,
                    'status'        => (!empty($status_itm) ? $status_itm : $sql_item->status),
                    'status_hsl'    => (!empty($status_hsl) ? $status_hsl : '0'),
                );  
                
                # Cek apakah sudah di posting atau belum ?
                # Kalau sudah yg bisa input hny rad, lab, dokter
                if($sql_medc->status < 5){
                    # Start Transact SQL
                    $this->db->trans_off();
                    $this->db->trans_start();
                    
                    # Simpan pada tabel medcheck det
                    $this->db->insert('tbl_trans_medcheck_det', $data);

                    $this->db->trans_complete();
                    
                    $this->session->set_flashdata('medcheck', '<div class="alert alert-success">Data item sudah disimpan !!</div>');                    
                }else{
                    
                    if(akses::hakSA() == TRUE OR akses::hakOwner() == TRUE OR akses::hakRad() == TRUE OR akses::hakAnalis() == TRUE){
                        # Start Transact SQL
                        $this->db->trans_off();
                        $this->db->trans_start();
                    
                        # Simpan pada tabel medcheck det
                        $this->db->insert('tbl_trans_medcheck_det', $data);

                        $this->db->trans_complete();
                    
                        $this->session->set_flashdata('medcheck_toast', 'toastr.success("Entri data berhasil !");');
//                        $this->session->set_flashdata('medcheck', '<div class="alert alert-success">Data item sudah disimpan !!</div>');   
                    }else{
                        $this->session->set_flashdata('medcheck', '<div class="alert alert-danger">Transaksi ini sudah diposting, sehingga tidak di perbolehkan menambah entrian</div>');
                    }
                }
                
                redirect(base_url('medcheck/tambah.php?'.(!empty($act) ? 'act='.$act.'&' : '').'id='.$id.(!empty($id_lab) ? '&id_lab='.$id_lab : '').(!empty($id_rad) ? '&id_rad='.$id_rad : '').(!empty($id_resep) ? '&id_resep='.$id_resep : '').'&status='.$status.(!empty($rute) ? '&route='.$rute : '')));
               
//                echo '<pre>';
//                print_r($data);
//                echo '</pre>';
            }
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }      

    public function cart_medcheck_retur_ranap() {
        if (akses::aksesLogin() == TRUE) {
            $id         = $this->input->post('id');
            $id_item    = $this->input->post('id_item');
            $id_produk  = $this->input->post('id_produk');
            $no_urut    = $this->input->post('no_urut');
            $jml        = $this->input->post('jml');
            $status     = $this->input->post('status');
            $status_hsl = $this->input->post('status_hsl');
            $status_itm = $this->input->post('status_item');
            $act        = $this->input->post('act');
            $rute       = $this->input->post('route');
            
            $this->form_validation->set_error_delimiters('<div class="alert alert-danger">', '</div>');

            $this->form_validation->set_rules('id', 'ID', 'required');
            $this->form_validation->set_rules('id_item', 'Kode', 'required');
            $this->form_validation->set_rules('jml', 'Jml', 'required|greater_than[0]');

            if ($this->form_validation->run() == FALSE) {
                $msg_error = array(
                    'id'    => form_error('id'),
                    'kode'  => form_error('id_item'),
                    'jml'   => form_error('jml')
                );

                $this->session->set_flashdata('form_error', $msg_error);

                redirect(base_url('medcheck/retur.php?id='.$id.'&item_id='.$id_item.'&id_produk='.$id_item));
            } else {
                $sql_medc       = $this->db->where('id', general::dekrip($id))->get('tbl_trans_medcheck')->row();
                $sql_medc_det   = $this->db->where('id', general::dekrip($id_item))->get('tbl_trans_medcheck_det')->row();
                $sql_item       = $this->db->where('id', general::dekrip($id_produk))->get('tbl_m_produk')->row();
                $sql_sat        = $this->db->where('id', $sql_item->id_satuan)->get('tbl_m_satuan')->row();
                $jml_akhir      = $sql_medc_det->jml - $jml;
                
                $disk1          = $sql_medc_det->harga - (($sql_medc_det->disk1 / 100) * $sql_medc_det->harga);
                $disk2          = $disk1 - (($sql_medc_det->disk2 / 100) * $disk1);
                $disk3          = $disk2 - (($sql_medc_det->disk3 / 100) * $disk2);
                $diskon         = $sql_medc_det->harga - $disk3;
                $subtotal       = ($disk3 - $sql_medc_det->potongan) * (int)$jml_akhir;
                
                $data = array(
                    'tgl_simpan'        => date('Y-m-d H:i:s'),
                    'id_medcheck'       => (int)$sql_medc->id,
                    'id_medcheck_det'   => (int)$sql_medc_det->id,
                    'id_pasien'         => (int)$sql_medc->id_pasien,
                    'id_item'           => (int)$sql_item->id,
                    'id_user'           => (int)$this->ion_auth->user()->row()->id,
                    'kode'              => $sql_item->kode,
                    'item'              => $sql_item->produk,
                    'jml'               => (int)$jml,
                    'status_item'       => (!empty($status_itm) ? $status_itm : $sql_item->status),
                );
                
                $data_det = array(
                    'tgl_modif'         => date('Y-m-d H:i:s'),
                    'jml'               => (int)$jml_akhir,
                    'subtotal'		=> $subtotal
                );

                if($jml_akhir < 0){
                    # Gagal Return
                    $this->session->set_flashdata('medcheck', '<div class="alert alert-danger">Item <b>'.$sql_item->produk.'</b> pada no '.$no_urut.', maksimal retur hanya <b>'.(float)$sql_medc_det->jml.'</b> !!</div>');
                }else{
                    # Start Transact SQL
                    $this->db->trans_off();
                    $this->db->trans_start();

                    # Kurangi Jumlah yang ada di medcheck det
                    $this->db->where('id', $sql_medc_det->id)->update('tbl_trans_medcheck_det', $data_det);

                    # Masukkan ke table retur
                    $this->db->insert('tbl_trans_medcheck_retur', $data);

                    $this->db->trans_complete();
                    
                    if ($this->db->trans_status() === FALSE) {
                        $this->db->trans_rollback();
                        
                        # Retur Gagal
                        $this->session->set_flashdata('medcheck', '<div class="alert alert-danger">Data retur sudah gagal disimpan !!</div>');
                    }else{
                        $this->db->trans_commit();
                        
                        # Success Return
                        $this->session->set_flashdata('medcheck', '<div class="alert alert-success">Data retur sudah disimpan !!</div>');
                    }

                    
                    
                }
                
                redirect(base_url('medcheck/retur.php?id='.$id));
                
                    
//                echo '<pre>';
//                print_r($data);
//                echo '</pre>';
            }
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }      

    // Update Invoice Dari kasir
    public function cart_medcheck_update() {
        if (akses::aksesLogin() == TRUE) {
            $id         = $this->input->post('id');
            $id_lab     = $this->input->post('id_lab');
            $id_item    = $this->input->post('item_id');
            $id_item_det= $this->input->post('item_id_det');
            $id_dokter  = $this->input->post('id_dokter');
            $id_resep   = $this->input->post('id_resep');
            $hrg        = $this->input->post('harga');
            $jml        = $this->input->post('jml');
            $diskon1    = $this->input->post('disk1');
            $diskon2    = $this->input->post('disk2');
            $diskon3    = $this->input->post('disk3');
            $pot        = $this->input->post('potongan');
            $pot_poin   = $this->input->post('potongan_poin');
            $keterangan = $this->input->post('keterangan');
            $hasil      = $this->input->post('hasil_lab');
            $status     = $this->input->post('status');
            $act        = $this->input->post('act');
            $lab_id     = $this->input->post('id_lab');
            
            $this->form_validation->set_error_delimiters('<div class="alert alert-danger">', '</div>');

            $this->form_validation->set_rules('id', 'ID', 'required');
            $this->form_validation->set_rules('item_id', 'Item', 'required');
            $this->form_validation->set_rules('harga', 'Harga', 'required');

            if ($this->form_validation->run() == FALSE) {
                $msg_error = array(
                    'id'        => form_error('id'),
                    'kode'      => form_error('id_item'),
                    'harga'     => form_error('harga')
                );

                $this->session->set_flashdata('form_error', $msg_error);

                redirect(base_url('medcheck/invoice/bayar.php?id='.$id));
            } else {
                $sql_medc       = $this->db->where('id', general::dekrip($id))->get('tbl_trans_medcheck')->row();
                $sql_item       = $this->db->where('id', general::dekrip($id_item))->get('tbl_m_produk')->row();
                $sql_medc_ck    = $this->db->where('id', general::dekrip($id_item_det))->get('tbl_trans_medcheck_det');
                $sql_radg_ck    = $this->db->where('id_medcheck', general::dekrip($id))->get('tbl_trans_medcheck_rad');
                $sql_sat        = $this->db->where('id', $sql_item->id_satuan)->get('tbl_m_satuan')->row();
                $harga          = general::format_angka_db($hrg);
                $potongan       = general::format_angka_db($pot);
                $potongan_poin  = general::format_angka_db($pot_poin);
                $jml_pot        = $potongan * $jml;
                $jml_pot_poin   = $potongan_poin;
                $dokter         = (!empty($id_dokter) ? $id_dokter : $sql_medc->id_dokter);

                $sql_cek_remun  = $this->db
                                       ->where('id_medcheck', $sql_medc->id)
                                       ->where('id_medcheck_det', $sql_medc_ck->row()->id)
                                       ->where('id_dokter', $sql_medc_ck->row()->id_dokter)
                                       ->where('id_item', $sql_item->id)
                                       ->get('tbl_trans_medcheck_remun');

                $sql_cek_apres  = $this->db
                                       ->where('id_medcheck', $sql_medc->id)
                                       ->where('id_medcheck_det', $sql_medc_ck->row()->id)
                                       ->where('id_dokter', $sql_medc_ck->row()->id_dokter)
                                       ->where('id_item', $sql_item->id)
                                       ->get('tbl_trans_medcheck_apres');
                
                $disk1      = $harga - (($diskon1 / 100) * $harga);
                $disk2      = $disk1 - (($diskon2 / 100) * $disk1);
                $disk3      = $disk2 - (($diskon3 / 100) * $disk2);
                $diskon     = ($harga - $disk3) * $jml;
                $subtotal   = (($disk3 - $potongan) * (int)$jml) - $potongan_poin;
                
                $data = array(
                    'tgl_modif'     => date('Y-m-d H:i:s'),
                    'kode'          => $sql_item->kode,
                    'item'          => $sql_item->produk,
                    'harga'         => $harga,
                    'jml'           => (int)$jml,
                    'jml_satuan'    => '1',
                    'satuan'        => $sql_sat->satuanTerkecil,
                    'disk1'         => (float)$diskon1,
                    'disk2'         => (float)$diskon2,
                    'disk3'         => (float)$diskon3,
                    'diskon'        => (float)$diskon,
                    'potongan'      => (float)general::format_angka_db($jml_pot),
//                    'potongan_poin' => (float)general::format_angka_db($jml_pot_poin),
                    'subtotal'      => (float)$subtotal,
                );
                
                if($sql_medc_ck->num_rows() > 0){
                    $last_id = $sql_medc_ck->row()->id;
                    crud::update('tbl_trans_medcheck_det', 'id', $last_id, $data);
                }else{
                    crud::simpan('tbl_trans_medcheck_det', $data);
                    $last_id = crud::last_id();
                }
                
                
                # Cek Remun dahulu
                if($sql_cek_remun->num_rows() > 0){
                    # Tentukan remun tipenya dan hitung total remunnya
                    $remun      = ($sql_item->remun_tipe == '2' ? $sql_item->remun_nom : (($sql_item->remun_perc / 100) * $subtotal));
                    $remun_tot  = ($remun * $sql_medc_ck->row()->jml) - $diskon - general::format_angka_db($jml_pot);
                    
                    $data_remun = array(
                        'harga'             => $subtotal,
                        'remun_subtotal'    => $remun_tot,
                    );
                    
                    # Update Remun
                    $this->db->where('id', $sql_cek_remun->row()->id)->update('tbl_trans_medcheck_remun', $data_remun);
                }
                
                # Cek Apres dahulu
                if($sql_cek_apres->num_rows() > 0){
                    # Tentukan apres tipenya dan hitung total remunnya
                    $apres      = ($sql_item->remun_tipe == '2' ? $sql_item->apres_nom : (($sql_item->apres_perc / 100) * $subtotal));
                    $apres_tot  = ($apres * $sql_medc_ck->row()->jml) - $diskon - general::format_angka_db($jml_pot);
                    
                    $data_apres = array(
                        'harga'             => $subtotal,
                        'apres_subtotal'    => $apres_tot,
                    );
                    
                    # Update Apres
                    $this->db->where('id', $sql_cek_apres->row()->id)->update('tbl_trans_medcheck_apres', $data_apres);
                }
                
                
                // Update price di total penjualan
                $sql_medc_det_sum   = $this->db->select('SUM(diskon) AS diskon, SUM(potongan) AS potongan, SUM(subtotal) AS subtotal')->where('id_medcheck', $sql_medc->id)->get('tbl_trans_medcheck_det')->row();
                $jml_total          = $sql_medc_det_sum->subtotal + $sql_medc_det_sum->diskon + $sql_medc_det_sum->potongan;
                $jml_diskon         = $sql_medc_det_sum->diskon;
                $jml_potongan       = $sql_medc_det_sum->potongan;
//                $diskon         = (($sql_medc_det_sum->potongan + $sql_medc_det_sum->diskon) / $sql_medc_det_sum->subtotal) * 100;
                $diskon             = (($sql_medc->jml_total - $sql_medc_det_sum->subtotal) / $sql_medc->jml_total) * 100;
                $jml_gtotal         = $sql_medc->jml_total - $jml_diskon - $jml_potongan;
                        
                $data_medc_tot = array(
                    'jml_diskon'    => $jml_diskon,
                    'jml_potongan'  => $jml_potongan,
                    'jml_subtotal'  => (float)$jml_gtotal,
                    'jml_gtotal'    => (float)$jml_gtotal,
                );
                
                crud::update('tbl_trans_medcheck', 'id', $sql_medc->id, $data_medc_tot);
                redirect(base_url('medcheck/invoice/bayar.php?id='.$id));
                
//                echo '<pre>';
//                print_r($data_apres);
//                echo '</pre>';                
//                echo '<pre>';
//                print_r($data);
//                echo '</pre>';                
                
            }
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }      

    public function cart_medcheck_resep() {
        if (akses::aksesLogin() == TRUE) {
            $id         = $this->input->post('id');
            $id_resep   = $this->input->post('id_resep');
            $id_item    = $this->input->post('id_item');
            $id_dokter  = $this->input->post('id_dokter');
            $hrg        = $this->input->post('harga');
            $jml        = $this->input->post('jml');
            $diskon1    = $this->input->post('disk1');
            $diskon2    = $this->input->post('disk2');
            $diskon3    = $this->input->post('disk3');
            $pot        = $this->input->post('potongan');
            $keterangan = $this->input->post('keterangan');
            $hasil      = $this->input->post('hasil_lab');
            $status     = $this->input->post('status');
            $dos_jml1   = $this->input->post('dos_jml1');
            $dos_jml2   = $this->input->post('dos_jml2');
            $dos_sat    = $this->input->post('dos_sat');
            $dos_wkt    = $this->input->post('dos_wkt');
            $dos_ket    = $this->input->post('dos_ket');
            $act        = $this->input->post('act');
            
            $this->form_validation->set_error_delimiters('<div class="alert alert-danger">', '</div>');

            $this->form_validation->set_rules('id', 'ID', 'required');
            $this->form_validation->set_rules('id_item', 'Kode', 'required');
            $this->form_validation->set_rules('harga', 'Harga', 'required');

            if ($this->form_validation->run() == FALSE) {
                $msg_error = array(
                    'id'        => form_error('id'),
                    'kode'      => form_error('id_item'),
                    'harga'     => form_error('harga'),
                );

                $this->session->set_flashdata('form_error', $msg_error);

                redirect(base_url('medcheck/tambah.php?id='.$id));
            } else {
                $sql_medc   = $this->db->where('id', general::dekrip($id))->get('tbl_trans_medcheck')->row();
                $sql_item   = $this->db->where('id', general::dekrip($id_item))->get('tbl_m_produk')->row();
                $sql_sat    = $this->db->where('id', $sql_item->id_satuan)->get('tbl_m_satuan')->row();
                $sql_sat_pk = $this->db->where('id', $dos_sat)->get('tbl_m_satuan_pakai')->row();
                $harga      = general::format_angka_db($hrg);
                $potongan   = general::format_angka_db($pot);
                $dokter     = (!empty($id_dokter) ? $id_dokter : $sql_medc->id_dokter);
                
                $disk1      = $harga - (($diskon1 / 100) * $harga);
                $disk2      = $disk1 - (($diskon2 / 100) * $disk1);
                $disk3      = $disk2 - (($diskon3 / 100) * $disk2);
                $diskon     = $harga - $disk3;
                $subtotal   = ($disk3 - $potongan) * (int)$jml;
                
                $keranjang = array(
                    'id'      => rand(1,1024).$sql_item->id,
                    'qty'     => (int)$jml,
                    'price'   => (!empty($disk3) ? $disk3 : 0),
                    'name'    => str_replace(array('\'','\\','/'), ' ', $sql_item->produk),
                    'options' => array(
                        'id_medcheck'   => (int)$sql_medc->id,
                        'id_item'       => (int)$sql_item->id,
                        'id_item_kat'   => (int)$sql_item->id_kategori,
                        'id_item_sat'   => (int)$sql_item->id_satuan,
                        'id_user'       => (int)$this->ion_auth->user()->row()->id,
                        'id_dokter'     => (int)$dokter,
                        'tgl_simpan'    => date('Y-m-d H:i:s'),
                        'kode'          => $sql_item->kode,
                        'jml'           => (int)$jml,
                        'jml_satuan'    => '1',
                        'satuan'        => $sql_sat->satuanTerkecil,
                        'harga'         => general::format_angka_db($harga),
                        'disk1'         => (float)$diskon1,
                        'disk2'         => (float)$diskon2,
                        'disk3'         => (float)$diskon3,
                        'potongan'      => (float)$potongan,
                        'dos_jml1'      => $dos_jml1,
                        'dos_sat'       => $sql_sat_pk->satuan,
                        'dos_jml2'      => $dos_jml2,
                        'dos_wkt'       => general::tipe_obat_pakai($dos_wkt),
                        'dos_ket'       => $dos_ket,
                    )
                );

                $this->cart->insert($keranjang);
                redirect(base_url('medcheck/tambah.php?id='.$id.(!empty($id_resep) ? '&id_resep='.$id_resep : '').(!empty($act) ? '&act='.$act : '').'&status='.$status));
//
//                echo '<pre>';
//                print_r($keranjang);
//                echo '</pre>';
            }
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }    

    public function cart_medcheck_resep_upd1() {
        if (akses::aksesLogin() == TRUE) {
            $id         = $this->input->post('id');
            $id_resep   = $this->input->post('id_resep');
            $id_item    = $this->input->post('id_item');
            $id_dokter  = $this->input->post('id_dokter');
            $hrg        = $this->input->post('harga');
            $jml        = $this->input->post('jml');
            $diskon1    = $this->input->post('disk1');
            $diskon2    = $this->input->post('disk2');
            $diskon3    = $this->input->post('disk3');
            $pot        = $this->input->post('potongan');
            $keterangan = $this->input->post('keterangan');
            $hasil      = $this->input->post('hasil_lab');
            $dos_jml1   = $this->input->post('dos_jml1');
            $dos_jml2   = $this->input->post('dos_jml2');
            $dos_sat    = $this->input->post('dos_sat');
            $dos_wkt    = $this->input->post('dos_wkt');
            $dos_ket    = $this->input->post('dos_ket');
            $act        = $this->input->post('act');
            $ed         = $this->input->post('ed');
            $ket        = $this->input->post('keterangan');
            $status     = $this->input->post('status');
            $status_mkn = $this->input->post('status_mkn');
            $status_et  = $this->input->post('status_etiket');
            $status_res = $this->input->post('tipe');
            
            $this->form_validation->set_error_delimiters('<div class="alert alert-danger">', '</div>');

            $this->form_validation->set_rules('id', 'ID', 'required');
            $this->form_validation->set_rules('kode', 'Kode', 'required');
            $this->form_validation->set_rules('harga', 'Harga', 'required');
            $this->form_validation->set_rules('jml', 'Jml', 'required|greater_than[0]');
            
            $this->form_validation->set_message('greater_than', 'Harap gunakan menu retur. Kolom %s harus lebih besar dari 0'); 

            if ($this->form_validation->run() == FALSE) {
                $msg_error = array(
                    'id'        => form_error('id'),
                    'kode'      => form_error('kode'),
                    'harga'     => form_error('harga'),
                    'jml'       => form_error('jml'),
                );

                $this->session->set_flashdata('form_error', $msg_error);

                redirect(base_url('medcheck/resep/tambah.php?id='.$id.'&id_resep='.$id_resep.'&status='.$status.'&id_item='.$id_item.'&harga='.$hrg));
            } else {
                $sql_medc   = $this->db->where('id', general::dekrip($id))->get('tbl_trans_medcheck')->row();
                $sql_pnjm   = $this->db->where('id', $sql_medc->tipe_bayar)->get('tbl_m_penjamin')->row();
                $sql_item   = $this->db->where('id', general::dekrip($id_item))->get('tbl_m_produk')->row();
                $sql_sat    = $this->db->where('id', $sql_item->id_satuan)->get('tbl_m_satuan')->row();
                $sql_sat_pk = $this->db->where('id', $dos_sat)->get('tbl_m_satuan_pakai')->row();
                $harga      = general::format_angka_db($hrg);
                $ass        = $harga * $sql_pnjm->persen;
                $harga_tot  = ($sql_item->status_racikan == '1' ? $harga : ($sql_pnjm->persen != 0 ? $ass : $harga)); # Jika penjamin asuransi, maka harga obat di tambah sesuai setelan % pada database
                $potongan   = general::format_angka_db($pot);
                $dokter     = (!empty($id_dokter) ? $id_dokter : $sql_medc->id_dokter);
                
                $disk1      = $harga_tot - (($diskon1 / 100) * $harga_tot);
                $disk2      = $disk1 - (($diskon2 / 100) * $disk1);
                $disk3      = $disk2 - (($diskon3 / 100) * $disk2);
                $diskon     = $harga_tot - $disk3;
                $subtotal   = ($disk3 - $potongan) * (int)$jml;

                $data_resep = array(
                    'id_medcheck'   => (int)$sql_medc->id,
                    'id_resep'      => (int)general::dekrip($id_resep),
                    'id_item'       => (int)$sql_item->id,
                    'id_item_kat'   => (int)$sql_item->id_kategori,
                    'id_item_sat'   => (int)$sql_item->id_satuan,
                    'id_user'       => $this->ion_auth->user()->row()->id,
                    'tgl_simpan'    => date('Y-m-d H:i:s'),
                    'tgl_modif'     => date('Y-m-d H:i:s'),
//                    'tgl_ed'        => (!empty($ed) ? $this->tanggalan->tgl_indo_sys($ed) : '0000-00-00'),
                    'kode'          => $sql_item->kode,
                    'item'          => $sql_item->produk,
                    'dosis'         => (!empty($dos_jml1) ? $dos_jml1.' '.$sql_sat_pk->satuan.' Tiap '.$dos_jml2.' '.general::tipe_obat_pakai($dos_wkt) : ''),
                    'dosis_ket'     => $dos_ket,
                    'keterangan'    => $ket,
                    'harga'         => (!empty($disk3) ? round($disk3) : 0),
                    'jml'           => (int)$jml,
                    'jml_satuan'    => '1',
                    'satuan'        => $sql_sat->satuanTerkecil,
                    'status'        => (int)$status,
                    'status_resep'  => '0',
                    'status_pj'     => ($ass > 0 ? '1' : '0'),
                    'status_mkn'    => (!empty($status_mkn) ? $status_mkn : '0'),
                    'status_etiket' => (!empty($status_et) ? $status_et : '0'),
                );
                
                if($sql_medc->status < 5){
                    # Transactional database
                    $this->db->query('SET autocommit = 0;');
                    $this->db->trans_start();
                
                    # Simpan ke tabel resep
                    $this->db->insert('tbl_trans_medcheck_resep_det', $data_resep);
                
                    # Complete
                    $this->db->trans_complete();
                    
                    $this->session->set_flashdata('medcheck_toast', 'toastr.success("Data item berhasil disimpan !!")');
                }
                                
                redirect(base_url('medcheck/tambah.php?'.(!empty($act) ? 'act='.$act.'&' : '').'id='.$id.'&id_resep='.$id_resep.'&status='.$status));

//                echo '<pre>';
//                print_r($data_resep);
//                echo '</pre>';
//                echo '<pre>';
//                print_r($keranjang);
//                echo '</pre>';
            }
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }    

    public function cart_medcheck_resep_upd2() {
        if (akses::aksesLogin() == TRUE) {
            $id         = $this->input->post('id');
            $id_resep   = $this->input->post('id_resep');
            $id_item    = $this->input->post('id_item_resep');
            $id_dokter  = $this->input->post('id_dokter');
            $hrg        = $this->input->post('harga');
            $jml        = $this->input->post('jml');
            $diskon1    = $this->input->post('disk1');
            $diskon2    = $this->input->post('disk2');
            $diskon3    = $this->input->post('disk3');
            $pot        = $this->input->post('potongan');
            $keterangan = $this->input->post('keterangan');
            $hasil      = $this->input->post('hasil_lab');
            $status     = $this->input->post('status');
            $dos_jml1   = $this->input->post('dos_jml1');
            $dos_jml2   = $this->input->post('dos_jml2');
            $dos_sat    = $this->input->post('dos_sat');
            $dos_wkt    = $this->input->post('dos_wkt');
            $dos_ket    = $this->input->post('dos_ket');
            $act        = $this->input->post('act');
            $status_res = $this->input->post('tipe');
            $ed         = $this->input->post('ed');
            $ket        = $this->input->post('keterangan');
            $status_mkn = $this->input->post('status_mkn');
            
            $this->form_validation->set_error_delimiters('<div class="alert alert-danger">', '</div>');

            $this->form_validation->set_rules('id', 'ID', 'required');
            $this->form_validation->set_rules('kode', 'Kode', 'required');
            $this->form_validation->set_rules('harga', 'Harga', 'required');

            if ($this->form_validation->run() == FALSE) {
                $msg_error = array(
                    'id'        => form_error('id'),
                    'kode'      => form_error('kode'),
                    'harga'     => form_error('harga'),
                );

                $this->session->set_flashdata('form_error', $msg_error);

                redirect(base_url('medcheck/tambah.php?id='.$id));
            } else {
                $sql_medc   = $this->db->where('id', general::dekrip($id))->get('tbl_trans_medcheck')->row();
                $sql_res_rw = $this->db->where('id', general::dekrip($id_item))->get('tbl_trans_medcheck_resep_det')->row();
                $sql_item   = $this->db->where('id', $sql_res_rw->id_item)->get('tbl_m_produk')->row();
                $sql_sat    = $this->db->where('id', $sql_item->id_satuan)->get('tbl_m_satuan')->row();
                $sql_sat_pk = $this->db->where('id', $dos_sat)->get('tbl_m_satuan_pakai')->row();
                $harga      = general::format_angka_db($hrg);
                $ass        = $harga * $sql_pnjm->persen;
                $harga_tot  = ($sql_item->status_racikan == '1' ? $harga : ($sql_pnjm->persen != 0 ? $ass : $harga)); # Jika penjamin asuransi, maka harga obat di tambah sesuai setelan % pada database
                $potongan   = general::format_angka_db($pot);
                $dokter     = (!empty($id_dokter) ? $id_dokter : $sql_medc->id_dokter);
                
                $disk1      = $harga_tot - (($diskon1 / 100) * $harga_tot);
                $disk2      = $disk1 - (($diskon2 / 100) * $disk1);
                $disk3      = $disk2 - (($diskon3 / 100) * $disk2);
                $diskon     = $harga - $disk3;
                $subtotal   = ($disk3 - $potongan) * (int)$jml;
                
                $data_resep = array(
//                    'tgl_ed'        => (!empty($ed) ? $this->tanggalan->tgl_indo_sys($ed) : '0000-00-00'),
                    'jml'           => (int)$jml,
                    'dosis'         => (!empty($dos_jml1) ? $dos_jml1.' '.$sql_sat_pk->satuan.' Tiap '.$dos_jml2.' '.general::tipe_obat_pakai($dos_wkt) : ''),
                    'dosis_ket'     => $dos_ket,
                    'keterangan'    => $ket,
                    'status_mkn'    => (!empty($status_mkn) ? $status_mkn : '0'),
                    'status_resep'  => (int)$status_res, 
                );
                
                # Transactional database
                $this->db->trans_start();
                
                # Update ke tabel resep
                $this->db->where('id', $sql_res_rw->id)->update('tbl_trans_medcheck_resep_det', $data_resep);
                
                # Complete
                $this->db->trans_complete();
                
                $this->session->set_flashdata('medcheck_toast', 'toastr.success("Data item berhasil disimpan !!")');
                redirect(base_url('medcheck/tambah.php?'.(!empty($act) ? 'act=res_input&' : '').'id='.$id.'&id_resep='.$id_resep.'&status='.$status));

//                echo $sql_res_rw->id;
//                echo '<pre>';
//                print_r($data_resep);
//                echo '</pre>';
            }
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }    

    public function cart_medcheck_resep_hapus() {
        if (akses::aksesLogin() == TRUE) {
            $id         = $this->input->get('id');
            $id_resep   = $this->input->get('id_resep');
            $id_item    = $this->input->get('id_item');
            $status     = $this->input->get('status');
            
            if(!empty($id_item)){
                $cart = array(
                    'rowid' => $id_item,
                    'qty'   => '0'
                );
                $this->cart->update($cart);
            }            
            
            redirect(base_url('medcheck/tambah.php?id='.$id.(!empty($id_resep) ? '&id_resep='.$id_resep : '').'&status='.$status));
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }  

    public function cart_medcheck_resep_item_hapus() {
        if (akses::aksesLogin() == TRUE) {
            $id         = $this->input->get('id');
            $id_resep   = $this->input->get('id_resep');
            $id_item    = $this->input->get('id_item');
            $status     = $this->input->get('status');
            
            if(!empty($id_item)){                
                crud::delete('tbl_trans_medcheck_resep_det', 'id', general::dekrip($id_item));
                
                $this->session->set_flashdata('medcheck_toast', "toastr.error('Item sudah terhapus')");
            }
            
            redirect(base_url('medcheck/tambah.php?act=res_input&id='.$id.(!empty($id_resep) ? '&id_resep='.$id_resep : '').'&status='.$status));
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }  
    
    public function cart_medcheck_resep_rc() {
        if (akses::aksesLogin() == TRUE) {
            $id             = $this->input->post('id');
            $id_resep       = $this->input->post('id_resep');
            $id_resep_det   = $this->input->post('id_resep_det');
            $id_item        = $this->input->post('id_item');
            $id_item_rc     = $this->input->post('id_item_rc');
            $id_dokter      = $this->input->post('id_dokter');
            $hrg            = $this->input->post('harga');
            $jml            = $this->input->post('jml');
            $diskon1        = $this->input->post('disk1');
            $diskon2        = $this->input->post('disk2');
            $diskon3        = $this->input->post('disk3');
            $pot            = $this->input->post('potongan');
            $keterangan     = $this->input->post('keterangan');
            $hasil          = $this->input->post('hasil_lab');
            $status         = $this->input->post('status');
            $satuan         = $this->input->post('satuan');
            $dos_jml1       = $this->input->post('dos_jml1');
            $dos_jml2       = $this->input->post('dos_jml2');
            $dos_sat        = $this->input->post('dos_sat');
            $dos_wkt        = $this->input->post('dos_wkt');
            $dos_ket        = $this->input->post('dos_ket');
            $act            = $this->input->post('act');
            $status_res     = $this->input->post('tipe');
            
            $this->form_validation->set_error_delimiters('<div class="alert alert-danger">', '</div>');

            $this->form_validation->set_rules('id', 'ID', 'required');
            $this->form_validation->set_rules('kode', 'Kode', 'required');

            if ($this->form_validation->run() == FALSE) {
                $msg_error = array(
                    'id'    => form_error('id'),
                    'kode'  => form_error('kode'),
                );

                $this->session->set_flashdata('form_error', $msg_error);

                redirect(base_url('medcheck/tambah.php?act=res_input_rc&id='.$id.'&id_resep='.$id_resep.'&status='.$status.'&id_produk='.$id_item.'&item_id='.$id_item_rc));
            } else {
//                $sql_item   = $this->db->where('id', general::dekrip($id_item))->get('tbl_m_produk')->row();
                $sql_item_rc= $this->db->where('id', general::dekrip($id_item_rc))->get('tbl_m_produk')->row();
                $sql_medc   = $this->db->where('id', general::dekrip($id))->get('tbl_trans_medcheck')->row();
                $sql_medc_rs= $this->db->where('id', general::dekrip($id))->get('tbl_trans_medcheck_resep')->row();
                $sql_medc_dt= $this->db->where('id', general::dekrip($id_item))->get('tbl_trans_medcheck_resep_det')->row();
                $sql_pnjm   = $this->db->where('id', $sql_medc->tipe_bayar)->get('tbl_m_penjamin')->row();
                $sql_sat    = $this->db->where('id', $sql_item_rc->id_satuan)->get('tbl_m_satuan')->row();
                $sql_sat_pk = $this->db->where('id', $dos_sat)->get('tbl_m_satuan_pakai')->row();
                $harga      = general::format_angka_db($hrg);
                $ass        = $harga * $sql_pnjm->persen;
                $harga_tot  = ($sql_pnjm->persen != 0 ? $ass : $harga); # Jika penjamin asuransi, maka harga obat di tambah sesuai setelan % pada database
                $potongan   = general::format_angka_db($pot);
                $dokter     = (!empty($id_dokter) ? $id_dokter : $sql_medc->id_dokter);
                
                $subtotal   = $harga_tot * (float)$jml;
                
                $data_resep = array(
                    'id_medcheck'   => (int)$sql_medc->id,
                    'id_resep'      => (int)general::dekrip($id_resep),
                    'id_resep_det'  => (int)general::dekrip($id_resep_det),
                    'id_item'       => (int)$sql_item_rc->id,
                    'id_item_kat'   => (int)$sql_item_rc->id_kategori,
                    'id_item_sat'   => (int)$sql_item_rc->id_satuan,
                    'id_user'       => $this->ion_auth->user()->row()->id,
                    'tgl_simpan'    => date('Y-m-d H:i:s'),
                    'kode'          => $sql_item_rc->kode,
                    'item'          => $sql_item_rc->produk,
                    'satuan_farmasi'=> $dos_jml1.' '.$sql_sat_pk->satuan,
                    'catatan'       => $dos_ket,
                    'harga'         => (!empty($harga_tot) ? $harga_tot : '0'),
                    'jml'           => (float)$jml,
                    'jml_satuan'    => '1',
                    'subtotal'      => $subtotal,
                    'satuan'        => $sql_sat->satuanTerkecil,
                    'status'        => $sql_item_rc->status,
                );
                
                # Simpan ke tabel resep
                $this->db->insert('tbl_trans_medcheck_resep_det_rc', $data_resep);
                
                //Update racikan
                $sql_sum_rc = $this->db->select('*')->where('id_resep_det', general::dekrip($id_resep_det))->get('tbl_trans_medcheck_resep_det_rc')->result();
                $item_rc    = json_encode($sql_sum_rc);
                crud::update('tbl_trans_medcheck_resep_det', 'id', general::dekrip($id_resep_det), array('resep'=>$item_rc));

                $this->session->set_flashdata('medcheck', 'toastr.success("Item '.$sql_item_rc->produk.' berhasil disimpan")');
                redirect(base_url('medcheck/tambah.php?act=res_input_rc&id='.$id.'&id_resep='.$id_resep.'&status='.$status.'&item_id='.$id_item));
                
//                echo general::dekrip($id_item_rc);
//                echo '<pre>';
//                print_r($data_resep);
//                echo '</pre>';
//                echo '<pre>';
//                print_r($keranjang);
//                echo '</pre>';
//                echo '<pre>';
//                print_r($sql_medc_dt);
//                echo '</pre>';
//                echo '<pre>';
//                print_r($sql_item_rc);
//                echo '</pre>';
//                echo '<pre>';
//                print_r($item_rc);
//                echo '</pre>';
//                echo general::dekrip($id_resep_det);
//                echo '<pre>';
//                print_r($item_rc);
//                echo '</pre>';
            }
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    } 

    public function cart_medcheck_resep_rc_hapus() {
        if (akses::aksesLogin() == TRUE) {
            $id         = $this->input->get('id');
            $id_resep   = $this->input->get('id_resep');
            $id_item    = $this->input->get('item_id');
            $id_item_dt = $this->input->get('item_id_det');
            $status     = $this->input->get('status');
            
            if(!empty($id_item)){
                # Hapus Item Racikannya Dulu
                crud::delete('tbl_trans_medcheck_resep_det_rc', 'id', general::dekrip($id_item));
                
                # Lalu Update Harga Untuk Item Racikan
                $sql_item   = $this->db->where('id', general::dekrip($id_item))->get('tbl_trans_medcheck_resep_det_rc')->row();
                $sql_sum_rc = $this->db->select_sum('harga')->where('id_resep_det', $sql_item->id_resep_det)->get('tbl_trans_medcheck_resep_det_rc')->row();
                $sql_sum_rc2= $this->db->where('id_resep_det', general::dekrip($id_item_dt))->get('tbl_trans_medcheck_resep_det_rc')->result();
                $item_rc    = json_encode($sql_sum_rc2);                
                
                crud::update('tbl_trans_medcheck_resep_det', 'id', general::dekrip($id_item_dt), array('resep'=>$item_rc));
                
                $this->session->set_flashdata('medcheck_toast', 'toastr.error("Item '.strtoupper($sql_item->item).' berhasil dihapus")');
            }
            
            redirect(base_url('medcheck/tambah.php?act=res_input_rc&id='.$id.(!empty($id_resep) ? '&id_resep='.$id_resep : '').'&status='.$status.'&item_id='.$id_item_dt));
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    } 

    public function cart_medcheck_rad() {
        if (akses::aksesLogin() == TRUE) {
            $id         = $this->input->post('id');
            $id_rad     = $this->input->post('id_rad');
            $id_item    = $this->input->post('id_item');
            $id_produk  = $this->input->post('id_produk');
            $id_dokter  = $this->input->post('id_dokter');
            $item_name  = $this->input->post('item_name');
            $item_val   = $this->input->post('item_value');
            $status     = $this->input->post('status');
            $act        = $this->input->post('act');
            
            $this->form_validation->set_error_delimiters('<div class="alert alert-danger">', '</div>');

            $this->form_validation->set_rules('id', 'ID', 'required');

            if ($this->form_validation->run() == FALSE) {
                $msg_error = array(
                    'id'        => form_error('id'),
                );

                $this->session->set_flashdata('form_error', $msg_error);

                redirect(base_url('medcheck/tambah.php?id='.$id));
            } else {
                $sql_medc       = $this->db->where('id', general::dekrip($id))->get('tbl_trans_medcheck')->row();
                $sql_medc_rad   = $this->db->where('id', general::dekrip($id_rad))->get('tbl_trans_medcheck_rad')->row();
                
//                if (!empty($_FILES['fupload']['name'])) {
//                    $file_tmp   = $_FILES['fupload']['tmp_name'];
//                    $file_ext   = $_FILES['fupload']['type']; //pathinfo($_FILES['fupload']['type'], PATHINFO_EXTENSION);
//                    $file_data  = file_get_contents($file_tmp);
//                    $file       = 'data:' . $file_ext . ';base64,' . base64_encode($file_data);
//                    
//                    crud::update('tbl_trans_medcheck_det', 'id', general::dekrip($id_item), array('file_rad'=>$file));
//                }
                
                $data_rad = array(
                    'id_medcheck'       => $sql_medc->id,
                    'id_medcheck_det'   => general::dekrip($id_item),
                    'id_rad'            => $sql_medc_rad->id,
                    'id_radiografer'    => $sql_medc_rad->id_radiografer,
                    'tgl_simpan'        => date('Y-m-d H:i:s'),
                    'tgl_modif'         => date('Y-m-d H:i:s'),
                    'item_name'         => $item_name,
                    'item_value'        => $item_val,
                    'file'              => $file,
                    'status'            => '0',
                );
                
                if($sql_medc->status < 5){
                    # Transaksi Database
                    $this->db->query('SET autocommit = 0;');
                    $this->db->trans_start();
                    
                    # Simpan pada tabel detail radiologi
                    $this->db->insert('tbl_trans_medcheck_rad_det', $data_rad);
                    
                    # Update pada tabel tracer radiologi
                    $this->db->where('id', $sql_medc->id)->update('tbl_trans_medcheck', array('tgl_periksa_rad_baca'=>date('Y-m-d H:i:s')));
                    
                    # Cek status transact MySQL
                    if ($this->db->trans_status() === FALSE) {
                        # Rollback jika gagal
                        $this->db->trans_rollback();

                        # Tampilkan pesan error
                        $this->session->set_flashdata('medcheck', '<div class="alert alert-danger">Data gagal disimpan !!</div>');
                    } else {
//                        $this->db->trans_commit();
                        $this->db->trans_complete();

                        # Buat session jika sudah berhasil commit
                        $this->session->set_userdata('trans_medcheck', $data);

                        # Tampilkan pesan sukses jika sudah berhasil commit
//                        $this->session->set_flashdata('medcheck', '<div class="alert alert-success">Data Medical Checkup Sudah disimpan !!</div>');
                        $this->session->set_flashdata('medcheck_toast', 'toastr.success("Nilai pemeriksaan berhasil di simpan !!");');
                    }
                }else{
                    if(akses::hakRad() == TRUE OR akses::hakAnalis() == TRUE){
                        # Transaksi Database
                        $this->db->query('SET autocommit = 0;');
                        $this->db->trans_start();

                        # Simpan pada tabel detail radiologi
                        $this->db->insert('tbl_trans_medcheck_rad_det', $data_rad);
                        
                        # Update pada tabel tracer radiologi
                        $this->db->where('id', $sql_medc->id)->update('tbl_trans_medcheck', array('tgl_periksa_rad_baca'=>date('Y-m-d H:i:s')));

                        # Cek status transact MySQL
                        if ($this->db->trans_status() === FALSE) {
                            # Rollback jika gagal
                            $this->db->trans_rollback();

                            # Tampilkan pesan error
//                            $this->session->set_flashdata('medcheck', '<div class="alert alert-danger">Data gagal disimpan !!</div>');
                            $this->session->set_flashdata('medcheck_toast', 'toastr.success("Nilai pemeriksaan berhasil di simpan !!");');
                        } else {
//                            $this->db->trans_commit();
                            $this->db->trans_complete();

                            # Buat session jika sudah berhasil commit
                            $this->session->set_userdata('trans_medcheck', $data);

                            # Tampilkan pesan sukses jika sudah berhasil commit
//                            $this->session->set_flashdata('medcheck', '<div class="alert alert-success">Data Medical Checkup Sudah disimpan !!</div>');
                            $this->session->set_flashdata('medcheck_toast', 'toastr.success("Nilai pemeriksaan berhasil di simpan !!");');
                        }
                    }else{
                        $this->session->set_flashdata('medcheck_toast', 'toastr.error("Transaksi ini sudah diposting, sehingga tidak di perbolehkan menambah / mengubah entrian");');
//                        $this->session->set_flashdata('medcheck', '<div class="alert alert-danger">Transaksi ini sudah diposting, sehingga tidak di perbolehkan menambah entrian</div>');
                    } 
                }
                
                
                
                redirect(base_url('medcheck/tambah.php?'.(!empty($act) ? '&act='.$act : '').(!empty($id) ? '&id='.$id : '').(!empty($id_rad) ? '&id_rad='.$id_rad : '').(!empty($status) ? '&status='.$status : '').(!empty($id_item) ? '&id_item='.$id_item : '').(!empty($id_produk) ? '&id_produk='.$id_produk : '')));
                
//                crud::update('tbl_trans_medcheck_det', 'id', general::dekrip($id_item), $data_rad);
//                
//                $sql_medc   = $this->db->where('id', general::dekrip($id))->get('tbl_trans_medcheck')->row();
//                $sql_res_rw = $this->db->where('id', general::dekrip($id_item))->get('tbl_trans_medcheck_resep_det')->row();
//                $sql_item   = $this->db->where('id', $sql_res_rw->id_item)->get('tbl_m_produk')->row();
//                $sql_sat    = $this->db->where('id', $sql_item->id_satuan)->get('tbl_m_satuan')->row();
//                $sql_sat_pk = $this->db->where('id', $dos_sat)->get('tbl_m_satuan_pakai')->row();
//                $harga      = general::format_angka_db($hrg);
//                $potongan   = general::format_angka_db($pot);
//                $dokter     = (!empty($id_dokter) ? $id_dokter : $sql_medc->id_dokter);
//                
//                $disk1      = $harga - (($diskon1 / 100) * $harga);
//                $disk2      = $disk1 - (($diskon2 / 100) * $disk1);
//                $disk3      = $disk2 - (($diskon3 / 100) * $disk2);
//                $diskon     = $harga - $disk3;
//                $subtotal   = ($disk3 - $potongan) * (int)$jml;
//                
//                $data_resep = array(
//                    'jml'           => (int)$jml,
//                    'status_resep'  => (int)$status_res,
//                );
//                
//                crud::update('tbl_trans_medcheck_resep_det', 'id', $sql_res_rw->id, $data_resep);
//                    
//                  // Simpan ke tabel resep
//                crud::simpan('tbl_trans_medcheck_resep_det', $data_resep);
//
//                $this->cart->insert($keranjang);
//
//                echo general::dekrip($id_item);
//                echo '<pre>';
//                print_r($_FILES['fupload']);
//                echo '</pre>';
            }
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    } 

    public function cart_medcheck_rad_file() {
        if (akses::aksesLogin() == TRUE) {
            $id         = $this->input->post('id');
            $id_rad     = $this->input->post('id_rad');
            $id_item    = $this->input->post('id_item');
            $id_produk  = $this->input->post('id_produk');
            $id_dokter  = $this->input->post('id_dokter');
            $judul      = $this->input->post('judul');
            $status     = $this->input->post('status');
            $act        = $this->input->post('act');
            
            $this->form_validation->set_error_delimiters('<div class="alert alert-danger">', '</div>');

            $this->form_validation->set_rules('id', 'ID', 'required');

            if ($this->form_validation->run() == FALSE) {
                $msg_error = array(
                    'id'        => form_error('id'),
                );

                $this->session->set_flashdata('form_error', $msg_error);

                redirect(base_url('medcheck/tambah.php?'.(!empty($act) ? '&act='.$act : '').(!empty($id) ? '&id='.$id : '').(!empty($id_rad) ? '&id_rad='.$id_rad : '').(!empty($status) ? '&status='.$status : '').(!empty($id_item) ? '&id_item='.$id_item : '').(!empty($id_produk) ? '&id_produk='.$id_produk : '')));
            } else {
                $sql_medc       = $this->db->where('id', general::dekrip($id))->get('tbl_trans_medcheck')->row();
                $sql_medc_rad   = $this->db->where('id', general::dekrip($id_rad))->get('tbl_trans_medcheck_rad')->row();               $sql_medc    = $this->db->where('id', general::dekrip($id))->get('tbl_trans_medcheck')->row();
                $sql_pasien     = $this->db->where('id', $sql_medc->id_pasien)->get('tbl_m_pasien')->row();
                $no_rm          = strtolower($sql_pasien->kode_dpn).$sql_pasien->kode;
                $folder         = realpath('./file/pasien/'.$no_rm);
                
                if (!empty($_FILES['fupload']['name'])) {
                    $config['upload_path']      = $folder;
                    $config['allowed_types']    = 'jpg|png|jpeg';
                    $config['remove_spaces']    = TRUE;
                    $config['overwrite']        = TRUE;
                    $config['file_name']        = 'medc_'.$sql_medc->no_rm.'_rad'.sprintf('%05d', rand(1,256));
                    $this->load->library('upload', $config);
                    
                    if (!$this->upload->do_upload('fupload')) {
                        $this->session->set_flashdata('medcheck', '<div class="alert alert-danger">Error : <b>' . $this->upload->display_errors() . '</b></div>');
                        redirect(base_url('medcheck/tambah.php?'.(!empty($act) ? '&act='.$act : '').(!empty($id) ? '&id='.$id : '').(!empty($id_rad) ? '&id_rad='.$id_rad : '').(!empty($status) ? '&status='.$status : '').(!empty($id_item) ? '&id_item='.$id_item : '').(!empty($id_produk) ? '&id_produk='.$id_produk : '').'&err='.$this->upload->display_errors()));
//                        redirect(base_url('medcheck/tambah.php?id='.$id.'&status=8&err='.$this->upload->display_errors()));
                    } else {
                        $f      = $this->upload->data();
                        
                    }
                    
//                    $file_tmp   = $_FILES['fupload']['tmp_name'];
//                    $file_ext   = $_FILES['fupload']['type']; //pathinfo($_FILES['fupload']['type'], PATHINFO_EXTENSION);
//                    $file_data  = file_get_contents($file_tmp);
//                    $file       = 'data:' . $file_ext . ';base64,' . base64_encode($file_data);
                }
                
                $data_rad = array(
                    'id_medcheck'       => $sql_medc->id,
                    'id_medcheck_det'   => general::dekrip($id_item),
                    'id_rad'            => $sql_medc_rad->id,
                    'id_user'           => $this->ion_auth->user()->row()->id,
                    'tgl_simpan'        => date('Y-m-d H:i:s'),
                    'tgl_modif'         => date('Y-m-d H:i:s'),
                    'judul'             => $judul,
                    'file_name'         => $f['orig_name'],
                    'file_name_orig'    => $f['client_name'],
                    'file_ext'          => $f['file_ext'],
                    'file_type'         => $f['file_type'],
//                    'file_base64'       => (!empty($file) ? $file : ''),
                );
                
                crud::simpan('tbl_trans_medcheck_rad_file', $data_rad);
                
                $this->db->where('id', $sql_medc->id)->update('tbl_trans_medcheck', array('tgl_periksa_rad_kirim'=>date('Y-m-d H:i:s')));
                
                redirect(base_url('medcheck/tambah.php?'.(!empty($act) ? 'act='.$act : '').(!empty($id) ? '&id='.$id : '').(!empty($id_rad) ? '&id_rad='.$id_rad : '').(!empty($status) ? '&status='.$status : '').(!empty($id_item) ? '&id_item='.$id_item : '').(!empty($id_produk) ? '&id_produk='.$id_produk : '')));
                
//                crud::update('tbl_trans_medcheck_det', 'id', general::dekrip($id_item), $data_rad);
//                
//                $sql_medc   = $this->db->where('id', general::dekrip($id))->get('tbl_trans_medcheck')->row();
//                $sql_res_rw = $this->db->where('id', general::dekrip($id_item))->get('tbl_trans_medcheck_resep_det')->row();
//                $sql_item   = $this->db->where('id', $sql_res_rw->id_item)->get('tbl_m_produk')->row();
//                $sql_sat    = $this->db->where('id', $sql_item->id_satuan)->get('tbl_m_satuan')->row();
//                $sql_sat_pk = $this->db->where('id', $dos_sat)->get('tbl_m_satuan_pakai')->row();
//                $harga      = general::format_angka_db($hrg);
//                $potongan   = general::format_angka_db($pot);
//                $dokter     = (!empty($id_dokter) ? $id_dokter : $sql_medc->id_dokter);
//                
//                $disk1      = $harga - (($diskon1 / 100) * $harga);
//                $disk2      = $disk1 - (($diskon2 / 100) * $disk1);
//                $disk3      = $disk2 - (($diskon3 / 100) * $disk2);
//                $diskon     = $harga - $disk3;
//                $subtotal   = ($disk3 - $potongan) * (int)$jml;
//                
//                $data_resep = array(
//                    'jml'           => (int)$jml,
//                    'status_resep'  => (int)$status_res,
//                );
//                
//                crud::update('tbl_trans_medcheck_resep_det', 'id', $sql_res_rw->id, $data_resep);
//                    
//                  // Simpan ke tabel resep
//                crud::simpan('tbl_trans_medcheck_resep_det', $data_resep);
//
//                $this->cart->insert($keranjang);
//
//                echo general::dekrip($id_item);
//                echo '<pre>';
//                print_r($_FILES['fupload']);
//                echo '</pre>';
            }
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    } 

    public function cart_medcheck_rad_file_hapus() {
        if (akses::aksesLogin() == TRUE) {
            $id         = $this->input->get('id');
            $id_item    = $this->input->get('file_id');
            $status     = $this->input->get('status');
            $act        = $this->input->get('act');
            
            if(!empty($id_item)){
                $sql_medc    = $this->db->where('id', general::dekrip($id))->get('tbl_trans_medcheck')->row();
                $sql_medc_rad= $this->db->where('id', general::dekrip($id_item))->get('tbl_trans_medcheck_rad_file')->row();
                $sql_pasien  = $this->db->where('id', $sql_medc->id_pasien)->get('tbl_m_pasien')->row();
                $no_rm       = strtolower($sql_pasien->kode_dpn).$sql_pasien->kode;
                $folder      = realpath('./file/pasien/'.$no_rm);
               
                $path   = $folder.'/';
                $berkas = $path.$sql_medc_rad->file_name;
                
                if(file_exists($berkas)){
                    unlink($berkas);
                }
                
                $this->session->set_flashdata('medcheck', '<div class="alert alert-success">Input hasil radiologi berhasil di hapus</div>');
                crud::delete('tbl_trans_medcheck_rad_file', 'id', general::dekrip($id_item));
            }
            
            redirect(base_url('medcheck/tambah.php?act='.$this->input->get('act').'&id='.$this->input->get('id').'&id_rad='.$this->input->get('id_rad').'&status='.$this->input->get('status').'&id_item=' . $this->input->get('id_item').'&id_produk=' . $this->input->get('id_produk')));
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    } 

    public function cart_medcheck_rad_hsl_hapus() {
        if (akses::aksesLogin() == TRUE) {
            $id         = $this->input->get('id');
            $id_item    = $this->input->get('item_id');
            $hasil_id   = $this->input->get('hasil_id');
            $status     = $this->input->get('status');
            
            if(!empty($hasil_id)){                
                $this->session->set_flashdata('medcheck_toast', 'toastr.success("Nilai pemeriksaan berhasil di hapus !!");');
                crud::delete('tbl_trans_medcheck_rad_det', 'id', general::dekrip($hasil_id));
            }else{
                $this->session->set_flashdata('medcheck_toast', 'toastr.error("Nilai pemeriksaan gagal di hapus !!");');
            }
            
            redirect(base_url('medcheck/tambah.php?act='.$this->input->get('act').'&id='.$this->input->get('id').'&id_rad='.$this->input->get('id_rad').'&status='.$this->input->get('status').'&id_item='.$this->input->get('id_item').'&id_produk='.$this->input->get('id_produk')));
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    } 

    public function cart_medcheck_lab_hsl_hapus() {
        if (akses::aksesLogin() == TRUE) {
            $id         = $this->input->get('id');
            $id_lab     = $this->input->get('id_lab');
            $id_item    = $this->input->get('item_id');
            $status     = $this->input->get('status');
            $act        = $this->input->get('act');
            
            if(!empty($id_item)){                
                $this->session->set_flashdata('medcheck', '<div class="alert alert-success">Input hasil radiologi berhasil di hapus</div>');
                crud::delete('tbl_trans_medcheck_lab_hsl', 'id', general::dekrip($id_item));
            }
            
            redirect(base_url('medcheck/tambah.php?id='.$id.'&status='.$status.'&act='.$act.'&id_lab='.$id_lab));
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    } 

    public function cart_medcheck_rm() {
        if (akses::aksesLogin() == TRUE) {
            $id         = $this->input->post('id');
            $id_dokter  = $this->input->post('id_dokter');
            $id_nurse   = $this->input->post('id_perawat');
            $id_pasien  = $this->input->post('id_pasien');
            $id_icd     = $this->input->post('icd');
            $id_icd10   = $this->input->post('icd10');
            $tgl        = $this->input->post('tgl');
            $anamnesa   = $this->input->post('anamnesa');
            $priksa     = $this->input->post('pemeriksaan');
            $diagnos    = $this->input->post('diagnosa');
            $terapi     = $this->input->post('terapi');
            $program    = $this->input->post('program');
            $ns_subj    = $this->input->post('ns_subj');
            $ns_obj     = $this->input->post('ns_obj');
            $ns_ass     = $this->input->post('ns_ass');
            $ns_prog    = $this->input->post('ns_prog');
            $ttv_st     = $this->input->post('ttv_st');
            $ttv_bb     = $this->input->post('ttv_bb');
            $ttv_tb     = $this->input->post('ttv_tb');
            $ttv_sst    = $this->input->post('ttv_sistole');
            $ttv_dst    = $this->input->post('ttv_diastole');
            $ttv_ndi    = $this->input->post('ttv_nadi');
            $ttv_lju    = $this->input->post('ttv_laju');
            $ttv_sat    = $this->input->post('ttv_saturasi');
            $ttv_skl    = $this->input->post('ttv_skala');
            $act        = $this->input->post('act');
            $status     = $this->input->post('status');
            $tipe       = $this->input->post('tipe');
            
            $this->form_validation->set_error_delimiters('<div class="alert alert-danger">', '</div>');
            

            $this->form_validation->set_rules('id', 'ID', 'required');
            $this->form_validation->set_rules('anamnesa', 'ID', 'required');
            $this->form_validation->set_rules('diagnosa', 'ID', 'required');
            $this->form_validation->set_rules('pemeriksaan', 'ID', 'required');
            $this->form_validation->set_rules('program', 'ID', 'required');
            $this->form_validation->set_rules('terapi', 'ID', 'required');
            $this->form_validation->set_rules('program', 'ID', 'required');
            $this->form_validation->set_rules('terapi', 'ID', 'required');
            
            if (akses::hakSA() == TRUE OR akses::hakOwner() == TRUE OR akses::hakPerawat() == TRUE) {
                $this->form_validation->set_rules('ttv_st', 'ID', 'required');
                $this->form_validation->set_rules('ttv_bb', 'ID', 'required');
                $this->form_validation->set_rules('ttv_tb', 'ID', 'required');
                $this->form_validation->set_rules('ttv_saturasi', 'ID', 'required');
                $this->form_validation->set_rules('ttv_sistole', 'ID', 'required');
                $this->form_validation->set_rules('ttv_diastole', 'ID', 'required');
                $this->form_validation->set_rules('ttv_nadi', 'ID', 'required');
                $this->form_validation->set_rules('ttv_laju', 'ID', 'required');
                $this->form_validation->set_rules('ttv_skala', 'ID', 'required');
            }

            if ($this->form_validation->run() == FALSE) {
                $msg_error = array(
                    'id'            => form_error('id'),
                    'anamnesa'      => form_error('anamnesa'),
                    'diagnosa'      => form_error('diagnosa'),
                    'pemeriksaan'   => form_error('pemeriksaan'),
                    'program'       => form_error('program'),
                    'terapi'        => form_error('terapi'),
                    'ttv_st'        => form_error('ttv_st'),
                    'ttv_bb'        => form_error('ttv_bb'),
                    'ttv_tb'        => form_error('ttv_tb'),
                    'ttv_sistole'   => form_error('ttv_sistole'),
                    'ttv_diastole'  => form_error('ttv_diastole'),
                    'ttv_saturasi'  => form_error('ttv_saturasi'),
                    'ttv_nadi'      => form_error('ttv_nadi'),
                    'ttv_laju'      => form_error('ttv_laju'),
                    'ttv_skala'     => form_error('ttv_skala'),
                );

                $this->session->set_flashdata('form_error', $msg_error);
                $this->session->set_flashdata('medcheck_toast', 'toastr.error("Entri rekam medis gagal disimpan !, isian tidak boleh kosong.");');
                
                # Form value
                $this->session->set_flashdata('anamnesa', $anamnesa);
                $this->session->set_flashdata('pemeriksaan', $priksa);
                $this->session->set_flashdata('diagnosa', $diagnos);
                $this->session->set_flashdata('program', $program);
                $this->session->set_flashdata('terapi', $terapi);
                
                $this->session->set_flashdata('ttv_st', $ttv_st);
                $this->session->set_flashdata('ttv_bb', $ttv_bb);
                $this->session->set_flashdata('ttv_tb', $ttv_tb);
                $this->session->set_flashdata('ttv_sistole', $ttv_sst);
                $this->session->set_flashdata('ttv_diastole', $ttv_dst);
                $this->session->set_flashdata('ttv_saturasi', $ttv_sat);
                $this->session->set_flashdata('ttv_nadi', $ttv_ndi);
                $this->session->set_flashdata('ttv_laju', $ttv_lju);
                $this->session->set_flashdata('ttv_skala', $ttv_skl);

                redirect(base_url('medcheck/tambah.php?act=rm_input&id='.$id.'&status='.$status));
            } else {
                $sql_rm = $this->db->get('tbl_trans_medcheck_rm');
                $nomer  = $sql_rm->num_rows() + 1;
                $kode   = sprintf('%05d', $nomer);
                        
                $data = array(
                    'id_medcheck' => general::dekrip($id),
                    'id_user'     => $this->ion_auth->user()->row()->id,
                    'id_perawat'  => $this->ion_auth->user()->row()->id,
                    'id_dokter'   => (!empty($id_dokter) ? $id_dokter : 0),
                    'id_pasien'   => general::dekrip($id_pasien),
                    'id_icd'      => (!empty($id_icd) ? $id_icd : '0'),
                    'id_icd10'    => (!empty($id_icd10) ? $id_icd10 : '0'),
                    'tgl_simpan'  => $this->tanggalan->tgl_indo_sys($tgl).' '.date('H:i:s'),
                    'kode'        => $kode,
                    'anamnesa'    => (!empty($anamnesa) ? htmlentities($anamnesa, ENT_QUOTES | ENT_IGNORE, "UTF-8") : '-'),
                    'pemeriksaan' => (!empty($priksa) ? htmlentities($priksa) : '-'),
                    'diagnosa'    => (!empty($diagnos) ? htmlentities($diagnos) : '-'),
                    'terapi'      => (!empty($terapi) ? htmlentities($terapi) : '-'),
                    'program'     => (!empty($program) ? htmlentities($program) : '-'),
                    'ttv_st'      => (!empty($ttv_st) ? $ttv_st : 0),
                    'ttv_bb'      => (!empty($ttv_bb) ? $ttv_bb : 0),
                    'ttv_tb'      => (!empty($ttv_tb) ? $ttv_tb : 0),
                    'ttv_sistole' => (!empty($ttv_sst) ? $ttv_sst : 0),
                    'ttv_diastole'=> (!empty($ttv_dst) ? $ttv_dst : 0),
                    'ttv_nadi'    => (!empty($ttv_ndi) ? $ttv_ndi : 0),
                    'ttv_laju'    => (!empty($ttv_lju) ? $ttv_lju : 0),
                    'ttv_saturasi'=> (!empty($ttv_sat) ? $ttv_sat : 0),
                    'ttv_skala'   => (!empty($ttv_skl) ? $ttv_skl : 0),
                    'ns_subj'     => (!empty($ns_subj) ? htmlentities($ns_subj) : '-'),
                    'ns_obj'      => (!empty($ns_obj) ? htmlentities($ns_obj) : '-'),
                    'ns_ass'      => (!empty($ns_ass) ? htmlentities($ns_ass) : '-'),
                    'ns_prog'     => (!empty($ns_prog) ? htmlentities($ns_prog) : '-'),
                    'status'      => '1',
                    'tipe'        => '0',
                );
                
                $this->db->insert('tbl_trans_medcheck_rm', $data);
                $last_id = crud::last_id();
                
                if ($this->db->affected_rows() > 0) {
                    $this->session->set_flashdata('medcheck_toast', 'toastr.success("Entri rekam medis berhasil ditambahkan !");');
                } else {
                    $this->session->set_flashdata('medcheck_toast', 'toastr.error("Entri rekam medis gagal disimpan !");');
                }

                redirect(base_url('medcheck/tambah.php?act=rm_ubah&id='.$id.'&status='.$status.(!empty($last_id) ? '&id_item='.general::enkrip($last_id) : '')));
                
//                echo $this->session->flashdata('medcheck_toast');
//                echo general::dekrip($id_item);
//                echo '<pre>';
//                print_r($data);
//                echo '</pre>';
//                echo '<pre>';
//                print_r(htmlentities($terapi, ENT_QUOTES | ENT_IGNORE | ENT_SUBSTITUTE));
//                echo '</pre>';
            }
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    } 

    public function cart_medcheck_rm_upd() {
        if (akses::aksesLogin() == TRUE) {
            $id         = $this->input->post('id');
            $id_rm      = $this->input->post('id_rm');
            $id_dokter  = $this->input->post('id_dokter');
            $id_nurse   = $this->input->post('id_perawat');
            $id_pasien  = $this->input->post('id_pasien');
            $id_icd     = $this->input->post('icd');
            $id_icd10   = $this->input->post('icd10');
            $tgl        = $this->input->post('tgl');
            $anamnesa   = $this->input->post('anamnesa');
            $priksa     = $this->input->post('pemeriksaan');
            $diagnos    = $this->input->post('diagnosa');
            $terapi     = $this->input->post('terapi');
            $program    = $this->input->post('program');
            $ttv_st     = $this->input->post('ttv_st');
            $ttv_bb     = $this->input->post('ttv_bb');
            $ttv_tb     = $this->input->post('ttv_tb');
            $ttv_td     = $this->input->post('ttv_td');
            $ttv_sst    = $this->input->post('ttv_sistole');
            $ttv_dst    = $this->input->post('ttv_diastole');
            $ttv_ndi    = $this->input->post('ttv_nadi');
            $ttv_lju    = $this->input->post('ttv_laju');
            $ttv_sat    = $this->input->post('ttv_saturasi');
            $ttv_skl    = $this->input->post('ttv_skala');
            $ns_subj    = $this->input->post('ns_subj');
            $ns_obj     = $this->input->post('ns_obj');
            $ns_ass     = $this->input->post('ns_ass');
            $ns_prog    = $this->input->post('ns_prog');
            $act        = $this->input->post('act');
            $status     = $this->input->post('status');
            $tipe       = $this->input->post('tipe');
            
            $this->form_validation->set_error_delimiters('<div class="alert alert-danger">', '</div>');

            $this->form_validation->set_rules('id', 'ID', 'required');
            $this->form_validation->set_rules('anamnesa', 'ID', 'required');
            $this->form_validation->set_rules('diagnosa', 'ID', 'required');
            $this->form_validation->set_rules('pemeriksaan', 'ID', 'required');
            $this->form_validation->set_rules('program', 'ID', 'required');
            $this->form_validation->set_rules('terapi', 'ID', 'required');
            
            if (akses::hakSA() == TRUE OR akses::hakOwner() == TRUE OR akses::hakPerawat() == TRUE) {
                $this->form_validation->set_rules('ttv_st', 'ID', 'required');
                $this->form_validation->set_rules('ttv_bb', 'ID', 'required');
                $this->form_validation->set_rules('ttv_tb', 'ID', 'required');
                $this->form_validation->set_rules('ttv_saturasi', 'ID', 'required');
                $this->form_validation->set_rules('ttv_sistole', 'ID', 'required');
                $this->form_validation->set_rules('ttv_diastole', 'ID', 'required');
                $this->form_validation->set_rules('ttv_nadi', 'ID', 'required');
                $this->form_validation->set_rules('ttv_laju', 'ID', 'required');
                $this->form_validation->set_rules('ttv_skala', 'ID', 'required');
            }

            if ($this->form_validation->run() == FALSE) {
                $msg_error = array(
                    'id'            => form_error('id'),
                    'anamnesa'      => form_error('anamnesa'),
                    'diagnosa'      => form_error('diagnosa'),
                    'pemeriksaan'   => form_error('pemeriksaan'),
                    'program'       => form_error('program'),
                    'terapi'        => form_error('terapi'),
                    'ttv_st'        => form_error('ttv_st'),
                    'ttv_bb'        => form_error('ttv_bb'),
                    'ttv_tb'        => form_error('ttv_tb'),
                    'ttv_sistole'   => form_error('ttv_sistole'),
                    'ttv_diastole'  => form_error('ttv_diastole'),
                    'ttv_saturasi'  => form_error('ttv_saturasi'),
                    'ttv_nadi'      => form_error('ttv_nadi'),
                    'ttv_laju'      => form_error('ttv_laju'),
                    'ttv_skala'     => form_error('ttv_skala'),
                );

                $this->session->set_flashdata('form_error', $msg_error);
                $this->session->set_flashdata('medcheck_toast', 'toastr.error("Entri rekam medis gagal disimpan !, isian tidak boleh kosong.");');

                redirect(base_url('medcheck/tambah.php?act=rm_input&id='.$id.'&status='.$status.'&id_item='.$id_rm));
            } else {
                $sql_rm = $this->db->get('tbl_trans_medcheck_rm');
                $nomer  = $sql_rm->num_rows() + 1;
                $kode   = sprintf('%05d', $nomer);
                        
                $data = array(
                    'tgl_simpan'  => $this->tanggalan->tgl_indo_sys($tgl).' '.date('H:i:s'),
                    'id_icd'      => (!empty($id_icd) ? $id_icd : 0),
                    'id_icd10'    => (!empty($id_icd10) ? $id_icd10 : 0),
                    'anamnesa'    => htmlentities($anamnesa),
                    'pemeriksaan' => htmlentities($priksa),
                    'diagnosa'    => htmlentities($diagnos),
                    'terapi'      => htmlentities($terapi),
                    'program'     => htmlentities($program),
                    'ttv_st'      => (!empty($ttv_st) ? $ttv_st : 0),
                    'ttv_bb'      => (!empty($ttv_bb) ? $ttv_bb : 0),
                    'ttv_tb'      => (!empty($ttv_tb) ? $ttv_tb : 0),
                    'ttv_sistole' => (!empty($ttv_sst) ? $ttv_sst : 0),
                    'ttv_diastole'=> (!empty($ttv_dst) ? $ttv_dst : 0),
                    'ttv_nadi'    => (!empty($ttv_ndi) ? $ttv_ndi : 0),
                    'ttv_laju'    => (!empty($ttv_lju) ? $ttv_lju : 0),
                    'ttv_saturasi'=> (!empty($ttv_sat) ? $ttv_sat : 0),
                    'ttv_skala'   => (!empty($ttv_skl) ? $ttv_skl : 0),
                    'ns_subj'     => (!empty($ns_subj) ? htmlentities($ns_subj) : '-'),
                    'ns_obj'      => (!empty($ns_obj) ? htmlentities($ns_obj) : '-'),
                    'ns_ass'      => (!empty($ns_ass) ? htmlentities($ns_ass) : '-'),
                    'ns_prog'     => (!empty($ns_prog) ? htmlentities($ns_prog) : '-'),
                );
                
                $this->db->where('id', general::dekrip($id_rm))->update('tbl_trans_medcheck_rm', $data);
                $last_id = general::dekrip($id_rm);
                
                if ($this->db->affected_rows() > 0) {
                    $this->session->set_flashdata('medcheck_toast', 'toastr.success("Entri rekam medis berhasil ditambahkan !");');
                } else {
                    $this->session->set_flashdata('medcheck_toast', 'toastr.error("Entri rekam medis gagal disimpan !");');
                }

                redirect(base_url('medcheck/tambah.php?act=rm_ubah&id='.$id.'&status='.$status.(!empty($last_id) ? '&id_item='.general::enkrip($last_id) : '')));
                
                
//                echo '<pre>';
//                print_r($data);
//                echo '</pre>';
            }
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    } 

    public function cart_medcheck_rm_hapus() {
        if (akses::aksesLogin() == TRUE) {
            $id         = $this->input->get('id');
            $id_item    = $this->input->get('id_item');
            $id_nota    = $this->input->get('no_nota');
            $status     = $this->input->get('status');
            
            if(!empty($id)){
                $this->session->set_flashdata('medcheck', '<div class="alert alert-success">Item berhasil di hapus</div>');
                crud::delete('tbl_trans_medcheck_rm', 'id', general::dekrip($id_item));
            }
            
            redirect(base_url('medcheck/tambah.php?id='.$id.'&status='.$status));
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }

    public function cart_medcheck_hapus() {
        if (akses::aksesLogin() == TRUE) {
            $id         = $this->input->get('id');
            $id_lab     = $this->input->get('id_lab');
            $id_rad     = $this->input->get('id_rad');
            $id_nota    = $this->input->get('no_nota');
            $status     = $this->input->get('status');
            $act        = $this->input->get('act');
            $rute       = $this->input->get('route');
            
            if(!empty($id)){
                crud::delete('tbl_trans_medcheck_det', 'id', general::dekrip($id));
                $this->session->set_flashdata('medcheck', '<div class="alert alert-success">Item berhasil di hapus</div>');
            }
            
            redirect(base_url((!empty($rute) ? $rute : 'medcheck/tambah.php?'.(!empty($act) ? 'act='.$act.'&' : '').'id='.$id_nota.(!empty($id_rad) ? '&id_rad='.$id_rad.'&' : '').(!empty($id_lab) ? '&id_lab='.$id_lab.'&' : '').'&status='.$status)));
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }

    public function cart_medcheck_retur_ranap_hapus() {
        if (akses::aksesLogin() == TRUE) {
            $id         = $this->input->get('id');
            $id_item    = $this->input->get('item_id');
            $status     = $this->input->get('status');
            $act        = $this->input->get('act');
            $rute       = $this->input->get('route');
            
            if(!empty($id)){
                $sql_ret    = $this->db->where('id', general::dekrip($id_item))->get('tbl_trans_medcheck_retur')->row();
                $sql_det    = $this->db->where('id', $sql_ret->id_medcheck_det)->get('tbl_trans_medcheck_det')->row();
                $jml_ret    = $sql_ret->jml + $sql_det->jml;

                $disk1      = $sql_det->harga - (($sql_det->disk1 / 100) * $sql_det->harga);
                $disk2      = $disk1 - (($sql_det->disk2 / 100) * $disk1);
                $disk3      = $disk2 - (($sql_det->disk3 / 100) * $disk2);
                $diskon     = $sql_det->harga - $disk3;
                $subtotal   = ($disk3 - $sql_det->potongan) * $jml_ret;
                                
                $data_det = array(
                    'jml'       => (int)$jml_ret,
                    'subtotal'  => (float)$subtotal
                );
                
//                echo '<pre>';
//                print_r($sql_det);
//                echo '</pre>';
//                echo '<pre>';
//                print_r($data_det);
//                echo '</pre>';
                
                # Transaksi start
                $this->db->trans_off();
                $this->db->trans_start();
                
                # Update tabel medcheck detail
                $this->db->where('id', $sql_det->id)->update('tbl_trans_medcheck_det', $data_det);
                
                # Hapus tabel retur
                $this->db->where('id', $sql_ret->id)->delete('tbl_trans_medcheck_retur');
                
                # Trans Complete
                $this->db->trans_complete();
                
                if ($this->db->trans_status() === FALSE) {
                    # Something went wrong.
                    $this->db->trans_rollback();
                    
                    # Berikan pesan gagal                   
                    $this->session->set_flashdata('medcheck', '<div class="alert alert-danger">Item gagal di hapus</div>');
                } else {
                    $this->db->trans_commit(); 
                    
                    # Berikan pesan sukses                   
                    $this->session->set_flashdata('medcheck', '<div class="alert alert-success">Item berhasil di hapus</div>');
                }
            }
            
            redirect(base_url('medcheck/retur.php?id='.$id));
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }

    public function cart_medcheck_status() {
        if (akses::aksesLogin() == TRUE) {
            $id         = $this->input->get('id');
            $id_lab     = $this->input->get('id_lab');
            $id_nota    = $this->input->get('no_nota');
            $status     = $this->input->get('status');
            $state      = $this->input->get('state');
            $act        = $this->input->get('act');
            
            if(!empty($id)){
                $this->session->set_flashdata('medcheck', '<div class="alert alert-success">Item berhasil di hapus</div>');
                crud::update('tbl_trans_medcheck_det', 'id', general::dekrip($id), array('status_baca'=>$state));
            }
            
            redirect(base_url('medcheck/tambah.php?'.(!empty($act) ? 'act='.$act.'&' : '').'id='.$id_nota.(!empty($id_lab) ? '&id_lab='.$id_lab : '').'&status='.$status));
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }

    public function cart_medcheck_lab_nilai() {
        if (akses::aksesLogin() == TRUE) {
            $id         = $this->input->post('id');
            $id_item    = $this->input->post('id_item');
            $id_det     = $this->input->post('id_det'); // ==> Medcheck Det
            $id_lab     = $this->input->post('id_lab'); // ==> Lab Det
            $item       = $this->input->post('item');
            $item_ket   = $this->input->post('item_ket');
            $hasil      = $this->input->post('keterangan');
            $nilai      = $_POST['nilai_normal'];
            $satuan     = $_POST['nilai_satuan'];
            $hasil      = $_POST['nilai_hasil'];
            $status_hsl = $_POST['status_hsl'];
            $status_wrn = $_POST['status_wrn'];
            $status     = $this->input->post('status');
            $act        = $this->input->post('act');
            
            $this->form_validation->set_error_delimiters('<div class="alert alert-danger">', '</div>');

            $this->form_validation->set_rules('id', 'ID', 'required');
            $this->form_validation->set_rules('id_item', 'Kode', 'required');

            if ($this->form_validation->run() == FALSE) {
                $msg_error = array(
                    'id'        => form_error('id'),
                    'kode'      => form_error('id_item'),
                );

                $this->session->set_flashdata('form_error', $msg_error);

                redirect(base_url('medcheck/tambah.php?id='.$id.'&status='.$status));
            } else {
                $sql_medc   = $this->db->where('id', general::dekrip($id))->get('tbl_trans_medcheck')->row();
                $sql_item   = $this->db->where('id', general::dekrip($id_item))->get('tbl_m_produk')->row();
                $sql_medc_ck= $this->db->where('id_medcheck', general::dekrip($id))->where('id_item', general::dekrip($id_item))->get('tbl_trans_medcheck_det');
                $sql_sat    = $this->db->where('id', $sql_item->id_satuan)->get('tbl_m_satuan')->row();
                $harga      = general::format_angka_db($hrg);
                $potongan   = general::format_angka_db($pot);
                $dokter     = (!empty($id_dokter) ? $id_dokter : $sql_medc->id_dokter);
                
                $data = array(
                    'tgl_modif'     => date('Y-m-d H:i:s'),
                    'tgl_baca'      => date('Y-m-d H:i:s'),
//                    'status_hsl_lab'=> $item_ket,
                );
                
                $this->db->where('id', general::dekrip($id_det))->update('tbl_trans_medcheck_det', $data);                
                    
                foreach ($nilai as $key => $hsl){
                    $sql_nilai      = $this->db->where('id', general::dekrip($key))->get('tbl_m_produk_ref_input')->row();
                    $input_id       = $sql_nilai->id;
                    $input_name     = $sql_nilai->item_name;
                    $input_sat      = $satuan[$key];
                    $input_hsl      = $hasil[$key];
                    $input_hsl_st   = $status_hsl[$key];
                    $input_hsl_wrn  = $status_wrn[$key];
                    $input_val      = $hsl;
                    
                    $data_lab = array(
                        'id_medcheck'       => $sql_medc->id,
                        'id_medcheck_det'   => $sql_medc_ck->row()->id,
                        'id_lab'            => general::dekrip($id_lab),
                        'id_user'           => $this->ion_auth->user()->row()->id,
                        'id_item'           => general::dekrip($id_item),
                        'id_item_ref_ip'    => $input_id,
                        'tgl_simpan'        => date('Y-m-d H:i:s'),
                        'item_name'         => $input_name,
                        'item_value'        => $input_val,
                        'item_satuan'       => $input_sat,
                        'item_hasil'        => $input_hsl,
                        'status'            => $sql_nilai->status,
                        'status_hsl_lab'    => (!empty($input_hsl_st) ? $input_hsl_st : '0'),
                        'status_hsl_wrn'    => (!empty($input_hsl_wrn) ? $input_hsl_wrn : '0'),
                    );

                    $this->db->insert('tbl_trans_medcheck_lab_hsl', $data_lab);
                    
//                    echo '<pre>';
//                    print_r($data_lab);
//                    echo '</pre>';
                }
                   
//                echo $id_det;
//                echo '<pre>';
//                print_r($data);
//                echo '</pre>';
                
                $this->session->set_flashdata('medcheck_toast', 'toastr.success("Entri data laborat berhasil !");');
                redirect(base_url('medcheck/tambah.php?act='.$act.'&id='.$id.'&id_lab='.$id_lab.'&status='.$status));
            }
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }
    
    public function cart_medcheck_lab_ekg_file_hapus() {
        if (akses::aksesLogin() == TRUE) {
            $id         = $this->input->get('id');
            $id_item    = $this->input->get('file_id');
            $status     = $this->input->get('status');
            $act        = $this->input->get('act');
            
            if(!empty($id_item)){
                $sql_medc    = $this->db->where('id', general::dekrip($id))->get('tbl_trans_medcheck')->row();
                $sql_medc_ekg= $this->db->where('id', general::dekrip($id_item))->get('tbl_trans_medcheck_lab_ekg_file')->row();
                $sql_pasien  = $this->db->where('id', $sql_medc->id_pasien)->get('tbl_m_pasien')->row();
                $no_rm       = strtolower($sql_pasien->kode_dpn).$sql_pasien->kode;
                $folder      = realpath('./file/pasien/'.$no_rm);
               
                $path   = $folder.'/';
                $berkas = $path.$sql_medc_ekg->file_name;
                
                if(file_exists($berkas)){
                    unlink($berkas);
                }
                
                $this->session->set_flashdata('medcheck', '<div class="alert alert-success">Input hasil ekg berhasil di hapus</div>');
                crud::delete('tbl_trans_medcheck_lab_ekg_file', 'id', general::dekrip($id_item));
            }
            
            redirect(base_url('medcheck/tambah.php?act='.$this->input->get('act').'&id='.$this->input->get('id').'&id_lab='.$this->input->get('id_lab').'&status='.$this->input->get('status')));
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    } 
    
    public function cart_beli_simpan() {
        if (akses::aksesLogin() == TRUE) {
            $no_nota  = $this->input->post('no_nota');
            $id_brg   = $this->input->post('id_item');
            $satuan   = $this->input->post('satuan');
            $kode     = $this->input->post('kode');
            $qty      = $this->input->post('jml');
            $diskon1  = general::format_angka_db($this->input->post('disk1'));
            $diskon2  = general::format_angka_db($this->input->post('disk2'));
            $diskon3  = general::format_angka_db($this->input->post('disk3'));
            $harga    = general::format_angka_db($this->input->post('harga'));
            $potongan = general::format_angka_db($this->input->post('potongan'));

            $this->form_validation->set_error_delimiters('<div class="alert alert-danger">', '</div>');

            $this->form_validation->set_rules('kode', 'Kode', 'required');

            if ($this->form_validation->run() == FALSE) {
                $msg_error = array(
                    'kode' => form_error('kode'),
                );

                $this->session->set_flashdata('form_error', $msg_error);

                redirect(base_url('transaksi/trans_beli.php?id='.$no_nota));
            } else {
                $sql_brg     = $this->db->where('id', general::dekrip($id_brg))
                                        ->get('tbl_m_produk')->row();
                $sql_satuan  = $this->db->where('id', $sql_brg->id_satuan)->get('tbl_m_satuan')->row();
                $trans_beli  = $this->session->userdata('trans_beli');
                $pengaturan  = $this->db->get('tbl_pengaturan')->row();

                $jml_pcs     = (!empty($sql_satuan->jml) ? $sql_satuan->jml : '1') * $qty;
                $harga_pcs   = ($harga * $qty) / $jml_pcs;
                $harga_sat   = $harga_pcs * $sql_satuan->jml;

                $disk1       = $harga_pcs - (($diskon1 / 100) * $harga_pcs);
                $disk2       = $disk1 - (($diskon2 / 100) * $disk1);
                $disk3       = $disk2 - (($diskon3 / 100) * $disk2);

                $harga_ppn   = ($trans_beli['status_ppn'] == '1' ? ($pengaturan->jml_ppn / 100) * $disk3 : 0);
                $harga_tot   = $disk3 + $harga_ppn;
                $subtotal    = ($disk3 * $jml_pcs) - $potongan;
                $jml_qty     = $qty;

                $jml_satuan  = $sql_satuan2->jml * $qty;

                // Cek di keranjang
                foreach ($this->cart->contents() as $cart){
                    // Cek ada datanya kagak?
                    if($sql_brg->kode == $cart['options']['kode']){
                        $jml_subtotal      = ($cart['qty'] + $qty) * $sql_satuan->jml;
                        $jml_qty           = ($cart['qty'] + $qty);

                        $this->cart->update(array('rowid'=>$cart['rowid'], 'qty'=>0));
                    }
                }

                $cart = array(
                    'id'      => rand(1,1024).$sql_brg->id,
                    'qty'     => $jml_qty,
                    'price'   => $harga, // number_format($harga, 2, '.',','),
                    'name'    => rtrim($sql_brg->produk),
                    'options' => array(
                            'no_nota'       => general::dekrip($no_nota),
                            'id_barang'     => $sql_brg->id,
                            'id_satuan'     => $sql_brg->id_satuan,
                            'satuan'        => $sql_satuan->satuanTerkecil,
//                            'satuan_ket'    => ($sql_satuan->jml != 1 ? ' ('.(!empty($jml_subtotal) ? $jml_qty : $qty) * $sql_satuan->jml.' '.$sql_satuan2->satuanTerkecil.')' : ''),
                            'jml'           => $qty,
                            'jml_satuan'    => (!empty($sql_satuan->jml) ? $sql_satuan->jml : '1'),
                            'kode'          => $sql_brg->kode,
                            'harga'         => $harga_tot,
                            'ppn'           => $harga_ppn,
                            'potongan'      => $potongan,
                            'disk1'         => (float)$diskon1,
                            'disk2'         => (float)$diskon2,
                            'disk3'         => (float)$diskon3,
                            'subtotal'      => (float)$subtotal,
                    )
                );
                
//                echo '<pre>';
//                print_r($cart);
//                echo '</pre>';
//                echo '<pre>';
//                print_r($this->cart->contents());
//                echo '</pre>';

                $this->cart->insert($cart);
                redirect(base_url('transaksi/beli/trans_beli.php?id='.$no_nota));
            }
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }
    

    public function hapus_medcheck_surat() {
        if (akses::aksesLogin() == TRUE) {
            $id         = $this->input->get('id');
            $id_nota    = $this->input->get('no_nota');
            $status     = $this->input->get('status');
            
            if(!empty($id)){
                # Simpan data surat kedalam tabel
                $this->db->where('id', general::dekrip($id))->delete('tbl_trans_medcheck_surat');
                
                if ($this->db->affected_rows() > 0) {
                    $this->session->set_flashdata('medcheck_toast', 'toastr.success("Surat berhasil dihapus !");');
                }
            }
            
            redirect(base_url('medcheck/tambah.php?id='.$id_nota.'&status='.$status));
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }

    public function hapus_medcheck_surat_inform() {
        if (akses::aksesLogin() == TRUE) {
            $id         = $this->input->get('id');
            $id_nota    = $this->input->get('no_nota');
            $status     = $this->input->get('status');
            
            if(!empty($id)){
                $sql_medc_inf   = $this->db->where('id', general::dekrip($id))->get('tbl_trans_medcheck_surat_inform')->row();
                $sql_medc_kmr   = $this->db->where('id_inform', $sql_medc_inf->id)->get('tbl_trans_medcheck_kamar')->row();
                $sql_kmr        = $this->db->where('id', $sql_medc_kmr->id_kamar)->get('tbl_m_kamar')->row();
                $jml            = $sql_kmr->jml - 1;
   
                $this->db->where('id', $sql_kmr->id)->update('tbl_m_kamar', array('jml' => ($jml < 0 ? 0 : $jml)));
                $this->db->where('id_inform', $sql_medc_inf->id)->delete('tbl_trans_medcheck_kamar');
                $this->db->where('id', $sql_medc_inf->id)->delete('tbl_trans_medcheck_surat_inform');
                
                $this->session->set_flashdata('medcheck_toast', 'toastr.success("Data kamar berhasil dihapus !");');
            }
            
            redirect(base_url('medcheck/tambah.php?id='.$id_nota.'&status='.$status));
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }
    
    public function cetak_medcheck_surat() {
        if (akses::aksesLogin() == TRUE) {
            $setting              = $this->db->get('tbl_pengaturan')->row();
            $id                   = $this->input->get('id');
            $id_medcheck          = $this->input->get('id_produk');
            $status               = $this->input->get('status');
            $userid               = $this->ion_auth->user()->row()->id;

            $data['sess_jual']    = $this->session->userdata('trans_medcheck');
            $data['kategori']     = $this->db->get('tbl_m_kategori')->result();
            $data['poli']         = $this->db->get('tbl_m_poli')->result();
            $data['sql_doc']      = $this->db->where('status', '2')->get('tbl_m_sales')->result();

            if(!empty($id)){
                $data['sql_medc']       = $this->db->where('id', general::dekrip($id))->get('tbl_trans_medcheck')->row();
                $data['sql_medc_srt']   = $this->db->where('id', general::dekrip($id))->group_by('id_item_kat')->get('tbl_trans_medcheck_det')->result();            
                $data['sql_pasien']     = $this->db->where('id', $data['sql_medc']->id_pasien)->get('tbl_m_pasien')->row();
                $data['sql_dokter']     = $this->db->where('id', $data['sql_medc']->id_dokter)->get('tbl_m_karyawan')->row();
                $data['sql_poli']       = $this->db->where('id', $data['sql_medc']->id_poli)->get('tbl_m_poli')->row();                
            }
            
            /* Sidebar Menu */
            $data['sidebar']    = 'admin-lte-3/includes/medcheck/sidebar_med';
            /* --- Sidebar Menu --- */

            $this->load->view('admin-lte-3/1_atas', $data);
            $this->load->view('admin-lte-3/2_header', $data);
            $this->load->view('admin-lte-3/3_navbar', $data);
            $this->load->view('admin-lte-3/includes/medcheck/med_detail', $data);
            $this->load->view('admin-lte-3/5_footer',$data);
            $this->load->view('admin-lte-3/6_bawah',$data);
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }
    

    
    public function pdf_gc() {
        if (akses::aksesLogin() == TRUE) {
            $setting            = $this->db->get('tbl_pengaturan')->row();
            $id                 = $this->input->get('dft');

            $sql_dft_gc         = $this->db->where('id', general::dekrip($id))->get('tbl_pendaftaran_gc')->row();
            $sql_dft            = $this->db->where('id', $sql_dft_gc->id_pendaftaran)->get('tbl_pendaftaran')->row();
            
            $sql_medc           = $this->db->where('id', general::dekrip($id_medcheck))->get('tbl_trans_medcheck')->row();
            $sql_medc_srt       = $this->db->where('id', general::dekrip($id))->get('tbl_trans_medcheck_surat_inform')->row(); 
            $sql_pasien         = $this->db->where('id', $sql_medc->id_pasien)->get('tbl_m_pasien')->row(); 
            $sql_pekerjaan      = $this->db->where('id', $sql_pasien->id_pekerjaan)->get('tbl_m_jenis_kerja')->row();
            $sql_dokter         = $this->db->where('id_user', $sql_medc->id_dokter)->get('tbl_m_karyawan')->row();
            $sql_dokter2        = $this->db->where('id_user', $sql_medc_srt->id_dokter)->get('tbl_m_karyawan')->row();
            $kode_pasien        = $sql_pasien->kode_dpn.$sql_pasien->kode;
            $gambar1            = FCPATH.'/assets/theme/admin-lte-3/dist/img/logo-esensia-2.png';
            $gambar2            = FCPATH.'/assets/theme/admin-lte-3/dist/img/logo-bw-bg2-1440px.png';
            $gambar3            = FCPATH.'/assets/theme/admin-lte-3/dist/img/logo-footer.png';
            
            $this->load->library('MedPDF');
            $pdf = new MedPDF('P', 'cm', array(21.5,33));
            $pdf->SetAutoPageBreak('auto', 7);
            $pdf->SetMargins(1,0.35,1);
            $pdf->header = 0;
            $pdf->addPage('','',false);
            
            // Gambar Watermark Tengah
            $pdf->Image($gambar2,5,4,17,19);
                        
            $judul = "SURAT PERSETUJUAN UMUM";

            # Blok Judul
            $pdf->SetFont('Arial', 'B', '14');
            $pdf->Cell(19, .5, $judul, 0, 1, 'C');
//            $pdf->Ln(0);
//            $pdf->SetFont('Arial', 'B', '10');
//            $pdf->Cell(19, .5, 'Nomor : ' . $sql_dft->no_surat, 0, 1, 'C');
            $pdf->Ln(); 

            // Blok Paragraf Pertama
            $fill = FALSE;
            $pdf->SetFont('Arial', '', '10');
            $pdf->Cell(19, .5, 'Yang bertanda tangan dibawah ini,', '', 0, 'L', $fill);
            $pdf->Ln(1);

            // Blok PENANGGUNG JAWAB
            $pdf->SetFont('Arial', 'B', '10');
            $pdf->Cell(1, .5, '', '0', 0, 'L', $fill);
            $pdf->Cell(4.5, .5, 'Nama Lengkap', '0', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
            $pdf->SetFont('Arial', '', '10');
            $pdf->Cell(12, .5, strtoupper($sql_dft_gc->nama), '0', 0, 'L', $fill);
            $pdf->Ln();
//            $pdf->SetFont('Arial', 'B', '10');
//            $pdf->Cell(1, .5, '', '0', 0, 'L', $fill);
//            $pdf->Cell(4.5, .5, 'Tanggal Lahir', '0', 0, 'L', $fill);
//            $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
//            $pdf->SetFont('Arial', '', '10');
//            $pdf->Cell(12, .5, ($sql_dft_gc->tgl_lahir != '0000-00-00' ? $this->tanggalan->tgl_indo2($sql_dft_gc->tgl_lahir) . ' (' . $this->tanggalan->usia($sql_dft_gc->tgl_lahir) . ')' : '-') . (!empty($sql_dft_gc->jns_klm) ? ' / ' . general::jns_klm($sql_dft_gc->jns_klm) : ''), '0', 0, 'L', $fill);
//            $pdf->Ln();
//            $pdf->SetFont('Arial', 'B', '10');
//            $pdf->Cell(1, .5, '', '0', 0, 'L', $fill);
//            $pdf->Cell(4.5, .5, 'Alamat', '0', 0, 'L', $fill);
//            $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
//            $pdf->SetFont('Arial', '', '10');
//            $pdf->MultiCell(12.5, .5, $sql_dft_gc->alamat, '', 'L', $fill);
            $pdf->SetFont('Arial', 'B', '10');
            $pdf->Cell(1, .5, '', '0', 0, 'L', $fill);
            $pdf->Cell(4.5, .5, 'Hubungan dengan pasien', '0', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
            $pdf->SetFont('Arial', '', '10');
            $pdf->Cell(12, .5, general::tipe_hubungan($sql_dft_gc->status_hub), '0', 0, 'L', $fill);
            $pdf->Ln(1);

            # Blok Paragraf kedua
            $pdf->SetFont('Arial', '', '10');
            $pdf->Cell(19, .5, 'Dengan ini menyatakan,', '', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->Cell(10, .5, 'Telah melihat, memahami dan menyetujui tarif yang berlaku di ', '', 0, 'L', $fill);
            $pdf->SetFont('Arial', 'B', '10');
            $pdf->Cell(9, .5, strtoupper($setting->judul), '', 0, 'L', $fill);
            $pdf->SetFont('Arial', '', '10');
            $pdf->Ln();
            $pdf->Cell(19, .5, 'beserta tindakan dan obat-obatan yang dimungkinkan. Sanggup menjamin kelancaran pembayaran semua biaya', '', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->Cell(19, .5, 'pelayanan bagi pasien :', '', 0, 'L', $fill);
            $pdf->Ln(1);

            // Blok ID PASIEN
            $pdf->SetFont('Arial', 'B', '10');
            $pdf->Cell(1, .5, '', '0', 0, 'L', $fill);
            $pdf->Cell(4.5, .5, 'NIK', '0', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
            $pdf->SetFont('Arial', '', '10');
            $pdf->Cell(12, .5, $sql_dft->nik, '0', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->SetFont('Arial', 'B', '10');
            $pdf->Cell(1, .5, '', '0', 0, 'L', $fill);
            $pdf->Cell(4.5, .5, 'Nama Lengkap', '0', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
            $pdf->SetFont('Arial', '', '10');
            $pdf->Cell(12, .5, $sql_dft->nama_pgl, '0', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->SetFont('Arial', 'B', '10');
            $pdf->Cell(1, .5, '', '0', 0, 'L', $fill);
            $pdf->Cell(4.5, .5, 'Tanggal Lahir', '0', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
            $pdf->SetFont('Arial', '', '10');
            $pdf->Cell(12, .5, $this->tanggalan->tgl_indo2($sql_dft->tgl_lahir) . ' (' . $this->tanggalan->usia_lkp($sql_dft->tgl_lahir) . ')' . (!empty($sql_dft->jns_klm) ? ' / ' . general::jns_klm($sql_dft->jns_klm) : ''), '0', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->SetFont('Arial', 'B', '10');
            $pdf->Cell(1, .5, '', '0', 0, 'L', $fill);
            $pdf->Cell(4.5, .5, 'Alamat', '0', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
            $pdf->SetFont('Arial', '', '10');
            $pdf->MultiCell(12.5, .5, $sql_dft->alamat, '', 'L', $fill);
//                    $pdf->Ln();
            $pdf->SetFont('Arial', 'B', '10');
            $pdf->Cell(1, .5, '', '0', 0, 'L', $fill);
            $pdf->Cell(4.5, .5, 'Tanggal Masuk', '0', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
            $pdf->SetFont('Arial', '', '10');
            $pdf->Cell(12, .5, $this->tanggalan->tgl_indo2($sql_dft->tgl_masuk), '0', 0, 'L', $fill);
            $pdf->Ln(1);

            $pdf->SetFont('Arial', '', '10');
            $pdf->Cell(19, .5, 'Demikian surat pernyataan ini dibuat dalam keadaan sadar tanpa ada tekanan dari pihak manapun.', '', 0, 'L', $fill);
            $pdf->Ln();

            # QR GENERATOR VALIDASI
            $qr_validasi = FCPATH . '/file/gc/' . $sql_dft->id . '/qr-petugas-' . strtolower($sql_dft->id) . '.png';
            $params['data'] = 'Telah diverifikasi dan ditandatangani secara elektronik oleh manajemen '.$setting->judul.'. Diwakili oleh ';
            $params['data'] .= strtoupper($this->ion_auth->user($sql_dft_gc->id_user)->row()->first_name) . ',';
            $params['data'] .= 'yang merupakan petugas yang bertugas pada tanggal ' . date('d/m/Y H:i') . '.';
            $params['level'] = 'H';
            $params['size'] = 2;
            $params['savename'] = $qr_validasi;
            $this->ciqrcode->generate($params);

            $gambar4 = $qr_validasi;

            # QR GENERATOR TANDA TANGAN
            $qr_ttd             = FCPATH.$sql_dft_gc->file_name;
            $gambar5            = $qr_ttd;  

            # Gambar VALIDASI
            $pdf->SetY(-10.5);
            $pdf->Image($gambar4, 2, $pdf->GetY(), 2, 2);
            $pdf->Image($gambar5, 12.5, $pdf->GetY(), 2, 2);

            $pdf->SetY(-11.5);
            $pdf->SetFont('Arial', '', '10');
            $pdf->Cell(11.5, .5, '', '', 0, 'L', $fill);
            $pdf->Cell(7.5, .5, 'Semarang, ' . $this->tanggalan->tgl_indo3($sql_dft->tgl_masuk), '', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->SetFont('Arial', '', '10');
            $pdf->Cell(4.5, .5, 'Petugas', '0', 0, 'C', $fill);
            $pdf->Cell(7.5, .5, '', '0', 0, 'C', $fill);
            $pdf->SetFont('Arial', '', '10');
            $pdf->Cell(7.5, .5, (!empty($ket) ? $ket : 'Yang Membuat Pernyataan'), '0', 0, 'L', $fill);
            $pdf->Ln(4);

            $pdf->SetY(-8.5);
            $pdf->SetFont('Arial', '', '10');
            $pdf->Cell(11.5, .5, $this->ion_auth->user($sql_dft_gc->id_user)->row()->first_name, '', 0, 'L', $fill);
            $pdf->Cell(7.5, .5, strtoupper($sql_dft_gc->nama), '', 0, 'L', $fill);
            $pdf->Ln();

            $pdf->SetFillColor(235, 232, 228);
            $pdf->SetTextColor(0);
            $pdf->SetFont('Arial', '', '10');

            $type = (isset($_GET['type']) ? $_GET['type'] : 'I');

            ob_start();
            $pdf->Output($sql_pasien->nama_pgl. '.pdf', $type);
            ob_end_flush();
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }
    
    public function pdf_medcheck_surat() {
        if (akses::aksesLogin() == TRUE) {
            $setting            = $this->db->get('tbl_pengaturan')->row();
            $id                 = $this->input->get('id');
            $id_medcheck        = $this->input->get('no_nota');

            $sql_medc           = $this->db->where('id', general::dekrip($id_medcheck))->get('tbl_trans_medcheck')->row();
            $sql_medc_srt       = $this->db->where('id', general::dekrip($id))->get('tbl_trans_medcheck_surat')->row(); 
            $sql_pasien         = $this->db->where('id', $sql_medc->id_pasien)->get('tbl_m_pasien')->row(); 
            $sql_pekerjaan      = $this->db->where('id', $sql_pasien->id_pekerjaan)->get('tbl_m_jenis_kerja')->row();
            $sql_dokter         = $this->db->where('id_user', $sql_medc_srt->id_dokter)->get('tbl_m_karyawan')->row();
            $kode_pasien        = $sql_pasien->kode_dpn.$sql_pasien->kode;
            $gambar1            = FCPATH.'/assets/theme/admin-lte-3/dist/img/logo-esensia-2.png';
            $gambar2            = FCPATH.'/assets/theme/admin-lte-3/dist/img/logo-bw-bg2-1440px.png';
            $gambar3            = FCPATH.'/assets/theme/admin-lte-3/dist/img/logo-footer.png';
            
            $this->load->library('MedPDF');
            $pdf = new MedPDF('P', 'cm', array(21.5,33));
            $pdf->SetAutoPageBreak('auto', 7);
            $pdf->SetMargins(1,0.35,1);
            $pdf->header = 0;
            $pdf->addPage('','',false);
            
            // Gambar Watermark Tengah
            $pdf->Image($gambar2,5,4,15,19);
                        
            // Blok Isi Surat
            switch ($sql_medc_srt->tipe){                
                case '1' :
                    $judul = "SURAT KETERANGAN ".strtoupper(general::tipe_surat($sql_medc_srt->tipe));

                    // Blok Judul
                    $pdf->SetFont('Arial', 'B', '14');
                    $pdf->Cell(19, .5, $judul, 0, 1, 'C');
                    $pdf->Ln(0);
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(19, .5, 'Nomor : '.$sql_medc_srt->no_surat, 0, 1, 'C');
                    $pdf->Ln();

                    // Blok Paragraf Pertama
                    $fill = FALSE;
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(19, .5, 'Yang bertanda tangan di bawah ini,', '', 0, 'L', $fill);
                    $pdf->Ln();
                    $pdf->Cell(19, .5, 'dokter di '.$setting->judul.', menerangkan bahwa:', '', 0, 'L', $fill);
                    $pdf->Ln(1);

                    // Blok ID PASIEN
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(1, .5, '', '0', 0, 'L', $fill);
                    $pdf->Cell(3.5, .5, 'Nama Lengkap', '0', 0, 'L', $fill);
                    $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(13, .5, $sql_pasien->nama_pgl, '0', 0, 'L', $fill);
                    $pdf->Ln();
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(1, .5, '', '0', 0, 'L', $fill);
                    $pdf->Cell(3.5, .5, 'Tanggal Lahir', '0', 0, 'L', $fill);
                    $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(13, .5, $this->tanggalan->tgl_indo2($sql_pasien->tgl_lahir), '0', 0, 'L', $fill);
                    $pdf->Ln();
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(1, .5, '', '0', 0, 'L', $fill);
                    $pdf->Cell(3.5, .5, 'Jenis Kelamin', '0', 0, 'L', $fill);
                    $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(13, .5, general::jns_klm($sql_pasien->jns_klm), '0', 0, 'L', $fill);
                    $pdf->Ln();
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(1, .5, '', '0', 0, 'L', $fill);
                    $pdf->Cell(3.5, .5, 'Pekerjaan', '0', 0, 'L', $fill);
                    $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(13, .5, $sql_pekerjaan->jenis, '0', 0, 'L', $fill);
                    $pdf->Ln();
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(1, .5, '', '0', 0, 'L', $fill);
                    $pdf->Cell(3.5, .5, 'Alamat', '0', 0, 'L', $fill);
                    $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->MultiCell(13, .5, (!empty($sql_pasien->alamat) ? $sql_pasien->alamat : (!empty($sql_pasien->alamat_dom) ? $sql_pasien->alamat_dom : '-')), '0', 'L');
                    $pdf->Ln(1);

                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(19, .5, 'Setelah dilakukan pemeriksaan, maka yang bersangkutan dinyatakan', '', 0, 'L', $fill);
                    $pdf->Ln();
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(19, .5, strtoupper(general::tipe_sehat($sql_medc_srt->hasil)), '', 0, 'C', $fill);
                    $pdf->Ln(1);
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(19, .5, 'Keterangan :', '', 0, 'L', $fill);
                    $pdf->Ln();
                    $pdf->Cell(4, .5, 'Tinggi Badan', '', 0, 'L', $fill);
                    $pdf->Cell(.5, .5, ':', '', 0, 'C', $fill);
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(5, .5, (float)$sql_medc_srt->tb.' cm', '', 0, 'L', $fill);
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(4, .5, 'Tekanan Darah', '', 0, 'L', $fill);
                    $pdf->Cell(.5, .5, ':', '', 0, 'C', $fill);
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(5, .5, $sql_medc_srt->td.' mmHg', '', 0, 'L', $fill);
                    $pdf->Ln();
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(4, .5, 'Buta Warna', '', 0, 'L', $fill);
                    $pdf->Cell(.5, .5, ':', '', 0, 'C', $fill);
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(5, .5, $sql_medc_srt->bw, '', 0, 'L', $fill);
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(4, .5, 'Berat Badan', '', 0, 'L', $fill);
                    $pdf->Cell(.5, .5, ':', '', 0, 'C', $fill);
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(5, .5, (float)$sql_medc_srt->bb.' kg', '', 0, 'L', $fill);
                    $pdf->Ln();
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(4, .5, 'Ket Buta Warna', '', 0, 'L', $fill);
                    $pdf->Cell(.5, .5, ':', '', 0, 'C', $fill);
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(14.5, .5, $sql_medc_srt->bw_ket, '', 0, 'L', $fill);
                    
//                    $pdf->SetFont('Arial', 'B', '10');
//                    $pdf->Cell(2, .5, $this->tanggalan->tgl_indo2($sql_medc_srt->tgl_keluar).'.', '', 0, 'L', $fill);
//                    $pdf->Ln();
//                    $pdf->SetFont('Arial', '', '10');
//                    $pdf->Cell(19, .5, 'Harap yang berkepentingan maklum.', '', 0, 'L', $fill);
                    $pdf->Ln(1);
            
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(19, .5, 'Demikian surat ini dibuat agar dapat digunakan sebagaimana mestinya.', '', 0, 'L', $fill);
                    $pdf->Ln(2);
                    break;
                
                case '2' :
                    $judul = "SURAT KETERANGAN ".strtoupper(general::tipe_surat($sql_medc_srt->tipe));

                    // Blok Judul
                    $pdf->SetFont('Arial', 'B', '14');
                    $pdf->Cell(19, .5, $judul, 0, 1, 'C');
                    $pdf->Ln(0);
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(19, .5, 'Nomor : '.$sql_medc_srt->no_surat, 0, 1, 'C');
                    $pdf->Ln();

                    // Blok Paragraf Pertama
                    $fill = FALSE;
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(19, .5, 'Yang bertanda tangan di bawah ini, dokter di '.$setting->judul.',', '0', 0, 'L', $fill);
                    $pdf->Ln();
                    $pdf->Cell(19, .5, 'menerangkan bahwa:', '0', 0, 'L', $fill);
                    $pdf->Ln(1);

                    // Blok ID PASIEN
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(1, .5, '', '0', 0, 'L', $fill);
                    $pdf->Cell(3.5, .5, 'Nama Lengkap', '0', 0, 'L', $fill);
                    $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(13, .5, $sql_pasien->nama_pgl, '0', 0, 'L', $fill);
                    $pdf->Ln();
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(1, .5, '', '0', 0, 'L', $fill);
                    $pdf->Cell(3.5, .5, 'Tanggal Lahir', '0', 0, 'L', $fill);
                    $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(13, .5, $this->tanggalan->tgl_indo2($sql_pasien->tgl_lahir), '0', 0, 'L', $fill);
                    $pdf->Ln();
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(1, .5, '', '0', 0, 'L', $fill);
                    $pdf->Cell(3.5, .5, 'Jenis Kelamin', '0', 0, 'L', $fill);
                    $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(13, .5, general::jns_klm($sql_pasien->jns_klm), '0', 0, 'L', $fill);
                    $pdf->Ln();
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(1, .5, '', '0', 0, 'L', $fill);
                    $pdf->Cell(3.5, .5, 'Pekerjaan', '0', 0, 'L', $fill);
                    $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(13, .5, $sql_pekerjaan->jenis, '0', 0, 'L', $fill);
                    $pdf->Ln();
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(1, .5, '', '0', 0, 'L', $fill);
                    $pdf->Cell(3.5, .5, 'Alamat', '0', 0, 'L', $fill);
                    $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
                    $pdf->SetFont('Arial', '', '10');$pdf->MultiCell(13, .5, (!empty($sql_pasien->alamat) ? $sql_pasien->alamat : (!empty($sql_pasien->alamat_dom) ? $sql_pasien->alamat_dom : '-')), '0', 'L');
                    $pdf->Ln(1);

                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(19, .5, 'Perlu beristirahat karena sakit sehingga tidak dapat melaksanakan kewajibannya,', '', 0, 'L', $fill);
                    $pdf->Ln();
                    $pdf->Cell(2, .5, 'selama : ', '', 0, 'L', $fill);
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(1.5, .5, $sql_medc_srt->jml_hari.' hari', '', 0, 'L', $fill);                  
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(5, .5, 'terhitung mulai tanggal', '', 0, 'L', $fill);
//                    $pdf->Ln();
//                    $pdf->Cell(2.5, .5, 'mulai tanggal', '', 0, 'L', $fill);
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(2.5, .5, $this->tanggalan->tgl_indo2($sql_medc_srt->tgl_masuk), '', 0, 'C', $fill);
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(1.5, .5, 's/d', '', 0, 'C', $fill);
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(2.5, .5, ($sql_medc_srt->status_sembuh == '1' ? 'Sembuh' : ($sql_medc_srt->tgl_keluar != '0000-00-00' ? $this->tanggalan->tgl_indo2($sql_medc_srt->tgl_keluar) : '-')).'.', '', 0, 'C', $fill);
                    $pdf->Ln();
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(19, .5, 'Harap yang berkepentingan maklum.', '', 0, 'L', $fill);
                    $pdf->Ln(1);
            
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(19, .5, 'Demikian surat ini dibuat agar dapat digunakan sebagaimana mestinya.', '', 0, 'L', $fill);
                    $pdf->Ln(2);
                    break;
                
                case '3' :
                    $judul = "SURAT KETERANGAN ".strtoupper(general::tipe_surat($sql_medc_srt->tipe));

                    // Blok Judul
                    $pdf->SetFont('Arial', 'B', '14');
                    $pdf->Cell(19, .5, $judul, 0, 1, 'C');
                    $pdf->Ln(0);
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(19, .5, 'Nomor : '.$sql_medc_srt->no_surat, 0, 1, 'C');
                    $pdf->Ln();

                    // Blok Paragraf Pertama
                    $fill = FALSE;
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(19, .5, 'Yang bertanda tangan di bawah ini, dokter di '.$setting->judul.',', '', 0, 'L', $fill);
                    $pdf->Ln();
                    $pdf->Cell(19, .5, 'menerangkan bahwa:', '', 0, 'L', $fill);
                    $pdf->Ln(1);

                    // Blok ID PASIEN
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(2, .5, '', '0', 0, 'L', $fill);
                    $pdf->Cell(3.5, .5, 'Nama Lengkap', '0', 0, 'L', $fill);
                    $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(13, .5, $sql_pasien->nama_pgl, '0', 0, 'L', $fill);
                    $pdf->Ln();
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(2, .5, '', '0', 0, 'L', $fill);
                    $pdf->Cell(3.5, .5, 'Tanggal Lahir', '0', 0, 'L', $fill);
                    $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(13, .5, $this->tanggalan->tgl_indo2($sql_pasien->tgl_lahir), '0', 0, 'L', $fill);
                    $pdf->Ln();
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(2, .5, '', '0', 0, 'L', $fill);
                    $pdf->Cell(3.5, .5, 'Jenis Kelamin', '0', 0, 'L', $fill);
                    $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(13, .5, general::jns_klm($sql_pasien->jns_klm), '0', 0, 'L', $fill);
                    $pdf->Ln();
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(2, .5, '', '0', 0, 'L', $fill);
                    $pdf->Cell(3.5, .5, 'Pekerjaan', '0', 0, 'L', $fill);
                    $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(13, .5, $sql_pekerjaan->jenis, '0', 0, 'L', $fill);
                    $pdf->Ln();
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(2, .5, '', '0', 0, 'L', $fill);
                    $pdf->Cell(3.5, .5, 'Alamat', '0', 0, 'L', $fill);
                    $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
                    $pdf->SetFont('Arial', '', '10');$pdf->MultiCell(13, .5, (!empty($sql_pasien->alamat) ? $sql_pasien->alamat : (!empty($sql_pasien->alamat_dom) ? $sql_pasien->alamat_dom : '-')), '0', 'L');
                    $pdf->Ln(1);

                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(19, .5, 'Bahwa pasien sedang dalam perawatan di kamar rawat inap kami, sehingga tidak dapat', '', 0, 'L', $fill);
                    $pdf->Ln();
                    $pdf->Cell(8.5, .5, 'melaksanakan kewajibannya mulai tanggal', '', 0, 'L', $fill);
//                    $pdf->Ln();
//                    $pdf->Cell(2.5, .5, 'mulai tanggal', '0', 0, 'L', $fill);
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(2.5, .5, $this->tanggalan->tgl_indo2($sql_medc_srt->tgl_masuk), '', 0, 'C', $fill);
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(1, .5, 's/d ', '0', 0, 'C', $fill);
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(7, .5, ($sql_medc_srt->status_sembuh == '1' ? 'Sembuh' : $this->tanggalan->tgl_indo2($sql_medc_srt->tgl_keluar)).'.', '', 0, 'L', $fill);
                    $pdf->Ln();
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(19, .5, 'Harap yang berkepentingan maklum.', '', 0, 'L', $fill);
                    $pdf->Ln(1);
            
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(19, .5, 'Demikian surat ini dibuat agar dapat digunakan sebagaimana mestinya.', '', 0, 'L', $fill);
                    $pdf->Ln(2);
                    break;
                
                case '4' :
                    $judul = "SURAT KETERANGAN ".strtoupper(general::tipe_surat($sql_medc_srt->tipe));

                    // Blok Judul
                    $pdf->SetFont('Arial', 'B', '14');
                    $pdf->Cell(19, .5, $judul, 0, 1, 'C');
                    $pdf->Ln(0);
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(19, .5, 'Nomor : '.$sql_medc_srt->no_surat, 0, 1, 'C');
                    $pdf->Ln();

                    // Blok Paragraf Pertama
                    $fill = FALSE;
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(19, .5, 'Yang bertanda tangan di bawah ini, dokter di '.$setting->judul.',', '', 0, 'L', $fill);
                    $pdf->Ln();
                    $pdf->Cell(19, .5, 'menerangkan bahwa:', '', 0, 'L', $fill);
                    $pdf->Ln(1);

                    // Blok ID PASIEN
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(2, .5, '', '0', 0, 'L', $fill);
                    $pdf->Cell(3.5, .5, 'Nama Lengkap', '0', 0, 'L', $fill);
                    $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(13, .5, $sql_pasien->nama_pgl, '0', 0, 'L', $fill);
                    $pdf->Ln();
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(2, .5, '', '0', 0, 'L', $fill);
                    $pdf->Cell(3.5, .5, 'Tanggal Lahir', '0', 0, 'L', $fill);
                    $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(13, .5, $this->tanggalan->tgl_indo2($sql_pasien->tgl_lahir), '0', 0, 'L', $fill);
                    $pdf->Ln();
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(2, .5, '', '0', 0, 'L', $fill);
                    $pdf->Cell(3.5, .5, 'Jenis Kelamin', '0', 0, 'L', $fill);
                    $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(13, .5, general::jns_klm($sql_pasien->jns_klm), '0', 0, 'L', $fill);
                    $pdf->Ln();
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(2, .5, '', '0', 0, 'L', $fill);
                    $pdf->Cell(3.5, .5, 'Pekerjaan', '0', 0, 'L', $fill);
                    $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(13, .5, $sql_pekerjaan->jenis, '0', 0, 'L', $fill);
                    $pdf->Ln();
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(2, .5, '', '0', 0, 'L', $fill);
                    $pdf->Cell(3.5, .5, 'Alamat', '0', 0, 'L', $fill);
                    $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
                    $pdf->SetFont('Arial', '', '10');$pdf->MultiCell(13, .5, (!empty($sql_pasien->alamat) ? $sql_pasien->alamat : (!empty($sql_pasien->alamat_dom) ? $sql_pasien->alamat_dom : '-')), '0', 'L');
                    $pdf->Ln(1);

                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(19, .5, 'Bahwa yang bersangkutan telah menjalani pemeriksaan di '.$setting->judul.'.', '', 0, 'L', $fill);
                    $pdf->Ln();
                    $pdf->Cell(19, .5, 'Sehubungan masih dalam perawatan atas sakitnya, ', '', 0, 'L', $fill);
                    $pdf->Ln();
                    $pdf->Cell(4.25, .5, 'mohon kiranya untuk', '0', 0, 'L', $fill);
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(2, .5, 'Kontrol', '0', 0, 'C', $fill);
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(2.5, .5, 'pada tanggal ', '', 0, 'L', $fill);
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(5, .5, ' '.$this->tanggalan->tgl_indo2($sql_medc_srt->tgl_kontrol).'.', '', 0, 'L', $fill);
                    $pdf->Ln(1);
            
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(19, .5, 'Demikian surat ini dibuat agar dapat digunakan sebagaimana mestinya.', '', 0, 'L', $fill);
                    $pdf->Ln(2);
                    break;
                
                case '5' :
                    $judul = "SURAT KETERANGAN ".strtoupper(general::tipe_surat($sql_medc_srt->tipe));

                    // Blok Judul
                    $pdf->SetFont('Arial', 'B', '14');
                    $pdf->Cell(19, .5, $judul, 0, 1, 'C');
                    $pdf->Ln(0);
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(19, .5, 'Nomor : '.$sql_medc_srt->no_surat, 0, 1, 'C');
                    $pdf->Ln();

                    // Blok Paragraf Pertama
                    $fill = FALSE;
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(19, .5, 'Yang bertanda tangan di bawah ini,', '', 0, 'L', $fill);
                    $pdf->Ln();
                    $pdf->Cell(9, .5, 'menerangkan bahwa telah lahir seorang bayi', '', 0, 'L', $fill);
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(2.5, .5, general::jns_klm($sql_medc_srt->jns_klm), '', 0, 'C', $fill);
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(1.5, .5, ':', '', 0, 'L', $fill);
                    $pdf->Ln(1);

                    // BLOK WAKTU LAHIR
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(1, .5, '', '0', 0, 'L', $fill);
                    $pdf->Cell(3.5, .5, 'Tanggal Lahir', '0', 0, 'L', $fill);
                    $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(14, .5, $this->tanggalan->tgl_indo2($sql_medc_srt->lahir_tgl), '0', 0, 'L', $fill);
                    $pdf->Ln();
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(1, .5, '', '0', 0, 'L', $fill);
                    $pdf->Cell(3.5, .5, 'Waktu Lahir', '0', 0, 'L', $fill);
                    $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(14, .5, $this->tanggalan->wkt_indo($sql_medc_srt->lahir_tgl).' WIB', '0', 0, 'L', $fill);
                    $pdf->Ln();
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(1, .5, '', '0', 0, 'L', $fill);
                    $pdf->Cell(3.5, .5, 'Nama Anak', '0', 0, 'L', $fill);
                    $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(14, .5, strtoupper($sql_medc_srt->lahir_nm), '0', 0, 'L', $fill);
                    $pdf->Ln(1);
                    
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(19, .5, 'ANAK DARI', '0', 0, 'C', $fill);
                    $pdf->Ln(1);
                    
                    // Blok ID PASIEN
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(1, .5, '', '0', 0, 'L', $fill);
                    $pdf->Cell(3.5, .5, 'Nama Ayah', '0', 0, 'L', $fill);
                    $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(14, .5, $sql_medc_srt->lahir_nm_ayah, '0', 0, 'L', $fill);
                    $pdf->Ln();
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(1, .5, '', '0', 0, 'L', $fill);
                    $pdf->Cell(3.5, .5, 'Nama Ibu', '0', 0, 'L', $fill);
                    $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(14, .5, $sql_medc_srt->lahir_nm_ibu, '0', 0, 'L', $fill);
                    $pdf->Ln();
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(1, .5, '', '0', 0, 'L', $fill);
                    $pdf->Cell(3.5, .5, 'Alamat', '0', 0, 'L', $fill);
                    $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->MultiCell(14, .5, $sql_pasien->alamat, '0', 'L');
                    $pdf->Ln();
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(1, .5, '', '0', 0, 'L', $fill);
                    $pdf->Cell(3.5, .5, 'Berat Lahir', '0', 0, 'L', $fill);
                    $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(14, .5, (float)$sql_medc_srt->bb.' Kg', '0', 0, 'L', $fill);
                    $pdf->Ln();
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(1, .5, '', '0', 0, 'L', $fill);
                    $pdf->Cell(3.5, .5, 'Panjang Badan', '0', 0, 'L', $fill);
                    $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(14, .5, (float)$sql_medc_srt->tb.' cm', '0', 0, 'L', $fill);
                    $pdf->Ln(1);
            
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(19, .5, 'Demikian Surat Keterangan Kelahiran ini dibuat dengan sesungguhnya,', '', 0, 'L', $fill);
                    $pdf->Ln();
                    $pdf->Cell(19, .5, 'untuk dipergunakan sebagaimana mestinya.', '', 0, 'L', $fill);
                    $pdf->Ln(2);
                    break;
                
                case '6' :
                    $judul = "SURAT KETERANGAN ".strtoupper(general::tipe_surat($sql_medc_srt->tipe));

                    // Blok Judul
                    $pdf->SetFont('Arial', 'B', '14');
                    $pdf->Cell(19, .5, $judul, 0, 1, 'C');
                    $pdf->Ln(0);
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(19, .5, 'Nomor : '.$sql_medc_srt->no_surat, 0, 1, 'C');
                    $pdf->Ln();

                    // Blok Paragraf Pertama
                    $fill = FALSE;
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(19, .5, 'Yang bertanda tangan di bawah ini, menerangkan bahwa :', '', 0, 'L', $fill);
                    $pdf->Ln(1);
                    
                    // Blok ID PASIEN
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(1, .5, '', '0', 0, 'L', $fill);
                    $pdf->Cell(3.5, .5, 'Nama Lengkap', '0', 0, 'L', $fill);
                    $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(14, .5, $sql_pasien->nama_pgl, '0', 0, 'L', $fill);
                    $pdf->Ln();
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(1, .5, '', '0', 0, 'L', $fill);
                    $pdf->Cell(3.5, .5, 'Tanggal Lahir', '0', 0, 'L', $fill);
                    $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(14, .5, $this->tanggalan->tgl_indo2($sql_pasien->tgl_lahir), '0', 0, 'L', $fill);
                    $pdf->Ln();
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(1, .5, '', '0', 0, 'L', $fill);
                    $pdf->Cell(3.5, .5, 'Jenis Kelamin', '0', 0, 'L', $fill);
                    $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(14, .5, general::jns_klm($sql_pasien->jns_klm), '0', 0, 'L', $fill);
                    $pdf->Ln();
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(1, .5, '', '0', 0, 'L', $fill);
                    $pdf->Cell(3.5, .5, 'Pekerjaan', '0', 0, 'L', $fill);
                    $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(14, .5, $sql_pekerjaan->jenis, '0', 0, 'L', $fill);
                    $pdf->Ln();
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(1, .5, '', '0', 0, 'L', $fill);
                    $pdf->Cell(3.5, .5, 'Alamat', '0', 0, 'L', $fill);
                    $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(14, .5, $sql_pasien->alamat, '0', 0, 'L', $fill);
                    $pdf->Ln(1);
                    
                    $pdf->SetFont('Arial', 'B', '14');
                    $pdf->Cell(19, .5, 'TELAH MENINGGAL DUNIA', '0', 0, 'C', $fill);
                    $pdf->Ln(1);
                    
                    // BLOK WAKTU KEMATIAN
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(1, .5, '', '0', 0, 'L', $fill);
                    $pdf->Cell(3.5, .5, 'Hari / Tanggal', '0', 0, 'L', $fill);
                    $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(14, .5, $this->tanggalan->tgl_indo6($sql_medc_srt->mati_tgl), '0', 0, 'L', $fill);
                    $pdf->Ln();
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(1, .5, '', '0', 0, 'L', $fill);
                    $pdf->Cell(3.5, .5, 'Waktu', '0', 0, 'L', $fill);
                    $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(14, .5, $this->tanggalan->wkt_indo($sql_medc_srt->mati_tgl).' WIB', '0', 0, 'L', $fill);
                    $pdf->Ln();
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(1, .5, '', '0', 0, 'L', $fill);
                    $pdf->Cell(3.5, .5, 'Tempat', '0', 0, 'L', $fill);
                    $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(14, .5, $sql_medc_srt->mati_tmp, '0', 0, 'L', $fill);
                    $pdf->Ln();
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(1, .5, '', '0', 0, 'L', $fill);
                    $pdf->Cell(3.5, .5, 'Penyebab', '0', 0, 'L', $fill);
                    $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(14, .5, $sql_medc_srt->mati_penyebab, '0', 0, 'L', $fill);
                    $pdf->Ln(1);
            
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(19, .5, 'Demikian Surat Keterangan Kematian ini dibuat dengan sesungguhnya,', '', 0, 'L', $fill);
                    $pdf->Ln();
                    $pdf->Cell(19, .5, 'untuk dipergunakan sebagaimana mestinya.', '', 0, 'L', $fill);
                    $pdf->Ln(2);
                    break;
                
                case '7' :
                    $judul = "SURAT KETERANGAN ".strtoupper(general::tipe_surat($sql_medc_srt->tipe));

                    // Blok Judul
                    $pdf->SetFont('Arial', 'B', '14');
                    $pdf->Cell(19, .5, $judul, 0, 1, 'C');
                    $pdf->Ln(0);
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(19, .5, 'Nomor : '.$sql_medc_srt->no_surat, 0, 1, 'C');
                    $pdf->Ln();

                    // Blok Paragraf Pertama
                    $fill = FALSE;
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(19, .5, 'Yang bertanda tangan di bawah ini, menerangkan bahwa :', '', 0, 'L', $fill);
                    $pdf->Ln(1);
                    
                    // Blok ID PASIEN
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(1, .5, '', '0', 0, 'L', $fill);
                    $pdf->Cell(3.5, .5, 'Nama Lengkap', '0', 0, 'L', $fill);
                    $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(14, .5, $sql_pasien->nama_pgl, '0', 0, 'L', $fill);
                    $pdf->Ln();
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(1, .5, '', '0', 0, 'L', $fill);
                    $pdf->Cell(3.5, .5, 'Tanggal Lahir', '0', 0, 'L', $fill);
                    $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(14, .5, $this->tanggalan->tgl_indo2($sql_pasien->tgl_lahir), '0', 0, 'L', $fill);
                    $pdf->Ln();
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(1, .5, '', '0', 0, 'L', $fill);
                    $pdf->Cell(3.5, .5, 'Jenis Kelamin', '0', 0, 'L', $fill);
                    $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(14, .5, general::jns_klm($sql_pasien->jns_klm), '0', 0, 'L', $fill);
                    $pdf->Ln();
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(1, .5, '', '0', 0, 'L', $fill);
                    $pdf->Cell(3.5, .5, 'Pekerjaan', '0', 0, 'L', $fill);
                    $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(14, .5, $sql_pekerjaan->jenis, '0', 0, 'L', $fill);
                    $pdf->Ln();
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(1, .5, '', '0', 0, 'L', $fill);
                    $pdf->Cell(3.5, .5, 'Alamat', '0', 0, 'L', $fill);
                    $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(14, .5, $sql_pasien->alamat, '0', 0, 'L', $fill);
                    $pdf->Ln(1);
                    
                    $pdf->SetFont('Arial', 'B', '14');
                    $pdf->Cell(19, .5, 'TELAH MENINGGAL DUNIA', '0', 0, 'C', $fill);
                    $pdf->Ln(1);
                    
                    // BLOK WAKTU KEMATIAN
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(1, .5, '', '0', 0, 'L', $fill);
                    $pdf->Cell(3.5, .5, 'Hari / Tanggal', '0', 0, 'L', $fill);
                    $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(14, .5, $this->tanggalan->tgl_indo6($sql_medc_srt->mati_tgl), '0', 0, 'L', $fill);
                    $pdf->Ln();
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(1, .5, '', '0', 0, 'L', $fill);
                    $pdf->Cell(3.5, .5, 'Waktu', '0', 0, 'L', $fill);
                    $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(14, .5, $this->tanggalan->wkt_indo($sql_medc_srt->mati_tgl).' WIB', '0', 0, 'L', $fill);
                    $pdf->Ln();
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(1, .5, '', '0', 0, 'L', $fill);
                    $pdf->Cell(3.5, .5, 'Tempat', '0', 0, 'L', $fill);
                    $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(14, .5, $sql_medc_srt->mati_tmp, '0', 0, 'L', $fill);
                    $pdf->Ln();
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(1, .5, '', '0', 0, 'L', $fill);
                    $pdf->Cell(3.5, .5, 'Penyebab', '0', 0, 'L', $fill);
                    $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(14, .5, $sql_medc_srt->mati_penyebab, '0', 0, 'L', $fill);
                    $pdf->Ln(1);
            
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(19, .5, 'Demikian Surat Keterangan Kematian ini dibuat dengan sesungguhnya,', '', 0, 'L', $fill);
                    $pdf->Ln();
                    $pdf->Cell(19, .5, 'untuk dipergunakan sebagaimana mestinya.', '', 0, 'L', $fill);
                    $pdf->Ln(2);
                    break;
                
                case '8' :
                    $judul = "SURAT ".strtoupper(general::tipe_surat($sql_medc_srt->tipe));

                    // Blok Judul
                    $pdf->SetFont('Arial', 'B', '14');
                    $pdf->Cell(19, .5, $judul, 0, 1, 'C');
                    $pdf->Ln(0);
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(19, .5, 'Nomor : '.$sql_medc_srt->no_surat, 0, 1, 'C');
                    $pdf->Ln();
                    
                    // BLOK TUJUAN RUJUKAN
                    $pdf->SetFont('Arial', 'B', '10');
//                    $pdf->Cell(1, .5, '', '0', 0, 'L', $fill);
                    $pdf->Cell(3.5, .5, 'Kepada Yth', '0', 0, 'L', $fill);
                    $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(14, .5, $sql_medc_srt->ruj_dokter, '0', 0, 'L', $fill);
                    $pdf->Ln();
                    $pdf->SetFont('Arial', 'B', '10');
//                    $pdf->Cell(1, .5, '', '0', 0, 'L', $fill);
                    $pdf->Cell(3.5, .5, 'di', '0', 0, 'L', $fill);
                    $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(14, .5, $sql_medc_srt->ruj_faskes, '0', 0, 'L', $fill);
                    $pdf->Ln(1);

                    // Blok Paragraf Pertama
                    $fill = FALSE;
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(19, .5, 'Mohon penatalaksanaan lebih lanjut terhadap pasien :', '', 0, 'L', $fill);
                    $pdf->Ln(1);
                    
                    // Blok ID PASIEN
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(1, .5, '', '0', 0, 'L', $fill);
                    $pdf->Cell(3.5, .5, 'Nama Lengkap', '0', 0, 'L', $fill);
                    $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(14, .5, $sql_pasien->nama_pgl, '0', 0, 'L', $fill);
                    $pdf->Ln();
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(1, .5, '', '0', 0, 'L', $fill);
                    $pdf->Cell(3.5, .5, 'Tanggal Lahir', '0', 0, 'L', $fill);
                    $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(14, .5, $this->tanggalan->tgl_indo2($sql_pasien->tgl_lahir), '0', 0, 'L', $fill);
                    $pdf->Ln();
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(1, .5, '', '0', 0, 'L', $fill);
                    $pdf->Cell(3.5, .5, 'Jenis Kelamin', '0', 0, 'L', $fill);
                    $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(14, .5, general::jns_klm($sql_pasien->jns_klm), '0', 0, 'L', $fill);
                    $pdf->Ln();
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(1, .5, '', '0', 0, 'L', $fill);
                    $pdf->Cell(3.5, .5, 'Pekerjaan', '0', 0, 'L', $fill);
                    $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(14, .5, $sql_pekerjaan->jenis, '0', 0, 'L', $fill);
                    $pdf->Ln();
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(1, .5, '', '0', 0, 'L', $fill);
                    $pdf->Cell(3.5, .5, 'Alamat', '0', 0, 'L', $fill);
                    $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(14, .5, $sql_pasien->alamat, '0', 0, 'L', $fill);
                    $pdf->Ln(1);
                    
                    // BLOK KETERANGAN
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(3.5, .5, 'RIWAYAT KELUHAN', '0', 0, 'L', $fill);
                    $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
                    $pdf->Ln();
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->MultiCell(19, .5, $sql_medc_srt->ruj_keluhan, '', 'J', false);
                    $pdf->Ln();
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(3.5, .5, 'DIAGNOSIS SEMENTARA', '0', 0, 'L', $fill);
                    $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
                    $pdf->Ln();
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->MultiCell(19, .5, $sql_medc_srt->ruj_diagnosa, '', 'J', false);
                    $pdf->Ln();
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(3.5, .5, 'TERAPI YANG TELAH DIBERIKAN', '0', 0, 'L', $fill);
                    $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
                    $pdf->Ln();
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->MultiCell(19, .5, $sql_medc_srt->ruj_terapi, '', 'J', false);
                    $pdf->Ln(1);
            
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(19, .5, 'Demikian surat rujukan ini, atas kerjasama dan perhatian Teman Sejawat', '', 0, 'L', $fill);
                    $pdf->Ln();
                    $pdf->Cell(19, .5, 'kami ucapkan terimakasih.', '', 0, 'L', $fill);
                    $pdf->Ln(2);
                    
                    $ket = 'Salam Sejawat';
                    break;
                                
                case '9' :
                    $judul = "SURAT KETERANGAN";

                    // Blok Judul
                    $pdf->SetFont('Arial', 'B', '14');
                    $pdf->Cell(19, .5, $judul, 0, 1, 'C');
                    $pdf->Ln(0);
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(19, .5, 'Nomor : '.$sql_medc_srt->no_surat, 0, 1, 'C');
                    $pdf->Ln();

                    // Blok Paragraf Pertama
                    $fill = FALSE;
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->MultiCell(19, .5, 'Yang bertanda tangan di bawah ini '.(!empty($sql_dokter->nama_dpn) ? $sql_dokter->nama_dpn.' ' : '').$sql_dokter->nama.(!empty($sql_dokter->nama_blk) ? ', '.$sql_dokter->nama_blk : '').', dokter pada '.$setting->judul.' menerangkan bahwa :', '0', 'L');
                    $pdf->Ln(1);

                    // Blok ID PASIEN
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(1, .5, '', '0', 0, 'L', $fill);
                    $pdf->Cell(3.5, .5, 'No. RM', '0', 0, 'L', $fill);
                    $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(13, .5, $sql_pasien->kode_dpn.$sql_pasien->kode, '0', 0, 'L', $fill);
                    $pdf->Ln();
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(1, .5, '', '0', 0, 'L', $fill);
                    $pdf->Cell(3.5, .5, 'Nama Lengkap', '0', 0, 'L', $fill);
                    $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(13, .5, $sql_pasien->nama_pgl, '0', 0, 'L', $fill);
                    $pdf->Ln();
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(1, .5, '', '0', 0, 'L', $fill);
                    $pdf->Cell(3.5, .5, 'Tanggal Lahir', '0', 0, 'L', $fill);
                    $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(13, .5, $this->tanggalan->tgl_indo2($sql_pasien->tgl_lahir).' - '.$this->tanggalan->usia($sql_pasien->tgl_lahir), '0', 0, 'L', $fill);
                    $pdf->Ln();
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(1, .5, '', '0', 0, 'L', $fill);
                    $pdf->Cell(3.5, .5, 'Jenis Kelamin', '0', 0, 'L', $fill);
                    $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(13, .5, general::jns_klm($sql_pasien->jns_klm), '0', 0, 'L', $fill);
                    $pdf->Ln();
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(1, .5, '', '0', 0, 'L', $fill);
                    $pdf->Cell(3.5, .5, 'Pekerjaan', '0', 0, 'L', $fill);
                    $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(13, .5, $sql_pekerjaan->jenis, '0', 0, 'L', $fill);
                    $pdf->Ln();
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(1, .5, '', '0', 0, 'L', $fill);
                    $pdf->Cell(3.5, .5, 'Alamat', '0', 0, 'L', $fill);
                    $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
                    $pdf->SetFont('Arial', '', '10');
//                    $pdf->Cell(13, .5, $sql_pasien->alamat, '0', 0, 'L', $fill);
                    $pdf->MultiCell(13, .5, $sql_pasien->alamat, '0', 'L');
                    $pdf->Ln(1);

                    $pdf->SetFont('Arial', '', '10');
                    $pdf->MultiCell(19, .5, 'Berdasarkan pemeriksaan yang dilakukan pada tanggal '.$this->tanggalan->tgl_indo3($sql_medc_srt->vks_tgl_periksa).' menerangkan bahwa pasien diatas telah diberikan vaksin '.$sql_medc_srt->keterangan.' di '.$setting->judul.' dan dinyatakan sehat.', '0', 'J');
//                    $pdf->Cell(10, .5, 'Berdasarkan pemeriksaan yang dilakukan pada tanggal ', '', 0, 'L', $fill);
//                    $pdf->SetFont('Arial', 'i', '10');
//                    $pdf->Cell(3.5, .5, $this->tanggalan->tgl_indo3($sql_medc_srt->vks_tgl_periksa), '', 0, 'C', $fill);
//                    $pdf->SetFont('Arial', '', '10');
//                    $pdf->Cell(11.5, .5, 'di '.$setting->judul, '', 0, 'L', $fill);
//                    $pdf->Ln();
//                    $pdf->SetFont('Arial', 'Bi', '10');
//                    $pdf->Cell(1, .5, '', '', 0, 'L', $fill);
//                    $pdf->Cell(18, .5, $sql_medc_srt->keterangan, '', 0, 'L', $fill);
                    $pdf->Ln();
            
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(19, .5, 'Demikian surat keterangan ini dibuat agar dapat digunakan sebagaimana mestinya.', '', 0, 'L', $fill);
                    $pdf->Ln(2);
                    break;
                                
                case '10' :
                    $judul = "SURAT KETERANGAN KEHAMILAN";
                    
                    $tgl_awal       = date_create($this->tanggalan->tgl_indo_sys($sql_medc_srt->hml_tgl_awal));
                    $tgl_akhir      = date_create($this->tanggalan->tgl_indo_sys($sql_medc_srt->hml_tgl_akhir));
                    $diff           = date_diff($tgl_awal, $tgl_akhir);
                    $hari           = $diff->format("%d%");
                    $jml_hari       = ($tgl_awal == $tgl_akhir ? '1' : ($hari > 1 ? $hari + 1 : '2'));

                    // Blok Judul
                    $pdf->SetFont('Arial', 'B', '14');
                    $pdf->Cell(19, .5, $judul, 0, 1, 'C');
                    $pdf->Ln(0);
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(19, .5, 'Nomor : '.$sql_medc_srt->no_surat, 0, 1, 'C');
                    $pdf->Ln();

                    // Blok Paragraf Pertama
                    $fill = FALSE;
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->MultiCell(19, .5, 'Yang bertanda tangan di bawah ini '.(!empty($sql_dokter->nama_dpn) ? $sql_dokter->nama_dpn.' ' : '').$sql_dokter->nama.(!empty($sql_dokter->nama_blk) ? ', '.$sql_dokter->nama_blk : '').', dokter pada '.$setting->judul.' menerangkan bahwa :', '0', 'L');
                    $pdf->Ln(1);

                    // Blok ID PASIEN
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(1, .5, '', '0', 0, 'L', $fill);
                    $pdf->Cell(3.5, .5, 'No. RM', '0', 0, 'L', $fill);
                    $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(13, .5, $sql_pasien->kode_dpn.$sql_pasien->kode, '0', 0, 'L', $fill);
                    $pdf->Ln();
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(1, .5, '', '0', 0, 'L', $fill);
                    $pdf->Cell(3.5, .5, 'Nama Lengkap', '0', 0, 'L', $fill);
                    $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(13, .5, $sql_pasien->nama_pgl, '0', 0, 'L', $fill);
                    $pdf->Ln();
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(1, .5, '', '0', 0, 'L', $fill);
                    $pdf->Cell(3.5, .5, 'Tanggal Lahir', '0', 0, 'L', $fill);
                    $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(13, .5, $this->tanggalan->tgl_indo2($sql_pasien->tgl_lahir).' - '.$this->tanggalan->usia($sql_pasien->tgl_lahir), '0', 0, 'L', $fill);
                    $pdf->Ln();
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(1, .5, '', '0', 0, 'L', $fill);
                    $pdf->Cell(3.5, .5, 'Jenis Kelamin', '0', 0, 'L', $fill);
                    $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(13, .5, general::jns_klm($sql_pasien->jns_klm), '0', 0, 'L', $fill);
                    $pdf->Ln();
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(1, .5, '', '0', 0, 'L', $fill);
                    $pdf->Cell(3.5, .5, 'Pekerjaan', '0', 0, 'L', $fill);
                    $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(13, .5, $sql_pekerjaan->jenis, '0', 0, 'L', $fill);
                    $pdf->Ln();
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(1, .5, '', '0', 0, 'L', $fill);
                    $pdf->Cell(3.5, .5, 'Alamat', '0', 0, 'L', $fill);
                    $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
                    $pdf->SetFont('Arial', '', '10');
//                    $pdf->Cell(13, .5, $sql_pasien->alamat, '0', 0, 'L', $fill);
                    $pdf->MultiCell(13, .5, $sql_pasien->alamat, '0', 'L');
                    $pdf->Ln(1);

                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(19, .5, 'Pemeriksaan dalam keadaan', '', 0, 'L', $fill);
                    $pdf->Ln();
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->MultiCell(19, .5, $sql_medc_srt->hml_periksa, '0', 'J');
//                    $pdf->Cell(10, .5, 'Berdasarkan pemeriksaan yang dilakukan pada tanggal ', '', 0, 'L', $fill);
//                    $pdf->SetFont('Arial', 'i', '10');
//                    $pdf->Cell(3.5, .5, $this->tanggalan->tgl_indo3($sql_medc_srt->vks_tgl_periksa), '', 0, 'C', $fill);
//                    $pdf->SetFont('Arial', '', '10');
//                    $pdf->Cell(11.5, .5, 'di '.$setting->judul, '', 0, 'L', $fill);
//                    $pdf->Ln();
//                    $pdf->SetFont('Arial', 'Bi', '10');
//                    $pdf->Cell(1, .5, '', '', 0, 'L', $fill);
//                    $pdf->Cell(18, .5, $sql_medc_srt->keterangan, '', 0, 'L', $fill);
//                    $pdf->Ln();
//                    $pdf->Cell(1, .5, ($sql_medc_srt->hml_tipe_ijin == '1' ? 'V' : ''), '1', 0, 'C', $fill);
//                    $pdf->Cell(10, .5, 'Perlu cuti hamil / bersalin selama 3 (tiga) bulan terhitung dari ', 'TB', 0, 'L', $fill);
//                    $pdf->Cell(2, .5, ($sql_medc_srt->hml_tipe_ijin == '1' ? $this->tanggalan->tgl_indo2($sql_medc_srt->hml_tgl_awal) : ''), 'TB', 0, 'L', $fill);
//                    $pdf->Cell(1, .5, 's/d', 'TB', 0, 'C', $fill);
//                    $pdf->Cell(4, .5, ($sql_medc_srt->hml_tipe_ijin == '1' ? $this->tanggalan->tgl_indo2($sql_medc_srt->hml_tgl_akhir) : ''), 'TBR', 0, 'L', $fill);
                    $pdf->Ln();
                    
                    if($sql_medc_srt->hml_tipe_ijin == '1'){
                        $pdf->Cell(1, .5, '- ', '', 0, 'C', $fill);
                        $pdf->Cell(10, .5, 'Perlu cuti hamil / bersalin selama 3 (tiga) bulan terhitung dari ', '', 0, 'L', $fill);
                        $pdf->Cell(2, .5, ($sql_medc_srt->hml_tipe_ijin == '1' ? $this->tanggalan->tgl_indo2($sql_medc_srt->hml_tgl_awal) : ''), '', 0, 'L', $fill);
                        $pdf->Cell(1, .5, 's/d', '', 0, 'C', $fill);
                        $pdf->Cell(4, .5, ($sql_medc_srt->hml_tipe_ijin == '1' ? $this->tanggalan->tgl_indo2($sql_medc_srt->hml_tgl_akhir) : ''), '', 0, 'L', $fill);
                        $pdf->Ln();
                    }elseif($sql_medc_srt->hml_tipe_ijin == '2'){
                        $pdf->Cell(1, .5, '-', '', 0, 'C', $fill);
                        $pdf->Cell(8, .5, 'Ijin tidak menjalankan tugas karena sakit, selama', '', 0, 'L', $fill);
                        $pdf->Cell(.5, .5, (float)$jml_hari, '', 0, 'C', $fill);
                        $pdf->Cell(3.5, .5, 'Hari, terhitung dari', '', 0, 'L', $fill);
                        $pdf->Cell(2, .5, ($sql_medc_srt->hml_tipe_ijin == '2' ? $this->tanggalan->tgl_indo2($sql_medc_srt->hml_tgl_awal) : ''), '', 0, 'L', $fill);
                        $pdf->Cell(1, .5, 's/d', '', 0, 'C', $fill);
                        $pdf->Cell(2, .5, ($sql_medc_srt->hml_tipe_ijin == '2' ? $this->tanggalan->tgl_indo2($sql_medc_srt->hml_tgl_akhir) : ''), '', 0, 'L', $fill);
                        $pdf->Ln();
                    }

                    if($sql_medc_srt->hml_tipe_terbang == '1'){
                        $pdf->Cell(1, .5, '', '', 0, 'C', $fill);
                        $pdf->Cell(18, .5, 'Cukup sehat untuk perjalanan / penerbangan dalam negeri / luar negeri', '', 0, 'L', $fill);
                        $pdf->Ln();
                    }elseif($sql_medc_srt->hml_tipe_terbang == '2'){
                        $pdf->Cell(1, .5, '', '', 0, 'C', $fill);
                        $pdf->Cell(18, .5, 'Tidak diperkenankan untuk perjalanan / penerbangan dalam negeri / luar negeri', '', 0, 'L', $fill);
                        $pdf->Ln();                        
                    }

//                    $pdf->Cell(1, .5, ($sql_medc_srt->hml_tipe_ijin == '2' ? 'V' : ''), 'LBR', 0, 'C', $fill);
//                    $pdf->Cell(8, .5, 'Ijin tidak menjalankan tugas karena sakit, selama', 'B', 0, 'L', $fill);
//                    $pdf->Cell(.5, .5, (float)$jml_hari, 'B', 0, 'C', $fill);
//                    $pdf->Cell(3.5, .5, 'Hari, terhitung dari', 'B', 0, 'L', $fill);
//                    $pdf->Cell(2, .5, ($sql_medc_srt->hml_tipe_ijin == '2' ? $this->tanggalan->tgl_indo2($sql_medc_srt->hml_tgl_awal) : ''), 'B', 0, 'L', $fill);
//                    $pdf->Cell(1, .5, 's/d', 'B', 0, 'C', $fill);
//                    $pdf->Cell(2, .5, ($sql_medc_srt->hml_tipe_ijin == '2' ? $this->tanggalan->tgl_indo2($sql_medc_srt->hml_tgl_akhir) : ''), 'BR', 0, 'L', $fill);
//                    $pdf->Ln();
//
//                    $pdf->Cell(1, .5, ($sql_medc_srt->hml_tipe_terbang == '1' ? 'V' : 'X'), 'LBR', 0, 'C', $fill);
//                    $pdf->Cell(17, .5, 'Cukup sehat untuk perjalanan / penerbangan dalam negeri / luar negeri', 'BR', 0, 'L', $fill);
                    $pdf->Ln(1);
            
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(19, .5, 'Demikian surat keterangan ini dibuat agar dapat digunakan sebagaimana mestinya.', '', 0, 'L', $fill);
                    $pdf->Ln(2);
                    break;
                                
                case '13' :
                    $judul = "SURAT ".strtoupper(general::tipe_surat($sql_medc_srt->tipe));

                    // Blok Judul
                    $pdf->SetFont('Arial', 'B', '14');
                    $pdf->Cell(19, .5, $judul, 0, 1, 'C');
                    $pdf->Ln(0);
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(19, .5, 'Nomor : '.$sql_medc_srt->no_surat, 0, 1, 'C');
                    $pdf->Ln();

                    // Blok Paragraf Pertama
                    $fill = FALSE;
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(19, .5, 'Yang bertanda tangan di bawah ini, menerangkan bahwa :', '', 0, 'L', $fill);
                    $pdf->Ln(1);

                    // Blok ID PASIEN
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(1, .5, '', '0', 0, 'L', $fill);
                    $pdf->Cell(3.5, .5, 'Nama Lengkap', '0', 0, 'L', $fill);
                    $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(13, .5, $sql_pasien->nama_pgl, '0', 0, 'L', $fill);
                    $pdf->Ln();
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(1, .5, '', '0', 0, 'L', $fill);
                    $pdf->Cell(3.5, .5, 'Tanggal Lahir', '0', 0, 'L', $fill);
                    $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(13, .5, $this->tanggalan->tgl_indo2($sql_pasien->tgl_lahir).' - '.$this->tanggalan->usia($sql_pasien->tgl_lahir), '0', 0, 'L', $fill);
                    $pdf->Ln();
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(1, .5, '', '0', 0, 'L', $fill);
                    $pdf->Cell(3.5, .5, 'Jenis Kelamin', '0', 0, 'L', $fill);
                    $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(13, .5, general::jns_klm($sql_pasien->jns_klm), '0', 0, 'L', $fill);
                    $pdf->Ln();
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(1, .5, '', '0', 0, 'L', $fill);
                    $pdf->Cell(3.5, .5, 'Pekerjaan', '0', 0, 'L', $fill);
                    $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(13, .5, $sql_pekerjaan->jenis, '0', 0, 'L', $fill);
                    $pdf->Ln();
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(1, .5, '', '0', 0, 'L', $fill);
                    $pdf->Cell(3.5, .5, 'Alamat', '0', 0, 'L', $fill);
                    $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
                    $pdf->SetFont('Arial', '', '10');
//                    $pdf->Cell(13, .5, $sql_pasien->alamat, '0', 0, 'L', $fill);
                    $pdf->MultiCell(13, .5, $sql_pasien->alamat, '0', 'L');
                    $pdf->Ln(1);

                    $pdf->SetFont('Arial', '', '10');
                    $pdf->MultiCell(19, .5, 'Berdasarkan hasil pemeriksaan sampel urine untuk pemeriksaan Test Narkoba di Laboratorium '.$setting->judul.', sampel urine pasien dinyatakan dengan hasil :', '0', 'J');
                    $pdf->SetFont('Arial', 'Bi', '10');
                    $pdf->Cell(19, .5, ($sql_medc_srt->nza_status == '1' ? 'POSITIF' : 'NEGATIF'), '', 0, 'C', $fill);
//                    $pdf->Cell(19, .5, 'Berdasarkan hasil pemeriksaan sampel urine untuk pemeriksaan Test Narkoba di Laboratorium '.$setting->judul.',', '', 0, 'L', $fill);
                    $pdf->Ln();
//                    $pdf->Cell(7.5, .5, 'sampel urine pasien dinyatakan dengan hasil', '', 0, 'L', $fill);
//                    $pdf->SetFont('Arial', 'Bi', '10');
//                    $pdf->Cell(2, .5, ($sql_medc_srt->nza_status == '1' ? 'POSITIF' : 'NEGATIF'), '', 0, 'L', $fill);
//                    $pdf->Ln(1);
            
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(19, .5, 'Demikian surat keterangan ini dibuat agar dapat digunakan sebagaimana mestinya.', '', 0, 'L', $fill);
                    $pdf->Ln(2);
                    break;
                                
                case '14' :
                    $judul = "SURAT LAYAK TERBANG";
                    
                    $tgl_awal       = date_create($this->tanggalan->tgl_indo_sys($sql_medc_srt->trb_tgl_awal));
                    $tgl_akhir      = date_create($this->tanggalan->tgl_indo_sys($sql_medc_srt->trb_tgl_akhir));
                    $diff           = date_diff($tgl_awal, $tgl_akhir);
                    $hari           = $diff->format("%d%");
                    $jml_hari       = ($tgl_awal == $tgl_akhir ? '1' : ($hari > 1 ? $hari + 1 : '2'));

                    // Blok Judul
                    $pdf->SetFont('Arial', 'B', '14');
                    $pdf->Cell(19, .5, $judul, 0, 1, 'C');
                    $pdf->Ln(0);
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(19, .5, 'Nomor : '.$sql_medc_srt->no_surat, 0, 1, 'C');
                    $pdf->Ln();

                    // Blok Paragraf Pertama
                    $fill = FALSE;
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->MultiCell(19, .5, 'Yang bertanda tangan di bawah ini '.(!empty($sql_dokter->nama_dpn) ? $sql_dokter->nama_dpn.' ' : '').$sql_dokter->nama.(!empty($sql_dokter->nama_blk) ? ', '.$sql_dokter->nama_blk : '').', dokter pada '.$setting->judul.' menerangkan bahwa :', '0', 'L');
                    $pdf->Ln(1);

                    // Blok ID PASIEN
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(1, .5, '', '0', 0, 'L', $fill);
                    $pdf->Cell(3.5, .5, 'No. RM', '0', 0, 'L', $fill);
                    $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(13, .5, $sql_pasien->kode_dpn.$sql_pasien->kode, '0', 0, 'L', $fill);
                    $pdf->Ln();
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(1, .5, '', '0', 0, 'L', $fill);
                    $pdf->Cell(3.5, .5, 'Nama Lengkap', '0', 0, 'L', $fill);
                    $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(13, .5, $sql_pasien->nama_pgl, '0', 0, 'L', $fill);
                    $pdf->Ln();
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(1, .5, '', '0', 0, 'L', $fill);
                    $pdf->Cell(3.5, .5, 'Tanggal Lahir', '0', 0, 'L', $fill);
                    $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(13, .5, $this->tanggalan->tgl_indo2($sql_pasien->tgl_lahir).' - '.$this->tanggalan->usia($sql_pasien->tgl_lahir), '0', 0, 'L', $fill);
                    $pdf->Ln();
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(1, .5, '', '0', 0, 'L', $fill);
                    $pdf->Cell(3.5, .5, 'Jenis Kelamin', '0', 0, 'L', $fill);
                    $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(13, .5, general::jns_klm($sql_pasien->jns_klm), '0', 0, 'L', $fill);
                    $pdf->Ln();
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(1, .5, '', '0', 0, 'L', $fill);
                    $pdf->Cell(3.5, .5, 'Pekerjaan', '0', 0, 'L', $fill);
                    $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(13, .5, $sql_pekerjaan->jenis, '0', 0, 'L', $fill);
                    $pdf->Ln();
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(1, .5, '', '0', 0, 'L', $fill);
                    $pdf->Cell(3.5, .5, 'Alamat', '0', 0, 'L', $fill);
                    $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
                    $pdf->SetFont('Arial', '', '10');
//                    $pdf->Cell(13, .5, $sql_pasien->alamat, '0', 0, 'L', $fill);
                    $pdf->MultiCell(13, .5, $sql_pasien->alamat, '0', 'L');
                    $pdf->Ln(1);

                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(19, .5, 'Pemeriksaan dalam keadaan', '', 0, 'L', $fill);
                    $pdf->Ln();
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->MultiCell(19, .5, $sql_medc_srt->trb_periksa, '0', 'J');
                    $pdf->Ln();

                    if($sql_medc_srt->trb_tipe_terbang == '1'){
                        $pdf->Cell(1, .5, '', '', 0, 'C', $fill);
                        $pdf->Cell(18, .5, 'Cukup sehat untuk perjalanan / penerbangan dalam negeri / luar negeri', '', 0, 'L', $fill);
                        $pdf->Ln();
                    }elseif($sql_medc_srt->trb_tipe_terbang == '2'){
                        $pdf->Cell(1, .5, '', '', 0, 'C', $fill);
                        $pdf->Cell(18, .5, 'Tidak diperkenankan untuk perjalanan / penerbangan dalam negeri / luar negeri', '', 0, 'L', $fill);
                        $pdf->Ln();                        
                    }

                    $pdf->Ln(1);
            
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(19, .5, 'Demikian surat keterangan ini dibuat agar dapat digunakan sebagaimana mestinya.', '', 0, 'L', $fill);
                    $pdf->Ln(2);
                    break;
                                
                case '15' :
                    $judul = "SURAT KETERANGAN DOKTER";
                    
                    $tgl_awal       = date_create($this->tanggalan->tgl_indo_sys($sql_medc_srt->trb_tgl_awal));
                    $tgl_akhir      = date_create($this->tanggalan->tgl_indo_sys($sql_medc_srt->trb_tgl_akhir));
                    $diff           = date_diff($tgl_awal, $tgl_akhir);
                    $hari           = $diff->format("%d%");
                    $jml_hari       = ($tgl_awal == $tgl_akhir ? '1' : ($hari > 1 ? $hari + 1 : '2'));

                    // Blok Judul
                    $pdf->SetFont('Arial', 'B', '14');
                    $pdf->Cell(19, .5, $judul, 0, 1, 'C');
                    $pdf->Ln(0);
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(19, .5, 'Nomor : '.$sql_medc_srt->no_surat, 0, 1, 'C');
                    $pdf->Ln();

                    // Blok Paragraf Pertama
                    $fill = FALSE;
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->MultiCell(19, .5, 'Yang bertanda tangan di bawah ini '.(!empty($sql_dokter->nama_dpn) ? $sql_dokter->nama_dpn.' ' : '').$sql_dokter->nama.(!empty($sql_dokter->nama_blk) ? ', '.$sql_dokter->nama_blk : '').', dokter pada '.$setting->judul.' menerangkan bahwa :', '0', 'L');
                    $pdf->Ln(1);

                    // Blok ID PASIEN
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(1, .5, '', '0', 0, 'L', $fill);
                    $pdf->Cell(3.5, .5, 'No. RM', '0', 0, 'L', $fill);
                    $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(13, .5, $sql_pasien->kode_dpn.$sql_pasien->kode, '0', 0, 'L', $fill);
                    $pdf->Ln();
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(1, .5, '', '0', 0, 'L', $fill);
                    $pdf->Cell(3.5, .5, 'Nama Lengkap', '0', 0, 'L', $fill);
                    $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(13, .5, $sql_pasien->nama_pgl, '0', 0, 'L', $fill);
                    $pdf->Ln();
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(1, .5, '', '0', 0, 'L', $fill);
                    $pdf->Cell(3.5, .5, 'Tanggal Lahir', '0', 0, 'L', $fill);
                    $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(13, .5, $this->tanggalan->tgl_indo2($sql_pasien->tgl_lahir).' - '.$this->tanggalan->usia($sql_pasien->tgl_lahir), '0', 0, 'L', $fill);
                    $pdf->Ln();
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(1, .5, '', '0', 0, 'L', $fill);
                    $pdf->Cell(3.5, .5, 'Jenis Kelamin', '0', 0, 'L', $fill);
                    $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(13, .5, general::jns_klm($sql_pasien->jns_klm), '0', 0, 'L', $fill);
                    $pdf->Ln();
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(1, .5, '', '0', 0, 'L', $fill);
                    $pdf->Cell(3.5, .5, 'Pekerjaan', '0', 0, 'L', $fill);
                    $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(13, .5, $sql_pekerjaan->jenis, '0', 0, 'L', $fill);
                    $pdf->Ln();
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(1, .5, '', '0', 0, 'L', $fill);
                    $pdf->Cell(3.5, .5, 'Alamat', '0', 0, 'L', $fill);
                    $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
                    $pdf->SetFont('Arial', '', '10');
//                    $pdf->Cell(13, .5, $sql_pasien->alamat, '0', 0, 'L', $fill);
                    $pdf->MultiCell(13, .5, $sql_pasien->alamat, '0', 'L');
                    $pdf->Ln(1);

                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(19, .5, 'HASIL PEMERIKSAAN THT', 'B', 0, 'L', $fill);
                    $pdf->Ln();
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(11, .5, 'Telinga', '', 0, 'L', $fill);
                    $pdf->Cell(4.25, .5, 'Kanan :', '', 0, 'L', $fill);
                    $pdf->Cell(4.25, .5, 'Kiri :', '', 0, 'L', $fill);
                    $pdf->Ln();
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(.5, .5, '', '', 0, 'L', $fill);
                    $pdf->Cell(5, .5, '- Liang Telinga', '', 0, 'L', $fill);
                    $pdf->Cell(.5, .5, ':', '', 0, 'C', $fill);
                    $pdf->Cell(5, .5, '', '', 0, 'L', $fill);
                    $pdf->Cell(4.25, .5, $sql_medc_srt->tht_lt_kiri, '', 0, 'L', $fill);
                    $pdf->Cell(4.25, .5, $sql_medc_srt->tht_lt_kanan, '', 0, 'L', $fill);
                    $pdf->Ln();
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(.5, .5, '', '', 0, 'L', $fill);
                    $pdf->Cell(5, .5, '- Membran Timpani', '', 0, 'L', $fill);
                    $pdf->Cell(.5, .5, ':', '', 0, 'C', $fill);
                    $pdf->Cell(5, .5, '', '', 0, 'L', $fill);
                    $pdf->Cell(4.25, .5, $sql_medc_srt->tht_membran_kiri, '', 0, 'L', $fill);
                    $pdf->Cell(4.25, .5, $sql_medc_srt->tht_membran_kanan, '', 0, 'L', $fill);
                    $pdf->Ln(1);
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(19, .5, 'Hidung', '', 0, 'L', $fill);
                    $pdf->Ln();
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(.5, .5, '', '', 0, 'L', $fill);
                    $pdf->Cell(5, .5, '- Mukosa', '', 0, 'L', $fill);
                    $pdf->Cell(.5, .5, ':', '', 0, 'C', $fill);
                    $pdf->Cell(5, .5, '', '', 0, 'L', $fill);
                    $pdf->Cell(4.25, .5, $sql_medc_srt->tht_mukosa_kiri, '', 0, 'L', $fill);
                    $pdf->Cell(4.25, .5, $sql_medc_srt->tht_mukosa_kanan, '', 0, 'L', $fill);
                    $pdf->Ln();
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(.5, .5, '', '', 0, 'L', $fill);
                    $pdf->Cell(5, .5, '- Konka Infenor', '', 0, 'L', $fill);
                    $pdf->Cell(.5, .5, ':', '', 0, 'C', $fill);
                    $pdf->Cell(5, .5, '', '', 0, 'L', $fill);
                    $pdf->Cell(4.25, .5, $sql_medc_srt->tht_konka_kiri, '', 0, 'L', $fill);
                    $pdf->Cell(4.25, .5, $sql_medc_srt->tht_konka_kanan, '', 0, 'L', $fill);
                    $pdf->Ln();
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(.5, .5, '', '', 0, 'L', $fill);
                    $pdf->Cell(5, .5, '- Timpanometri', '', 0, 'L', $fill);
                    $pdf->Cell(.5, .5, ':', '', 0, 'C', $fill);
                    $pdf->Cell(5, .5, '', '', 0, 'L', $fill);
                    $pdf->Cell(4.25, .5, $sql_medc_srt->tht_timpa_kiri, '', 0, 'L', $fill);
                    $pdf->Cell(4.25, .5, $sql_medc_srt->tht_timpa_kanan, '', 0, 'L', $fill);
                    $pdf->Ln(1);
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(19, .5, 'Tenggorokan', '', 0, 'L', $fill);
                    $pdf->Ln();
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(.5, .5, '', '', 0, 'L', $fill);
                    $pdf->Cell(5, .5, '- Tonsil', '', 0, 'L', $fill);
                    $pdf->Cell(.5, .5, ':', '', 0, 'C', $fill);
                    $pdf->Cell(8.5, .5, $sql_medc_srt->tht_tonsil_tg, '', 0, 'L', $fill);
                    $pdf->Ln();
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(.5, .5, '', '', 0, 'L', $fill);
                    $pdf->Cell(5, .5, '- Mukosa', '', 0, 'L', $fill);
                    $pdf->Cell(.5, .5, ':', '', 0, 'C', $fill);
                    $pdf->Cell(8.5, .5, $sql_medc_srt->tht_mukosa_tg, '', 0, 'L', $fill);
                    $pdf->Ln();
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(.5, .5, '', '', 0, 'L', $fill);
                    $pdf->Cell(5, .5, '- Dinding Faring', '', 0, 'L', $fill);
                    $pdf->Cell(.5, .5, ':', '', 0, 'C', $fill);
                    $pdf->Cell(8.5, .5, $sql_medc_srt->tht_faring_tg, '', 0, 'L', $fill);
                    $pdf->Ln(1);
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(2, .5, 'Kesimpulan', '', 0, 'L', $fill);
                    $pdf->Cell(.5, .5, ':', '', 0, 'C', $fill);
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(16.5, .5, $sql_medc_srt->tht_kesimpulan, '', 0, 'L', $fill);
                    $pdf->Ln();
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(2, .5, 'Audiometri', '', 0, 'L', $fill);
                    $pdf->Cell(.5, .5, ':', '', 0, 'C', $fill);
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(16.5, .5, $sql_medc_srt->tht_audio, '', 0, 'L', $fill);
                    $pdf->Ln();
                    break;
            }
            
            // QR GENERATOR VALIDASI
            $qr_validasi        = FCPATH.'/file/pasien/'.strtolower($kode_pasien).'/qr-validasi-'.strtolower($kode_pasien).'.png';
//            $params['data']     = 'https://verify.esensia.co.id/?id='.general::enkrip($sql_medc_srt->id).'&id_pasien='.general::enkrip($sql_pasien->id).'&role=surat';
            $params['data']     = 'Telah diverifikasi dan ditandatangani secara elektronik oleh manajemen '.$setting->judul.'. Pasien a/n. ';
//            $params['data']    .= strtoupper($sql_pasien->nama_pgl).' ('.strtoupper($kode_pasien).')';
            $params['level']    = 'H';
            $params['size']     = 2;
            $params['savename'] = $qr_validasi; 
            $this->ciqrcode->generate($params);
            
            $gambar4            = $qr_validasi; 
                        
            // QR GENERATOR DOKTER
            $qr_dokter          = FCPATH.'/file/pasien/'.strtolower($kode_pasien).'/qr-dokter-'.strtolower($sql_dokter->id).'.png';
            $params['data']     = 'Telah diverifikasi dan ditandatangani secara elektronik oleh dokter penanggung jawab ['.(!empty($sql_dokter->nama_dpn) ? $sql_dokter->nama_dpn.' ' : '').$sql_dokter->nama.(!empty($sql_dokter->nama_blk) ? ', '.$sql_dokter->nama_blk : '').']';
            $params['level']    = 'H';
            $params['size']     = 2;
            $params['savename'] = $qr_dokter;
            $this->ciqrcode->generate($params);
            
            $gambar5            = $qr_dokter;        
            
            // Gambar VALIDASI
//            $pdf->SetY(-10.5);
            $pdf->Image($gambar4,2,$pdf->GetY() + 1,2,2);
            $pdf->Image($gambar5,12.5,$pdf->GetY()+1,2,2);
            
//            $pdf->SetY(-11.5);
            $pdf->SetFont('Arial', '', '10');
            $pdf->Cell(11.5, .5, '', '', 0, 'L', $fill);
            $pdf->Cell(7.5, .5, 'Semarang, '.$this->tanggalan->tgl_indo3($sql_medc_srt->tgl_simpan), '', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->SetFont('Arial', 'B', '10');
            $pdf->Cell(4, .5, 'Validasi', '0', 0, 'C', $fill);
            $pdf->Cell(7.5, .5, '', '0', 0, 'C', $fill);
            $pdf->SetFont('Arial', '', '10');
            $pdf->Cell(7.5, .5, (!empty($ket) ? $ket : 'Dokter Pemeriksa'), '0', 0, 'L', $fill);
            $pdf->Ln(2.5);
            
//            $pdf->SetY(-8.5);
            $pdf->SetFont('Arial', '', '10');
            $pdf->Cell(11.5, .5, '', '', 0, 'L', $fill);
            $pdf->Cell(7.5, .5, (!empty($sql_dokter->nama_dpn) ? $sql_dokter->nama_dpn.' ' : '').$sql_dokter->nama.(!empty($sql_dokter->nama_blk) ? ', '.$sql_dokter->nama_blk : ''), '', 0, 'L', $fill);
            $pdf->Ln();
                    
            $pdf->SetFillColor(235, 232, 228);
            $pdf->SetTextColor(0);
            $pdf->SetFont('Arial', '', '10');

            $type = (isset($_GET['type']) ? $_GET['type'] : 'I');

            ob_start();
            $pdf->Output($sql_pasien->nama_pgl. '.pdf', $type);
            ob_end_flush();
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }
    
    public function pdf_medcheck_surat_inform() {
        if (akses::aksesLogin() == TRUE) {
            $setting            = $this->db->get('tbl_pengaturan')->row();
            $id                 = $this->input->get('id');
            $id_medcheck        = $this->input->get('no_nota');

            $sql_medc           = $this->db->where('id', general::dekrip($id_medcheck))->get('tbl_trans_medcheck')->row();
            $sql_medc_srt       = $this->db->where('id', general::dekrip($id))->get('tbl_trans_medcheck_surat_inform')->row(); 
            $sql_pasien         = $this->db->where('id', $sql_medc->id_pasien)->get('tbl_m_pasien')->row(); 
            $sql_pekerjaan      = $this->db->where('id', $sql_pasien->id_pekerjaan)->get('tbl_m_jenis_kerja')->row();
            $sql_dokter         = $this->db->where('id_user', $sql_medc->id_dokter)->get('tbl_m_karyawan')->row();
            $sql_dokter2        = $this->db->where('id_user', $sql_medc_srt->id_dokter)->get('tbl_m_karyawan')->row();
            $kode_pasien        = $sql_pasien->kode_dpn.$sql_pasien->kode;
            $gambar1            = FCPATH.'/assets/theme/admin-lte-3/dist/img/logo-esensia-2.png';
            $gambar2            = FCPATH.'/assets/theme/admin-lte-3/dist/img/logo-bw-bg2-1440px.png';
            $gambar3            = FCPATH.'/assets/theme/admin-lte-3/dist/img/logo-footer.png';
            
            $this->load->library('MedSuratPDF');
            $pdf = new MedSuratPDF('P', 'cm', array(21.5,33));
            $pdf->SetAutoPageBreak('auto', 7);
            $pdf->SetMargins(1,0.35,1);
            $pdf->header = 0;
            $pdf->addPage('','',false);
            
            // Gambar Watermark Tengah
            $pdf->Image($gambar2,5,4,17,19);
                        
            // Blok Isi Surat
            switch ($sql_medc_srt->tipe){
                
                case '1' :
                    $judul = "SURAT ".strtoupper(general::tipe_surat_inf($sql_medc_srt->tipe));

                    // Blok Judul
                    $pdf->SetFont('Arial', 'B', '14');
                    $pdf->Cell(19, .5, $judul, 0, 1, 'C');
                    $pdf->Ln(0);
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(19, .5, 'Nomor : '.$sql_medc_srt->no_surat, 0, 1, 'C');
                    $pdf->Ln();

                    // Blok Paragraf Pertama
                    $fill = FALSE;
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(19, .5, 'Yang bertanda tangan dibawah ini,', '', 0, 'L', $fill);
                    $pdf->Ln(1);

                    // Blok PENANGGUNG JAWAB
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(1, .5, '', '0', 0, 'L', $fill);
                    $pdf->Cell(4.5, .5, 'Nama Lengkap', '0', 0, 'L', $fill);
                    $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(12, .5, strtoupper($sql_medc_srt->nama), '0', 0, 'L', $fill);
                    $pdf->Ln();
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(1, .5, '', '0', 0, 'L', $fill);
                    $pdf->Cell(4.5, .5, 'Tanggal Lahir', '0', 0, 'L', $fill);
                    $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(12, .5, ($sql_medc_srt->tgl_lahir != '0000-00-00' ? $this->tanggalan->tgl_indo2($sql_medc_srt->tgl_lahir).' ('.$this->tanggalan->usia($sql_medc_srt->tgl_lahir).')' : '-').(!empty($sql_medc_srt->jns_klm) ? ' / '.general::jns_klm($sql_medc_srt->jns_klm) : ''), '0', 0, 'L', $fill);
                    $pdf->Ln();
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(1, .5, '', '0', 0, 'L', $fill);
                    $pdf->Cell(4.5, .5, 'Alamat', '0', 0, 'L', $fill);
                    $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
                    $pdf->SetFont('Arial', '', '10');
//                    $pdf->Cell(12, .5, $sql_medc_srt->alamat, '0', 0, 'L', $fill);
                    $pdf->MultiCell(12.5, .5, $sql_medc_srt->alamat, '', 'L', $fill);
//                    $pdf->Ln();
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(1, .5, '', '0', 0, 'L', $fill);
                    $pdf->Cell(4.5, .5, 'Hubungan dengan pasien', '0', 0, 'L', $fill);
                    $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(12, .5, general::tipe_hubungan($sql_medc_srt->status_hub), '0', 0, 'L', $fill);
                    $pdf->Ln(1);
                    
                    # Blok Paragraf kedua
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(19, .5, 'Dengan ini menyatakan,', '', 0, 'L', $fill);
                    $pdf->Ln();
                    $pdf->Cell(10, .5, 'Telah melihat, memahami dan menyetujui tarif yang berlaku di ', '', 0, 'L', $fill);
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(9, .5, strtoupper($setting->judul), '', 0, 'L', $fill);
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Ln();
                    $pdf->Cell(19, .5, 'beserta tindakan dan obat-obatan yang dimungkinkan. Sanggup menjamin kelancaran pembayaran semua biaya', '', 0, 'L', $fill);
                    $pdf->Ln();
                    $pdf->Cell(19, .5, 'pelayanan bagi pasien :', '', 0, 'L', $fill);
                    $pdf->Ln(1);

                    // Blok ID PASIEN
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(1, .5, '', '0', 0, 'L', $fill);
                    $pdf->Cell(4.5, .5, 'Nomor Rekam Medis', '0', 0, 'L', $fill);
                    $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(12, .5, $sql_pasien->kode_dpn.$sql_pasien->kode, '0', 0, 'L', $fill);
                    $pdf->Ln();
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(1, .5, '', '0', 0, 'L', $fill);
                    $pdf->Cell(4.5, .5, 'NIK', '0', 0, 'L', $fill);
                    $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(12, .5, $sql_pasien->nik, '0', 0, 'L', $fill);
                    $pdf->Ln();
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(1, .5, '', '0', 0, 'L', $fill);
                    $pdf->Cell(4.5, .5, 'Nama Lengkap', '0', 0, 'L', $fill);
                    $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(12, .5, $sql_pasien->nama_pgl, '0', 0, 'L', $fill);
                    $pdf->Ln();
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(1, .5, '', '0', 0, 'L', $fill);
                    $pdf->Cell(4.5, .5, 'Tanggal Lahir', '0', 0, 'L', $fill);
                    $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(12, .5, $this->tanggalan->tgl_indo2($sql_pasien->tgl_lahir).' ('.$this->tanggalan->usia_lkp($sql_pasien->tgl_lahir).')'.(!empty($sql_pasien->jns_klm) ? ' / '.general::jns_klm($sql_pasien->jns_klm) : ''), '0', 0, 'L', $fill);
                    $pdf->Ln();
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(1, .5, '', '0', 0, 'L', $fill);
                    $pdf->Cell(4.5, .5, 'Alamat', '0', 0, 'L', $fill);
                    $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
                    $pdf->SetFont('Arial', '', '10');
//                    $pdf->Cell(12, .5, $sql_pasien->alamat, '0', 0, 'L', $fill);
                    $pdf->MultiCell(12.5, .5, $sql_pasien->alamat, '', 'L', $fill);
//                    $pdf->Ln();
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(1, .5, '', '0', 0, 'L', $fill);
                    $pdf->Cell(4.5, .5, 'Tanggal Masuk', '0', 0, 'L', $fill);
                    $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(12, .5, $this->tanggalan->tgl_indo2($sql_medc->tgl_masuk), '0', 0, 'L', $fill);
                    $pdf->Ln();
//                    $pdf->SetFont('Arial', 'B', '10');
//                    $pdf->Cell(1, .5, '', '0', 0, 'L', $fill);
//                    $pdf->Cell(4.5, .5, 'Ruang Perawatan', '0', 0, 'L', $fill);
//                    $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
//                    $pdf->SetFont('Arial', '', '10');
//                    $pdf->Cell(12, .5, $sql_medc_srt->ruang, '0', 0, 'L', $fill);
//                    $pdf->Ln();
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(1, .5, '', '0', 0, 'L', $fill);
                    $pdf->Cell(4.5, .5, 'Dokter yang merawat', '0', 0, 'L', $fill);
                    $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(12, .5, (!empty($sql_dokter2->nama_dpn) ? $sql_dokter2->nama_dpn.' ' : '').$sql_dokter2->nama.(!empty($sql_dokter2->nama_blk) ? ', '.$sql_dokter2->nama_blk.' ' : ''), '0', 0, 'L', $fill);
                    $pdf->Ln(1);
                    
                    # Tentukan penjamin ASURANSI / UMUM, jika 1 maka umum
                    if($sql_medc->tipe_bayar == '1'){                    
                        $pdf->SetFont('Arial', 'B', '10');
//                        $pdf->Cell(1, .5, '', '', 0, 'L', $fill);
                        $pdf->Cell(4.5, .5, 'PASIEN UMUM / PRIBADI', '0', 0, 'L', $fill);
                        $pdf->Ln();
                        $pdf->SetFont('Arial', '', '10');
//                        $pdf->Cell(1, .5, '', '', 0, 'L', $fill);
                        $pdf->Cell(19, .5, 'Bersedia dan siap membayar seluruh biaya perawatan dan tindakan serta obat - obatan yang diberikan terhadap', '', 0, 'L', $fill);
                        $pdf->Ln();
//                        $pdf->Cell(1, .5, '', '', 0, 'L', $fill);
                        $pdf->Cell(19, .5, 'pasien tersebut diatas, yang jumlahnya akan diketahui setelah pasien selesai Rawat Inap.', '', 0, 'L', $fill);
                        $pdf->Ln(1);
                    }else{
                        $pdf->SetFont('Arial', 'B', '10');
                        $pdf->Cell(4.5, .5, 'PASIEN ASURANSI', '0', 0, 'L', $fill);
                        $pdf->Ln();
                        $pdf->SetFont('Arial', 'B', '10');
                        $pdf->Cell(1, .5, '', '0', 0, 'L', $fill);
                        $pdf->Cell(4.5, .5, 'Penjamin', '0', 0, 'L', $fill);
                        $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
                        $pdf->SetFont('Arial', '', '10');
                        $pdf->Cell(12, .5, $sql_medc_srt->penjamin, '0', 0, 'L', $fill);
                        $pdf->Ln();
                        $pdf->SetFont('Arial', 'B', '10');
                        $pdf->Cell(1, .5, '', '0', 0, 'L', $fill);
                        $pdf->Cell(4.5, .5, 'Keterangan', '0', 0, 'L', $fill);
                        $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
                        $pdf->SetFont('Arial', '', '10');
                        $pdf->Cell(12, .5, $sql_medc_srt->penanggung, '0', 0, 'L', $fill);
                        $pdf->Ln();
                        $pdf->Cell(19, .5, 'Bila kelas yang dipilih melebihi dari jatah kelas yang ditentukan, bersedia membayar', '', 0, 'L', $fill);
                        $pdf->Ln();
                        $pdf->Cell(19, .5, 'seluruh selisih biaya sesuai dengan tarif yang berlaku.', '', 0, 'L', $fill);
                        $pdf->Ln(1);
                    }
            
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(19, .5, 'Demikian surat pernyataan ini dibuat dalam keadaan sadar tanpa ada tekanan dari pihak manapun.', '', 0, 'L', $fill);
                    $pdf->Ln();
            
                    # QR GENERATOR VALIDASI
                    $qr_validasi        = FCPATH.'/file/pasien/'.strtolower($kode_pasien).'/qr-petugas-'.strtolower($sql_medc->no_rm).'.png';
//                    $params['data']     = 'https://verify.esensia.co.id/?id='.general::enkrip($sql_medc_srt->id).'&id_pasien='.general::enkrip($sql_pasien->id).'&role=surat';
                    $params['data']     = 'Telah diverifikasi dan ditandatangani secara elektronik oleh manajemen '.$setting->judul.'. Diwakili oleh ';
                    $params['data']    .= strtoupper($this->ion_auth->user($sql_medc_srt->id_user)->row()->first_name).',';
                    $params['data']    .= 'yang merupakan petugas yang bertugas pada tanggal '.date('d/m/Y H:i').'.';
                    $params['level']    = 'H';
                    $params['size']     = 2;
                    $params['savename'] = $qr_validasi; 
                    $this->ciqrcode->generate($params);
                    
                    $gambar4            = $qr_validasi; 
                                
                    # QR GENERATOR DOKTER
                    $qr_dokter          = FCPATH.'/'.$sql_medc_srt->file_name1;
//                    $params['data']     = 'Telah diverifikasi dan ditandatangani secara elektronik oleh dokter penanggung jawab ['.(!empty($sql_dokter->nama_dpn) ? $sql_dokter->nama_dpn.' ' : '').$sql_dokter->nama.(!empty($sql_dokter->nama_blk) ? ', '.$sql_dokter->nama_blk : '').']';
//                    $params['level']    = 'H';
//                    $params['size']     = 2;
//                    $params['savename'] = $qr_dokter;
//                    $this->ciqrcode->generate($params);
                    $gambar5            = $qr_dokter;        
                    
                    # Gambar VALIDASI
                    $pdf->SetY(-10.5);
//                    $pdf->Image($gambar4,1.25,22.75,3.5,3.5);
//                    $pdf->Image($gambar5,12.5,22.75,3.5,3.5);
                    $pdf->Image($gambar4,2,$pdf->GetY(),2,2);
                    $pdf->Image($gambar5,12.5,$pdf->GetY(),2,2);
                    
                    $pdf->SetY(-11.5);
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(11.5, .5, '', '', 0, 'L', $fill);
                    $pdf->Cell(7.5, .5, 'Semarang, '.$this->tanggalan->tgl_indo3($sql_medc_srt->tgl_masuk), '', 0, 'L', $fill);
                    $pdf->Ln();
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(4.5, .5, 'Petugas', '0', 0, 'C', $fill);
                    $pdf->Cell(7.5, .5, '', '0', 0, 'C', $fill);
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(7.5, .5, (!empty($ket) ? $ket : 'Yang Membuat Pernyataan'), '0', 0, 'L', $fill);
                    $pdf->Ln(4);
                    
                    $pdf->SetY(-8.5);
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(11.5, .5, $this->ion_auth->user($sql_medc_srt->id_user)->row()->first_name, '', 0, 'L', $fill);
                    $pdf->Cell(7.5, .5, strtoupper($sql_medc_srt->nama), '', 0, 'L', $fill);
                    $pdf->Ln();
                    break;
                    
                case '2' :
                    $judul = "SURAT ".strtoupper(general::tipe_surat_inf($sql_medc_srt->tipe));

                    // Blok Judul
                    $pdf->SetFont('Arial', 'B', '14');
                    $pdf->Cell(19, .5, $judul, 0, 1, 'C');
                    $pdf->Ln(0);
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(19, .5, 'Nomor : '.$sql_medc_srt->no_surat, 0, 1, 'C');
                    $pdf->Ln();

                    // Blok Paragraf Pertama
                    $fill = FALSE;
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(19, .5, 'Yang bertanda tangan dibawah ini,', '', 0, 'L', $fill);
                    $pdf->Ln(1);

                    // Blok PENANGGUNG JAWAB
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(1, .5, '', '0', 0, 'L', $fill);
                    $pdf->Cell(4.5, .5, 'Nama Lengkap', '0', 0, 'L', $fill);
                    $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(12, .5, $sql_medc_srt->nama, '0', 0, 'L', $fill);
                    $pdf->Ln();
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(1, .5, '', '0', 0, 'L', $fill);
                    $pdf->Cell(4.5, .5, 'Tanggal Lahir', '0', 0, 'L', $fill);
                    $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(12, .5, ($sql_medc_srt->tgl_lahir != '0000-00-00' ? $this->tanggalan->tgl_indo2($sql_medc_srt->tgl_lahir).' ('.$this->tanggalan->usia($sql_medc_srt->tgl_lahir).')' : '-').(!empty($sql_medc_srt->jns_klm) ? ' / '.general::jns_klm($sql_medc_srt->jns_klm) : ''), '0', 0, 'L', $fill);
                    $pdf->Ln();
//                    $pdf->SetFont('Arial', 'B', '10');
//                    $pdf->Cell(1, .5, '', '0', 0, 'L', $fill);
//                    $pdf->Cell(4, .5, 'Alamat', '0', 0, 'L', $fill);
//                    $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
//                    $pdf->SetFont('Arial', '', '10');
//                    $pdf->Cell(12.5, .5, $sql_medc_srt->alamat, '0', 0, 'L', $fill);
//                    $pdf->Ln();
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(1, .5, '', '0', 0, 'L', $fill);
                    $pdf->Cell(4.5, .5, 'Hubungan dengan pasien', '0', 0, 'L', $fill);
                    $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(12, .5, general::tipe_hubungan($sql_medc_srt->status_hub), '0', 0, 'L', $fill);
                    $pdf->Ln(1);
                    
                    # Blok Paragraf kedua
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(19, .5, 'Dengan ini saya menyatakan dengan sesungguhnya telah memberikan pernyataan,', '', 0, 'L', $fill);
                    $pdf->Ln();
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(19, .5, general::tipe_surat_inf_stj($sql_medc_srt->status_stj), '', 0, 'C', $fill);
                    $pdf->Ln();
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(10, .5, 'Untuk dilakukan pemeriksaan, pengobatan dan tindakan medis yaitu :', '', 0, 'L', $fill);
                    $pdf->Ln();
                    $pdf->SetFont('Arial', 'iB', '10');
                    $pdf->MultiCell(19, .5, $sql_medc_srt->tindakan, '', 'C', $fill);
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(19, .5, 'terhadap pasien dengan identitas pasien sebagai berikut :', '', 0, 'L', $fill);
                    $pdf->Ln(1);

                    // Blok ID PASIEN
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(1, .5, '', '0', 0, 'L', $fill);
                    $pdf->Cell(4.5, .5, 'Nomor Rekam Medis', '0', 0, 'L', $fill);
                    $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(12, .5, $sql_pasien->kode_dpn.$sql_pasien->kode, '0', 0, 'L', $fill);
                    $pdf->Ln();
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(1, .5, '', '0', 0, 'L', $fill);
                    $pdf->Cell(4.5, .5, 'NIK', '0', 0, 'L', $fill);
                    $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(12, .5, $sql_pasien->nik, '0', 0, 'L', $fill);
                    $pdf->Ln();
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(1, .5, '', '0', 0, 'L', $fill);
                    $pdf->Cell(4.5, .5, 'Nama Lengkap', '0', 0, 'L', $fill);
                    $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(12, .5, $sql_pasien->nama_pgl, '0', 0, 'L', $fill);
                    $pdf->Ln();
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(1, .5, '', '0', 0, 'L', $fill);
                    $pdf->Cell(4.5, .5, 'Tanggal Lahir', '0', 0, 'L', $fill);
                    $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(12, .5, $this->tanggalan->tgl_indo2($sql_pasien->tgl_lahir).' ('.$this->tanggalan->usia_lkp($sql_pasien->tgl_lahir).')'.(!empty($sql_pasien->jns_klm) ? ' / '.general::jns_klm($sql_pasien->jns_klm) : ''), '0', 0, 'L', $fill);
                    $pdf->Ln();
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(1, .5, '', '0', 0, 'L', $fill);
                    $pdf->Cell(4.5, .5, 'Alamat', '0', 0, 'L', $fill);
                    $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->MultiCell(12, .5, $sql_pasien->alamat, '', 'L', $fill);
//                    $pdf->Ln();
//                    $pdf->SetFont('Arial', 'B', '10');
//                    $pdf->Cell(1, .5, '', '0', 0, 'L', $fill);
//                    $pdf->Cell(4, .5, 'Tanggal Masuk', '0', 0, 'L', $fill);
//                    $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
//                    $pdf->SetFont('Arial', '', '10');
//                    $pdf->Cell(12.5, .5, $this->tanggalan->tgl_indo2($sql_medc->tgl_masuk), '0', 0, 'L', $fill);
//                    $pdf->Ln();
//                    $pdf->SetFont('Arial', 'B', '10');
//                    $pdf->Cell(1, .5, '', '0', 0, 'L', $fill);
//                    $pdf->Cell(4, .5, 'Ruang Perawatan', '0', 0, 'L', $fill);
//                    $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
//                    $pdf->SetFont('Arial', '', '10');
//                    $pdf->Cell(12.5, .5, (!empty($sql_medc_srt->ruang) ? $sql_medc_srt->ruang : '-'), '0', 0, 'L', $fill);
//                    $pdf->Ln();
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(1, .5, '', '0', 0, 'L', $fill);
                    $pdf->Cell(4.5, .5, 'Dokter yang merawat', '0', 0, 'L', $fill);
                    $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(12, .5, (!empty($sql_dokter2->nama_dpn) ? $sql_dokter2->nama_dpn.' ' : '').$sql_dokter2->nama.(!empty($sql_dokter2->nama_blk) ? ', '.$sql_dokter2->nama_blk.' ' : ''), '0', 0, 'L', $fill);
                    $pdf->Ln(1);
                    
                    # Paragraf bawah
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(19, .5, 'Yang cara, manfaat tujuan serta resiko yang ditimbulkan dari pemeriksaan pengobatan serta tindakan medis tersebut', '', 0, 'L', $fill);
                    $pdf->Ln();
                    $pdf->Cell(19, .5, 'diatas telah dijelaskan oleh dokter dan saya telah mengerti sepenuhnya.', '', 0, 'L', $fill);
                    $pdf->Ln();
            
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(19, .5, 'Demikian surat pernyataan ini dibuat dalam keadaan sadar tanpa ada tekanan dari pihak manapun.', '', 0, 'L', $fill);
                    $pdf->Ln();
            
                    # QR GENERATOR VALIDASI
                    $qr_validasi        = FCPATH.'/file/pasien/'.strtolower($kode_pasien).'/qr-petugas-'.strtolower($sql_medc->no_rm).'.png';
//                    $params['data']     = 'https://verify.esensia.co.id/?id='.general::enkrip($sql_medc_srt->id).'&id_pasien='.general::enkrip($sql_pasien->id).'&role=surat';
                    $params['data']     = 'Telah diverifikasi dan ditandatangani secara elektronik oleh manajemen '.$setting->judul.'. Diwakili oleh ';
                    $params['data']    .= strtoupper($this->ion_auth->user($sql_medc_srt->id_user)->row()->first_name).',';
                    $params['data']    .= 'yang merupakan petugas yang bertugas pada tanggal '.date('d/m/Y H:i').'.';
                    $params['level']    = 'H';
                    $params['size']     = 2;
                    $params['savename'] = $qr_validasi; 
                    $this->ciqrcode->generate($params);
                    
                    $gambar4            = $qr_validasi; 
                                
                    # QR GENERATOR TANDA TANGAN
                    $qr_ttd             = FCPATH.'/'.$sql_medc_srt->file_name1;
                    $gambar5            = $qr_ttd;        
                                
                    # QR GENERATOR DOKTER
                    $qr_dokter          = FCPATH.'/file/pasien/'.strtolower($kode_pasien).'/qr-dokter-'.strtolower($sql_dokter->id).'.png';
                    $params['data']     = 'Telah diverifikasi dan ditandatangani secara elektronik oleh dokter penanggung jawab ['.(!empty($sql_dokter->nama_dpn) ? $sql_dokter->nama_dpn.' ' : '').$sql_dokter->nama.(!empty($sql_dokter->nama_blk) ? ', '.$sql_dokter->nama_blk : '').']';
                    $params['level']    = 'H';
                    $params['size']     = 2;
                    $params['savename'] = $qr_dokter;
                    $this->ciqrcode->generate($params);
                    $gambar6            = $qr_dokter;        
                    
                    # Gambar VALIDASI
                    $pdf->SetY(-13.5);
                    $pdf->Image($gambar6,3.25,$pdf->GetY(),2,2);
                    $pdf->Image($gambar5,13.5,$pdf->GetY(),2,2);
                    
                    # QR Petugas di kolom saksi
                    $pdf->SetY(-10.5);
                    $pdf->Image($gambar4,3.25,$pdf->GetY(),2,2);
                    
                    $pdf->SetY(-14.5);
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(12.5, .5, '', '', 0, 'L', $fill);
                    $pdf->Cell(6.5, .5, 'Semarang, '.$this->tanggalan->tgl_indo3($sql_medc_srt->tgl_masuk), '', 0, 'L', $fill);
                    $pdf->Ln();
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(6.5, .5, 'Dokter Penanggung Jawab', '0', 0, 'C', $fill);
                    $pdf->Cell(6, .5, '', '0', 0, 'C', $fill);
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(6.5, .5, (!empty($ket) ? $ket : 'Yang Membuat Pernyataan'), '0', 0, 'L', $fill);
                    $pdf->Ln(4);
                    
                    $pdf->SetY(-11.5);
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(6.5, .5,(!empty($sql_dokter->nama_dpn) ? $sql_dokter->nama_dpn.' ' : '').$sql_dokter->nama.(!empty($sql_dokter->nama_blk) ? ', '.$sql_dokter->nama_blk.' ' : ''), '', 0, 'L', $fill);
                    $pdf->Cell(6, .5, '', '0', 0, 'C', $fill);
                    $pdf->Cell(6.5, .5, $sql_medc_srt->nama, '', 0, 'L', $fill);
                    $pdf->Ln();
                    
                    $pdf->SetY(-11);
                    $pdf->SetFont('Arial', 'B', '10');
                    $pdf->Cell(6.5, .5, 'Saksi 1', '', 0, 'C', $fill);
                    $pdf->Cell(6, .5, '', '0', 0, 'C', $fill);
                    $pdf->Cell(6.5, .5, 'Saksi 2 '.$sql_pasien->nama, '', 0, 'L', $fill);
                    $pdf->Ln(4);
                    
                    $pdf->SetY(-8.5);
                    $pdf->SetFont('Arial', '', '10');
                    $pdf->Cell(6.5, .5, '( '.$this->ion_auth->user($sql_medc_srt->id_user)->row()->first_name.' )', '', 0, 'C', $fill);
                    $pdf->Cell(6, .5, '', '', 0, 'L', $fill);
//                    $pdf->Cell(6.5, .5, '( '.$sql_pasien->nama.' )', '', 0, 'C', $fill);
                    $pdf->Ln();
                    break;
            }
                    
            $pdf->SetFillColor(235, 232, 228);
            $pdf->SetTextColor(0);
            $pdf->SetFont('Arial', '', '10');

            $type = (isset($_GET['type']) ? $_GET['type'] : 'I');


            ob_start();
            $pdf->Output($sql_pasien->nama_pgl. '.pdf', $type);
            ob_end_flush();
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }
    
    public function pdf_medcheck_lab() {
        if (akses::aksesLogin() == TRUE) {
            $setting            = $this->db->get('tbl_pengaturan')->row();
            $id_medcheck        = $this->input->get('id');
            $id_lab             = $this->input->get('id_lab');
            $status_ctk         = $this->input->get('status_ctk');
            
            $sql_medc           = $this->db->where('id', general::dekrip($id_medcheck))->get('tbl_trans_medcheck')->row();
            $sql_medc_srt       = $this->db->where('id', general::dekrip($id))->get('tbl_trans_medcheck_surat')->row(); 
            $sql_medc_lab       = $this->db->where('id', general::dekrip($id_lab))->get('tbl_trans_medcheck_lab')->row(); 
            $sql_medc_lab_det   = $this->db->where('id_medcheck', general::dekrip($id_medcheck))->where('id_lab', general::dekrip($id_lab))->where('status', '3')->where('status_hsl', '1')->group_by('id_lab_kat')->get('tbl_trans_medcheck_det')->result(); 
            $sql_poli           = $this->db->where('id', $sql_medc->id_poli)->get('tbl_m_poli')->row(); 
            $sql_pasien         = $this->db->where('id', $sql_medc->id_pasien)->get('tbl_m_pasien')->row(); 
            $sql_pekerjaan      = $this->db->where('id', $sql_pasien->id_pekerjaan)->get('tbl_m_jenis_kerja')->row();
            $sql_dokter         = $this->db->where('id_user', (!empty($sql_medc_lab->id_dokter) ? $sql_medc_lab->id_dokter : $sql_medc->id_dokter))->get('tbl_m_karyawan')->row();
            $sql_dokter2        = $this->db->where('id_user', '221')->get('tbl_m_karyawan')->row();
            $sql_dokter3        = $this->db->where('id_user', '48167')->get('tbl_m_karyawan')->row();
            $kode_pasien        = $sql_pasien->kode_dpn.$sql_pasien->kode;
            $gambar1            = FCPATH.'/assets/theme/admin-lte-3/dist/img/logo-esensia-2.png'; // base_url('assets/theme/admin-lte-3/dist/img/logo-esensia-2.png');
            $gambar2            = FCPATH.'/assets/theme/admin-lte-3/dist/img/logo-bw-bg2-1440px.png'; // base_url('assets/theme/admin-lte-3/dist/img/logo-bw-bg2-1440px.png');
            $gambar3            = FCPATH.'/assets/theme/admin-lte-3/dist/img/logo-footer.png'; // base_url('assets/theme/admin-lte-3/dist/img/logo-footer.png');
            $sess_print         = $this->session->userdata('lab_print');
            
            $judul              = "HASIL PEMERIKSAAN LABORATORIUM";
            $judul2             = "Laboratory Result";

            $this->load->library('MedLabPDF');
            $pdf = new MedLabPDF('P', 'cm', array(21.5,33));
            $pdf->SetAutoPageBreak('auto', 6.5);
            $pdf->SetMargins(1,0.35,1);
            $pdf->header = 0;
            $pdf->addPage('','',false);
            
            # Gambar Watermark Tengah
            $pdf->Image($gambar2,5,4,15,19);  
            
            # Blok Judul
            $pdf->SetFont('Arial', 'B', '13');
            $pdf->Cell(19, .5, $judul, 0, 1, 'C');
            $pdf->Ln(0);
            $pdf->SetFont('Arial', 'Bi', '13');
            $pdf->Cell(19, .5, $judul2, 'B', 1, 'C');
            $pdf->Ln();
            
            # Blok Dokter Penanggung Jawab
            $pdf->SetFont('Arial', 'B', '9');
            $pdf->Cell(9, .5, '', '0', 0, 'L', $fill);
            $pdf->Cell(4, .5, 'Dokter Penanggung Jawab', '0', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
            $pdf->SetFont('Arial', 'B', '9');
            $pdf->Cell(5.5, .5, '1. dr. ANITA TRI HASTUTI, Sp.PK', '', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->Cell(9, .5, '', '0', 0, 'L', $fill);
            $pdf->Cell(4, .5, '', '0', 0, 'L', $fill);
            $pdf->Cell(.5, .5, '', '0', 0, 'C', $fill);
            $pdf->Cell(5.5, .5, '2. dr. YENI JAMILAH, Sp.MK', '', 0, 'L', $fill);
            $pdf->Ln();
            
            # Blok ID PASIEN
            $pdf->SetFont('Arial', '', '9');
            $pdf->Cell(3, .5, 'No. Pemeriksaan', '0', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
            $pdf->Cell(4.5, .5, $sql_medc_lab->no_lab, '0', 0, 'L', $fill);
            $pdf->Cell(2.5, .5, 'No. RM', '0', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
            $pdf->Cell(8, .5, $sql_pasien->kode_dpn.$sql_pasien->kode, '0', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->Cell(3, .5, 'No. Sampel', '0', 0, 'L', $fill); 
            $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
            $pdf->Cell(4.5, .5, $sql_medc_lab->no_sample, '0', 0, 'L', $fill);
            $pdf->Cell(2.5, .5, 'Nama Name', '0', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
            $pdf->Cell(8, .5, general::bersih($sql_pasien->nama_pgl).' ('.$sql_pasien->jns_klm.')', '0', 0, 'L', $fill);
            $pdf->Ln(); 
            $pdf->Cell(3, .5, 'Tgl Periksa', '0', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
            $pdf->Cell(4.5, .5, $this->tanggalan->tgl_indo5($sql_medc_lab->tgl_masuk), '0', 0, 'L', $fill);
//            $pdf->Cell(4.5, .5, $this->tanggalan->tgl_indo5(date('Y-m-d H:i')), '0', 0, 'L', $fill);
            $pdf->Cell(2.5, .5, 'NIK', '0', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
            $pdf->Cell(8, .5, $sql_pasien->nik, '0', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->Cell(3, .5, 'Poli', '0', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
            $pdf->Cell(4.5, .5, $sql_poli->lokasi, '0', 0, 'L', $fill);
            $pdf->Cell(2.5, .5, 'Tgl Lahir', '0', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
            $pdf->Cell(8, .5, $this->tanggalan->tgl_indo2($sql_pasien->tgl_lahir).' / '.$this->tanggalan->usia_lkp($sql_pasien->tgl_lahir), '0', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->Cell(3, .5, 'Alamat', '0', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
            $pdf->MultiCell(15.5, .5, (!empty($sql_pasien->alamat) ? general::bersih($sql_pasien->alamat) : (!empty($sql_pasien->alamat_dom) ? $sql_pasien->alamat_dom : '-')), '0', 'L');
            $pdf->Cell(3, .5, 'No. HP / Rmh', '0', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
            $pdf->MultiCell(15.5, .5, $sql_pasien->no_hp.(!empty($penj->no_telp) ? ' / '.$penj->no_telp : ''), '0', 'L');
            $pdf->Cell(3, .5, 'Dokter Pengirim', '0', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
            $pdf->MultiCell(15.5, .5, (!empty($sql_dokter->nama_dpn) ? $sql_dokter->nama_dpn.' ' : '').$sql_dokter->nama.(!empty($sql_dokter->nama_blk) ? ', '.$sql_dokter->nama_blk : ''), '0', 'L');
            $pdf->Ln();
            
            $fill = FALSE;
            $pdf->SetFont('Arial', 'B', '9');
            $pdf->Cell(7, .5, 'PEMERIKSAAN', 'T', 0, 'L', $fill);
            $pdf->Cell(4.5, .5, 'HASIL', 'T', 0, 'L', $fill);
            $pdf->Cell(5.5, .5, 'NILAI RUJUKAN', 'T', 0, 'L', $fill);
            $pdf->Cell(2, .5, 'SATUAN', 'T', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->SetFont('Arial', 'Bi', '9');
            $pdf->Cell(7, .5, 'EXAMINATION', 'B', 0, 'L', $fill);
            $pdf->Cell(4.5, .5, 'RESULT', 'B', 0, 'L', $fill);
            $pdf->Cell(5.5, .5, 'REFERENCE VALUE', 'B', 0, 'L', $fill);
            $pdf->Cell(2, .5, 'MEASURE', 'B', 0, 'L', $fill);
            $pdf->Ln();
            
            # Jika status cetak 1, maka akan di cetak semua
            # Pilihan ini untuk mengakomodir ePasien supaya bisa mencetak hasil
            # Jika status cetak tidak ada, maka untuk perawat bisa memilih item yg di cetak
            if ($status_ctk == '1') {
                foreach ($sql_medc_lab_det as $det) {
                    $sql_kat = $this->db->where('id', $det->id_lab_kat)->get('tbl_m_kategori')->row();
                    $sql_det = $this->db->where('status_hsl', '1')->where('id_medcheck', $det->id_medcheck)->where('id_lab', $det->id_lab)->where('id_lab_kat', $det->id_lab_kat)->get('tbl_trans_medcheck_det')->result();

                    if (!empty($det->id_lab_kat)) {
                        $pdf->SetFont('Arial', 'Bi', '9');
                        $pdf->Cell(19, .5, $sql_kat->keterangan, '', 0, 'L', $fill);
                        $pdf->Ln();
                    }

                    foreach ($sql_det as $medc) {
                        $sql_lab_rws = $this->db->where('id_medcheck', $medc->id_medcheck)->get('tbl_trans_medcheck_lab');
                        if ($sql_lab_rws->num_rows() > 1) {
                            $sql_lab = $this->db->where('id_medcheck', $medc->id_medcheck)->where('id_lab', general::dekrip($this->input->get('id_lab')))->where('id_item', $medc->id_item)->get('tbl_trans_medcheck_lab_hsl')->result();
                        } else {
                            $sql_lab = $this->db->where('id_medcheck', $medc->id_medcheck)->where('id_item', $medc->id_item)->get('tbl_trans_medcheck_lab_hsl')->result();
                        }

                        $pdf->SetFont('Arial', '', '8');

                        if (!empty($det->id_lab_kat)) {
                            $pdf->Cell(.25, .5, '', '', 0, 'L', $fill);
                        }

                        $pdf->Cell(18.5, .5, $medc->item, '', 0, 'L', $fill);
                        $pdf->Ln();

                        foreach ($sql_lab as $lab) {
                            # Jika warna hasil di tandai merah
                            if ($lab->status_hsl_wrn == 1) {
                                $pdf->SetTextColor(249, 11, 11);
                            }

                            $pdf->Cell(.25, .5, '', '', 0, 'L', $fill);
                            $pdf->Cell(7, .5, ' - ' . html_entity_decode($lab->item_name) . ($lab->status_hsl_lab == '1' ? '*' : ''), '', 0, 'L', $fill);
//                            $pdf->Cell(7, .5, '', 'B', 0, 'L', $fill);
                            $pdf->Cell(4.5, .5, html_entity_decode($lab->item_hasil, ENT_NOQUOTES, 'utf-8') . ($lab_det->status_hsl_lab == '1' ? '*' : ''), '', 0, 'L', $fill);
                            
                            $x = $pdf->GetX();
                            $y = $pdf->GetY();                           
                            $pdf->MultiCell(5.5, .5, html_entity_decode($lab->item_value, ENT_NOQUOTES, 'utf-8'), '', 'L');                            
                            $pdf->SetXY($x + 5.5, $y);                            
                            $pdf->Cell(2, .5, html_entity_decode($lab->item_satuan, ENT_NOQUOTES, 'utf-8'), '', 0, 'L', $fill);
//                            $pdf->Cell(5.5, .5, html_entity_decode($lab->item_value, ENT_NOQUOTES, 'utf-8'), '', 0, 'L', $fill);
//                            $pdf->Cell(2, .5, html_entity_decode($lab->item_satuan, ENT_NOQUOTES, 'utf-8'), '', 0, 'L', $fill);
                            $pdf->Ln();
                            
                            # Jika warna hasil di tandai merah
                            if ($lab->status_hsl_wrn == 1) {
                                $pdf->SetTextColor(0,0,0);
                            }
                        }
                    }
                }
            } else {
                # Untuk Mencetak dengan pilihan                
                $sql_medc_lab_det2   = $this->db->where('status', '3')->where('status_ctk', '1')->where('status_hsl', '1')->group_by('id_lab_kat')->where('id_medcheck', general::dekrip($id_medcheck))->where('id_lab', general::dekrip($id_lab))->get('tbl_trans_medcheck_det')->result();
                
                $i = 0;
                foreach ($sql_medc_lab_det2 as $det2) {
                    $sql_kat2 = $this->db->where('id', $det2->id_lab_kat)->get('tbl_m_kategori')->row();
                    $sql_det2 = $this->db->where('status_ctk', '1')->where('status_hsl', '1')->where('id_medcheck', $det2->id_medcheck)->where('id_lab', $det2->id_lab)->where('id_lab_kat', $det2->id_lab_kat)->get('tbl_trans_medcheck_det')->result();                        
                    
                    if (!empty($det2->id_lab_kat)) {
                        $pdf->SetFont('Arial', 'Bi', '9');
                        $pdf->Cell(19, .5, $sql_kat2->keterangan, '', 0, 'L', $fill);
                        $pdf->Ln();
                    }

                    foreach ($sql_det2 as $medc2) {
                        $sql_lab_rws2 = $this->db->where('id_medcheck', $medc2->id_medcheck)->get('tbl_trans_medcheck_lab');
                        if ($sql_lab_rws2->num_rows() > 1) {
                            $sql_lab2 = $this->db->where('id_medcheck', $medc2->id_medcheck)->where('id_lab', $medc2->id_lab)->where('id_item', $medc2->id_item)->get('tbl_trans_medcheck_lab_hsl');
                        } else {
                            $sql_lab2 = $this->db->where('id_medcheck', $medc2->id_medcheck)->where('id_item', $medc2->id_item)->get('tbl_trans_medcheck_lab_hsl');
                        }

                        $pdf->SetFont('Arial', '', '8');

                        if (!empty($det2->id_lab_kat)) {
//                            if ($sess_print[$i]['value'] == '1' AND $sess_print[$i]['id_kat'] == $det->id_lab_kat) {
                                $pdf->Cell(.25, .5, '', '', 0, 'L', $fill);
//                            }
                        }
                        
                        if(strtoupper($sql_lab2->row()->item_name) != strtoupper($medc2->item)){
                            $pdf->Cell(18.5, .5, $medc2->item . ($lab_det2->status_hsl_lab == '1' ? '*' : ''), '', 0, 'L', $fill);
                            $pdf->Ln();                         
                        }

                        foreach ($sql_lab2->result() as $lab2) {
                                $x = $pdf->GetX();
                                $y = $pdf->GetY();
                                
//                            if ($sess_print[$i]['value'] == '1' AND $sess_print[$i]['id_lab_hsl'] == $lab->id) {
                                if(strtoupper($sql_lab2->row()->item_name) != strtoupper($medc2->item)){
                                    $pdf->Cell(.25, .5, '', '', 0, 'L', $fill);
                                }
                                
                                # Jika warna hasil di tandai merah
                                if($lab2->status_hsl_wrn == 1){
                                    $pdf->SetTextColor(249,11,11);
                                }
                                
                                $itm_tg     = 0.5; # tinggi cell
                                $itm_lbr    = 4.5;
                                $itm_txt    = ceil($pdf->GetStringWidth($lab2->item_hasil));
                                $itm_hsl    = (ceil(($itm_txt / $itm_lbr)) * $itm_tg) + 0.25;
                                
                                $pdf->Cell(6.75, .5, ' - '.html_entity_decode($lab2->item_name), '', 0, 'L', $fill);
                                $pdf->MultiCell(4.5, .5, html_entity_decode($lab2->item_hasil, ENT_NOQUOTES, 'utf-8'), '', 'J');
                                $pdf->SetXY($x + 11.5, $y);
                                $pdf->MultiCell(5.5, $itm_hsl, html_entity_decode($lab2->item_value, ENT_NOQUOTES, 'utf-8'), '', 'L'); 
                                $pdf->SetXY($x + 17, $y);
                                $pdf->MultiCell(2, $itm_hsl, html_entity_decode($lab2->item_satuan, ENT_NOQUOTES, 'utf-8'), '', 'L'); 
                                $pdf->Ln(0);

//                                $len = strlen($lab2->item_hasil);
//                                $len = $itm_txt;
//                                if($len > 36){
//                                    $pdf->Ln($itm_hsl);
//                                }else{
//                                    $pdf->Ln(0);
//                                }
                                
                                # Jika warna hasil di tandai merah
                                if($lab2->status_hsl_wrn == 1){
                                    $pdf->SetTextColor(0,0,0);
                                }
//                            }
                        }
                    }
                    
                    $i++;
                }                
            }
            
            $pdf->SetFont('Arial', 'i', '8');
            $pdf->Ln();
            $pdf->Cell(19, .5, ($sql_medc_lab->status_duplo == '1' ? '* Sudah dilakukan duplo' : ''), 'T', 0, 'L', $fill);
            $pdf->Ln();
            
            // Keterangan Hasil Lab selain template covid
            if ($sql_medc_lab->status_cvd == '0' AND !empty($sql_medc_lab->ket)) {
                $pdf->SetFont('Arial', 'B', '10');
                $pdf->Cell(19, .5, 'Catatan / Note', '', 0, 'L', $fill);
                $pdf->Ln();
                $pdf->SetFont('Arial', '', '9');
                $pdf->MultiCell(6, .5, $sql_medc_lab->ket, '0', 'L');
            }elseif($sql_medc_lab->status_cvd != '0'){
                $pdf->SetFont('Arial', 'B', '10');
                $pdf->Cell(19, .5, 'Catatan / Note', '', 0, 'L', $fill);
                $pdf->Ln();
                $pdf->SetFont('Arial', '', '8');
                $pdf->Cell(.5, .5, '', '', 0, 'C', $fill);              
                $pdf->Cell(.5, .5, '1.', '', 0, 'C', $fill);             
                $pdf->Cell(18, .5, 'Hasil positiv berlaku untuk hasil PCR SARS CoV-2 atau Antigen dari Laboratorium Klinik Utama Rawat Inap', '', 0, 'L', $fill);
                $pdf->Ln();
                $pdf->Cell(.5, .5, '', '', 0, 'C', $fill);              
                $pdf->Cell(.5, .5, '', '', 0, 'C', $fill);             
                $pdf->Cell(18, .5, 'Esensia. Nilai tersebut tidak dapat dibandingkan dengan CT hasil PCR SARS CoV-2 atau Antigen dari', '', 0, 'L', $fill);
                $pdf->Ln();
                $pdf->Cell(.5, .5, '', '', 0, 'C', $fill);              
                $pdf->Cell(.5, .5, '', '', 0, 'C', $fill);             
                $pdf->Cell(18, .5, 'laboratorium lain.', '', 0, 'L', $fill);
                $pdf->Ln();
                $pdf->SetFont('Arial', 'i', '8');
                $pdf->Cell(.5, .5, '', '', 0, 'C', $fill);              
                $pdf->Cell(.5, .5, '', '', 0, 'C', $fill);             
                $pdf->Cell(18, .5, 'Positive results apply to PCR results for SARS CoV-2 or Antigens from the Esensia Inpatient Main', '', 0, 'L', $fill);
                $pdf->Ln();
                $pdf->Cell(.5, .5, '', '', 0, 'C', $fill);              
                $pdf->Cell(.5, .5, '', '', 0, 'C', $fill);             
                $pdf->Cell(18, .5, 'Clinical Laboratory. This value cannot be compared with CT PCR results from SARS CoV-2 or Antigens from', '', 0, 'L', $fill);
                $pdf->Ln();
                $pdf->Cell(.5, .5, '', '', 0, 'C', $fill);              
                $pdf->Cell(.5, .5, '', '', 0, 'C', $fill);             
                $pdf->Cell(18, .5, 'other laboratories.', '', 0, 'L', $fill);
                $pdf->Ln();
                $pdf->SetFont('Arial', '', '8');
                $pdf->Cell(.5, .5, '', '', 0, 'C', $fill);              
                $pdf->Cell(.5, .5, '2.', '', 0, 'C', $fill);             
                $pdf->Cell(18, .5, 'Kondisi tersebut hanya menggambarkan kondisi saat pengambilan sampel.', '', 0, 'L', $fill);
                $pdf->Ln();
                $pdf->SetFont('Arial', 'i', '8');
                $pdf->Cell(.5, .5, '', '', 0, 'C', $fill);              
                $pdf->Cell(.5, .5, '', '', 0, 'C', $fill);             
                $pdf->Cell(18, .5, 'These conditions only describe the conditions at the time of sampling.', '', 0, 'L', $fill);
                $pdf->Ln();
                $pdf->SetFont('Arial', '', '8');
                $pdf->Cell(.5, .5, '', '', 0, 'C', $fill);              
                $pdf->Cell(.5, .5, '3.', '', 0, 'C', $fill);             
                $pdf->Cell(18, .5, 'Bila hasil positif dan terdapat gejala klinis, segera konsultasikan ke faskes.', '', 0, 'L', $fill);
                $pdf->Ln();
                $pdf->SetFont('Arial', 'i', '8');
                $pdf->Cell(.5, .5, '', '', 0, 'C', $fill);              
                $pdf->Cell(.5, .5, '', '', 0, 'C', $fill);             
                $pdf->Cell(18, .5, 'These conditions only describe the conditions at the time of sampling.', '', 0, 'L', $fill);
                $pdf->Ln();
                $pdf->SetFont('Arial', '', '8');
                $pdf->Cell(.5, .5, '', '', 0, 'C', $fill);              
                $pdf->Cell(.5, .5, '4.', '', 0, 'C', $fill);             
                $pdf->Cell(18, .5, 'Bila hasil negatif tidak selalu berarti pasien tidak terinfeksi SARS CoV-2, dan perlu dilakukan', '', 0, 'L', $fill);
                $pdf->Ln();
                $pdf->Cell(.5, .5, '', '', 0, 'C', $fill);              
                $pdf->Cell(.5, .5, '', '', 0, 'C', $fill);             
                $pdf->Cell(18, .5, 'pemeriksaan secara berkala.', '', 0, 'L', $fill);
                $pdf->Ln();
                $pdf->SetFont('Arial', 'i', '8');
                $pdf->Cell(.5, .5, '', '', 0, 'C', $fill);              
                $pdf->Cell(.5, .5, '', '', 0, 'C', $fill);             
                $pdf->Cell(18, .5, 'A negative results  does not necessarily mean that the patient is not infected with SARS-CoV-2, and', '', 0, 'L', $fill);
                $pdf->Ln();
                $pdf->Cell(.5, .5, '', '', 0, 'C', $fill);
                $pdf->Cell(.5, .5, '', '', 0, 'C', $fill);
                $pdf->Cell(18, .5, 'periodic examinations need to be carried out.', '', 0, 'L', $fill);
                $pdf->Ln();
            }
           
            // QR GENERATOR VALIDASI
            $qr_validasi        = FCPATH.'/file/pasien/'.strtolower($kode_pasien).'/qr-validasi-'.strtolower($kode_pasien).'.png';
            $params['data']     = 'Telah diverifikasi dan ditandatangani secara elektronik oleh manajemen '.$setting->judul.'. Pasien a/n. ';
//            $params['data']    .= strtoupper($sql_pasien->nama_pgl).' ('.strtoupper($kode_pasien).')';
//            $params['data']     = 'https://verify.esensia.co.id/?id='.general::enkrip($sql_medc_srt->id).'&id_pasien='.general::enkrip($sql_pasien->id).'&role=surat';
            $params['level']    = 'H';
            $params['size']     = 2;
            $params['savename'] = $qr_validasi;
            $this->ciqrcode->generate($params);
            
//            $gambar4            = base_url('file/qr/validasi-'.$sql_pasien->id.'.png');         
            $gambar4            = $qr_validasi;         
                        
            // QR GENERATOR DOKTER
            $qr_dokter          = FCPATH.'/file/pasien/'.strtolower($kode_pasien).'/qr-dokter-'.strtolower($sql_dokter2->id).'.png';
            $params['data']     = 'Telah diverifikasi dan ditandatangani secara elektronik oleh dokter penanggung jawab ['.(!empty($sql_dokter2->nama_dpn) ? $sql_dokter2->nama_dpn.' ' : '').$sql_dokter2->nama.(!empty($sql_dokter2->nama_blk) ? ', '.$sql_dokter2->nama_blk : '').']';
            $params['level']    = 'H';
            $params['size']     = 2;
            $params['savename'] = $qr_dokter;
            $this->ciqrcode->generate($params);
            
            $gambar5            = $qr_dokter;
//            $gambar5            = base_url('file/qr/dokter-'.strtolower($sql_dokter2->id).'.png');
            
            # Gambar VALIDASI
            $getY = $pdf->GetY() + 1;
            $pdf->Image($gambar4,2,$getY,2,2);
            $pdf->Image($gambar5,12.5,$getY,2,2);
            
            
            $pdf->SetFont('Arial', '', '10');
            $pdf->Cell(10.5, .5, '', '', 0, 'L', $fill);
            $pdf->Cell(.5, .5, '', '0', 0, 'C', $fill);
//            $pdf->Cell(7, .5, 'Semarang, '.$this->tanggalan->tgl_indo3($sql_medc_lab->tgl_masuk), '', 0, 'L', $fill);
            $pdf->Cell(7, .5, 'Semarang, '.$this->tanggalan->tgl_indo3($sql_medc_lab->tgl_masuk), '', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->SetFont('Arial', 'B', '10');
            $pdf->Cell(4, .5, 'Validasi', '0', 0, 'C', $fill);            
            # Jika hasil normal, maka muncul nilai kritis
            if($sql_medc_lab->status_normal == '1'){
                $pdf->SetDrawColor(49, 42, 238);
                $pdf->SetTextColor(49, 42, 238);
                $pdf->SetFont('Arial', 'B', '8');
                $pdf->Cell(6.5, .5, 'PELAPORAN NILAI KRITIS', '1', 0, 'C', $fill);
                $pdf->SetTextColor(0,0,0);
            }else{                
                $pdf->Cell(6.5, .5, '', '', 0, 'C', $fill);
            }            
            $pdf->SetFont('Arial', 'B', '10');
            $pdf->Cell(.5, .5, '', '0', 0, 'C', $fill);
            $pdf->Cell(7, .5, (!empty($ket) ? $ket : 'Dokter Pemeriksa'), '0', 0, 'L', $fill);
            $pdf->Ln();            
            $pdf->Cell(4, .5, '', '0', 0, 'C', $fill);            
            # Jika hasil normal, maka muncul nilai kritis
            if($sql_medc_lab->status_normal == '1'){
                $pdf->SetFont('Arial', 'B', '6');
                $pdf->SetTextColor(49, 42, 238);
                $pdf->Cell(3.25, .5, 'PETUGAS LABORATORIUM', '1', 0, 'L', $fill);
                $pdf->Cell(3.25, .5, 'DPJP', '1', 0, 'L', $fill);
                $pdf->SetTextColor(0,0,0);
            }else{                
                $pdf->Cell(6.5, .5, '', '', 0, 'C', $fill);
            }
            
            $pdf->SetFont('Arial', 'B', '10');
            $pdf->Ln();
            $pdf->Cell(4, .5, '', '0', 0, 'C', $fill);
            
            # Jika hasil normal, maka muncul nilai kritis
            if($sql_medc_lab->status_normal == '1'){
                $pdf->SetFont('Arial', 'B', '6');
                $pdf->SetTextColor(49, 42, 238);
                $pdf->Cell(3.25, .5, 'Tanggal', 'L', 0, 'L', $fill);
                $pdf->Cell(3.25, .5, 'Tanggal', 'LR', 0, 'L', $fill);
                $pdf->SetTextColor(0,0,0);
            }else{                
                $pdf->Cell(6.5, .5, '', '', 0, 'C', $fill);
            }
            $pdf->SetFont('Arial', 'B', '10');
            $pdf->Ln();
            $pdf->Cell(4, .5, '', '0', 0, 'C', $fill);
            # Jika hasil normal, maka muncul nilai kritis
            if($sql_medc_lab->status_normal == '1'){
                $pdf->SetFont('Arial', 'B', '6');
                $pdf->SetTextColor(49, 42, 238);
                $pdf->Cell(3.25, .5, 'Jam', 'L', 0, 'L', $fill);
                $pdf->Cell(3.25, .5, 'Jam', 'LR', 0, 'L', $fill);
                $pdf->SetTextColor(0,0,0);
            }else{                
                $pdf->Cell(6.5, .5, '', '', 0, 'C', $fill);
            }
            $pdf->SetFont('Arial', 'B', '10');
            $pdf->Ln();
            $pdf->Cell(4, .5, '', '0', 0, 'C', $fill);
            # Jika hasil normal, maka muncul nilai kritis
            if($sql_medc_lab->status_normal == '1'){
                $pdf->SetFont('Arial', 'B', '6');
                $pdf->SetTextColor(49, 42, 238);
                $pdf->Cell(3.25, .5, 'Nama', 'L', 0, 'L', $fill);
                $pdf->Cell(3.25, .5, 'Nama', 'LR', 0, 'L', $fill);
                $pdf->SetTextColor(0,0,0);
            }else{                
                $pdf->Cell(6.5, .5, '', '', 0, 'C', $fill);
            }
            $pdf->SetFont('Arial', 'B', '10');
            $pdf->Ln();            
            $pdf->Cell(4, .5, '', '0', 0, 'C', $fill);
            # Jika hasil normal, maka muncul nilai kritis
            if($sql_medc_lab->status_normal == '1'){
                $pdf->SetFont('Arial', 'B', '6');
                $pdf->SetTextColor(49, 42, 238);
                $pdf->Cell(3.25, .5, 'TTD', 'L', 0, 'L', $fill);
                $pdf->Cell(3.25, .5, 'TTD', 'LR', 0, 'L', $fill);
                $pdf->SetTextColor(0,0,0);
            }else{                
                $pdf->Cell(6.5, .5, '', '', 0, 'C', $fill);
            }
            $pdf->SetFont('Arial', '', '10');
            $pdf->Cell(.5, .5, '', '0', 0, 'C', $fill);
            
            # JIka status APS = 1, maka ganti dr anita
            if($sql_dokter->status_aps == '1'){
                $pdf->Cell(7, .5, (!empty($sql_dokter2->nama_dpn) ? $sql_dokter2->nama_dpn.' ' : '').$sql_dokter2->nama.(!empty($sql_dokter2->nama_blk) ? ', '.$sql_dokter2->nama_blk : ''), '', 0, 'L', $fill);
            }else{
                $pdf->Cell(7, .5, (!empty($sql_dokter2->nama_dpn) ? $sql_dokter2->nama_dpn.' ' : '').$sql_dokter2->nama.(!empty($sql_dokter2->nama_blk) ? ', '.$sql_dokter2->nama_blk : ''), '', 0, 'L', $fill);
            }
            
            $pdf->Ln();
            $pdf->Cell(4, .5, '', '0', 0, 'C', $fill);
            # Jika hasil normal, maka muncul nilai kritis
            if($sql_medc_lab->status_normal == '1'){
                $pdf->SetFont('Arial', 'B', '6');
                $pdf->Cell(3.25, .5, '', 'LB', 0, 'L', $fill);
                $pdf->Cell(3.25, .5, '', 'LRB', 0, 'L', $fill);
            }else{                
                $pdf->Cell(6.5, .5, '', '', 0, 'C', $fill);
            }
            $pdf->SetFont('Arial', '', '10');
            $pdf->Cell(.5, .5, '', '0', 0, 'C', $fill);
            $pdf->Cell(7, .5, $sql_dokter2->nik, '', 0, 'L', $fill);
            $pdf->Ln();
            
            $type = (isset($_GET['type']) ? $_GET['type'] : 'I');

            ob_start();
            $pdf->Output($sql_pasien->nama_pgl. '.pdf', $type);
            ob_end_flush();
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }
    
    public function pdf_medcheck_lab_spiro() {
        if (akses::aksesLogin() == TRUE) {
            $setting            = $this->db->get('tbl_pengaturan')->row();
            $id_medcheck        = $this->input->get('id');
            $id_lab             = $this->input->get('id_lab');
            $status_ctk         = $this->input->get('status_ctk');
            
            $sql_medc           = $this->db->where('id', general::dekrip($id_medcheck))->get('tbl_trans_medcheck')->row();
            $sql_medc_srt       = $this->db->where('id', general::dekrip($id))->get('tbl_trans_medcheck_surat')->row(); 
            $sql_medc_lab       = $this->db->where('id', general::dekrip($id_lab))->get('tbl_trans_medcheck_lab_spiro')->row(); 
            $sql_medc_lab_det   = $this->db->where('id_lab_spiro', general::dekrip($id_lab))->get('tbl_trans_medcheck_lab_spiro_hsl')->result(); 
            $sql_poli           = $this->db->where('id', $sql_medc->id_poli)->get('tbl_m_poli')->row(); 
            $sql_pasien         = $this->db->where('id', $sql_medc->id_pasien)->get('tbl_m_pasien')->row(); 
            $sql_pekerjaan      = $this->db->where('id', $sql_pasien->id_pekerjaan)->get('tbl_m_jenis_kerja')->row();
            $sql_dokter         = $this->db->where('id_user', (!empty($sql_medc_lab->id_dokter) ? $sql_medc_lab->id_dokter : $sql_medc->id_dokter))->get('tbl_m_karyawan')->row();
            $kode_pasien        = $sql_pasien->kode_dpn.$sql_pasien->kode;
            $gambar1            = FCPATH.'/assets/theme/admin-lte-3/dist/img/logo-esensia-2.png'; // base_url('assets/theme/admin-lte-3/dist/img/logo-esensia-2.png');
            $gambar2            = FCPATH.'/assets/theme/admin-lte-3/dist/img/logo-bw-bg2-1440px.png'; // base_url('assets/theme/admin-lte-3/dist/img/logo-bw-bg2-1440px.png');
            $gambar3            = FCPATH.'/assets/theme/admin-lte-3/dist/img/logo-footer.png'; // base_url('assets/theme/admin-lte-3/dist/img/logo-footer.png');
            $sess_print         = $this->session->userdata('lab_print');
            
            $judul              = "HASIL ANALISA SPIROGRAM";
            $judul2             = "Spirogram Result";

            $this->load->library('MedLabPDF');
            $pdf = new MedLabPDF('P', 'cm', array(21.5,33));
            $pdf->SetAutoPageBreak('auto', 7);
            $pdf->SetMargins(1,0.35,1);
            $pdf->header = 0;
            $pdf->addPage('','',false);
            
            // Gambar Watermark Tengah
            $pdf->Image($gambar2,5,4,15,19);     
            
            # Blok Judul
            $pdf->SetFont('Arial', 'B', '13');
            $pdf->Cell(19, .5, $judul, 0, 1, 'C');
            $pdf->Ln(0);
            $pdf->SetFont('Arial', 'Bi', '13');
            $pdf->Cell(19, .5, $judul2, 'B', 1, 'C');
            $pdf->Ln(0);
            
            # Blok ID PASIEN
            $pdf->SetFont('Arial', '', '9');
            $pdf->Cell(3, .5, 'No. Pemeriksaan', '0', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
            $pdf->Cell(4.5, .5, $sql_medc_lab->no_lab, '0', 0, 'L', $fill);
            $pdf->Cell(2.5, .5, 'No. RM', '0', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
            $pdf->Cell(8, .5, $sql_pasien->kode_dpn.$sql_pasien->kode, '0', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->Cell(3, .5, 'No. Sampel', '0', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
            $pdf->Cell(4.5, .5, $sql_medc_lab->no_sample, '0', 0, 'L', $fill);
            $pdf->Cell(2.5, .5, 'Nama Name', '0', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
            $pdf->Cell(8, .5, general::bersih($sql_pasien->nama_pgl).' ('.$sql_pasien->jns_klm.')', '0', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->Cell(3, .5, 'Tanggal', '0', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
            $pdf->Cell(4.5, .5, $this->tanggalan->tgl_indo5($sql_medc_lab->tgl_masuk), '0', 0, 'L', $fill);
            $pdf->Cell(2.5, .5, 'NIK', '0', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
            $pdf->Cell(8, .5, $sql_pasien->nik, '0', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->Cell(3, .5, 'No. HP / Rmh', '0', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
            $pdf->Cell(4.5, .5, $sql_pasien->no_hp.(!empty($penj->no_telp) ? ' / '.$penj->no_telp : ''), '0', 0, 'L', $fill);
            $pdf->Cell(2.5, .5, 'Tgl Lahir', '0', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
            $pdf->Cell(8, .5, $this->tanggalan->tgl_indo2($sql_pasien->tgl_lahir).' / '.$this->tanggalan->usia_lkp($sql_pasien->tgl_lahir), '0', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->Cell(3, .5, 'Alamat', '0', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
            $pdf->MultiCell(15.5, .5, (!empty($sql_pasien->alamat) ? general::bersih($sql_pasien->alamat) : (!empty($sql_pasien->alamat_dom) ? $sql_pasien->alamat_dom : '-')), '0', 'L');
            $pdf->Ln();
            $pdf->Cell(3, .5, 'Tinggi Badan', '0', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
            $pdf->Cell(4.5, .5, (float)$sql_medc_lab->tb.' cm', '0', 0, 'L', $fill);
            $pdf->Cell(3, .5, 'Berat Badan', '0', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
            $pdf->Cell(7, .5, (float)$sql_medc_lab->bb.' Kg', '0', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->Cell(3, .5, 'IMT', '0', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
            $pdf->Cell(4.5, .5, (float)$sql_medc_lab->imt, '0', 0, 'L', $fill);
            $pdf->Cell(3, .5, 'Kebiasaan Merokok', '0', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
            $pdf->Cell(7, .5, general::status_rokok($sql_medc_lab->status_rokok), '0', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->Cell(3, .5, 'Keluhan', '0', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
            $pdf->MultiCell(15.5, .5, $sql_medc_lab->keluhan, '0', 'L');
            $pdf->Cell(3, .5, 'Riwayat Asma', '0', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
            $pdf->MultiCell(15.5, .5, $sql_medc_lab->riwayat, '0', 'L');
            $pdf->Ln();
            
            $fill = FALSE;
            $pdf->SetFont('Arial', 'B', '9');
            $pdf->Cell(6, .5, '', 'TLB', 0, 'L', $fill);
            $pdf->Cell(4, .5, 'HASIL PENGUKURAN', 'TB', 0, 'C', $fill);
            $pdf->Cell(3, .5, 'PREDIKSI', 'TB', 0, 'C', $fill);
            $pdf->Cell(3, .5, '% PREDIKSI', 'TB', 0, 'C', $fill);
            $pdf->Cell(3, .5, 'LLN', 'TRB', 0, 'C', $fill);
            $pdf->Ln();
            
            $pdf->SetFont('Arial', '', '9');
            foreach ($sql_medc_lab_det as $spiro){
                $sql_spiro = $this->db->where('id', $spiro->id_lab_spiro_kat)->get('tbl_m_kategori_spiro')->row();
                
                $pdf->Cell(6, .5, $spiro->item_name, 'L', 0, 'L', $fill);
                $pdf->Cell(4, .5, general::format_angka2($spiro->item_value, 2), '', 0, 'C', $fill);
                $pdf->Cell(3, .5, general::format_angka2($spiro->item_value2, 2), '', 0, 'C', $fill);
                $pdf->Cell(3, .5, general::format_angka2($spiro->item_value3, 2), '', 0, 'C', $fill);
                $pdf->Cell(3, .5, general::format_angka2($sql_spiro->jml_lln, 2), 'R', 0, 'C', $fill);
                $pdf->Ln();                
            }
            
            $pdf->Cell(19, .5, '', 'T', 0, 'C', $fill);
            $pdf->Ln();
            
            # Keterangan Hasil Analisa Spirogram
            $pdf->SetFont('Arial', 'B', '10');
            $pdf->Cell(19, .5, 'Catatan / Note', '', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->SetFont('Arial', '', '9');
            $pdf->MultiCell(19, .5, 'angka pada kolom prediksi, % prediksi, dan LLN menggunakan reference Pneumobile Project Indonesia	( nilai fungsi paru normal orang indonesia ), jadi nilainya berbeda dengan yang tercantum pada  spirogram.', '0', 'L');
            $pdf->Ln();
            $pdf->MultiCell(19, .5, 'Berdasarkan hasil pemeriksaan spirometri di atas, fungsi paru '.$sql_pasien->nama_pgl.' adalah : ', '0', 'L');
            $pdf->SetFont('Arial', 'B', '10');
            $pdf->Cell(19, .5, $sql_medc_lab->ket, '', 0, 'L', $fill);
            $pdf->Ln(1);
            $pdf->SetFont('Arial', 'B', '10');
            $pdf->Cell(19, .5, 'Anjuran', '', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->SetFont('Arial', '', '9');
            $pdf->MultiCell(19, .5, 'Kontrol ulang spirometri 1 tahun lagi dan bandingkan dengan hasil pemeriksaan saat ini.', '0', 'L');
            $pdf->Ln();
           
            // QR GENERATOR VALIDASI
            $qr_validasi        = FCPATH.'/file/pasien/'.strtolower($kode_pasien).'/qr-validasi-'.strtolower($kode_pasien).'.png';
            $params['data']     = 'Telah diverifikasi dan ditandatangani secara elektronik oleh manajemen '.$setting->judul.'. Pasien a/n. ';
//            $params['data']    .= strtoupper($sql_pasien->nama_pgl).' ('.strtoupper($kode_pasien).')';
//            $params['data']     = 'https://verify.esensia.co.id/?id='.general::enkrip($sql_medc_srt->id).'&id_pasien='.general::enkrip($sql_pasien->id).'&role=surat';
            $params['level']    = 'H';
            $params['size']     = 2;
            $params['savename'] = $qr_validasi;
            $this->ciqrcode->generate($params);
            
//            $gambar4            = base_url('file/qr/validasi-'.$sql_pasien->id.'.png');         
            $gambar4            = $qr_validasi;         
                        
            // QR GENERATOR DOKTER
            $qr_dokter          = FCPATH.'/file/pasien/'.strtolower($kode_pasien).'/qr-dokter-'.strtolower($sql_dokter2->id).'.png';
            $params['data']     = 'Telah diverifikasi dan ditandatangani secara elektronik oleh dokter penanggung jawab ['.(!empty($sql_dokter2->nama_dpn) ? $sql_dokter2->nama_dpn.' ' : '').$sql_dokter2->nama.(!empty($sql_dokter2->nama_blk) ? ', '.$sql_dokter2->nama_blk : '').']';
            $params['level']    = 'H';
            $params['size']     = 2;
            $params['savename'] = $qr_dokter;
            $this->ciqrcode->generate($params);
            
            $gambar5            = $qr_dokter;
//            $gambar5            = base_url('file/qr/dokter-'.strtolower($sql_dokter2->id).'.png');
            
            // Gambar VALIDASI
            $getY = $pdf->GetY() + 1;
            $pdf->Image($gambar4,2,$getY,2,2);
            $pdf->Image($gambar5,12,$getY,2,2);
            
            
            $pdf->SetFont('Arial', '', '10');
            $pdf->Cell(10.5, .5, '', '', 0, 'L', $fill);
            $pdf->Cell(7.5, .5, 'Semarang, '.$this->tanggalan->tgl_indo3($sql_medc_lab->tgl_masuk), '', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->SetFont('Arial', 'B', '10');
            $pdf->Cell(4, .5, 'Validasi', '0', 0, 'C', $fill);
            $pdf->Cell(6.5, .5, '', '0', 0, 'C', $fill);
            $pdf->SetFont('Arial', '', '10');
            $pdf->Cell(7.5, .5, 'Yang melakukan penilaian,', '0', 0, 'L', $fill);
            $pdf->Ln(2.5);
            
            $pdf->SetFont('Arial', '', '10');
            $pdf->Cell(10.5, .5, '', '', 0, 'L', $fill);
            $pdf->Cell(7.5, .5, (!empty($sql_dokter->nama_dpn) ? $sql_dokter->nama_dpn.' ' : '').$sql_dokter->nama.(!empty($sql_dokter->nama_blk) ? ', '.$sql_dokter->nama_blk : ''), '', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->Cell(10.5, .5, '', '', 0, 'L', $fill);
            $pdf->Cell(7.5, .5, $sql_dokter2->nik, '', 0, 'L', $fill);
            $pdf->Ln();
            
            $type = (isset($_GET['type']) ? $_GET['type'] : 'I');

            ob_start();
            $pdf->Output($sql_pasien->nama_pgl. '.pdf', $type);
            ob_end_flush();
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }
    
    public function pdf_medcheck_lab_ekg() {
        if (akses::aksesLogin() == TRUE) {
            $setting            = $this->db->get('tbl_pengaturan')->row();
            $id_medcheck        = $this->input->get('id');
            $id_lab             = $this->input->get('id_lab');
            $status_ctk         = $this->input->get('status_ctk');
            
            $sql_medc           = $this->db->where('id', general::dekrip($id_medcheck))->get('tbl_trans_medcheck')->row();
            $sql_medc_lab       = $this->db->where('id', general::dekrip($id_lab))->get('tbl_trans_medcheck_lab_ekg')->row();
            $sql_medc_lab_ekg   = $this->db->where('id_lab_ekg', general::dekrip($id_lab))->get('tbl_trans_medcheck_lab_ekg_file')->row();
            $sql_poli           = $this->db->where('id', $sql_medc->id_poli)->get('tbl_m_poli')->row(); 
            $sql_pasien         = $this->db->where('id', $sql_medc->id_pasien)->get('tbl_m_pasien')->row(); 
            $sql_pekerjaan      = $this->db->where('id', $sql_pasien->id_pekerjaan)->get('tbl_m_jenis_kerja')->row();
            $sql_dokter         = $this->db->where('id_user', (!empty($sql_medc_lab->id_dokter) ? $sql_medc_lab->id_dokter : $sql_medc->id_dokter))->get('tbl_m_karyawan')->row();
            $kode_pasien        = $sql_pasien->kode_dpn.$sql_pasien->kode;
            $no_rm              = strtolower($sql_pasien->kode_dpn).$sql_pasien->kode;
            $folder             = realpath('./file/pasien/'.$no_rm);
            
            $gambar1            = FCPATH.'/assets/theme/admin-lte-3/dist/img/logo-esensia-2.png'; // base_url('assets/theme/admin-lte-3/dist/img/logo-esensia-2.png');
            $gambar2            = FCPATH.'/assets/theme/admin-lte-3/dist/img/logo-bw-bg2-1440px.png'; // base_url('assets/theme/admin-lte-3/dist/img/logo-bw-bg2-1440px.png');
            $gambar3            = FCPATH.'/assets/theme/admin-lte-3/dist/img/logo-footer.png'; // base_url('assets/theme/admin-lte-3/dist/img/logo-footer.png');
            $file_ekg           = $folder.'/'.$sql_medc_lab_ekg->file_name;
            $sess_print         = $this->session->userdata('lab_print');
            
            $judul              = "HASIL PEMBACAAN EKG";

            $this->load->library('MedLabPDF');
            $pdf = new MedLabPDF('P', 'cm', array(21.5,33));
            $pdf->SetAutoPageBreak('auto', 7);
            $pdf->SetMargins(1,0.35,1);
            $pdf->header = 0;
            $pdf->addPage('','',false);
            
            // Gambar Watermark Tengah
            $pdf->Image($gambar2,5,4,15,19);
            
            if(!empty($sql_medc_lab_ekg->file_name)){
//                $pdf->Image(general::rotateImage($file_ekg),1,null,2,0);
                $pdf->Image($file_ekg,1,4.25,18.5,9.75);
            }
            
            # Blok Judul & ID Pasien
            $pdf->SetFont('Arial', 'B', '13');
            $pdf->Cell(7, .5, '', 'LTR', 0, 'L', $fill);
            $pdf->SetFont('Arial', '', '9');
            $pdf->Cell(2, .5, 'Nama', 'T', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', 'T', 0, 'C', $fill);
            $pdf->Cell(9.5, .5, general::bersih($sql_pasien->nama_pgl).' ('.$sql_pasien->jns_klm.')', 'TR', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->SetFont('Arial', 'B', '13');
            $pdf->Cell(7, .5, $judul, 'LR', 0, 'C', $fill);
            $pdf->SetFont('Arial', '', '9');
            $pdf->Cell(2, .5, 'No. RM', '', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '', 0, 'C', $fill);
//            $pdf->Cell(9.5, .5, $file_ekg, 'R', 0, 'L', $fill);
            $pdf->Cell(9.5, .5, $sql_pasien->kode_dpn.$sql_pasien->kode, 'R', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->SetFont('Arial', 'B', '13');
            $pdf->Cell(7, .5, '', 'LBR', 0, 'C', $fill);
            $pdf->SetFont('Arial', '', '9');
            $pdf->Cell(2, .5, 'Tanggal Lahir', 'LB', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', 'B', 0, 'C', $fill);
            $pdf->Cell(9.5, .5, $this->tanggalan->tgl_indo2($sql_pasien->tgl_lahir).' / '.$this->tanggalan->usia_lkp($sql_pasien->tgl_lahir), 'BR', 0, 'L', $fill);
            $pdf->Ln();
            
            # Blok Lampiran hasil EKG
            $pdf->SetFont('Times', '', '10');
            $pdf->Cell(19, .5, '', 'LR', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->SetFont('Times', 'B', '13');
            $pdf->Cell(19, .5, '', 'LR', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->SetFont('Times', '', '10');
            $pdf->Cell(19, .5, '', 'LR', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->Cell(19, .5, '', 'LR', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->Cell(19, .5, '', 'LR', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->Cell(19, .5, '', 'LR', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->Cell(19, .5, '', 'LR', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->Cell(19, .5, '', 'LR', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->Cell(19, .5, '', 'LR', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->Cell(19, .5, '', 'LR', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->Cell(19, .5, '', 'LR', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->Cell(19, .5, '', 'LR', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->Cell(19, .5, '', 'LR', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->Cell(19, .5, '', 'LR', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->Cell(19, .5, '', 'LR', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->Cell(19, .5, '', 'LR', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->Cell(19, .5, '', 'LR', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->Cell(19, .5, '', 'LR', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->Cell(19, .5, '', 'LR', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->Cell(19, .5, '', 'LR', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->Cell(19, .5, '', 'LR', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->Cell(19, .5, '', 'LR', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->Cell(19, .5, '', 'LR', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->Cell(19, .5, '', 'LR', 0, 'L', $fill);
            $pdf->Ln();
            
           
            // QR GENERATOR VALIDASI
            $qr_validasi        = FCPATH.'/file/pasien/'.strtolower($kode_pasien).'/qr-validasi-'.strtolower($kode_pasien).'.png';
            $params['data']     = 'Telah diverifikasi dan ditandatangani secara elektronik oleh petugas '.$this->ion_auth->user($sql_medc_lab->id_user)->row()->first_name;
            $params['level']    = 'H';
            $params['size']     = 2;
            $params['savename'] = $qr_validasi;
            $this->ciqrcode->generate($params);  
            
            $gambar6            = $qr_validasi;  
            
            // Gambar VALIDASI
            $getY = $pdf->GetY() + 1;
            $pdf->Image($gambar6,14,14,2,2);
            
            $pdf->Cell(9.5, .5, '', 'L', 0, 'L', $fill);
            $pdf->Cell(9.5, .5, '('.$this->ion_auth->user($sql_medc_lab->id_user)->row()->first_name.')', 'R', 0, 'C', $fill);
            $pdf->Ln();
            $pdf->SetFont('Times', 'B', '10');
            $pdf->Cell(19, .5, 'Hasil Pembacaan :', '1', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->SetFont('Times', '', '10');
            $pdf->Cell(2, .5, 'Irama', 'L', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '', 0, 'C', $fill);
            $pdf->Cell(7, .5, $sql_medc_lab->hsl_irama, '', 0, 'L', $fill);
            $pdf->Cell(2.5, .5, 'Interval P - R', '', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '', 0, 'C', $fill);
            $pdf->Cell(6.5, .5, $sql_medc_lab->hsl_int, 'R', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->Cell(2, .5, 'Frekwensi', 'L', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '', 0, 'C', $fill);
            $pdf->Cell(7, .5, $sql_medc_lab->hsl_frek, '', 0, 'L', $fill);
            $pdf->Cell(2.5, .5, 'Kompleks Q R S', '', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '', 0, 'C', $fill);
            $pdf->Cell(6.5, .5, $sql_medc_lab->hsl_qrs, 'R', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->Cell(2, .5, 'Axis', 'L', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '', 0, 'C', $fill);
            $pdf->Cell(7, .5, $sql_medc_lab->hsl_axis, '', 0, 'L', $fill);
            $pdf->Cell(2.5, .5, 'Segmen ST', '', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '', 0, 'C', $fill);
            $pdf->Cell(6.5, .5, $sql_medc_lab->hsl_st, 'R', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->Cell(2, .5, 'Posisi', 'L', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '', 0, 'C', $fill);
            $pdf->Cell(7, .5, $sql_medc_lab->hsl_pos, '', 0, 'L', $fill);
            $pdf->Cell(2.5, .5, 'Gelombang T', '', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '', 0, 'C', $fill);
            $pdf->Cell(6.5, .5, $sql_medc_lab->hsl_gelt, 'R', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->Cell(2, .5, 'Zona Transisi', 'L', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '', 0, 'C', $fill);
            $pdf->Cell(7, .5, $sql_medc_lab->hsl_zona, '', 0, 'L', $fill);
            $pdf->Cell(2.5, .5, 'Gelombang U', '', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '', 0, 'C', $fill);
            $pdf->Cell(6.5, .5, $sql_medc_lab->hsl_gelu, 'R', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->Cell(2, .5, 'Gelombang P', 'L', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '', 0, 'C', $fill);
            $pdf->Cell(7, .5, $sql_medc_lab->hsl_gelp, '', 0, 'L', $fill);
            $pdf->Cell(2.5, .5, 'Lain-lain', '', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '', 0, 'C', $fill);
            $pdf->Cell(6.5, .5, $sql_medc_lab->hsl_lain, 'R', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->MultiCell(19, .5, 'Kesimpulan : '.$sql_medc_lab->kesimpulan, '1', 'L');
            
            
            $pdf->Cell(19, .5, '', 'T', 0, 'C', $fill);
            $pdf->Ln();
           
            // QR GENERATOR VALIDASI
            $qr_validasi        = FCPATH.'/file/pasien/'.strtolower($kode_pasien).'/qr-validasi-'.strtolower($kode_pasien).'.png';
            $params['data']     = 'Telah diverifikasi dan ditandatangani secara elektronik oleh manajemen '.$setting->judul.'. Pasien a/n. ';
            $params['data']    .= strtoupper($sql_pasien->nama_pgl).' ('.strtoupper($kode_pasien).')';
            $params['level']    = 'H';
            $params['size']     = 2;
            $params['savename'] = $qr_validasi;
            $this->ciqrcode->generate($params);
                     
            $gambar4            = $qr_validasi;         
                        
            // QR GENERATOR DOKTER
            $qr_dokter          = FCPATH.'/file/pasien/'.strtolower($kode_pasien).'/qr-dokter-'.strtolower($sql_dokter2->id).'.png';
            $params['data']     = 'Telah diverifikasi dan ditandatangani secara elektronik oleh dokter penanggung jawab ['.(!empty($sql_dokter2->nama_dpn) ? $sql_dokter2->nama_dpn.' ' : '').$sql_dokter2->nama.(!empty($sql_dokter2->nama_blk) ? ', '.$sql_dokter2->nama_blk : '').']';
            $params['level']    = 'H';
            $params['size']     = 2;
            $params['savename'] = $qr_dokter;
            $this->ciqrcode->generate($params);
            
            $gambar5            = $qr_dokter;
//            $gambar5            = base_url('file/qr/dokter-'.strtolower($sql_dokter2->id).'.png');
            
            // Gambar VALIDASI
            $getY = $pdf->GetY() + 1;
            $pdf->Image($gambar4,2,$getY,2,2);
            $pdf->Image($gambar5,12,$getY,2,2);
            
            
            $pdf->SetFont('Arial', '', '10');
            $pdf->Cell(10.5, .5, '', '', 0, 'L', $fill);
            $pdf->Cell(7.5, .5, 'Semarang, '.$this->tanggalan->tgl_indo3($sql_medc_lab->tgl_masuk), '', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->SetFont('Arial', 'B', '10');
            $pdf->Cell(4, .5, 'Validasi', '0', 0, 'C', $fill);
            $pdf->Cell(6.5, .5, '', '0', 0, 'C', $fill);
            $pdf->SetFont('Arial', '', '10');
            $pdf->Cell(7.5, .5, 'Dokter Yang Memeriksa,', '0', 0, 'L', $fill);
            $pdf->Ln(2.5);
            
            $pdf->SetFont('Arial', '', '10');
            $pdf->Cell(10.5, .5, '', '', 0, 'L', $fill);
            $pdf->Cell(7.5, .5, (!empty($sql_dokter->nama_dpn) ? $sql_dokter->nama_dpn.' ' : '').$sql_dokter->nama.(!empty($sql_dokter->nama_blk) ? ', '.$sql_dokter->nama_blk : ''), '', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->Cell(10.5, .5, '', '', 0, 'L', $fill);
            $pdf->Cell(7.5, .5, $sql_dokter2->nik, '', 0, 'L', $fill);
            $pdf->Ln();
            
            $type = (isset($_GET['type']) ? $_GET['type'] : 'I');

            ob_start();
            $pdf->Output($sql_pasien->nama_pgl. '.pdf', $type);
            ob_end_flush();
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }
    
    public function pdf_medcheck_pen_hrv() {
        if (akses::aksesLogin() == TRUE) {
            $setting            = $this->db->get('tbl_pengaturan')->row();
            $id_medcheck        = $this->input->get('id');
            $id_pen             = $this->input->get('id_pen');
            $status_ctk         = $this->input->get('status_ctk');
            
            $sql_medc           = $this->db->where('id', general::dekrip($id_medcheck))->get('tbl_trans_medcheck')->row();
            $sql_medc_pen       = $this->db->where('id', general::dekrip($id_pen))->get('tbl_trans_medcheck_pen_hrv')->row();
            $sql_poli           = $this->db->where('id', $sql_medc->id_poli)->get('tbl_m_poli')->row(); 
            $sql_pasien         = $this->db->where('id', $sql_medc->id_pasien)->get('tbl_m_pasien')->row(); 
            $sql_pekerjaan      = $this->db->where('id', $sql_pasien->id_pekerjaan)->get('tbl_m_jenis_kerja')->row();
            $sql_dokter         = $this->db->where('id_user', (!empty($sql_medc_pen->id_dokter) ? $sql_medc_pen->id_dokter : $sql_medc->id_dokter))->get('tbl_m_karyawan')->row();
            $kode_pasien        = $sql_pasien->kode_dpn.$sql_pasien->kode;
            $gambar1            = FCPATH.'/assets/theme/admin-lte-3/dist/img/logo-esensia-2.png'; // base_url('assets/theme/admin-lte-3/dist/img/logo-esensia-2.png');
            $gambar2            = FCPATH.'/assets/theme/admin-lte-3/dist/img/logo-bw-bg2-1440px.png'; // base_url('assets/theme/admin-lte-3/dist/img/logo-bw-bg2-1440px.png');
            $gambar3            = FCPATH.'/assets/theme/admin-lte-3/dist/img/logo-footer.png'; // base_url('assets/theme/admin-lte-3/dist/img/logo-footer.png');
            $sess_print         = $this->session->userdata('lab_print');
            
            $judul              = "Hasil Pembacaan Heart Rate Variability (HRV)";

            $this->load->library('MedLabPDF');
            $pdf = new MedLabPDF('P', 'cm', array(21.5,33));
            $pdf->SetAutoPageBreak('auto', 7);
            $pdf->SetMargins(1,0.35,1);
            $pdf->header = 0;
            $pdf->addPage('','',false);
            
            // Gambar Watermark Tengah
            $pdf->Image($gambar2,5,4,15,19);     
            
            # Blok Judul
            $pdf->SetFont('Arial', 'B', '13');
            $pdf->Cell(19, .5, $judul, 0, 1, 'C');
            $pdf->Ln();
            
            # Blok ID PASIEN
            $pdf->SetFont('Arial', '', '9');
            $pdf->Cell(2.5, .5, 'No. RM', '0', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
            $pdf->Cell(8, .5, $sql_pasien->kode_dpn.$sql_pasien->kode, '0', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->Cell(2.5, .5, 'Nama Name', '0', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
            $pdf->Cell(8, .5, general::bersih($sql_pasien->nama_pgl).' ('.$sql_pasien->jns_klm.')', '0', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->Cell(2.5, .5, 'NIK', '0', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
            $pdf->Cell(8, .5, $sql_pasien->nik, '0', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->Cell(2.5, .5, 'Tgl Lahir', '0', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
            $pdf->Cell(8, .5, $this->tanggalan->tgl_indo2($sql_pasien->tgl_lahir).' / '.$this->tanggalan->usia_lkp($sql_pasien->tgl_lahir), '0', 0, 'L', $fill);
            $pdf->Ln(1);
            
            # Blok Lampiran hasil EKG
            $pdf->SetFont('Times', 'B', '12');
            $pdf->Cell(9, .5, 'Mean Heart Rate (bpm)', '', 0, 'L', $fill);
            $pdf->Cell(1, .5, '', '', 0, '', $fill);
            $pdf->Cell(9, .5, 'Ectopic Beat', '', 0, '', $fill);
            $pdf->Ln();
            $pdf->SetFont('Times', '', '13');
            $pdf->Cell(9, .75, $sql_medc_pen->hsl_mhr, '1', 0, 'L', $fill);
            $pdf->Cell(1, .75, '', '', 0, '', $fill);
            $pdf->Cell(9, .75, $sql_medc_pen->hsl_eb, '1', 0, '', $fill);
            $pdf->Ln(1);
            $pdf->SetFont('Times', 'B', '12');
            $pdf->Cell(9, .5, 'SDNN (ms)', '', 0, 'L', $fill);
            $pdf->Cell(1, .5, '', '', 0, '', $fill);
            $pdf->Cell(9, .5, 'Autonomic Nervous System', '', 0, '', $fill);
            $pdf->Ln();
            $pdf->SetFont('Times', '', '13');
            $pdf->Cell(9, .75, $sql_medc_pen->hsl_sdnn, '1', 0, 'L', $fill);
            $pdf->Cell(1, .75, '', '', 0, '', $fill);
            $pdf->Cell(9, .75, $sql_medc_pen->hsl_ans, '1', 0, '', $fill);
            $pdf->Ln(1);
            $pdf->SetFont('Times', 'B', '12');
            $pdf->Cell(9, .5, 'RMSSD (ms)', '', 0, 'L', $fill);
            $pdf->Cell(1, .5, '', '', 0, '', $fill);
            $pdf->Cell(9, .5, 'Pressure Index', '', 0, '', $fill);
            $pdf->Ln();
            $pdf->SetFont('Times', '', '13');
            $pdf->Cell(9, .75, $sql_medc_pen->hsl_rmssd, '1', 0, 'L', $fill);
            $pdf->Cell(1, .75, '', '', 0, '', $fill);
            $pdf->Cell(9, .75, $sql_medc_pen->hsl_pi, '1', 0, '', $fill);
            $pdf->Ln(1);
            $pdf->SetFont('Times', 'B', '12');
            $pdf->Cell(9, .5, 'PSI', '', 0, 'L', $fill);
            $pdf->Cell(1, .5, '', '', 0, '', $fill);
            $pdf->Cell(9, .5, 'Emotional State', '', 0, '', $fill);
            $pdf->Ln();
            $pdf->SetFont('Times', '', '13');
            $pdf->Cell(9, .75, $sql_medc_pen->hsl_psi, '1', 0, 'L', $fill);
            $pdf->Cell(1, .75, '', '', 0, '', $fill);
            $pdf->Cell(9, .75, $sql_medc_pen->hsl_es, '1', 0, '', $fill);
            $pdf->Ln(1);
            $pdf->SetFont('Times', 'B', '12');
            $pdf->Cell(9, .5, 'LH/HF', '', 0, 'L', $fill);
            $pdf->Cell(1, .5, '', '', 0, '', $fill);
            $pdf->Cell(9, .5, 'RRV', '', 0, '', $fill);
            $pdf->Ln();
            $pdf->SetFont('Times', '', '13');
            $pdf->Cell(9, .75, $sql_medc_pen->hsl_lhhf, '1', 0, 'L', $fill);
            $pdf->Cell(1, .75, '', '', 0, '', $fill);
            $pdf->Cell(9, .75, $sql_medc_pen->hsl_rrv, '1', 0, '', $fill);
            $pdf->Ln(1);
            $pdf->SetFont('Times', 'B', '12');
            $pdf->Cell(9, .5, 'Comment', '', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->MultiCell(19, .5, $sql_medc_pen->keterangan, '1', 'L');
            $pdf->Ln();
            $pdf->Ln();
            
           
//            // QR GENERATOR VALIDASI
//            $qr_validasi        = FCPATH.'/file/pasien/'.strtolower($kode_pasien).'/qr-validasi-'.strtolower($kode_pasien).'.png';
//            $params['data']     = 'Telah diverifikasi dan ditandatangani secara elektronik oleh petugas '.$this->ion_auth->user($sql_medc_pen->id_user)->row()->first_name;
//            $params['level']    = 'H';
//            $params['size']     = 2;
//            $params['savename'] = $qr_validasi;
//            $this->ciqrcode->generate($params);  
//            
//            $gambar6            = $qr_validasi;  
//            
//            // Gambar VALIDASI
//            $getY = $pdf->GetY() + 1;
//            $pdf->Image($gambar6,14,10.5,2,2);
//            
//            $pdf->Cell(9.5, .5, '', 'L', 0, 'L', $fill);
//            $pdf->Cell(9.5, .5, '('.$this->ion_auth->user($sql_medc_pen->id_user)->row()->first_name.')', 'R', 0, 'C', $fill);
//            $pdf->Ln();
//            $pdf->SetFont('Times', 'B', '10');
//            $pdf->Cell(19, .5, 'Hasil Pembacaan :', '1', 0, 'L', $fill);
//            $pdf->Ln();
//            $pdf->SetFont('Times', '', '10');
//            $pdf->Cell(9.5, .5, 'Mean Heart Rate (bpm)', 'L', 0, 'L', $fill);
//            $pdf->Cell(.5, .5, ':', '', 0, 'C', $fill);
//            $pdf->Cell(5, .5, $sql_medc_pen->hsl_mhr, '', 0, 'L', $fill);
//            $pdf->Cell(2.5, .5, 'SDNN (ms)', '', 0, 'L', $fill);
//            $pdf->Cell(.5, .5, ':', '', 0, 'C', $fill);
//            $pdf->Cell(6.5, .5, $sql_medc_pen->hsl_sdnn, 'R', 0, 'L', $fill);
//            $pdf->Ln();
//            $pdf->Cell(4, .5, 'RMSSD (ms)', 'L', 0, 'L', $fill);
//            $pdf->Cell(.5, .5, ':', '', 0, 'C', $fill);
//            $pdf->Cell(5, .5, $sql_medc_pen->hsl_rmssd, '', 0, 'L', $fill);
//            $pdf->Cell(2.5, .5, 'PSI', '', 0, 'L', $fill);
//            $pdf->Cell(.5, .5, ':', '', 0, 'C', $fill);
//            $pdf->Cell(6.5, .5, $sql_medc_pen->hsl_psi, 'R', 0, 'L', $fill);
//            $pdf->Ln();
//            $pdf->Cell(4, .5, 'LH / HF', 'L', 0, 'L', $fill);
//            $pdf->Cell(.5, .5, ':', '', 0, 'C', $fill);
//            $pdf->Cell(5, .5, $sql_medc_pen->hsl_lhhf, '', 0, 'L', $fill);
//            $pdf->Cell(2.5, .5, 'Ectopic Beat', '', 0, 'L', $fill);
//            $pdf->Cell(.5, .5, ':', '', 0, 'C', $fill);
//            $pdf->Cell(6.5, .5, $sql_medc_pen->hsl_eb, 'R', 0, 'L', $fill);
//            $pdf->Ln();
//            $pdf->Cell(4, .5, 'Autonomic Nervous System', 'L', 0, 'L', $fill);
//            $pdf->Cell(.5, .5, ':', '', 0, 'C', $fill);
//            $pdf->Cell(5, .5, $sql_medc_pen->hsl_ans, '', 0, 'L', $fill);
//            $pdf->Cell(2.5, .5, 'Pressure Index', '', 0, 'L', $fill);
//            $pdf->Cell(.5, .5, ':', '', 0, 'C', $fill);
//            $pdf->Cell(6.5, .5, $sql_medc_pen->hsl_pi, 'R', 0, 'L', $fill);
//            $pdf->Ln();
//            $pdf->Cell(4, .5, 'Emotional State', 'L', 0, 'L', $fill);
//            $pdf->Cell(.5, .5, ':', '', 0, 'C', $fill);
//            $pdf->Cell(5, .5, $sql_medc_pen->hsl_es, '', 0, 'L', $fill);
//            $pdf->Cell(2.5, .5, 'RRV', '', 0, 'L', $fill);
//            $pdf->Cell(.5, .5, ':', '', 0, 'C', $fill);
//            $pdf->Cell(6.5, .5, $sql_medc_pen->hsl_rrv, 'R', 0, 'L', $fill);
//            $pdf->Ln();
//            $pdf->Cell(19, .5, '', 'LR', 0, 'L', $fill);
//            $pdf->Ln();
//            $pdf->MultiCell(19, .5, 'Komentar : '.$sql_medc_pen->keterangan, '1', 'L');
//            
//            
//            $pdf->Cell(19, .5, '', 'T', 0, 'C', $fill);
//            $pdf->Ln();
           
            // QR GENERATOR VALIDASI
            $qr_validasi        = FCPATH.'/file/pasien/'.strtolower($kode_pasien).'/qr-validasi-'.strtolower($kode_pasien).'.png';
            $params['data']     = 'Telah diverifikasi dan ditandatangani secara elektronik oleh manajemen '.$setting->judul.'. Pasien a/n. ';
            $params['data']    .= strtoupper($sql_pasien->nama_pgl).' ('.strtoupper($kode_pasien).')';
            $params['level']    = 'H';
            $params['size']     = 2;
            $params['savename'] = $qr_validasi;
            $this->ciqrcode->generate($params);
                     
            $gambar4            = $qr_validasi;         
                        
            // QR GENERATOR DOKTER
            $qr_dokter          = FCPATH.'/file/pasien/'.strtolower($kode_pasien).'/qr-dokter-'.strtolower($sql_dokter2->id).'.png';
            $params['data']     = 'Telah diverifikasi dan ditandatangani secara elektronik oleh dokter penanggung jawab ['.(!empty($sql_dokter2->nama_dpn) ? $sql_dokter2->nama_dpn.' ' : '').$sql_dokter2->nama.(!empty($sql_dokter2->nama_blk) ? ', '.$sql_dokter2->nama_blk : '').']';
            $params['level']    = 'H';
            $params['size']     = 2;
            $params['savename'] = $qr_dokter;
            $this->ciqrcode->generate($params);
            
            $gambar5            = $qr_dokter;
//            $gambar5            = base_url('file/qr/dokter-'.strtolower($sql_dokter2->id).'.png');
            
            // Gambar VALIDASI
            $getY = $pdf->GetY() + 1;
            $pdf->Image($gambar4,2,$getY,2,2);
            $pdf->Image($gambar5,12,$getY,2,2);
            
            
            $pdf->SetFont('Arial', '', '10');
            $pdf->Cell(10.5, .5, '', '', 0, 'L', $fill);
            $pdf->Cell(7.5, .5, 'Semarang, '.$this->tanggalan->tgl_indo3($sql_medc_pen->tgl_masuk), '', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->SetFont('Arial', 'B', '10');
            $pdf->Cell(4, .5, 'Validasi', '0', 0, 'C', $fill);
            $pdf->Cell(6.5, .5, '', '0', 0, 'C', $fill);
            $pdf->SetFont('Arial', '', '10');
            $pdf->Cell(7.5, .5, 'Dokter Yang Memeriksa,', '0', 0, 'L', $fill);
            $pdf->Ln(2.5);
            
            $pdf->SetFont('Arial', '', '10');
            $pdf->Cell(10.5, .5, '', '', 0, 'L', $fill);
            $pdf->Cell(7.5, .5, (!empty($sql_dokter->nama_dpn) ? $sql_dokter->nama_dpn.' ' : '').$sql_dokter->nama.(!empty($sql_dokter->nama_blk) ? ', '.$sql_dokter->nama_blk : ''), '', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->Cell(10.5, .5, '', '', 0, 'L', $fill);
            $pdf->Cell(7.5, .5, $sql_dokter2->nik, '', 0, 'L', $fill);
            $pdf->Ln();
            
            $type = (isset($_GET['type']) ? $_GET['type'] : 'I');

            ob_start();
            $pdf->Output($sql_pasien->nama_pgl. '.pdf', $type);
            ob_end_flush();
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }
    
//    public function pdf_medcheck_pen_hrv2() {
//        if (akses::aksesLogin() == TRUE) {
//            $setting            = $this->db->get('tbl_pengaturan')->row();
//            $id_medcheck        = $this->input->get('id');
//            $id_pen             = $this->input->get('id_pen');
//            $status_ctk         = $this->input->get('status_ctk');
//            
//            $sql_medc           = $this->db->where('id', general::dekrip($id_medcheck))->get('tbl_trans_medcheck')->row();
//            $sql_medc_pen       = $this->db->where('id', general::dekrip($id_pen))->get('tbl_trans_medcheck_pen_hrv')->row();
//            $sql_poli           = $this->db->where('id', $sql_medc->id_poli)->get('tbl_m_poli')->row(); 
//            $sql_pasien         = $this->db->where('id', $sql_medc->id_pasien)->get('tbl_m_pasien')->row(); 
//            $sql_pekerjaan      = $this->db->where('id', $sql_pasien->id_pekerjaan)->get('tbl_m_jenis_kerja')->row();
//            $sql_dokter         = $this->db->where('id_user', (!empty($sql_medc_pen->id_dokter) ? $sql_medc_pen->id_dokter : $sql_medc->id_dokter))->get('tbl_m_karyawan')->row();
//            $kode_pasien        = $sql_pasien->kode_dpn.$sql_pasien->kode;
//            $gambar1            = FCPATH.'/assets/theme/admin-lte-3/dist/img/logo-esensia-2.png'; // base_url('assets/theme/admin-lte-3/dist/img/logo-esensia-2.png');
//            $gambar2            = FCPATH.'/assets/theme/admin-lte-3/dist/img/logo-bw-bg2-1440px.png'; // base_url('assets/theme/admin-lte-3/dist/img/logo-bw-bg2-1440px.png');
//            $gambar3            = FCPATH.'/assets/theme/admin-lte-3/dist/img/logo-footer.png'; // base_url('assets/theme/admin-lte-3/dist/img/logo-footer.png');
//            $sess_print         = $this->session->userdata('lab_print');
//            
//            $judul              = "HASIL PEMBACAAN HRV";
//
//            $this->load->library('MedLabPDF');
//            $pdf = new MedLabPDF('P', 'cm', array(21.5,33));
//            $pdf->SetAutoPageBreak('auto', 7);
//            $pdf->SetMargins(1,0.35,1);
//            $pdf->header = 0;
//            $pdf->addPage('','',false);
//            
//            // Gambar Watermark Tengah
//            $pdf->Image($gambar2,5,4,15,19);     
//            
//            # Blok Judul & ID Pasien
//            $pdf->SetFont('Arial', 'B', '13');
//            $pdf->Cell(7, .5, '', 'LTR', 0, 'L', $fill);
//            $pdf->SetFont('Arial', '', '9');
//            $pdf->Cell(2, .5, 'Nama', 'T', 0, 'L', $fill);
//            $pdf->Cell(.5, .5, ':', 'T', 0, 'C', $fill);
//            $pdf->Cell(9.5, .5, $sql_pasien->nama_pgl.' ('.$sql_pasien->jns_klm.')', 'TR', 0, 'L', $fill);
//            $pdf->Ln();
//            $pdf->SetFont('Arial', 'B', '13');
//            $pdf->Cell(7, .5, $judul, 'LR', 0, 'C', $fill);
//            $pdf->SetFont('Arial', '', '9');
//            $pdf->Cell(2, .5, 'No. RM', '', 0, 'L', $fill);
//            $pdf->Cell(.5, .5, ':', '', 0, 'C', $fill);
//            $pdf->Cell(9.5, .5, $sql_pasien->kode_dpn.$sql_pasien->kode, 'R', 0, 'L', $fill);
//            $pdf->Ln();
//            $pdf->SetFont('Arial', 'B', '13');
//            $pdf->Cell(7, .5, '', 'LBR', 0, 'C', $fill);
//            $pdf->SetFont('Arial', '', '9');
//            $pdf->Cell(2, .5, 'Tanggal Lahir', 'LB', 0, 'L', $fill);
//            $pdf->Cell(.5, .5, ':', 'B', 0, 'C', $fill);
//            $pdf->Cell(9.5, .5, $this->tanggalan->tgl_indo2($sql_pasien->tgl_lahir).' / '.$this->tanggalan->usia_lkp($sql_pasien->tgl_lahir), 'BR', 0, 'L', $fill);
//            $pdf->Ln();
//            
//            # Blok Lampiran hasil EKG
//            $pdf->SetFont('Times', '', '10');
//            $pdf->Cell(19, .5, 'Tempelkan mulai dari sini :', 'LR', 0, 'L', $fill);
//            $pdf->Ln();
//            $pdf->SetFont('Times', 'B', '13');
//            $pdf->Cell(19, .5, 'Terlampir', 'LR', 0, 'L', $fill);
//            $pdf->Ln();
//            $pdf->SetFont('Times', '', '10');
//            $pdf->Cell(19, .5, '', 'LR', 0, 'L', $fill);
//            $pdf->Ln();
//            $pdf->Cell(19, .5, '', 'LR', 0, 'L', $fill);
//            $pdf->Ln();
//            $pdf->Cell(19, .5, '', 'LR', 0, 'L', $fill);
//            $pdf->Ln();
//            $pdf->Cell(19, .5, '', 'LR', 0, 'L', $fill);
//            $pdf->Ln();
//            $pdf->Cell(19, .5, '', 'LR', 0, 'L', $fill);
//            $pdf->Ln();
//            $pdf->Cell(19, .5, '', 'LR', 0, 'L', $fill);
//            $pdf->Ln();
//            $pdf->Cell(19, .5, '', 'LR', 0, 'L', $fill);
//            $pdf->Ln();
//            $pdf->Cell(19, .5, '', 'LR', 0, 'L', $fill);
//            $pdf->Ln();
//            $pdf->Cell(19, .5, '', 'LR', 0, 'L', $fill);
//            $pdf->Ln();
//            $pdf->Cell(19, .5, '', 'LR', 0, 'L', $fill);
//            $pdf->Ln();
//            $pdf->Cell(19, .5, '', 'LR', 0, 'L', $fill);
//            $pdf->Ln();
//            $pdf->Cell(19, .5, '', 'LR', 0, 'L', $fill);
//            $pdf->Ln();
//            $pdf->Cell(19, .5, '', 'LR', 0, 'L', $fill);
//            $pdf->Ln();
//            $pdf->Cell(19, .5, '', 'LR', 0, 'L', $fill);
//            $pdf->Ln();
//            $pdf->Cell(19, .5, '', 'LR', 0, 'L', $fill);
//            $pdf->Ln();
//            
//           
//            // QR GENERATOR VALIDASI
//            $qr_validasi        = FCPATH.'/file/pasien/'.strtolower($kode_pasien).'/qr-validasi-'.strtolower($kode_pasien).'.png';
//            $params['data']     = 'Telah diverifikasi dan ditandatangani secara elektronik oleh petugas '.$this->ion_auth->user($sql_medc_pen->id_user)->row()->first_name;
//            $params['level']    = 'H';
//            $params['size']     = 2;
//            $params['savename'] = $qr_validasi;
//            $this->ciqrcode->generate($params);  
//            
//            $gambar6            = $qr_validasi;  
//            
//            // Gambar VALIDASI
//            $getY = $pdf->GetY() + 1;
//            $pdf->Image($gambar6,14,10.5,2,2);
//            
//            $pdf->Cell(9.5, .5, '', 'L', 0, 'L', $fill);
//            $pdf->Cell(9.5, .5, '('.$this->ion_auth->user($sql_medc_pen->id_user)->row()->first_name.')', 'R', 0, 'C', $fill);
//            $pdf->Ln();
//            $pdf->SetFont('Times', 'B', '10');
//            $pdf->Cell(19, .5, 'Hasil Pembacaan :', '1', 0, 'L', $fill);
//            $pdf->Ln();
//            $pdf->SetFont('Times', '', '10');
//            $pdf->Cell(4, .5, 'Mean Heart Rate (bpm)', 'L', 0, 'L', $fill);
//            $pdf->Cell(.5, .5, ':', '', 0, 'C', $fill);
//            $pdf->Cell(5, .5, $sql_medc_pen->hsl_mhr, '', 0, 'L', $fill);
//            $pdf->Cell(2.5, .5, 'SDNN (ms)', '', 0, 'L', $fill);
//            $pdf->Cell(.5, .5, ':', '', 0, 'C', $fill);
//            $pdf->Cell(6.5, .5, $sql_medc_pen->hsl_sdnn, 'R', 0, 'L', $fill);
//            $pdf->Ln();
//            $pdf->Cell(4, .5, 'RMSSD (ms)', 'L', 0, 'L', $fill);
//            $pdf->Cell(.5, .5, ':', '', 0, 'C', $fill);
//            $pdf->Cell(5, .5, $sql_medc_pen->hsl_rmssd, '', 0, 'L', $fill);
//            $pdf->Cell(2.5, .5, 'PSI', '', 0, 'L', $fill);
//            $pdf->Cell(.5, .5, ':', '', 0, 'C', $fill);
//            $pdf->Cell(6.5, .5, $sql_medc_pen->hsl_psi, 'R', 0, 'L', $fill);
//            $pdf->Ln();
//            $pdf->Cell(4, .5, 'LH / HF', 'L', 0, 'L', $fill);
//            $pdf->Cell(.5, .5, ':', '', 0, 'C', $fill);
//            $pdf->Cell(5, .5, $sql_medc_pen->hsl_lhhf, '', 0, 'L', $fill);
//            $pdf->Cell(2.5, .5, 'Ectopic Beat', '', 0, 'L', $fill);
//            $pdf->Cell(.5, .5, ':', '', 0, 'C', $fill);
//            $pdf->Cell(6.5, .5, $sql_medc_pen->hsl_eb, 'R', 0, 'L', $fill);
//            $pdf->Ln();
//            $pdf->Cell(4, .5, 'Autonomic Nervous System', 'L', 0, 'L', $fill);
//            $pdf->Cell(.5, .5, ':', '', 0, 'C', $fill);
//            $pdf->Cell(5, .5, $sql_medc_pen->hsl_ans, '', 0, 'L', $fill);
//            $pdf->Cell(2.5, .5, 'Pressure Index', '', 0, 'L', $fill);
//            $pdf->Cell(.5, .5, ':', '', 0, 'C', $fill);
//            $pdf->Cell(6.5, .5, $sql_medc_pen->hsl_pi, 'R', 0, 'L', $fill);
//            $pdf->Ln();
//            $pdf->Cell(4, .5, 'Emotional State', 'L', 0, 'L', $fill);
//            $pdf->Cell(.5, .5, ':', '', 0, 'C', $fill);
//            $pdf->Cell(5, .5, $sql_medc_pen->hsl_es, '', 0, 'L', $fill);
//            $pdf->Cell(2.5, .5, 'RRV', '', 0, 'L', $fill);
//            $pdf->Cell(.5, .5, ':', '', 0, 'C', $fill);
//            $pdf->Cell(6.5, .5, $sql_medc_pen->hsl_rrv, 'R', 0, 'L', $fill);
//            $pdf->Ln();
//            $pdf->Cell(19, .5, '', 'LR', 0, 'L', $fill);
//            $pdf->Ln();
//            $pdf->MultiCell(19, .5, 'Komentar : '.$sql_medc_pen->keterangan, '1', 'L');
//            
//            
//            $pdf->Cell(19, .5, '', 'T', 0, 'C', $fill);
//            $pdf->Ln();
//           
//            // QR GENERATOR VALIDASI
//            $qr_validasi        = FCPATH.'/file/pasien/'.strtolower($kode_pasien).'/qr-validasi-'.strtolower($kode_pasien).'.png';
//            $params['data']     = 'Telah diverifikasi dan ditandatangani secara elektronik oleh manajemen '.$setting->judul.'. Pasien a/n. ';
//            $params['data']    .= strtoupper($sql_pasien->nama_pgl).' ('.strtoupper($kode_pasien).')';
//            $params['level']    = 'H';
//            $params['size']     = 2;
//            $params['savename'] = $qr_validasi;
//            $this->ciqrcode->generate($params);
//                     
//            $gambar4            = $qr_validasi;         
//                        
//            // QR GENERATOR DOKTER
//            $qr_dokter          = FCPATH.'/file/pasien/'.strtolower($kode_pasien).'/qr-dokter-'.strtolower($sql_dokter2->id).'.png';
//            $params['data']     = 'Telah diverifikasi dan ditandatangani secara elektronik oleh dokter penanggung jawab ['.(!empty($sql_dokter2->nama_dpn) ? $sql_dokter2->nama_dpn.' ' : '').$sql_dokter2->nama.(!empty($sql_dokter2->nama_blk) ? ', '.$sql_dokter2->nama_blk : '').']';
//            $params['level']    = 'H';
//            $params['size']     = 2;
//            $params['savename'] = $qr_dokter;
//            $this->ciqrcode->generate($params);
//            
//            $gambar5            = $qr_dokter;
////            $gambar5            = base_url('file/qr/dokter-'.strtolower($sql_dokter2->id).'.png');
//            
//            // Gambar VALIDASI
//            $getY = $pdf->GetY() + 1;
//            $pdf->Image($gambar4,2,$getY,2,2);
//            $pdf->Image($gambar5,12,$getY,2,2);
//            
//            
//            $pdf->SetFont('Arial', '', '10');
//            $pdf->Cell(10.5, .5, '', '', 0, 'L', $fill);
//            $pdf->Cell(7.5, .5, 'Semarang, '.$this->tanggalan->tgl_indo3($sql_medc_pen->tgl_masuk), '', 0, 'L', $fill);
//            $pdf->Ln();
//            $pdf->SetFont('Arial', 'B', '10');
//            $pdf->Cell(4, .5, 'Validasi', '0', 0, 'C', $fill);
//            $pdf->Cell(6.5, .5, '', '0', 0, 'C', $fill);
//            $pdf->SetFont('Arial', '', '10');
//            $pdf->Cell(7.5, .5, 'Dokter Yang Memeriksa,', '0', 0, 'L', $fill);
//            $pdf->Ln(2.5);
//            
//            $pdf->SetFont('Arial', '', '10');
//            $pdf->Cell(10.5, .5, '', '', 0, 'L', $fill);
//            $pdf->Cell(7.5, .5, (!empty($sql_dokter->nama_dpn) ? $sql_dokter->nama_dpn.' ' : '').$sql_dokter->nama.(!empty($sql_dokter->nama_blk) ? ', '.$sql_dokter->nama_blk : ''), '', 0, 'L', $fill);
//            $pdf->Ln();
//            $pdf->Cell(10.5, .5, '', '', 0, 'L', $fill);
//            $pdf->Cell(7.5, .5, $sql_dokter2->nik, '', 0, 'L', $fill);
//            $pdf->Ln();
//            
//            $type = (isset($_GET['type']) ? $_GET['type'] : 'I');
//
//            ob_start();
//            $pdf->Output($sql_pasien->nama_pgl. '.pdf', $type);
//            ob_end_flush();
//        } else {
//            $errors = $this->ion_auth->messages();
//            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
//            redirect();
//        }
//    }
    
    public function pdf_medcheck_rad() {
        if (akses::aksesLogin() == TRUE) {
            $setting            = $this->db->get('tbl_pengaturan')->row();
//            $id                 = $this->input->get('id');
            $id_medcheck        = $this->input->get('id');
            $id_rad             = $this->input->get('id_rad');
            
            $sql_medc           = $this->db->where('id', general::dekrip($id_medcheck))->get('tbl_trans_medcheck')->row();
            $sql_medc_item      = $this->db->where('id_medcheck', general::dekrip($id_medcheck))
                                           ->where('id_rad', general::dekrip($id_rad))
//                                           ->where('status', '5')
                                           ->where('status_hsl', '1')
                                           ->get('tbl_trans_medcheck_det')->result(); 
            $sql_medc_rad       = $this->db->where('id', general::dekrip($id_rad))->get('tbl_trans_medcheck_rad')->row(); 
            $sql_pasien         = $this->db->where('id', $sql_medc->id_pasien)->get('tbl_m_pasien')->row(); 
            $sql_pekerjaan      = $this->db->where('id', $sql_pasien->id_pekerjaan)->get('tbl_m_jenis_kerja')->row();
            $sql_dokter         = $this->db->where('id_user', $sql_medc->id_dokter)->get('tbl_m_karyawan')->row();
            $sql_dokter_rad     = $this->db->where('id_user', $sql_medc_rad->id_dokter)->get('tbl_m_karyawan')->row();
            $sql_dokter_krm     = $this->db->where('id_user', $sql_medc_rad->id_dokter_kirim)->get('tbl_m_karyawan')->row();
            $kode_pasien        = $sql_pasien->kode_dpn.$sql_pasien->kode;
            $gambar1            = FCPATH.'/assets/theme/admin-lte-3/dist/img/logo-esensia-2.png';
            $gambar2            = FCPATH.'/assets/theme/admin-lte-3/dist/img/logo-bw-bg2-1440px.png';
            $gambar3            = FCPATH.'/assets/theme/admin-lte-3/dist/img/logo-footer.png';

            $judul  = "HASIL PEMERIKSAAN RADIOLOGI";
            $judul2 = "Radiology Result";
            
            $this->load->library('MedRadPDF');
            $pdf = new MedRadPDF('P', 'cm', array(21.5,33));
            $pdf->SetAutoPageBreak('auto', 7);
            $pdf->SetMargins(1,0.35,1);
            $pdf->addPage();
            
            // Gambar Watermark Tengah
            $pdf->Image($gambar2,5,4,17,19);
            
            // Blok Judul
            $pdf->SetFont('Arial', 'B', '14');
            $pdf->Cell(19, .5, $judul, 0, 1, 'C');
            $pdf->Ln(0);
            $pdf->SetFont('Arial', 'Bi', '14');
            $pdf->Cell(19, .5, $judul2, 0, 1, 'C');
            $pdf->Ln();
            
            // Blok ID PASIEN
            $pdf->SetFont('Arial', '', '9');
            $pdf->Cell(5.5, .5, 'Nama / Name', '0', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
            $pdf->Cell(8, .5, strtoupper(general::bersih($sql_pasien->nama_pgl)).' ('.strtoupper($kode_pasien).')', '0', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->Cell(5.5, .5, 'Tgl Lahir / Date of Birth', '0', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
            $pdf->Cell(8, .5, $this->tanggalan->tgl_indo($sql_pasien->tgl_lahir).' - '.$this->tanggalan->usia($sql_pasien->tgl_lahir).' ('.general::jns_klm($sql_pasien->jns_klm).')', '0', 0, 'L', $fill);
            $pdf->Ln();
//            $pdf->Cell(5.5, .5, 'Jenis Kelamin / Gender', '0', 0, 'L', $fill);
//            $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
//            $pdf->Cell(8, .5, $this->tanggalan->usia($sql_pasien->tgl_lahir).' ('.general::jns_klm($sql_pasien->jns_klm).')', '0', 0, 'L', $fill);
//            $pdf->Ln();
            $pdf->Cell(5.5, .5, 'Alamat / Address', '0', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
            $pdf->Cell(8, .5, (!empty($sql_pasien->alamat) ? general::bersih($sql_pasien->alamat) : (!empty($sql_pasien->alamat_dom) ? $sql_pasien->alamat_dom : '-')), '0', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->Cell(5.5, .5, 'Tgl Periksa / Check Date', '0', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
            $pdf->Cell(8, .5, $this->tanggalan->tgl_indo5($sql_medc->tgl_masuk), '0', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->Cell(5.5, .5, 'Tgl Selesai / End Date', '0', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
            $pdf->Cell(8, .5, $this->tanggalan->tgl_indo5($sql_medc->tgl_modif), '0', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->Cell(5.5, .5, 'Dokter Pengirim / Reffered', '0', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
            $pdf->Cell(8, .5, (!empty($sql_dokter_krm->nama) ? (!empty($sql_dokter_krm->nama_dpn) ? $sql_dokter_krm->nama_dpn.' ' : '').$sql_dokter_krm->nama.(!empty($sql_dokter_krm->nama_blk) ? ', '.$sql_dokter_krm->nama_blk.' ' : '') : $sql_medc->nama), '0', 0, 'L', $fill);
            $pdf->Ln(1);
                        
            $fill = FALSE;
            foreach ($sql_medc_item as $rad){
                $sql_rad_det = $this->db->where('id_medcheck_det', $rad->id)->where('id_rad', $rad->id_rad)->get('tbl_trans_medcheck_rad_det')->result();
                
                $pdf->SetFont('Arial', 'B', '11');
                $pdf->Cell(19, .5, $rad->item, '', 0, 'L', $fill);
                $pdf->Ln();
                
                foreach ($sql_rad_det as $rad_hasil){
                    $pdf->SetFont('Arial', 'Bi', '7.5');
                    $pdf->Cell(5, .5, (!empty($rad_hasil->item_name) ? ' - ' : '').strtoupper($rad_hasil->item_name), '', 0, 'L', $fill);
                    $pdf->Cell(.5, .5, (!empty($rad_hasil->item_name) ? ':' : ''), '', 0, 'C', $fill);
                    $pdf->SetFont('Arial', '', '7.5');
//                    $pdf->Ln();
//                    $pdf->Cell(13.5, .5, ucfirst($rad_hasil->item_value), '', 0, 'L', $fill);
                    $pdf->MultiCell(13.5, .5, $rad_hasil->item_value, '', 'J', false);
//                    $pdf->Ln();
                }
                
                $pdf->Ln();
            }
            
            $pdf->SetFont('Arial', 'B', '11');
            $pdf->Cell(19, .5, 'KESAN', '', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->SetFont('Arial', '', '9');
            $pdf->MultiCell(19, .5, $sql_medc_rad->ket, '', 'J', false);
            $pdf->Ln();

            // QR GENERATOR VALIDASI
            $qr_validasi        = FCPATH.'/file/pasien/'.strtolower($kode_pasien).'/qr-validasi-'.strtolower($kode_pasien).'.png';
            $params['data']     = 'Telah diverifikasi dan ditandatangani secara elektronik oleh manajemen '.$setting->judul.'. Pasien a/n. ';
//            $params['data']    .= strtoupper($sql_pasien->nama_pgl).' ('.strtoupper($kode_pasien).')';
//            $params['data']     = 'https://verify.esensia.co.id/?id='.general::enkrip($sql_medc_srt->id).'&id_pasien='.general::enkrip($sql_pasien->id).'&role=surat';
            $params['level']    = 'H';
            $params['size']     = 2;
            $params['savename'] = $qr_validasi; 
            $this->ciqrcode->generate($params);
            
            $gambar4            = $qr_validasi; 
                        
            // QR GENERATOR DOKTER
            $qr_dokter          = FCPATH.'/file/pasien/'.strtolower($kode_pasien).'/qr-dokter-'.strtolower($sql_dokter_rad->id).'.png';
            $params['data']     = 'Telah diverifikasi dan ditandatangani secara elektronik oleh dokter penanggung jawab ['.(!empty($sql_dokter_rad->nama_dpn) ? $sql_dokter_rad->nama_dpn.' ' : '').$sql_dokter_rad->nama.(!empty($sql_dokter_rad->nama_blk) ? ', '.$sql_dokter_rad->nama_blk : '').']';
            $params['level']    = 'H';
            $params['size']     = 2;
            $params['savename'] = $qr_dokter;
            $this->ciqrcode->generate($params);
            
            $gambar5            = $qr_dokter;  
            
            // Gambar VALIDASI
            $getY = $pdf->GetY() + 1;
            $pdf->Image($gambar4,2,$getY,2,2);
            $pdf->Image($gambar5,12.5,$getY,2,2);
            
            $pdf->SetFont('Arial', '', '10');
            $pdf->Cell(11.5, .5, '', '', 0, 'L', $fill);
            $pdf->Cell(7.5, .5, 'Semarang, '.($sql_medc->tgl_keluar == '0000-00-00 00:00:00' ? $this->tanggalan->tgl_indo3(date('Y-m-d')) : $this->tanggalan->tgl_indo3($sql_medc->tgl_keluar)), '', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->SetFont('Arial', 'B', '10');
            $pdf->Cell(4, .5, 'Validasi', '0', 0, 'C', $fill);
            $pdf->Cell(7.5, .5, '', '0', 0, 'C', $fill);
            $pdf->SetFont('Arial', '', '10');
            $pdf->Cell(7.5, .5, (!empty($ket) ? $ket : 'Dokter Spesialis Radiologi'), '0', 0, 'L', $fill);
            $pdf->Ln(2.5);
            
            $pdf->SetFont('Arial', '', '10');
            $pdf->Cell(11, .5, '', '', 0, 'L', $fill);
            $pdf->Cell(8, .5, (!empty($sql_dokter_rad->nama_dpn) ? $sql_dokter_rad->nama_dpn.' ' : '').$sql_dokter_rad->nama.(!empty($sql_dokter_rad->nama_blk) ? ', '.$sql_dokter_rad->nama_blk.' ' : ''), '0', 0, 'L', $fill);
            $pdf->Ln();
                    
            $pdf->SetFillColor(235, 232, 228);
            $pdf->SetTextColor(0);
            $pdf->SetFont('Arial', '', '10');
            
            $type = (isset($_GET['type']) ? $_GET['type'] : 'I');
            
            ob_start();
            $pdf->Output($sql_pasien->nama_pgl. '.pdf', $type);
            ob_end_flush();
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }
    
    public function pdf_medcheck_resume() {
        if (akses::aksesLogin() == TRUE) {
            $setting            = $this->db->get('tbl_pengaturan')->row();
            $id_medcheck        = $this->input->get('id');
            $id_rsm             = $this->input->get('id_resm');
            
            $sql_medc           = $this->db->where('id', general::dekrip($id_medcheck))->get('tbl_trans_medcheck')->row();
            $sql_medc_det       = $this->db->where('id_medcheck', $sql_medc->id)->where('status_pkt', '0')->group_by('id_item_kat')->get('tbl_trans_medcheck_det')->result();
            $sql_medc_icd       = $this->db->where('id_medcheck', $sql_medc->id)->get('tbl_trans_medcheck_icd')->result();
            $sql_poli           = $this->db->where('id', $sql_medc->id_poli)->get('tbl_m_poli')->row(); 
            $sql_pasien         = $this->db->where('id', $sql_medc->id_pasien)->get('tbl_m_pasien')->row(); 
            $sql_pekerjaan      = $this->db->where('id', $sql_pasien->id_pekerjaan)->get('tbl_m_jenis_kerja')->row();
            $sql_dokter         = $this->db->where('id_user', $sql_medc->id_dokter)->get('tbl_m_karyawan')->row();
            $sql_icd            = $this->db->where('id', $sql_medc->id_icd)->get('tbl_m_icd')->row();
            $kode_pasien        = $sql_pasien->kode_dpn.$sql_pasien->kode;
            $gambar1            = FCPATH.'/assets/theme/admin-lte-3/dist/img/logo-esensia-2.png';
            $gambar2            = FCPATH.'/assets/theme/admin-lte-3/dist/img/logo-bw-bg2-1440px.png';
            $gambar3            = FCPATH.'/assets/theme/admin-lte-3/dist/img/logo-footer.png';

            $judul  = "RESUME MEDIS";
            $judul2 = "Medical Resume Result";
            
            $this->load->library('MedPDF');
            $pdf = new MedPDF('P', 'cm', array(21.5,33));
            $pdf->SetAutoPageBreak('auto', 7);
            $pdf->SetMargins(1,0.35,1);
            $pdf->header = 0;
            $pdf->addPage('','',false);
            
            // Gambar Watermark Tengah
            $pdf->Image($gambar2,5,4,15,19);
            
            // Blok Judul
            $pdf->SetFont('Arial', 'B', '14');
            $pdf->Cell(19, .5, $judul, 0, 1, 'C');
            $pdf->Ln(0);
            $pdf->SetFont('Arial', 'Bi', '14');
            $pdf->Cell(19, .5, $judul2, 0, 1, 'C');
            $pdf->Ln();
            
            // Blok ID PASIEN
            $pdf->SetFont('Arial', '', '9');
            $pdf->Cell(3, .5, 'ID Transaksi', '0', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
            $pdf->Cell(4.5, .5, $sql_medc->no_rm, '0', 0, 'L', $fill);
            $pdf->Cell(2.5, .5, 'No. RM', '0', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
            $pdf->Cell(8, .5, $sql_pasien->kode_dpn.$sql_pasien->kode, '0', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->Cell(3, .5, 'No. Invoice', '0', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
            $pdf->Cell(4.5, .5, (!empty($sql_medc->no_nota) ? $sql_medc->no_nota : '-'), '0', 0, 'L', $fill);
            $pdf->Cell(2.5, .5, 'Nama Name', '0', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
            $pdf->Cell(8, .5, general::bersih($sql_pasien->nama_pgl).' ('.$sql_pasien->jns_klm.')', '0', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->Cell(3, .5, 'Tgl Periksa', '0', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
            $pdf->Cell(4.5, .5, $this->tanggalan->tgl_indo5($sql_medc->tgl_masuk), '0', 0, 'L', $fill);
            $pdf->Cell(2.5, .5, 'NIK', '0', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
            $pdf->Cell(8, .5, $sql_pasien->nik, '0', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->Cell(3, .5, 'Poli', '0', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
            $pdf->Cell(4.5, .5, $sql_poli->lokasi, '0', 0, 'L', $fill);
            $pdf->Cell(2.5, .5, 'Tgl Lahir', '0', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
            $pdf->Cell(8, .5, $this->tanggalan->tgl_indo2($sql_pasien->tgl_lahir).' / '.$this->tanggalan->usia_lkp($sql_pasien->tgl_lahir), '0', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->Cell(3, .5, 'Alamat', '0', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
            $pdf->MultiCell(15.5, .5, (!empty($sql_pasien->alamat) ? general::bersih($sql_pasien->alamat) : (!empty($sql_pasien->alamat_dom) ? $sql_pasien->alamat_dom : '-')), '0', 'L');
            $pdf->Cell(3, .5, 'Dokter', '0', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
            $pdf->MultiCell(15.5, .5, (!empty($sql_dokter->nama_dpn) ? $sql_dokter->nama_dpn.' ' : '').$sql_dokter->nama.(!empty($sql_dokter->nama_blk) ? ', '.$sql_dokter->nama_blk.' ' : ''), '0', 'L');
            $pdf->Ln();
            
            # DATA MEDIS PASIEN
            $pdf->SetFont('Arial', 'B', '9');
            $pdf->Cell(3, .5, 'KELUHAN', '', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
            $pdf->SetFont('Arial', '', '9');
            $pdf->MultiCell(15.5, .5, $sql_medc->keluhan, '0', 'L');
            $pdf->Ln(0);
            $pdf->SetFont('Arial', 'B', '9');
            $pdf->Cell(3, .5, 'TTV', '', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
            $pdf->SetFont('Arial', '', '9');
            $pdf->Cell(2.5, .5, '- Suhu Tubuh', '', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '', 0, 'C', $fill);
            $pdf->Cell(1, .5, $sql_medc->ttv_st, '', 0, 'R', $fill);
            $pdf->Cell(1.5, .5, 'C', '', 0, 'L', $fill);
            $pdf->Cell(2.5, .5, '- Berat Badan', '', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '', 0, 'C', $fill);
            $pdf->Cell(1, .5, $sql_medc->ttv_bb, '', 0, 'R', $fill);
            $pdf->Cell(1.5, .5, 'Kg', '', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->Cell(3.5, .5, '', '', 0, 'L', $fill);
            $pdf->SetFont('Arial', '', '9');
            $pdf->Cell(2.5, .5, '- Tinggi Badan', '', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '', 0, 'C', $fill);
            $pdf->Cell(1, .5, $sql_medc->ttv_tb, '', 0, 'R', $fill);
            $pdf->Cell(1.5, .5, 'Cm', '', 0, 'L', $fill);
            $pdf->Cell(2.5, .5, '- Nadi', '', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '', 0, 'C', $fill);
            $pdf->Cell(1, .5, $sql_medc->ttv_nadi, '', 0, 'R', $fill);
            $pdf->Cell(1.5, .5, '/ Menit', '', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->Cell(3.5, .5, '', '', 0, 'L', $fill);
            $pdf->SetFont('Arial', '', '9');
            $pdf->Cell(2.5, .5, '- Sistole', '', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '', 0, 'C', $fill);
            $pdf->Cell(1, .5, $sql_medc->ttv_sistole, '', 0, 'R', $fill);
            $pdf->Cell(1.5, .5, 'mmHg', '', 0, 'L', $fill);
            $pdf->Cell(2.5, .5, '- Diastole', '', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '', 0, 'C', $fill);
            $pdf->Cell(1, .5, $sql_medc->ttv_diastole, '', 0, 'R', $fill);
            $pdf->Cell(1.5, .5, 'mmHg', '', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->Cell(3.5, .5, '', '', 0, 'L', $fill);
            $pdf->SetFont('Arial', '', '9');
            $pdf->Cell(2.5, .5, '- Laju Nafas', '', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '', 0, 'C', $fill);
            $pdf->Cell(1, .5, $sql_medc->ttv_laju, '', 0, 'R', $fill);
            $pdf->Cell(1.5, .5, '/ Menit', '', 0, 'L', $fill);
            $pdf->Cell(2.5, .5, '- Saturasi', '', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '', 0, 'C', $fill);
            $pdf->Cell(1, .5, $sql_medc->ttv_saturasi, '', 0, 'R', $fill);
            $pdf->Cell(1.5, .5, '%', '', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->Cell(3.5, .5, '', '', 0, 'L', $fill);
            $pdf->SetFont('Arial', '', '9');
            $pdf->Cell(2.5, .5, '- Skala Nyeri', '', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '', 0, 'C', $fill);
            $pdf->Cell(1, .5, $sql_medc->ttv_skala, '', 0, 'R', $fill);
            $pdf->Ln();
            $pdf->SetFont('Arial', 'B', '9');
            $pdf->Cell(3, .5, 'ANAMNESA', '', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
            $pdf->SetFont('Arial', '', '9');
            $pdf->MultiCell(15.5, .5, $sql_medc->anamnesa, '0', 'L');
            $pdf->Ln(0);
            $pdf->SetFont('Arial', 'B', '9');
            $pdf->Cell(3, .5, 'DIAGNOSA', '', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
            $pdf->SetFont('Arial', '', '9');
            $pdf->MultiCell(15.5, .5, $sql_medc->diagnosa, '0', 'L');
            $pdf->Ln(0);
            $pdf->SetFont('Arial', 'B', '9');
            $pdf->Cell(3, .5, 'DIAGNOSA ICD 10', '', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
            $pdf->SetFont('Arial', '', '9');
            $pdf->Ln();
            
            foreach ($sql_medc_icd as $icd){
                $pdf->Cell(.5, .5, '', '0', 0, 'L', $fill);
                $pdf->Cell(.5, .5, '-', '0', 0, 'L', $fill);
                $pdf->Cell(15, .5, $icd->icd, '0', 0, 'L', $fill);
                
                if(!empty($icd->diagnosa_en)){
                    $pdf->Ln();
                    $pdf->SetFont('Arial', 'i', '9');
                    $pdf->Cell(.5, .5, '', '0', 0, 'L', $fill);
                    $pdf->Cell(.5, .5, '', '0', 0, 'L', $fill);
                    $pdf->Cell(15, .5, $icd->diagnosa_en, '0', 0, 'L', $fill);                    
                }
                $pdf->Ln();
            }
                
//            $pdf->Ln();
            $pdf->SetFont('Arial', 'B', '9');
            $pdf->Cell(3, .5, 'PEMERIKSAAN', '', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
            $pdf->SetFont('Arial', '', '9');
            $pdf->MultiCell(15.5, .5, $sql_medc->pemeriksaan, '0', 'L');
            $pdf->Ln(0);
            $pdf->SetFont('Arial', 'B', '9');
            $pdf->Cell(3, .5, 'PROGRAM', '', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
            $pdf->SetFont('Arial', '', '9');
            $pdf->MultiCell(15.5, .5, $sql_medc->program, '0', 'L');
            $pdf->Ln();
            
            # DATA RESEP
            $pdf->SetFont('Arial', 'B', '9');
            $pdf->Cell(1, .5, 'No.', 'LT', 0, 'L', $fill);
            $pdf->Cell(3, .5, 'Tgl', 'T', 0, 'L', $fill);
            $pdf->Cell(8.5, .5, 'Item', 'T', 0, 'L', $fill);
            $pdf->Cell(6.5, .5, 'Keterangan', 'TR', 0, 'L', $fill);
//            $pdf->Cell(2, .5, 'Harga', 'T', 0, 'R', $fill);
//            $pdf->Cell(2, .5, 'Subtotal', 'TR', 0, 'R', $fill);
            $pdf->Ln();
            
            $fill = FALSE;
            $no   = 1;
            foreach ($sql_medc_det as $det){
                $sql_kat = $this->db->where('id', $det->id_item_kat)->get('tbl_m_kategori')->row();
                $sql_det = $this->db->where('id_medcheck', $det->id_medcheck)->where('id_item_kat', $det->id_item_kat)->where('status_pkt', '0')->get('tbl_trans_medcheck_det')->result();
                
                $pdf->SetFont('Arial', 'B', '9');
                $pdf->Cell(19, .5, $sql_kat->keterangan . ' (' . $sql_kat->kategori . ')', 'LTR', 0, 'L', $fill);
                $pdf->Ln();
                
                $pdf->SetFont('Arial', '', '9');
                foreach ($sql_det as $medc){
                    
                    $pdf->Cell(1, .5, $no.'.', 'L', 0, 'C', $fill);
                    $pdf->Cell(3, .5, $this->tanggalan->tgl_indo5($medc->tgl_simpan), '', 0, 'L', $fill);
                    $pdf->Cell(8.5, .5, $medc->item, '', 0, 'L', $fill);
                    $pdf->Cell(6.5, .5, (!empty($medc->keterangan) ? $medc->keterangan : ''), 'R', 0, 'L', $fill);
//                    $pdf->Cell(2, .5, general::format_angka($medc->harga), '', 0, 'R', $fill);
//                    $pdf->Cell(2, .5, general::format_angka($medc->subtotal), 'R', 0, 'R', $fill);
                    $pdf->Ln();
                    
                    # Tampilkan ini jika ada resep
                    if (!empty($medc->resep)) {
                        $pdf->SetFont('Arial', 'i', '8');
                        foreach (json_decode($medc->resep) as $racikan) {
                            $pdf->Cell(4, .5, '', 'L', 0, 'C', $fill);
                            $pdf->Cell(15, .5, ' - '.$racikan->item, 'R', 0, 'L', $fill);
//                            $pdf->Cell(2, .5, general::format_angka($racikan->harga), '', 0, 'R', $fill);
//                            $pdf->Cell(2, .5, '', 'R', 0, 'R', $fill);
                            $pdf->Ln();
                        }
                    }
                    
                    # Tampilkan ini jika ada dosis
                    if (!empty($medc->dosis) OR !empty($medc->dosis_ket)) {
                        $pdf->SetFont('Arial', 'Bi', '8');
                        $pdf->Cell(4, .5, 'Dosis : ', 'L', 0, 'R', $fill);
                        $pdf->SetFont('Arial', 'i', '8');
                        $pdf->Cell(15, .5, $medc->dosis.(!empty($medc->dosis_ket) ? ' ('.$medc->dosis_ket.')' : ''), 'R', 0, 'L', $fill);
                        $pdf->Ln();
                    }
                    
                    $no++;
                }
            }
            $pdf->Cell(19, .5, '', 'T', 0, 'L', $fill);
//            
//            $pdf->Ln();
//            $pdf->SetFont('Arial', 'B', '11');
//            $pdf->Cell(19, .5, 'SARAN', '', 0, 'L', $fill);
//            $pdf->Ln();
//            $pdf->SetFont('Arial', '', '9');
//            $pdf->MultiCell(19, .5, $sql_medc_rsm->saran, '', 'J', false);
//            $pdf->Ln();            
//            $pdf->SetFont('Arial', 'B', '11');
//            $pdf->Cell(19, .5, 'KESIMPULAN', '', 0, 'L', $fill);
//            $pdf->Ln();
//            $pdf->SetFont('Arial', '', '9');
//            $pdf->MultiCell(19, .5, $sql_medc_rsm->kesimpulan, '', 'J', false);
//            $pdf->Ln();

            // QR GENERATOR VALIDASI
            $qr_validasi        = FCPATH.'/file/pasien/'.strtolower($kode_pasien).'/qr-validasi-'.strtolower($kode_pasien).'.png';
//            $params['data']     = 'https://verify.esensia.co.id/?id='.general::enkrip($sql_medc_srt->id).'&id_pasien='.general::enkrip($sql_pasien->id).'&role=surat';
//            $params['data']     = 'Telah diverifikasi dan ditandatangani secara elektronik oleh manajemen '.$setting->judul.'. Pasien a/n. ';
//            $params['data']    .= strtoupper($sql_pasien->nama_pgl).' ('.strtoupper($kode_pasien).')';
            $params['level']    = 'H';
            $params['size']     = 2;
            $params['savename'] = $qr_validasi; 
            $this->ciqrcode->generate($params);
            
            $gambar4            = $qr_validasi; 
                        
            // QR GENERATOR DOKTER
            $qr_dokter          = FCPATH.'/file/pasien/'.strtolower($kode_pasien).'/qr-dokter-'.strtolower($sql_dokter->id).'.png';
            $params['data']     = 'Telah diverifikasi dan ditandatangani secara elektronik oleh dokter penanggung jawab ['.(!empty($sql_dokter->nama_dpn) ? $sql_dokter->nama_dpn.' ' : '').$sql_dokter->nama.(!empty($sql_dokter->nama_blk) ? ', '.$sql_dokter->nama_blk : '').']';
            $params['level']    = 'H';
            $params['size']     = 2;
            $params['savename'] = $qr_dokter;
            $this->ciqrcode->generate($params);
            
            $gambar5            = $qr_dokter;
            
            // Gambar VALIDASI
            $getY = $pdf->GetY() + 1;
            $pdf->Image($gambar4,2,$getY,2,2);
            $pdf->Image($gambar5,13.5,$getY,2,2);
            
            $pdf->SetFont('Arial', '', '10');
            $pdf->Cell(10.5, .5, '', '', 0, 'L', $fill);
            $pdf->Cell(8.5, .5, '', '', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->SetFont('Arial', 'B', '10');
            $pdf->Cell(4, .5, 'Validasi', '0', 0, 'C', $fill);
            $pdf->Cell(6.5, .5, '', '0', 0, 'C', $fill);
            $pdf->SetFont('Arial', '', '10');
            $pdf->Cell(8.5, .5, 'Semarang, '.$this->tanggalan->tgl_indo3($sql_medc_rsm->tgl_masuk), '0', 0, 'C', $fill);
            $pdf->Ln(2.5);
            
            $pdf->SetFont('Arial', '', '10');
            $pdf->Cell(10.5, .5, '', '0', 0, 'L', $fill);
            $pdf->Cell(8.5, .5, (!empty($sql_dokter->nama_dpn) ? $sql_dokter->nama_dpn.' ' : '').$sql_dokter->nama.(!empty($sql_dokter->nama_blk) ? ', '.$sql_dokter->nama_blk.' ' : ''), '0', 0, 'C', $fill);
            $pdf->Ln();
                    
            $pdf->SetFillColor(235, 232, 228);
            $pdf->SetTextColor(0);
            $pdf->SetFont('Arial', '', '10');
            
            $type = (isset($_GET['type']) ? $_GET['type'] : 'I');
            
            ob_start();
            $pdf->Output($sql_pasien->nama_pgl. '.pdf', $type);
            ob_end_flush();
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }
        
    public function pdf_medcheck_resume_lab() {
        if (akses::aksesLogin() == TRUE) {
            $setting            = $this->db->get('tbl_pengaturan')->row();
//            $id                 = $this->input->get('id');
            $id_medcheck        = $this->input->get('id');
            $id_rsm             = $this->input->get('id_resm');
            
            $sql_medc           = $this->db->where('id', general::dekrip($id_medcheck))->get('tbl_trans_medcheck')->row();
            $sql_medc_rsm       = $this->db->where('id', general::dekrip($id_rsm))->get('tbl_trans_medcheck_resume')->row(); 
            $sql_medc_rsm_hsl   = $this->db->where('id_resume', general::dekrip($id_rsm))->get('tbl_trans_medcheck_resume_det')->result(); 
            $sql_poli           = $this->db->where('id', $sql_medc->id_poli)->get('tbl_m_poli')->row(); 
            $sql_pasien         = $this->db->where('id', $sql_medc->id_pasien)->get('tbl_m_pasien')->row(); 
            $sql_pekerjaan      = $this->db->where('id', $sql_pasien->id_pekerjaan)->get('tbl_m_jenis_kerja')->row();
            $sql_dokter         = $this->db->where('id_user', $sql_medc_rsm->id_dokter)->get('tbl_m_karyawan')->row();
            $kode_pasien        = $sql_pasien->kode_dpn.$sql_pasien->kode;
            $gambar1            = FCPATH.'/assets/theme/admin-lte-3/dist/img/logo-esensia-2.png';
            $gambar2            = FCPATH.'/assets/theme/admin-lte-3/dist/img/logo-bw-bg2-1440px.png';
            $gambar3            = FCPATH.'/assets/theme/admin-lte-3/dist/img/logo-footer.png';
            $foto_file          = realpath($sql_pasien->file_name);
            $ck_foto            = (!empty($sql_pasien->file_name) ? FCPATH.'/'.$sql_pasien->file_name : FCPATH.'/assets/theme/admin-lte-3/dist/img/'.($sql_pasien->jns_klm == 'L' ? 'avatar7-men' : 'avatar7-women').'.png');
            $foto_pasien        = $ck_foto;
                    
            $judul  = "RESUME MEDICAL CHECKUP";
            $judul2 = "Resume Medical Checkup Result";
            
            $this->load->library('MedLabPDF');
            $pdf = new MedLabPDF('P', 'cm', array(21.5,33));
            $pdf->SetAutoPageBreak('auto', 7);
            $pdf->SetMargins(1,0.35,1);
            $pdf->header = 0;
            $pdf->addPage('','',false);
            
            // Gambar Watermark Tengah
            $pdf->Image($gambar2,5,4,15,19);
            
            // Blok Judul
            $pdf->SetFont('Arial', 'B', '14');
            $pdf->Cell(19, .5, $judul, 0, 1, 'C');
            $pdf->Ln(0);
            $pdf->SetFont('Arial', 'Bi', '14');
            $pdf->Cell(19, .5, $judul2, 0, 1, 'C');
            $pdf->Ln();
            
            # Blok ID PASIEN
            $pdf->Image($foto_pasien,1,4,2.5,3);
            
            $pdf->SetFont('Arial', 'B', '9');
            $pdf->Cell(2.5, .5, '', '0', 0, 'L', $fill);
            $pdf->Cell(2.5, .5, 'No. RM', '0', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
            $pdf->SetFont('Arial', '', '9');
            $pdf->Cell(7, .5, $sql_pasien->kode_dpn.$sql_pasien->kode, '', 0, 'L', $fill);
            $pdf->SetFont('Arial', 'B', '9');
            $pdf->Cell(3, .5, 'No. Pemeriksaan', '', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '', 0, 'C', $fill);
            $pdf->SetFont('Arial', '', '9');
            $pdf->Cell(3, .5, $sql_medc_rsm->no_surat, '', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->SetFont('Arial', 'B', '9');
            $pdf->Cell(2.5, .5, '', '0', 0, 'L', $fill);
            $pdf->Cell(2.5, .5, 'Nama Name', '0', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
            $pdf->SetFont('Arial', '', '9');
            $pdf->Cell(7, .5, general::bersih($sql_pasien->nama_pgl).' ('.$sql_pasien->jns_klm.')', '', 0, 'L', $fill);
            $pdf->SetFont('Arial', 'B', '9');
            $pdf->Cell(3, .5, 'No. Sampel', '', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '', 0, 'C', $fill);
            $pdf->SetFont('Arial', '', '9');
            $pdf->Cell(3, .5, $sql_medc_rsm->no_sample, '', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->SetFont('Arial', 'B', '9');
            $pdf->Cell(2.5, .5, '', '0', 0, 'L', $fill);
            $pdf->Cell(2.5, .5, 'NIK', '0', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
            $pdf->SetFont('Arial', '', '9');
            $pdf->Cell(7, .5, $sql_pasien->nik, '', 0, 'L', $fill);
            $pdf->SetFont('Arial', 'B', '9');
            $pdf->Cell(3, .5, 'Tgl Masuk', '', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '', 0, 'C', $fill);
            $pdf->SetFont('Arial', '', '9');
            $pdf->Cell(3, .5, $this->tanggalan->tgl_indo5($sql_medc->tgl_masuk), '', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->SetFont('Arial', 'B', '9');
            $pdf->Cell(2.5, .5, '', '0', 0, 'L', $fill);
            $pdf->Cell(2.5, .5, 'Tanggal Lahir', '0', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
            $pdf->SetFont('Arial', '', '9');
            $pdf->Cell(7, .5, $this->tanggalan->tgl_indo2($sql_pasien->tgl_lahir).' ('.$this->tanggalan->usia_lkp($sql_pasien->tgl_lahir).')', '', 0, 'L', $fill);
            $pdf->SetFont('Arial', 'B', '9');
            $pdf->Cell(3, .5, 'Poli', '', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '', 0, 'C', $fill);
            $pdf->SetFont('Arial', '', '9');
            $pdf->Cell(3, .5, $sql_poli->lokasi, '', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->SetFont('Arial', 'B', '9');
            $pdf->Cell(2.5, .5, '', '0', 0, 'L', $fill);
            $pdf->Cell(2.5, .5, 'Alamat', '0', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
            $pdf->SetFont('Arial', '', '9');
            $pdf->MultiCell(13.5, .5, (!empty($sql_pasien->alamat) ? general::bersih($sql_pasien->alamat) : (!empty($sql_pasien->alamat_dom) ? $sql_pasien->alamat_dom : '-')), '0', 'L');
            $pdf->Cell(2.5, .5, '', '0', 0, 'L', $fill);
            $pdf->SetFont('Arial', 'B', '9');
            $pdf->Cell(2.5, .5, 'Dokter Pengirim', '0', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
            $pdf->SetFont('Arial', '', '9');
            $pdf->Cell(13.5, .5, (!empty($sql_dokter->nama_dpn) ? $sql_dokter->nama_dpn.' ' : '').$sql_dokter->nama.(!empty($sql_dokter->nama_blk) ? ', '.$sql_dokter->nama_blk.' ' : ''), '0', 0, 'L', $fill);
            $pdf->Ln(1);
//            
//            $pdf->SetFont('Arial', '', '9');
//            $pdf->Cell(3, .5, 'No. Pemeriksaan', '0', 0, 'L', $fill);
//            $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
//            $pdf->Cell(4.5, .5, $sql_medc_rsm->no_surat, '0', 0, 'L', $fill);
//            $pdf->Cell(2.5, .5, 'No. RM', '0', 0, 'L', $fill);
//            $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
//            $pdf->Cell(8, .5, $sql_pasien->kode_dpn.$sql_pasien->kode, '0', 0, 'L', $fill);
//            $pdf->Ln();
//            $pdf->Cell(3, .5, 'No. Sampel', '0', 0, 'L', $fill);
//            $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
//            $pdf->Cell(4.5, .5, $sql_medc_rsm->no_sample, '0', 0, 'L', $fill);
//            $pdf->Cell(2.5, .5, 'Nama Name', '0', 0, 'L', $fill);
//            $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
//            $pdf->Cell(8, .5, $sql_pasien->nama_pgl.' ('.$sql_pasien->jns_klm.')', '0', 0, 'L', $fill);
//            $pdf->Ln();
//            $pdf->Cell(3, .5, 'Tgl Masuk', '0', 0, 'L', $fill);
//            $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
//            $pdf->Cell(4.5, .5, $this->tanggalan->tgl_indo5($sql_medc->tgl_masuk), '0', 0, 'L', $fill);
//            $pdf->Cell(2.5, .5, 'NIK', '0', 0, 'L', $fill);
//            $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
//            $pdf->Cell(8, .5, $sql_pasien->nik, '0', 0, 'L', $fill);
//            $pdf->Ln();
//            $pdf->Cell(3, .5, 'Poli', '0', 0, 'L', $fill);
//            $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
//            $pdf->Cell(4.5, .5, $sql_poli->lokasi, '0', 0, 'L', $fill);
//            $pdf->Cell(2.5, .5, 'Tgl Lahir', '0', 0, 'L', $fill);
//            $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
//            $pdf->Cell(8, .5, $this->tanggalan->tgl_indo2($sql_pasien->tgl_lahir).' / '.$this->tanggalan->usia_lkp($sql_pasien->tgl_lahir), '0', 0, 'L', $fill);
//            $pdf->Ln();
//            $pdf->Cell(3, .5, 'Alamat', '0', 0, 'L', $fill);
//            $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
//            $pdf->MultiCell(15.5, .5, (!empty($sql_pasien->alamat) ? $sql_pasien->alamat : (!empty($sql_pasien->alamat_dom) ? $sql_pasien->alamat_dom : '-')), '0', 'L');
//            $pdf->Cell(3, .5, 'Dokter Pengirim', '0', 0, 'L', $fill);
//            $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
//            $pdf->MultiCell(15.5, .5, (!empty($sql_dokter->nama_dpn) ? $sql_dokter->nama_dpn.' ' : '').$sql_dokter->nama.(!empty($sql_dokter->nama_blk) ? ', '.$sql_dokter->nama_blk.' ' : ''), '0', 'L');
//            $pdf->Ln();
                        
            $fill = FALSE;
            foreach ($sql_medc_rsm_hsl as $rsm){
                $pdf->SetFont('Arial', 'B', '10');
                $pdf->Cell(5.5, .5, $rsm->param, '', 0, 'L', $fill);
                $pdf->Cell(.5, .5, ':', '', 0, 'C', $fill);
                $pdf->SetFont('Arial', '', '10');
                $pdf->MultiCell(13, .5, $rsm->param_nilai, '0', 'L');
//                $pdf->Cell(13, .5, $rsm->param_nilai, '', 0, 'L', $fill);
//                $pdf->Ln();
            }
            
            $pdf->Ln();
            $pdf->SetFont('Arial', 'B', '11');
            $pdf->Cell(19, .5, 'SARAN', '', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->SetFont('Arial', '', '9');
            $pdf->MultiCell(19, .5, $sql_medc_rsm->saran, '', 'J', false);
            $pdf->Ln();            
            $pdf->SetFont('Arial', 'B', '11');
            $pdf->Cell(19, .5, 'KESIMPULAN', '', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->SetFont('Arial', '', '9');
            $pdf->MultiCell(19, .5, $sql_medc_rsm->kesimpulan, '', 'J', false);
            $pdf->Ln();

            // QR GENERATOR VALIDASI
            $qr_validasi        = FCPATH.'/file/pasien/'.strtolower($kode_pasien).'/qr-validasi-'.strtolower($kode_pasien).'.png';
//            $params['data']     = 'https://verify.esensia.co.id/?id='.general::enkrip($sql_medc_srt->id).'&id_pasien='.general::enkrip($sql_pasien->id).'&role=surat';
            $params['data']     = 'Telah diverifikasi dan ditandatangani secara elektronik oleh manajemen '.$setting->judul.'. Pasien a/n. ';
//            $params['data']    .= strtoupper($sql_pasien->nama_pgl).' ('.strtoupper($kode_pasien).')';
            $params['level']    = 'H';
            $params['size']     = 2;
            $params['savename'] = $qr_validasi; 
            $this->ciqrcode->generate($params);
            
            $gambar4            = $qr_validasi; 
                        
            // QR GENERATOR DOKTER
            $qr_dokter          = FCPATH.'/file/pasien/'.strtolower($kode_pasien).'/qr-dokter-'.strtolower($sql_dokter->id).'.png';
            $params['data']     = 'Telah diverifikasi dan ditandatangani secara elektronik oleh dokter penanggung jawab ['.(!empty($sql_dokter->nama_dpn) ? $sql_dokter->nama_dpn.' ' : '').$sql_dokter->nama.(!empty($sql_dokter->nama_blk) ? ', '.$sql_dokter->nama_blk : '').']';
            $params['level']    = 'H';
            $params['size']     = 2;
            $params['savename'] = $qr_dokter;
            $this->ciqrcode->generate($params);
            
            $gambar5            = $qr_dokter;
            
            // Gambar VALIDASI
            $getY = $pdf->GetY() + 1;
            $pdf->Image($gambar4,2,$getY,2,2);
            $pdf->Image($gambar5,13.80,$getY,2,2);
            
            $pdf->SetFont('Arial', '', '10');
            $pdf->Cell(10.5, .5, '', '', 0, 'L', $fill);
            $pdf->Cell(8.5, .5, '', '', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->SetFont('Arial', 'B', '10');
            $pdf->Cell(4, .5, 'Validasi', '0', 0, 'C', $fill);
            $pdf->Cell(6.5, .5, '', '0', 0, 'C', $fill);
            $pdf->SetFont('Arial', '', '10');
            $pdf->Cell(8.5, .5, 'Semarang, '.$this->tanggalan->tgl_indo3($sql_medc_rsm->tgl_masuk), '0', 0, 'C', $fill);
            $pdf->Ln(2.5);
            
            $pdf->SetFont('Arial', '', '10');
            $pdf->Cell(10.5, .5, '', '0', 0, 'L', $fill);
            $pdf->Cell(8.5, .5, (!empty($sql_dokter->nama_dpn) ? $sql_dokter->nama_dpn.' ' : '').$sql_dokter->nama.(!empty($sql_dokter->nama_blk) ? ', '.$sql_dokter->nama_blk.' ' : ''), '0', 0, 'C', $fill);
            $pdf->Ln();
                    
            $pdf->SetFillColor(235, 232, 228);
            $pdf->SetTextColor(0);
            $pdf->SetFont('Arial', '', '10');
            
            $type = (isset($_GET['type']) ? $_GET['type'] : 'I');
            
            ob_start();
            $pdf->Output($sql_pasien->nama_pgl. '.pdf', $type);
            ob_end_flush();
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }        
        
    public function pdf_medcheck_resume_rnp() {
        if (akses::aksesLogin() == TRUE) {
            $setting            = $this->db->get('tbl_pengaturan')->row();
//            $id                 = $this->input->get('id');
            $id_medcheck        = $this->input->get('id');
            $id_rsm             = $this->input->get('id_resm');
            
            $sql_medc           = $this->db->where('id', general::dekrip($id_medcheck))->get('tbl_trans_medcheck')->row();
            $sql_medc_rsm       = $this->db->where('id', general::dekrip($id_rsm))->get('tbl_trans_medcheck_resume')->row(); 
            $sql_medc_rsm_hsl   = $this->db->where('id_resume', general::dekrip($id_rsm))->where('status_rnp', '1')->get('tbl_trans_medcheck_resume_det')->result(); 
            $sql_medc_rsm_trp   = $this->db->where('id_resume', general::dekrip($id_rsm))->where('status_trp', '1')->get('tbl_trans_medcheck_resume_det')->result(); 
            $sql_medc_res       = $this->db->where('id_medcheck', $sql_medc->id)->where('status_plg', '1')->get('tbl_trans_medcheck_resep')->row(); 
            $sql_medc_res_det   = $this->db->where('id_resep', $sql_medc_res->id)->get('tbl_trans_medcheck_resep_det')->result();
            $sql_medc_icd       = $this->db->where('id_medcheck', $sql_medc->id)->get('tbl_trans_medcheck_icd')->result();
            $sql_poli           = $this->db->where('id', $sql_medc->id_poli)->get('tbl_m_poli')->row(); 
            $sql_pasien         = $this->db->where('id', $sql_medc->id_pasien)->get('tbl_m_pasien')->row(); 
            $sql_pekerjaan      = $this->db->where('id', $sql_pasien->id_pekerjaan)->get('tbl_m_jenis_kerja')->row();
            $sql_dokter         = $this->db->where('id_user', $sql_medc_rsm->id_dokter)->get('tbl_m_karyawan')->row();
            $kode_pasien        = $sql_pasien->kode_dpn.$sql_pasien->kode;
            $gambar1            = FCPATH.'/assets/theme/admin-lte-3/dist/img/logo-esensia-2.png';
            $gambar2            = FCPATH.'/assets/theme/admin-lte-3/dist/img/logo-bw-bg2-1440px.png';
            $gambar3            = FCPATH.'/assets/theme/admin-lte-3/dist/img/logo-footer.png';

            $judul  = "RESUME MEDIS RAWAT INAP";
            $judul2 = "Inpatient Medical Resume";
            
            $this->load->library('MedPDF');
            $pdf = new MedPDF('P', 'cm', array(21.5,33));
            $pdf->SetAutoPageBreak('auto', 6.5);
            $pdf->header = 0;
            $pdf->addPage('','',false);
            
            // Gambar Watermark Tengah
            $pdf->Image($gambar2,5,4,15,19);
            
            // Blok Judul
            $pdf->SetFont('Arial', 'B', '11');
            $pdf->Cell(19, .5, $judul, 0, 1, 'C');
            $pdf->Ln(0);
            $pdf->SetFont('Arial', 'Bi', '10');
            $pdf->Cell(19, .5, $judul2, 0, 1, 'C');
            $pdf->Ln();
            
            // Blok ID PASIEN
            $pdf->SetFont('Arial', '', '9');
            $pdf->Cell(3, .5, 'No. Pemeriksaan', '0', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
            $pdf->Cell(4.5, .5, $sql_medc_rsm->no_surat, '0', 0, 'L', $fill);
            $pdf->Cell(2.5, .5, 'No. RM', '0', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
            $pdf->Cell(8, .5, $sql_pasien->kode_dpn.$sql_pasien->kode, '0', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->Cell(3, .5, 'Tgl Masuk', '0', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
            $pdf->Cell(4.5, .5, $this->tanggalan->tgl_indo5($sql_medc->tgl_masuk), '0', 0, 'L', $fill);
            $pdf->Cell(2.5, .5, 'Nama Name', '0', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
            $pdf->Cell(8, .5, $sql_pasien->nama_pgl.' ('.$sql_pasien->jns_klm.')', '0', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->Cell(3, .5, 'NIK', '0', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
            $pdf->Cell(4.5, .5, $sql_pasien->nik, '0', 0, 'L', $fill);
            $pdf->Cell(2.5, .5, 'Tgl Lahir', '0', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
            $pdf->Cell(8, .5, $this->tanggalan->tgl_indo2($sql_pasien->tgl_lahir).' / '.$this->tanggalan->usia_lkp($sql_pasien->tgl_lahir), '0', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->Cell(3, .5, 'Poli', '0', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
            $pdf->Cell(4.5, .5, $sql_poli->lokasi, '0', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->Cell(3, .5, 'Alamat', '0', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
            $pdf->MultiCell(15.5, .5, (!empty($sql_pasien->alamat) ? $sql_pasien->alamat : (!empty($sql_pasien->alamat_dom) ? $sql_pasien->alamat_dom : '-')), '0', 'L');
            $pdf->Ln();
            
            $fill = FALSE;
            foreach ($sql_medc_rsm_hsl as $rsm){
                $pdf->SetFont('Arial', 'B', '8');
//                $pdf->MultiCell(5.5, .5, $rsm->param, '0', 'L');
                $pdf->Cell(4, .5, $rsm->param, '', 0, 'L', $fill);
                $pdf->Cell(.5, .5, ':', '', 0, 'C', $fill);
                $pdf->SetFont('Arial', '', '8');
                $pdf->MultiCell(14.5, .5, iconv('UTF-8', 'windows-1252', html_entity_decode($rsm->param_nilai)), '0', 'J');
            }
            
//            $pdf->SetFont('Arial', 'B', '8');
//            $pdf->Cell(4, .5, 'ICD 10', '', 0, 'L', $fill);
//            $pdf->Cell(.5, .5, ':', '', 0, 'C', $fill);
//            $pdf->Ln();
            
            $n = 1;
            foreach ($sql_medc_icd as $icd){
                if($n == 1){
                    $pdf->SetFont('Arial', 'B', '8');
                    $pdf->Cell(4, .5, 'ICD 10', '', 0, 'L', $fill);
                    $pdf->Cell(.5, .5, ':', '', 0, 'C', $fill);
                }else{
                    $pdf->SetFont('Arial', '', '8');
                    $pdf->Cell(4.5, .5, '', '', 0, 'L', $fill);
                }
                $pdf->SetFont('Arial', '', '8');
                $pdf->Cell(14.5, .5, '- '.$icd->diagnosa_en, '', 0, 'L', $fill);
                $pdf->Ln();
                
                $n++;
            }
            $pdf->Ln();
            
            $pdf->SetFont('Arial', 'B', '8');
            $pdf->Cell(19, .5, 'TERAPI PULANG', 'TB', 0, 'C', $fill);
            $pdf->Ln(); 
            
            $pdf->Cell(1, .5, 'No.', 'B', 0, 'C', $fill);
            $pdf->Cell(6, .5, 'Nama Obat', 'B', 0, 'L', $fill);
            $pdf->Cell(12, .5, 'Catatan', 'B', 0, 'L', $fill);
            $pdf->Ln();    
            
            $fill = FALSE;
            $no_trp = 1;
            foreach ($sql_medc_res_det as $trp){
//                $pdf->SetFont('Arial', '', 8);
////                $pdf->Cell(1, 0.5, $no_trp, 'LR', 0, 'C', $fill);
//
//                $x = $pdf->GetX() + 1; // Mengambil posisi X saat ini dan menambahkan offset
//                $y = $pdf->GetY(); // Mengambil posisi Y saat ini
//
//                $pdf->SetXY($x, $y); // Mengatur posisi X dan Y baru
//
//                $pdf->MultiCell(1, 0.5, $no_trp, 'LR', 'C', $fill);
//                $x += 0;
//                $pdf->MultiCell(6, 0.5, $trp->param, 'R', 'L', $fill);
//                $x += 5; // Menambahkan offset X untuk selanjutnya
//
//                $pdf->SetXY($x, $y); // Mengatur posisi X dan Y baru
//
//                $pdf->MultiCell(12, 0.5, $trp->param_nilai, 'R', 'L', $fill);
//
//                $pdf->SetFont('Arial', '', '8');
//                $pdf->Cell(1, .5, $no_trp, '', 0, 'C', $fill);
//                $pdf->Cell(6, .5, ucwords($trp->param), '', 0, 'L', $fill);
////                $pdf->SetFont('Arial', '', '8');
////                $pdf->Cell(12, .5, $trp->param_nilai, 'R', 0, 'L', $fill);
//                $pdf->MultiCell(12, .5, str_replace('#', ' ', $trp->param_nilai), '', 'L', $fill,$pdf->GetX(),15);
////                $pdf->Ln();


                $pdf->SetFont('Arial', '', '8');
                $pdf->Cell(1, .5, $no_trp, '', 0, 'C', $fill);
                $pdf->Cell(6, .5, ucwords($trp->item), '', 0, 'L', $fill);
                $pdf->MultiCell(12, .5, $trp->dosis.' '.(!empty($trp->dosis_ket) ? '('.$trp->dosis_ket.')' : '').(!empty($trp->keterangan) ? ' / '.$trp->keterangan : ''), '', 'L', $fill,$pdf->GetX(),15);
                
                $no_trp++;
            }
            $pdf->Cell(19, .5, '', 'T', 0, 'L', $fill);

            // QR GENERATOR VALIDASI
            $qr_validasi        = FCPATH.'/file/pasien/'.strtolower($kode_pasien).'/qr-validasi-'.strtolower($kode_pasien).'.png';
//            $params['data']     = 'https://verify.esensia.co.id/?id='.general::enkrip($sql_medc_srt->id).'&id_pasien='.general::enkrip($sql_pasien->id).'&role=surat';
            $params['data']     = 'Telah diverifikasi dan ditandatangani secara elektronik oleh manajemen '.$setting->judul.'. Pasien a/n. ';
//            $params['data']    .= strtoupper($sql_pasien->nama_pgl).' ('.strtoupper($kode_pasien).')';
            $params['level']    = 'H';
            $params['size']     = 2;
            $params['savename'] = $qr_validasi; 
            $this->ciqrcode->generate($params);
            
            $gambar4            = $qr_validasi; 
                        
            // QR GENERATOR DOKTER
            $qr_dokter          = FCPATH.'/file/pasien/'.strtolower($kode_pasien).'/qr-dokter-'.strtolower($sql_dokter->id).'.png';
            $params['data']     = 'Telah diverifikasi dan ditandatangani secara elektronik oleh dokter penanggung jawab ['.(!empty($sql_dokter->nama_dpn) ? $sql_dokter->nama_dpn.' ' : '').$sql_dokter->nama.(!empty($sql_dokter->nama_blk) ? ', '.$sql_dokter->nama_blk : '').']';
            $params['level']    = 'H';
            $params['size']     = 2;
            $params['savename'] = $qr_dokter;
            $this->ciqrcode->generate($params);
            
            $gambar5            = $qr_dokter;
            
            // Gambar VALIDASI
            $getY = $pdf->GetY() + 1;
            $pdf->Image($gambar4,2,$getY,2,2);
            $pdf->Image($gambar5,13.80,$getY,2,2);
            
            $pdf->SetFont('Arial', '', '8');
            $pdf->Cell(10.5, .5, '', '', 0, 'L', $fill);
            $pdf->Cell(8.5, .5, '', '', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->SetFont('Arial', 'B', '8');
            $pdf->Cell(4, .5, 'Petugas', '0', 0, 'C', $fill);
            $pdf->Cell(6.5, .5, '', '0', 0, 'C', $fill);
            $pdf->SetFont('Arial', '', '8');
            $pdf->Cell(8.5, .5, 'Semarang, '.$this->tanggalan->tgl_indo3($sql_medc_rsm->tgl_masuk), '0', 0, 'C', $fill);
            $pdf->Ln(2.5);
            
            $pdf->SetFont('Arial', '', '8');
            $pdf->Cell(10.5, .5, $this->ion_auth->user($sql_medc_rsm->id_user)->row()->first_name, '0', 0, 'L', $fill);
            $pdf->Cell(8.5, .5, (!empty($sql_dokter->nama_dpn) ? $sql_dokter->nama_dpn.' ' : '').$sql_dokter->nama.(!empty($sql_dokter->nama_blk) ? ', '.$sql_dokter->nama_blk.' ' : ''), '0', 0, 'C', $fill);
            $pdf->Ln();
                    
            $pdf->SetFillColor(235, 232, 228);
            $pdf->SetTextColor(0);
            $pdf->SetFont('Arial', '', '8');
            
            $type = (isset($_GET['type']) ? $_GET['type'] : 'I');
            
            ob_start();
            $pdf->Output($sql_pasien->nama_pgl. '.pdf', $type);
            ob_end_flush();
//            
//            $sql_cek_file = $this->db->where('id_resume', $sql_medc_rsm->id)->get('tbl_trans_medcheck_file');
//            
//            if($sql_cek_file->num_rows() == 0){
//                $this->load->helper('download');
//                
//               $folder      = realpath('./file/pasien/'.$kode_pasien);
//               $filename    = $folder.'/kontol.pdf';
//               $fdata       = (base_url('medcheck/surat/cetak_pdf_rsm_rnp.php?id='.$id_medcheck.'&id_resm='.$id_rsm));
//               $fbase64     = 'data:application/pdf;base64,'.base64_encode(file_get_contents($pdf->Output($sql_pasien->nama_pgl. '.pdf', $type)));
//                
//                $data_file = array(
//                   'id_medcheck'   => $sql_medc->id,
//                   'id_pasien'     => $sql_medc->id_pasien,
//                   'id_user'       => $this->ion_auth->user()->row()->id,
//                   'tgl_simpan'    => date('Y-m-d H:i:s'),
//                   'tgl_masuk'     => date('Y-m-d H:i'),
//                   'judul'         => 'ppp',
//                   'keterangan'    => 'hhh',
////                   'file_name_ori' => $f['client_name'],
//                   'file_name'     => $filename,
//                   'file_ext'      => $f['file_ext'],
//                   'file_type'     => $f['file_type'],
//                   'file_base64'   => '-',
//                   'status'        => '1',
//               );
//                
//                crud::simpan('tbl_trans_medcheck_file', $data_file);
//                
//                force_download($filename, $fdata);
//            }
//            
//                        $data_file = array(
//                            'id_medcheck'   => $sql_medc->id,
//                            'id_pasien'     => $sql_medc->id_pasien,
//                            'id_user'       => $this->ion_auth->user()->row()->id,
//                            'tgl_simpan'    => date('Y-m-d H:i:s'),
//                            'tgl_masuk'     => date('Y-m-d H:i'),
//                            'judul'         => $judul,
//                            'keterangan'    => $ket,
//                            'file_name_ori' => $f['client_name'],
//                            'file_name'     => $f['file_name'],
//                            'file_ext'      => $f['file_ext'],
//                            'file_type'     => $f['file_type'],
////                            'file_base64'   => $file64,
//                            'status'        => '1',
//                        );
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }
        
    public function pdf_medcheck_ass_rnp() {
        if (akses::aksesLogin() == TRUE) {
            $setting            = $this->db->get('tbl_pengaturan')->row();
//            $id                 = $this->input->get('id');
            $id_medcheck        = $this->input->get('id');
            $id_rsm             = $this->input->get('id_resm');
            
            $sql_medc           = $this->db->where('id', general::dekrip($id_medcheck))->get('tbl_trans_medcheck')->row();
            $sql_medc_ass       = $this->db->where('id_medcheck', $sql_medc->id)->get('tbl_trans_medcheck_ass_ranap')->row(); 
            $sql_medc_ass_obt   = $this->db->where('id_ass_ranap', $sql_medc_ass->id)->get('tbl_trans_medcheck_ass_ranap_obat')->result(); 
            $sql_medc_icd       = $this->db->where('id_medcheck', $sql_medc->id)->get('tbl_trans_medcheck_icd')->result();
            $sql_poli           = $this->db->where('id', $sql_medc->id_poli)->get('tbl_m_poli')->row(); 
            $sql_pasien         = $this->db->where('id', $sql_medc->id_pasien)->get('tbl_m_pasien')->row(); 
            $sql_pekerjaan      = $this->db->where('id', $sql_pasien->id_pekerjaan)->get('tbl_m_jenis_kerja')->row();
            $sql_dokter         = $this->db->where('id_user', $sql_medc_rsm->id_dokter)->get('tbl_m_karyawan')->row();
            $kode_pasien        = $sql_pasien->kode_dpn.$sql_pasien->kode;
            $gambar1            = FCPATH.'/assets/theme/admin-lte-3/dist/img/logo-esensia-2.png';
            $gambar2            = FCPATH.'/assets/theme/admin-lte-3/dist/img/logo-bw-bg2-1440px.png';
            $gambar3            = FCPATH.'/assets/theme/admin-lte-3/dist/img/logo-footer.png';
            $gambar3            = FCPATH.'/assets/theme/admin-lte-3/dist/img/skala-nyeri.png';

            $judul  = "ASSESMENT RAWAT INAP";
            $judul2 = "Inpatient Medical Resume";
            
            $this->load->library('MedPDF');
            $pdf = new MedPDF('P', 'cm', array(21.5,33));
            $pdf->SetAutoPageBreak('auto', 6.5);
            $pdf->header = 0;
            $pdf->addPage('','',false);
            
            // Gambar Watermark Tengah
            $pdf->Image($gambar2,5,4,15,19);
            
            // Blok Judul
            $pdf->SetFont('Arial', 'B', '11');
            $pdf->Cell(19, .5, $judul, 0, 1, 'C');
            $pdf->Ln(0);
//            $pdf->SetFont('Arial', 'Bi', '10');
//            $pdf->Cell(19, .5, $judul2, 0, 1, 'C');
//            $pdf->Ln();
            
            // Blok ID PASIEN
            $pdf->SetFont('Arial', '', '9');
            $pdf->Cell(3, .5, 'No. Pemeriksaan', '0', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
            $pdf->Cell(4.5, .5, $sql_medc_rsm->no_surat, '0', 0, 'L', $fill);
            $pdf->Cell(2.5, .5, 'No. RM', '0', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
            $pdf->Cell(8, .5, $sql_pasien->kode_dpn.$sql_pasien->kode, '0', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->Cell(3, .5, 'Tgl Masuk', '0', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
            $pdf->Cell(4.5, .5, $this->tanggalan->tgl_indo5($sql_medc->tgl_masuk), '0', 0, 'L', $fill);
            $pdf->Cell(2.5, .5, 'Nama Name', '0', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
            $pdf->Cell(8, .5, $sql_pasien->nama_pgl.' ('.$sql_pasien->jns_klm.')', '0', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->Cell(3, .5, 'NIK', '0', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
            $pdf->Cell(4.5, .5, $sql_pasien->nik, '0', 0, 'L', $fill);
            $pdf->Cell(2.5, .5, 'Tgl Lahir', '0', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
            $pdf->Cell(8, .5, $this->tanggalan->tgl_indo2($sql_pasien->tgl_lahir).' / '.$this->tanggalan->usia_lkp($sql_pasien->tgl_lahir), '0', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->Cell(3, .5, 'Poli', '0', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
            $pdf->Cell(4.5, .5, $sql_poli->lokasi, '0', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->Cell(3, .5, 'Alamat', '0', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
            $pdf->MultiCell(15.5, .5, (!empty($sql_pasien->alamat) ? $sql_pasien->alamat : (!empty($sql_pasien->alamat_dom) ? $sql_pasien->alamat_dom : '-')), '0', 'L');
            $pdf->Ln();
            $pdf->Cell(19, .5, '', 'T', 0, 'C', $fill);
            $pdf->Ln();
            
            $pdf->SetFont('Arial', 'B', '9');
            $pdf->Cell(19, .5, '1.  KELUHAN UTAMA', '', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->SetFont('Arial', '', '9');
            $pdf->Cell(.5, .5, '', '', 0, 'L', $fill);
            $pdf->MultiCell(18.5, .5, $sql_medc_ass->keluhan, '', 'J');
            $pdf->Ln();
            $pdf->SetFont('Arial', 'B', '9');
            $pdf->Cell(19, .5, '2.  RIWAYAT PENYAKIT', '', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->Cell(.5, .5, '', '', 0, 'L', $fill);
            $pdf->Cell(18.5, .5, 'a.  Riwayat penyakit lalu :', '', 0, 'J', $fill);
            $pdf->Ln();            
            $pdf->SetFont('Arial', '', '9');
            $pdf->Cell(1, .5, '', '', 0, 'L', $fill);
            $pdf->MultiCell(18, .5, $sql_medc_ass->riwayat_skg, '', 'J');
            $pdf->Cell(.5, .5, '', '', 0, 'L', $fill);
            $pdf->SetFont('Arial', 'B', '9');
            $pdf->Cell(18.5, .5, 'b.  Riwayat Mnum Obat :', '', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->SetFont('Arial', '', '9');
            
            $fill = FALSE;
            foreach ($sql_medc_ass_obt as $obt){
//                $pdf->SetFont('Arial', 'B', '8');
//                $pdf->MultiCell(5.5, .5, $rsm->param, '0', 'L');
//                $pdf->Cell(4, .5, $rsm->param, '', 0, 'L', $fill);
                $pdf->Cell(1, .5, '', '', 0, 'C', $fill);
                $pdf->Cell(18, .5, '- '.$obt->param, '', 0, 'L', $fill);
                $pdf->Ln();
            }
            
            $pdf->Ln();
            $pdf->SetFont('Arial', 'B', '9');
            $pdf->Cell(19, .5, '3.  PEMERIKSAAN FISIK', '', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->SetFont('Arial', '', '9');
            $pdf->Cell(.5, .5, '', '', 0, 'L', $fill);
            $pdf->Cell(3.5, .5, 'Suhu Tubuh', '', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '', 0, 'C', $fill);
            $pdf->Cell(2, .5, $sql_medc->ttv_st.' C', '', 0, 'L', $fill);
            $pdf->Cell(3.5, .5, 'Berat Badan', '', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '', 0, 'C', $fill);
            $pdf->Cell(2, .5, $sql_medc->ttv_bb.' C', '', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->Cell(.5, .5, '', '', 0, 'L', $fill);
            $pdf->Cell(3.5, .5, 'Tinggi Badan', '', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '', 0, 'C', $fill);
            $pdf->Cell(2, .5, $sql_medc->ttv_tb.' Cm', '', 0, 'L', $fill);
            $pdf->Cell(3.5, .5, 'Tekanan Darah', '', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '', 0, 'C', $fill);
            $pdf->Cell(2, .5, $sql_medc->ttv_td.' Cm', '', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->Cell(.5, .5, '', '', 0, 'L', $fill);
            $pdf->Cell(3.5, .5, 'Sistole', '', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '', 0, 'C', $fill);
            $pdf->Cell(2, .5, $sql_medc->ttv_sistole.' mmHg', '', 0, 'L', $fill);
            $pdf->Cell(3.5, .5, 'Diastole', '', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '', 0, 'C', $fill);
            $pdf->Cell(2, .5, $sql_medc->ttv_diastole.' mmHg', '', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->Cell(.5, .5, '', '', 0, 'L', $fill);
            $pdf->Cell(3.5, .5, 'Laju Nafas', '', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '', 0, 'C', $fill);
            $pdf->Cell(2, .5, $sql_medc->ttv_laju.' / Menit', '', 0, 'L', $fill);
            $pdf->Cell(3.5, .5, 'Saturasi', '', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '', 0, 'C', $fill);
            $pdf->Cell(2, .5, $sql_medc->ttv_saturasi.' %', '', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->Cell(19, .5, '', '', 0, 'L', $fill);
            $pdf->Ln();
            
            $pdf->SetFont('Arial', 'B', '9');
            $pdf->Cell(19, .5, '4.  SKALA NYERI', '', 0, 'L', $fill);
            $pdf->Ln(2.75);
            $pdf->SetFont('Arial', '', '9');
            $pdf->Cell(1, .5, '', '', 0, 'L', $fill);
            
            for($a = 0; $a <= 10; $a++){
                $pdf->Cell(1, .5, '', ($sql_medc_ass->skala_nyeri == $a ? '1' : ''), 0, 'L', $fill);
            }
            
            # Skala Nyeri
            $pdf->Image($gambar3,1.5,16.75,11.75,3);
            $pdf->Ln(1);
            $pdf->SetFont('Arial', 'B', '9');
            $pdf->Cell(19, .5, '5.  ASUHAN KEPERAWATAN', '', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->Cell(9.5, .5, 'Masalah Keperawatan', '', 0, 'L', $fill);
            $pdf->Cell(9.5, .5, 'Tujuan Terukur', '', 0, 'L', $fill);
            $pdf->Ln();
            
            $pdf->SetFont('Arial', '', '9');
            $x = $pdf->GetX() + 9.5;
            $y = $pdf->GetY();            
            
            $pdf->MultiCell(9.5, .5, $sql_medc_ass->askep_masalah, '', 'J');
            $pdf->SetXY($x, $y); // Mengatur posisi X dan Y baru
            $pdf->MultiCell(9.5, .5, $sql_medc_ass->askep_tujuan, '', 'J');
            $x += 5;
            
//            
////            $pdf->SetFont('Arial', 'B', '8');
////            $pdf->Cell(4, .5, 'ICD 10', '', 0, 'L', $fill);
////            $pdf->Cell(.5, .5, ':', '', 0, 'C', $fill);
////            $pdf->Ln();
//            
//            $n = 1;
//            foreach ($sql_medc_icd as $icd){
//                if($n == 1){
//                    $pdf->SetFont('Arial', 'B', '8');
//                    $pdf->Cell(4, .5, 'ICD 10', '', 0, 'L', $fill);
//                    $pdf->Cell(.5, .5, ':', '', 0, 'C', $fill);
//                }else{
//                    $pdf->SetFont('Arial', '', '8');
//                    $pdf->Cell(4.5, .5, '', '', 0, 'L', $fill);
//                }
//                $pdf->SetFont('Arial', '', '8');
//                $pdf->Cell(14.5, .5, '- '.$icd->diagnosa_en, '', 0, 'L', $fill);
//                $pdf->Ln();
//                
//                $n++;
//            }
//            $pdf->Ln();
//            
//            $pdf->SetFont('Arial', 'B', '8');
//            $pdf->Cell(19, .5, 'TERAPI PULANG', 'TB', 0, 'C', $fill);
//            $pdf->Ln(); 
//            
//            $pdf->Cell(1, .5, 'No.', 'B', 0, 'C', $fill);
//            $pdf->Cell(6, .5, 'Nama Obat', 'B', 0, 'L', $fill);
//            $pdf->Cell(12, .5, 'Catatan', 'B', 0, 'L', $fill);
//            $pdf->Ln();    
//            
//            $fill = FALSE;
//            $no_trp = 1;
//            foreach ($sql_medc_res_det as $trp){
////                $pdf->SetFont('Arial', '', 8);
//////                $pdf->Cell(1, 0.5, $no_trp, 'LR', 0, 'C', $fill);
////
////                $x = $pdf->GetX() + 1; // Mengambil posisi X saat ini dan menambahkan offset
////                $y = $pdf->GetY(); // Mengambil posisi Y saat ini
////
////                $pdf->SetXY($x, $y); // Mengatur posisi X dan Y baru
////
////                $pdf->MultiCell(1, 0.5, $no_trp, 'LR', 'C', $fill);
////                $x += 0;
////                $pdf->MultiCell(6, 0.5, $trp->param, 'R', 'L', $fill);
////                $x += 5; // Menambahkan offset X untuk selanjutnya
////
////                $pdf->SetXY($x, $y); // Mengatur posisi X dan Y baru
////
////                $pdf->MultiCell(12, 0.5, $trp->param_nilai, 'R', 'L', $fill);
////
////                $pdf->SetFont('Arial', '', '8');
////                $pdf->Cell(1, .5, $no_trp, '', 0, 'C', $fill);
////                $pdf->Cell(6, .5, ucwords($trp->param), '', 0, 'L', $fill);
//////                $pdf->SetFont('Arial', '', '8');
//////                $pdf->Cell(12, .5, $trp->param_nilai, 'R', 0, 'L', $fill);
////                $pdf->MultiCell(12, .5, str_replace('#', ' ', $trp->param_nilai), '', 'L', $fill,$pdf->GetX(),15);
//////                $pdf->Ln();
//
//
//                $pdf->SetFont('Arial', '', '8');
//                $pdf->Cell(1, .5, $no_trp, '', 0, 'C', $fill);
//                $pdf->Cell(6, .5, ucwords($trp->item), '', 0, 'L', $fill);
//                $pdf->MultiCell(12, .5, $trp->dosis.' '.(!empty($trp->dosis_ket) ? '('.$trp->dosis_ket.')' : '').(!empty($trp->keterangan) ? ' / '.$trp->keterangan : ''), '', 'L', $fill,$pdf->GetX(),15);
//                
//                $no_trp++;
//            }
//            $pdf->Cell(19, .5, '', 'T', 0, 'L', $fill);

//            // QR GENERATOR VALIDASI
//            $qr_validasi        = FCPATH.'/file/pasien/'.strtolower($kode_pasien).'/qr-validasi-'.strtolower($kode_pasien).'.png';
////            $params['data']     = 'https://verify.esensia.co.id/?id='.general::enkrip($sql_medc_srt->id).'&id_pasien='.general::enkrip($sql_pasien->id).'&role=surat';
//            $params['data']     = 'Telah diverifikasi dan ditandatangani secara elektronik oleh manajemen '.$setting->judul.'. Pasien a/n. ';
////            $params['data']    .= strtoupper($sql_pasien->nama_pgl).' ('.strtoupper($kode_pasien).')';
//            $params['level']    = 'H';
//            $params['size']     = 2;
//            $params['savename'] = $qr_validasi; 
//            $this->ciqrcode->generate($params);
//            
//            $gambar4            = $qr_validasi; 
//                        
//            // QR GENERATOR DOKTER
//            $qr_dokter          = FCPATH.'/file/pasien/'.strtolower($kode_pasien).'/qr-dokter-'.strtolower($sql_dokter->id).'.png';
//            $params['data']     = 'Telah diverifikasi dan ditandatangani secara elektronik oleh dokter penanggung jawab ['.(!empty($sql_dokter->nama_dpn) ? $sql_dokter->nama_dpn.' ' : '').$sql_dokter->nama.(!empty($sql_dokter->nama_blk) ? ', '.$sql_dokter->nama_blk : '').']';
//            $params['level']    = 'H';
//            $params['size']     = 2;
//            $params['savename'] = $qr_dokter;
//            $this->ciqrcode->generate($params);
//            
//            $gambar5            = $qr_dokter;
//            
//            // Gambar VALIDASI
//            $getY = $pdf->GetY() + 1;
//            $pdf->Image($gambar4,2,$getY,2,2);
//            $pdf->Image($gambar5,13.80,$getY,2,2);
//            
//            $pdf->SetFont('Arial', '', '9');
//            $pdf->Cell(10.5, .5, '', '', 0, 'L', $fill);
//            $pdf->Cell(8.5, .5, '', '', 0, 'L', $fill);
//            $pdf->Ln();
//            $pdf->SetFont('Arial', 'B', '9');
//            $pdf->Cell(4, .5, 'Petugas', '0', 0, 'C', $fill);
//            $pdf->Cell(6.5, .5, '', '0', 0, 'C', $fill);
//            $pdf->SetFont('Arial', '', '9');
//            $pdf->Cell(8.5, .5, 'Semarang, '.$this->tanggalan->tgl_indo3($sql_medc_rsm->tgl_masuk), '0', 0, 'C', $fill);
//            $pdf->Ln(2.5);
//            
//            $pdf->SetFont('Arial', '', '9');
//            $pdf->Cell(10.5, .5, $this->ion_auth->user($sql_medc_rsm->id_user)->row()->first_name, '0', 0, 'L', $fill);
//            $pdf->Cell(8.5, .5, (!empty($sql_dokter->nama_dpn) ? $sql_dokter->nama_dpn.' ' : '').$sql_dokter->nama.(!empty($sql_dokter->nama_blk) ? ', '.$sql_dokter->nama_blk.' ' : ''), '0', 0, 'C', $fill);
//            $pdf->Ln();
                    
            $pdf->SetFillColor(235, 232, 228);
            $pdf->SetTextColor(0);
            $pdf->SetFont('Arial', '', '8');
            
            $type = (isset($_GET['type']) ? $_GET['type'] : 'I');
            
            ob_start();
            $pdf->Output($sql_pasien->nama_pgl. '.pdf', $type);
            ob_end_flush();
//            
//            $sql_cek_file = $this->db->where('id_resume', $sql_medc_rsm->id)->get('tbl_trans_medcheck_file');
//            
//            if($sql_cek_file->num_rows() == 0){
//                $this->load->helper('download');
//                
//               $folder      = realpath('./file/pasien/'.$kode_pasien);
//               $filename    = $folder.'/kontol.pdf';
//               $fdata       = (base_url('medcheck/surat/cetak_pdf_rsm_rnp.php?id='.$id_medcheck.'&id_resm='.$id_rsm));
//               $fbase64     = 'data:application/pdf;base64,'.base64_encode(file_get_contents($pdf->Output($sql_pasien->nama_pgl. '.pdf', $type)));
//                
//                $data_file = array(
//                   'id_medcheck'   => $sql_medc->id,
//                   'id_pasien'     => $sql_medc->id_pasien,
//                   'id_user'       => $this->ion_auth->user()->row()->id,
//                   'tgl_simpan'    => date('Y-m-d H:i:s'),
//                   'tgl_masuk'     => date('Y-m-d H:i'),
//                   'judul'         => 'ppp',
//                   'keterangan'    => 'hhh',
////                   'file_name_ori' => $f['client_name'],
//                   'file_name'     => $filename,
//                   'file_ext'      => $f['file_ext'],
//                   'file_type'     => $f['file_type'],
//                   'file_base64'   => '-',
//                   'status'        => '1',
//               );
//                
//                crud::simpan('tbl_trans_medcheck_file', $data_file);
//                
//                force_download($filename, $fdata);
//            }
//            
//                        $data_file = array(
//                            'id_medcheck'   => $sql_medc->id,
//                            'id_pasien'     => $sql_medc->id_pasien,
//                            'id_user'       => $this->ion_auth->user()->row()->id,
//                            'tgl_simpan'    => date('Y-m-d H:i:s'),
//                            'tgl_masuk'     => date('Y-m-d H:i'),
//                            'judul'         => $judul,
//                            'keterangan'    => $ket,
//                            'file_name_ori' => $f['client_name'],
//                            'file_name'     => $f['file_name'],
//                            'file_ext'      => $f['file_ext'],
//                            'file_type'     => $f['file_type'],
////                            'file_base64'   => $file64,
//                            'status'        => '1',
//                        );
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }
    

    
    public function pdf_medcheck_ass_fisik() {
        if (akses::aksesLogin() == TRUE) {
            $setting             = $this->db->get('tbl_pengaturan')->row();
            $id_medcheck         = $this->input->get('id');
            $id_lab              = $this->input->get('id_ass');
            $status_ctk          = $this->input->get('status_ctk');
 
            $sql_medc            = $this->db->where('id', general::dekrip($id_medcheck))->get('tbl_trans_medcheck')->row();
            $sql_medc_srt        = $this->db->where('id', general::dekrip($id))->get('tbl_trans_medcheck_surat')->row(); 
            $sql_medc_lab        = $this->db->where('id', general::dekrip($id_lab))->get('tbl_trans_medcheck_ass_fisik')->row();
            
            # Blok Assesment Fisik
            $sql_medc_ass1L      = $this->db->where('id_medcheck_ass', $sql_medc_lab->id)->where('status_posisi', 'L')->where('tipe', '1')->get('tbl_trans_medcheck_ass_fisik_hsl')->result();
            $sql_medc_ass1R      = $this->db->where('id_medcheck_ass', $sql_medc_lab->id)->where('status_posisi', 'R')->where('tipe', '1')->get('tbl_trans_medcheck_ass_fisik_hsl')->result();
            $sql_medc_ass2       = $this->db->where('id_medcheck_ass', $sql_medc_lab->id)->where('tipe', '2')->get('tbl_trans_medcheck_ass_fisik_hsl')->result();
            $sql_medc_ass3L      = $this->db->where('id_medcheck_ass', $sql_medc_lab->id)->where('status_posisi', 'L')->where('tipe', '3')->get('tbl_trans_medcheck_ass_fisik_hsl')->result();
            $sql_medc_ass3R      = $this->db->where('id_medcheck_ass', $sql_medc_lab->id)->where('status_posisi', 'R')->where('tipe', '3')->get('tbl_trans_medcheck_ass_fisik_hsl')->result();
            $sql_medc_ass4       = $this->db->where('id_medcheck_ass', $sql_medc_lab->id)->where('tipe', '4')->get('tbl_trans_medcheck_ass_fisik_hsl')->result();
            $sql_medc_ass5L      = $this->db->where('id_medcheck_ass', $sql_medc_lab->id)->where('tipe', '5')->where('status_posisi', 'L')->get('tbl_trans_medcheck_ass_fisik_hsl')->result();
            $sql_medc_ass5R      = $this->db->where('id_medcheck_ass', $sql_medc_lab->id)->where('tipe', '5')->where('status_posisi', 'R')->get('tbl_trans_medcheck_ass_fisik_hsl')->result();
            $sql_medc_ass6       = $this->db->where('id_medcheck_ass', $sql_medc_lab->id)->where('tipe', '6')->get('tbl_trans_medcheck_ass_fisik_hsl')->result();
            $sql_medc_ass7       = $this->db->where('id_medcheck_ass', $sql_medc_lab->id)->where('tipe', '7')->get('tbl_trans_medcheck_ass_fisik_hsl')->result();
            $sql_medc_ass8       = $this->db->where('id_medcheck_ass', $sql_medc_lab->id)->where('tipe', '8')->get('tbl_trans_medcheck_ass_fisik_hsl')->result();
            $sql_medc_ass9       = $this->db->where('id_medcheck_ass', $sql_medc_lab->id)->where('tipe', '9')->get('tbl_trans_medcheck_ass_fisik_hsl')->result();
            $sql_medc_ass10      = $this->db->where('id_medcheck_ass', $sql_medc_lab->id)->where('tipe', '10')->get('tbl_trans_medcheck_ass_fisik_hsl')->result();
            $sql_medc_ass11      = $this->db->limit(5)->where('id_medcheck_ass', $sql_medc_lab->id)->where('tipe', '11')->get('tbl_trans_medcheck_ass_fisik_hsl')->result();
            $sql_medc_ass12      = $this->db->limit(5)->where('id_medcheck_ass', $sql_medc_lab->id)->where('tipe', '12')->get('tbl_trans_medcheck_ass_fisik_hsl')->result();
            $sql_medc_ass13A     = $this->db->where('id_medcheck_ass', $sql_medc_lab->id)->where('status_posisi', 'L')->where('tipe', '13')->get('tbl_trans_medcheck_ass_fisik_hsl')->result();
            $sql_medc_ass13B     = $this->db->where('id_medcheck_ass', $sql_medc_lab->id)->where('status_posisi', 'R')->where('tipe', '13')->get('tbl_trans_medcheck_ass_fisik_hsl')->result();
            $sql_medc_ass14L     = $this->db->where('id_medcheck_ass', $sql_medc_lab->id)->where('status_posisi', 'L')->where('tipe', '14')->get('tbl_trans_medcheck_ass_fisik_hsl')->result();
            $sql_medc_ass14R     = $this->db->where('id_medcheck_ass', $sql_medc_lab->id)->where('status_posisi', 'R')->where('tipe', '14')->get('tbl_trans_medcheck_ass_fisik_hsl')->result();
            $sql_medc_ass15      = $this->db->where('id_medcheck_ass', $sql_medc_lab->id)->where('tipe', '15')->get('tbl_trans_medcheck_ass_fisik_hsl')->result();
            $sql_medc_ass16      = $this->db->where('id_medcheck_ass', $sql_medc_lab->id)->where('tipe', '16')->get('tbl_trans_medcheck_ass_fisik_hsl')->result();
            # --- END --
            
            $sql_poli            = $this->db->where('id', $sql_medc->id_poli)->get('tbl_m_poli')->row();
            $sql_pasien          = $this->db->where('id', $sql_medc->id_pasien)->get('tbl_m_pasien')->row(); 
            $sql_pekerjaan       = $this->db->where('id', $sql_pasien->id_pekerjaan)->get('tbl_m_jenis_kerja')->row();
            $sql_dokter          = $this->db->where('id_user', (!empty($sql_medc_lab->id_dokter) ? $sql_medc_lab->id_dokter : $sql_medc->id_dokter))->get('tbl_m_karyawan')->row();
            $sql_dokter2         = $this->db->where('id_user', '221')->get('tbl_m_karyawan')->row();
            $kode_pasien         = $sql_pasien->kode_dpn.$sql_pasien->kode;
            $gambar1             = FCPATH.'/assets/theme/admin-lte-3/dist/img/logo-esensia-2.png'; // base_url('assets/theme/admin-lte-3/dist/img/logo-esensia-2.png');
            $gambar2             = FCPATH.'/assets/theme/admin-lte-3/dist/img/logo-bw-bg2-1440px.png'; // base_url('assets/theme/admin-lte-3/dist/img/logo-bw-bg2-1440px.png');
            $gambar3             = FCPATH.'/assets/theme/admin-lte-3/dist/img/logo-footer.png'; // base_url('assets/theme/admin-lte-3/dist/img/logo-footer.png');
            $sess_print          = $this->session->userdata('lab_print');
            
            $judul              = "DAFTAR RIWAYAT KESEHATAN";
            $judul2             = "Laboratory Result";

            $this->load->library('MedLabPDF');
            $pdf = new MedLabPDF('P', 'cm', array(21.5,33));
            $pdf->SetAutoPageBreak('auto', 5.5);
            $pdf->SetMargins(1,0.35,1);
            $pdf->header = 0;
            $pdf->addPage('','',false);
            
            # Gambar Watermark Tengah
            $pdf->Image($gambar2,5,4,15,19);  
            
            # Blok Judul
            $pdf->SetFont('Arial', 'B', '13');
            $pdf->Cell(19, .5, $judul, 0, 1, 'C');
//            $pdf->Ln(0);
//            $pdf->SetFont('Arial', 'Bi', '13');
//            $pdf->Cell(19, .5, $judul2, 'B', 1, 'C');
            $pdf->Ln();
            
            # Blok ID PASIEN
            $pdf->SetFont('Arial', '', '9');
            $pdf->Cell(3, .5, 'No. Pemeriksaan', '0', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
            $pdf->Cell(4.5, .5, $sql_medc_lab->no_lab, '0', 0, 'L', $fill);
            $pdf->Cell(2.5, .5, 'No. RM', '0', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
            $pdf->Cell(8, .5, $sql_pasien->kode_dpn.$sql_pasien->kode, '0', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->Cell(3, .5, 'No. Sampel', '0', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
            $pdf->Cell(4.5, .5, $sql_medc_lab->no_sample, '0', 0, 'L', $fill);
            $pdf->Cell(2.5, .5, 'Nama', '0', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
            $pdf->Cell(8, .5, general::bersih($sql_pasien->nama_pgl).' ('.$sql_pasien->jns_klm.')', '0', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->Cell(3, .5, 'Tgl Periksa', '0', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
            $pdf->Cell(4.5, .5, $this->tanggalan->tgl_indo5($sql_medc_lab->tgl_masuk), '0', 0, 'L', $fill);
            $pdf->Cell(2.5, .5, 'NIK', '0', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
            $pdf->Cell(8, .5, $sql_pasien->nik, '0', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->Cell(3, .5, 'Poli', '0', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
            $pdf->Cell(4.5, .5, $sql_poli->lokasi, '0', 0, 'L', $fill);
            $pdf->Cell(2.5, .5, 'Tgl Lahir', '0', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
            $pdf->Cell(8, .5, $this->tanggalan->tgl_indo2($sql_pasien->tgl_lahir).' / '.$this->tanggalan->usia_lkp($sql_pasien->tgl_lahir), '0', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->Cell(3, .5, 'Alamat', '0', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
            $pdf->MultiCell(15.5, .5, (!empty($sql_pasien->alamat) ? general::bersih($sql_pasien->alamat) : (!empty($sql_pasien->alamat_dom) ? $sql_pasien->alamat_dom : '-')), '0', 'L');
            $pdf->Cell(3, .5, 'No. HP / Rmh', '0', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
            $pdf->MultiCell(15.5, .5, $sql_pasien->no_hp.(!empty($penj->no_telp) ? ' / '.$penj->no_telp : ''), '0', 'L');
            $pdf->Cell(3, .5, 'Dokter Pengirim', '0', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
            $pdf->MultiCell(15.5, .5, (!empty($sql_dokter->nama_dpn) ? $sql_dokter->nama_dpn.' ' : '').$sql_dokter->nama.(!empty($sql_dokter->nama_blk) ? ', '.$sql_dokter->nama_blk : ''), '0', 'L');
            $pdf->Ln();
            
            $pdf->SetFont('Arial', 'B', '9');
            $pdf->Cell(19, .5, 'Anamnesa', '0', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->SetFont('Arial', 'i', '9');
            $pdf->Cell(19, .5, 'Riwayat Kesehatan Pribadi ( berikan tanda V pada pilihan anda )', '0', 0, 'L', $fill);
            $pdf->Ln();
            
            # Blok Grup 1
            $fill = FALSE;
            
            $pdf->SetFont('Arial', 'B', '9');
            $pdf->Cell(7, .5, 'Penyakit / Keluhan', '1', 0, 'C', $fill);
            $pdf->Cell(1, .5, 'Ya', '1', 0, 'C', $fill);
            $pdf->Cell(1, .5, 'Tidak', '1', 0, 'C', $fill);
            $pdf->Cell(1, .5, '', '0', 0, 'C', $fill);
            $pdf->Cell(7, .5, 'Penyakit / Keluhan', '1', 0, 'C', $fill);
            $pdf->Cell(1, .5, 'Ya', '1', 0, 'C', $fill);
            $pdf->Cell(1, .5, 'Tidak', '1', 0, 'C', $fill);
            $pdf->Ln();
            $pdf->SetFont('Arial', '', '9');
            
            foreach ($sql_medc_ass1L as $ass1L) {
                $pdf->Cell(7, .5, $ass1L->item_name, 'BL', 0, 'L', $fill);
                $pdf->Cell(1, .5, ($ass1L->item_value == '1' ? 'V' : ''), 'BL', 0, 'C', $fill);
                $pdf->Cell(1, .5, ($ass1L->item_value == '0' ? 'V' : ''), 'BLR', 0, 'C', $fill);
                $pdf->Cell(1, .5, '', '0', 0, 'C', $fill);
                $pdf->Ln();
            }
//            $pdf->Ln();
            
            $setY = 9.1;
            foreach ($sql_medc_ass1R as $ass1R) {
                $pdf->SetXY(11,$setY);
                $pdf->Cell(7, .5, $ass1R->item_name, 'BL', 0, 'L', $fill);
                $pdf->Cell(1, .5, ($ass1R->item_value == '1' ? 'V' : ''), 'BL', 0, 'C', $fill);
                $pdf->Cell(1, .5, ($ass1R->item_value == '0' ? 'V' : ''), 'BLR', 0, 'C', $fill);
                $pdf->Cell(1, .5, '', '0', 0, 'C', $fill);
                $pdf->Ln();
                
                $setY+=0.5;
            }

            $pdf->Cell(9, .5, '', 'T', 0, 'C', $fill);
            $pdf->Cell(1, .5, '', '', 0, 'C', $fill);
            $pdf->Cell(9, .5, '', 'T', 0, 'C', $fill);
            $pdf->Ln();
            
            # Blok Grup 15 Kebiasaan sehari2, harusnya nomer 2 tapi ketinggalan sehingga di taruh sini            
            $pdf->SetFont('Arial', '', '9');
            foreach ($sql_medc_ass15 as $ass15){                
                $pdf->Cell(7, .5, $ass15->item_name, '', 0, 'L', $fill);
                $pdf->Cell(.5, .5, ':', '', 0, 'C', $fill);
                $pdf->Cell(11.5, .5, $ass15->item_value2, '', 0, 'L', $fill);
                $pdf->Ln();
            }
            $pdf->Ln();
            # ----------------------------------------------------------------------------------------
            
            # Blok Grup 16 Kebiasaan merokok, harusnya nomer 3 tapi ketinggalan sehingga di taruh sini
            $pdf->SetFont('Arial', 'B', '9');
            $pdf->Cell(7, .5, 'Kebiasaan sehari-hari', '1', 0, 'L', $fill);
            $pdf->Cell(1, .5, 'Ya', 'TLB', 0, 'C', $fill);
            $pdf->Cell(1, .5, 'Tidak', 'TLB', 0, 'C', $fill);
            $pdf->Cell(10, .5, 'Keterangan', '1', 0, 'L', $fill);
            $pdf->Ln();
            
            $pdf->SetFont('Arial', '', '9');
            foreach ($sql_medc_ass16 as $ass16){                
                $pdf->Cell(7, .5, $ass16->item_name, 'BLR', 0, 'L', $fill);
                $pdf->Cell(1, .5, (!empty($ass16->item_value) ? 'V' : ''), 'BL', 0, 'C', $fill);
                $pdf->Cell(1, .5, (empty($ass16->item_value2) ? 'V' : ''), 'BL', 0, 'C', $fill);
                $pdf->Cell(10, .5, $ass16->item_value2, 'BLR', 0, 'L', $fill);
                $pdf->Ln();
            }
            $pdf->Cell(19, .5, '', 'T', 0, 'C', $fill);
            $pdf->Ln();
            # --------------
            
            # ISI BLOK 2
            $pdf->SetFont('Arial', 'i', '9');
            $pdf->Cell(19, .5, 'Riwayat Kesehatan Orang Tua ( berikan tanda v pada pilihan anda )', '0', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->SetFont('Arial', 'B', '9');
            $pdf->Cell(7, .5, 'Penyakit / Keluhan', '1', 0, 'L', $fill);
            $pdf->Cell(1, .5, 'Ya', '1', 0, 'C', $fill);
            $pdf->Cell(1, .5, 'Tidak', '1', 0, 'C', $fill);
            $pdf->Cell(10, .5, 'Jika ya, jelaskan', '1', 0, 'L', $fill);
            $pdf->Ln();
            
            $pdf->SetFont('Arial', '', '9');
            foreach ($sql_medc_ass2 as $ass2) {
                $pdf->Cell(7, .5, $ass2->item_name, 'BL', 0, 'L', $fill);
                $pdf->Cell(1, .5, (!empty($ass2->item_value2) ? 'V' : ''), 'BL', 0, 'C', $fill);
                $pdf->Cell(1, .5, (empty($ass2->item_value2) ? 'V' : ''), 'BL', 0, 'C', $fill);
                $pdf->Cell(10, .5, $ass2->item_value2, 'BLR', 0, 'L', $fill);
                $pdf->Ln();
            }
            
            $pdf->Cell(19, .5, '', 'T', 0, 'C', $fill);
            $pdf->Ln();
            # --- END BLOK 2 --
            
            # ISI BLOK 3
            $pdf->SetFont('Arial', 'i', '9');
            $pdf->Cell(19, .5, 'Pemeriksaan Fisik', '0', 0, 'L', $fill);
            $pdf->Ln();
            
            foreach ($sql_medc_ass3L as $ass3L) {
                $bb  = $this->db->where('id_medcheck_ass', $ass3L->id_medcheck_ass)->where('id_item', '36')->get('tbl_trans_medcheck_ass_fisik_hsl')->row()->item_value2;
                $tb  = $this->db->where('id_medcheck_ass', $ass3L->id_medcheck_ass)->where('id_item', '35')->get('tbl_trans_medcheck_ass_fisik_hsl')->row()->item_value2 / 100;
                $imt = $bb / ($tb * $tb);
                        
                $pdf->SetFont('Arial', 'B', '9');
                $pdf->Cell(4, .5, $ass3L->item_name, '0', 0, 'L', $fill);
                $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
                $pdf->SetFont('Arial', '', '9');
                $pdf->Cell(1, .5, ($ass3L->id_item == 37 ? (!empty($imt) ? general::format_angka($imt, 2) : '') : $ass3L->item_value2), '0', 0, 'L', $fill);
                $pdf->Cell(4.5, .5, $ass3L->item_value3, '0', 0, 'L', $fill);
                $pdf->Ln();
            }
            $pdf->Ln();
            
            $setYAss3R = 25.1;
            foreach ($sql_medc_ass3R as $ass3R) {
                $pdf->SetXY(10.5,$setYAss3R);
                $pdf->SetFont('Arial', 'B', '9');
                $pdf->Cell(3, .5, $ass3R->item_name, '0', 0, 'L', $fill);
                $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
                $pdf->SetFont('Arial', '', '9');
                $pdf->Cell(2, .5, ($ass3R->id_item == 37 ? general::format_angka($imt, 2) : $ass3R->item_value2), '0', 0, 'L', $fill);
                $pdf->Cell(4.5, .5, $ass3R->item_value3, '0', 0, 'L', $fill);
                $pdf->Ln();
                
                $setYAss3R += 0.5;
            }
            $pdf->Ln();
            # --- END BLOK 3 --
            
            # ISI BLOK 4
            $pdf->SetFont('Arial', 'B', '9');
            $pdf->Cell(6.33, .5, '1. Pemeriksaan Mata', 'TL', 0, 'L', $fill);
            $pdf->Cell(6.33, .5, '2. Pemeriksaan THT-KL', 'T', 0, 'L', $fill);
            $pdf->Cell(6.33, .5, '', 'TR', 0, 'L', $fill);
            $pdf->Ln();
            
            $pdf->SetFont('Arial', '', '9');
            foreach ($sql_medc_ass4 as $ass4) {
                $pdf->Cell(3, .5, $ass4->item_name, 'L', 0, 'L', $fill);
                $pdf->Cell(.33, .5, ':', '', 0, 'C', $fill);
                $pdf->Cell(1, .5, $ass4->item_value2, '', 0, '', $fill);
                $pdf->Cell(2, .5, $ass4->item_value3, '', 0, 'R', $fill);
                $pdf->Ln();
            }
            
            $pdf->Cell(3, .5, '', 'L', 0, 'L', $fill);
            $pdf->Cell(.33, .5, '', '', 0, 'L', $fill);
            $pdf->Cell(3, .5, '', '', 0, 'L', $fill);
            # --- END BLOK 4 --
            
            # ISI BLOK 5
////            $pdf->SetXY(7.33,3.1);
//            $pdf->SetFont('Arial', 'i', '9');
//            $pdf->Cell(12.66, .5, 'Pemeriksaan THT-KLT', '1', 0, 'L', $fill);
//            $pdf->Ln();
            
            $setYAss5L = 3.1;
            foreach ($sql_medc_ass5L as $ass5L) {
                $pdf->SetXY(7.33,$setYAss5L);
                $pdf->Cell(3, .5, $ass5L->item_name, '', 0, 'L', $fill);
                $pdf->Cell(.33, .5, ':', '', 0, 'C', $fill);
                $pdf->Cell(3, .5, $ass5L->item_value2, '', 0, 'L', $fill);
                $pdf->Ln();
                
                $setYAss5L += 0.5;
            }
            $pdf->Ln();
            
            $setYAss5R = 3.1;
            foreach ($sql_medc_ass5R as $ass5R) {
                $pdf->SetXY(13.66,$setYAss5R);                
                $pdf->Cell(3, .5, $ass5R->item_name, '', 0, 'L', $fill);
                $pdf->Cell(.33, .5, ':', '', 0, 'C', $fill);
                $pdf->Cell(3, .5, $ass5R->item_value2, 'R', 0, 'L', $fill);
                $pdf->Ln();
                
                $setYAss5R += 0.5;
            }
            $pdf->SetXY(13.66,$setYAss5R);
            $pdf->Cell(3, .5, '', '', 0, 'L', $fill);
            $pdf->Cell(.33, .5, '', '', 0, 'L', $fill);
            $pdf->Cell(3, .5, '', 'R', 0, 'L', $fill);
            # --- END BLOK 5 --
            
            # ISI BLOK 6
            $setYAss6 = $setYAss5R + 0.5;
            $pdf->SetXY(1,$setYAss6);
            $pdf->SetFont('Arial', 'B', '9');
            $pdf->Cell(6.33, .5, '3. Pemeriksaan Thorax', 'L', 0, 'L', $fill);
            $pdf->Cell(6.33, .5, '4. Pemeriksaan Paru', '', 0, 'L', $fill);
            $pdf->Cell(6.33, .5, '5. Pemeriksaan Jantung', 'R', 0, 'L', $fill);
            $pdf->Ln();
            
            $pdf->SetFont('Arial', '', '9');
            foreach ($sql_medc_ass6 as $ass6) { 
                $pdf->Cell(3, .5, $ass6->item_name, 'L', 0, 'L', $fill);
                $pdf->Cell(.33, .5, ':', '', 0, 'C', $fill);
                $pdf->Cell(3, .5, $ass6->item_value2, '', 0, 'L', $fill);
                $pdf->Ln();
            }
            # --- END BLOK 6 --
            
            # ISI BLOK 7 DAN 8 
            $setYAss7 = 6.1;
            $pdf->SetFont('Arial', '', '9');
            foreach ($sql_medc_ass7 as $ass7) {
                $pdf->SetXY(7.33,$setYAss7);
                $pdf->Cell(3, .5, $ass7->item_name, '', 0, 'L', $fill);
                $pdf->Cell(.33, .5, ':', '', 0, 'C', $fill);
                $pdf->Cell(3, .5, $ass7->item_value2, '', 0, 'L', $fill);
                $pdf->Ln();
                
                $setYAss7 += 0.5;
            }
            $pdf->Ln();
            
            $setYAss8 = 6.1;
            $pdf->SetFont('Arial', '', '9');
            foreach ($sql_medc_ass8 as $ass8) {
                $pdf->SetXY(13.66,$setYAss8);
                $pdf->Cell(3, .5, $ass8->item_name, '', 0, 'L', $fill);
                $pdf->Cell(.33, .5, ':', '', 0, 'C', $fill);
                $pdf->Cell(3, .5, $ass8->item_value2, 'R', 0, 'L', $fill);
                $pdf->Ln();
                
                $setYAss8 += 0.5;
            }
            # --- END BLOK 7 DAN 8 --
            
            # ISI BLOK 9 DAN 10
            $pdf->SetFont('Arial', 'B', '9');
            $pdf->Cell(6.33, .5, '6. Pemeriksaan Abdomen', 'L', 0, 'L', $fill);
            $pdf->Cell(6.33, .5, '7. Pemeriksaan Urogenital', '', 0, 'L', $fill);
            $pdf->Cell(6.33, .5, '8. Pemeriksaan Psikiatri', 'R', 0, 'L', $fill);
            $pdf->Ln();
            
            $pdf->SetFont('Arial', '', '9');
            foreach ($sql_medc_ass9 as $ass9) {
                $pdf->Cell(3, .5, $ass9->item_name, 'L', 0, 'L', $fill);
                $pdf->Cell(.33, .5, ':', '', 0, 'C', $fill);
                $pdf->Cell(3, .5, $ass9->item_value2, '', 0, 'L', $fill);
                $pdf->Ln();
            }
            $pdf->Ln();
            
            $setYAss10 = 8.6;
            $pdf->SetFont('Arial', '', '9');
            foreach ($sql_medc_ass10 as $ass10) {
                $pdf->SetXY(7.33,$setYAss10);
                $pdf->Cell(3, .5, $ass10->item_name, '', 0, '', $fill);
                $pdf->Cell(.33, .5, ':', '', 0, 'C', $fill);
                $pdf->Cell(3, .5, $ass10->item_value2, '', 0, 'L', $fill);
                $pdf->Ln();
                
                $setYAss10 += 0.5;
            }
            
            $pdf->SetXY(7.33,$setYAss10);
            $pdf->Cell(3, .5, '', '', 0, 'L', $fill);
            $pdf->Cell(.33, .5, '', '', 0, 'L', $fill);
            $pdf->Cell(3, .5, '', '', 0, 'L', $fill);
            $pdf->SetXY(7.33,$setYAss10 + 0.5);
            $pdf->Cell(3, .5, '', '', 0, 'L', $fill);
            $pdf->Cell(.33, .5, '', '', 0, 'L', $fill);
            $pdf->Cell(3, .5, '', '', 0, 'L', $fill);
            # --- END BLOK 9 DAN 10 --
            
            # ISI BLOK 12
            $setYAss12 = 8.6;
            $pdf->SetFont('Arial', '', '9');           
            foreach ($sql_medc_ass12 as $ass12) {
                $pdf->SetXY(13.66,$setYAss12);
                $pdf->Cell(3, .5, $ass12->item_name, '', 0, 'L', $fill);
                $pdf->Cell(.33, .5, ':', '', 0, 'C', $fill);
                $pdf->Cell(3, .5, $ass12->item_value2, 'R', 0, 'L', $fill);
                $pdf->Ln();
                
                $setYAss12 += 0.5;
            }
            $pdf->SetXY(13.66,$setYAss12);
            $pdf->Cell(3, .5, '', '', 0, 'L', $fill);
            $pdf->Cell(.33, .5, '', '', 0, 'L', $fill);
            $pdf->Cell(3, .5, '', 'R', 0, 'L', $fill);
            $pdf->SetXY(13.66,$setYAss12 + 0.5);
            $pdf->Cell(3, .5, '', '', 0, 'L', $fill);
            $pdf->Cell(.33, .5, '', '', 0, 'L', $fill);
            $pdf->Cell(3, .5, '', 'R', 0, 'L', $fill);
            $pdf->Ln();
            
            # ISI BLOK 11 DAN 12
            $sens_a = $this->db->where('id_medcheck_ass', $sql_medc_lab->id)->where('id_item', '84')->get('tbl_trans_medcheck_ass_fisik_hsl')->row();
            $sens_b = $this->db->where('id_medcheck_ass', $sql_medc_lab->id)->where('id_item', '85')->get('tbl_trans_medcheck_ass_fisik_hsl')->row();
            $sens_c = $this->db->where('id_medcheck_ass', $sql_medc_lab->id)->where('id_item', '86')->get('tbl_trans_medcheck_ass_fisik_hsl')->row();
            $sens_d = $this->db->where('id_medcheck_ass', $sql_medc_lab->id)->where('id_item', '87')->get('tbl_trans_medcheck_ass_fisik_hsl')->row();
            $moto_a = $this->db->where('id_medcheck_ass', $sql_medc_lab->id)->where('id_item', '80')->get('tbl_trans_medcheck_ass_fisik_hsl')->row();
            $moto_b = $this->db->where('id_medcheck_ass', $sql_medc_lab->id)->where('id_item', '81')->get('tbl_trans_medcheck_ass_fisik_hsl')->row();
            $moto_c = $this->db->where('id_medcheck_ass', $sql_medc_lab->id)->where('id_item', '82')->get('tbl_trans_medcheck_ass_fisik_hsl')->row();
            $moto_d = $this->db->where('id_medcheck_ass', $sql_medc_lab->id)->where('id_item', '83')->get('tbl_trans_medcheck_ass_fisik_hsl')->row();
            
            $pdf->SetXY(1,$setYAss10 + 1);
            $pdf->SetFont('Arial', 'B', '9');
            $pdf->Cell(19, .5, '9. Pemeriksaan Ekstremitas', 'LR', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->SetFont('Arial', '', '9');
            $pdf->Cell(6.33, .5, 'Sensorik', 'L', 0, 'C', $fill);
            $pdf->Cell(6.33, .5, 'Motorik', '', 0, 'C', $fill);
//            $pdf->Cell(6.33, .5, $pdf->getX(), 'R', 0, 'C', $fill);
            $pdf->Ln();
            
            $pdf->SetFont('Arial', '', '7');
            # Blok Sensorik
            $pdf->Cell(1.165, .5, '', 'L', 0, 'C', $fill);
            $pdf->Cell(2, .5, '', 'R', 0, 'C', $fill);
            $pdf->Cell(2, .5, '', '', 0, 'C', $fill);
            $pdf->Cell(1.165, .5, '', '', 0, 'C', $fill);
            
            # Blok Motorik
            $pdf->Cell(1.165, .5, '', '', 0, 'C', $fill);
            $pdf->Cell(2, .5, '', 'R', 0, 'C', $fill);
            $pdf->Cell(2, .5, '', '', 0, 'C', $fill);
            $pdf->Cell(1.165, .5, '', '', 0, 'C', $fill);
            $pdf->Ln();
            
            # Blok Sensorik
            $pdf->Cell(2.165, .5, '', 'L', 0, 'C', $fill);
            $pdf->Cell(1, .5, $sens_a->item_value2, 'BR', 0, 'C', $fill); // Tanda plus di sensorik di tengah
            $pdf->Cell(1, .5, $sens_b->item_value2, 'B', 0, 'C', $fill); // Tanda plus di sensorik di tengah
            $pdf->Cell(2.165, .5, '', '', 0, 'C', $fill);
            
            # Blok Motorik
            $pdf->Cell(2.165, .5, '', '', 0, 'C', $fill);
            $pdf->Cell(1, .5, $moto_a->item_value2, 'BR', 0, 'C', $fill); // Tanda plus di motorik di tengah
            $pdf->Cell(1, .5, $moto_b->item_value2, 'B', 0, 'C', $fill); // Tanda plus di motorik di tengah
            $pdf->Cell(2.165, .5, '', '', 0, 'C', $fill);
            $pdf->Ln();
            
            # Blok Sensorik
            $pdf->Cell(2.165, .5, '', 'L', 0, 'C', $fill);
            $pdf->Cell(1, .5, $sens_c->item_value2, 'R', 0, 'C', $fill); // Tanda plus di sensorik di tengah
            $pdf->Cell(1, .5, $sens_d->item_value2, '', 0, 'C', $fill); // Tanda plus di sensorik di tengah
            $pdf->Cell(2.165, .5, '', '', 0, 'C', $fill);
            
            # Blok Motorik
            $pdf->Cell(2.165, .5, '', '', 0, 'C', $fill);
            $pdf->Cell(1, .5, $moto_c->item_value2, 'R', 0, 'C', $fill); // Tanda plus di motorik di tengah
            $pdf->Cell(1, .5, $moto_d->item_value2, '', 0, 'C', $fill); // Tanda plus di motorik di tengah
            $pdf->Cell(2.165, .5, '', '', 0, 'C', $fill);
            $pdf->Ln();
            
            # Blok Sensorik
            $pdf->Cell(1.165, .5, '', 'L', 0, 'C', $fill);
            $pdf->Cell(2, .5, '', 'R', 0, 'C', $fill);
            $pdf->Cell(2, .5, '', '', 0, 'C', $fill); 
            $pdf->Cell(1.165, .5, '', '', 0, 'C', $fill);
            
            # Blok Motorik
            $pdf->Cell(1.165, .5, '', '', 0, 'C', $fill);
            $pdf->Cell(2, .5, '', 'R', 0, 'C', $fill); 
            $pdf->Cell(2, .5, '', '', 0, 'C', $fill);
            $pdf->Cell(1.165, .5, '', '', 0, 'C', $fill);
            $pdf->Ln();
            
            $setYAss11 = 11.6;
            $pdf->SetFont('Arial', '', '9');
            foreach ($sql_medc_ass11 as $ass11) {
                $pdf->SetXY(13.66,$setYAss11);
                $pdf->Cell(3, .5, $ass11->item_name, '', 0, 'L', $fill);
                $pdf->Cell(.33, .5, ':', '', 0, 'C', $fill);
                $pdf->Cell(3, .5, $ass11->item_value2, 'R', 0, 'L', $fill);
                $pdf->Ln();
                
                $setYAss11 += 0.5;
            }
            
            # -- BLOK 14--
            $pdf->SetFont('Arial', 'B', '9');
            $pdf->SetXY(1,14.1);
            $pdf->Cell(19, .5, '10. Pemeriksaan Syaraf', 'LR', 0, 'L', $fill);
            $pdf->Ln();
            
            $setYAss14L = 14.6;
            $pdf->SetFont('Arial', '', '9');
            foreach ($sql_medc_ass14L as $ass14L) {
                $pdf->SetXY(1,$setYAss14L);
                $pdf->Cell(3, .5, $ass14L->item_name, 'L', 0, 'L', $fill);
                $pdf->Cell(.33, .5, ':', '', 0, 'C', $fill);
                $pdf->Cell(3, .5, $ass14L->item_value2, '', 0, 'L', $fill);
                $pdf->Ln();
                
                $setYAss14L += 0.5;
            }
            
            $setYAss14R = 14.6;
            $pdf->SetFont('Arial', '', '9');
            foreach ($sql_medc_ass14R as $ass14R) {
                $pdf->SetXY(7.33,$setYAss14R);
                $pdf->Cell(3, .5, $ass14R->item_name, '', 0, '', $fill);
                $pdf->Cell(.33, .5, ':', '', 0, 'C', $fill);
                $pdf->Cell(9.33, .5, $ass14R->item_value2, 'R', 0, 'L', $fill);
                $pdf->Ln();
                
                $setYAss14R += 0.5;
            }
            
            $pdf->SetXY(13.66,$setYAss14R);
            $pdf->Cell(3, .5, '', '', 0, 'L', $fill);
            $pdf->Cell(.33, .5, '', '', 0, 'L', $fill);
            $pdf->Cell(3, .5, '', 'R', 0, 'L', $fill);
            $pdf->SetXY(13.66,$setYAss14R + 0.5);
            $pdf->Cell(3, .5, '', '', 0, 'L', $fill);
            $pdf->Cell(.33, .5, '', '', 0, 'L', $fill);
            $pdf->Cell(3, .5, '', 'R', 0, 'L', $fill);
            $pdf->SetXY(13.66,$setYAss14R + 1);
            $pdf->Cell(3, .5, '', '', 0, 'L', $fill);
            $pdf->Cell(.33, .5, '', '', 0, 'L', $fill);
            $pdf->Cell(3, .5, '', 'R', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->SetXY(13.66,$setYAss14R + 1.5);
            $pdf->Cell(3, .5, '', '', 0, 'L', $fill);
            $pdf->Cell(.33, .5, '', '', 0, 'L', $fill);
            $pdf->Cell(3, .5, '', 'R', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->SetXY(1,$setYAss14R + 2);
            $pdf->Cell(19, .5, '', 'T', 0, 'L', $fill);
            $pdf->Ln();
            # -- END
            
            # ISI BLOK 13
//            $setYAss13 = $setYAss12 + 1;
//            $pdf->SetXY(1,$setYAss13);
            $pdf->SetFont('Arial', 'B', '9');
            $pdf->Cell(19, .5, 'Pemeriksaan Gigi', '', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->SetFont('Arial', '', '9');
            $pdf->Cell(3, .5, 'Posisi Gigi Atas', '', 0, 'L', $fill);
            
            foreach ($sql_medc_ass13A as $ass13A) {
                $pdf->Cell(1, .5, $ass13A->item_name, '', 0, 'C', $fill);                
            }
            
            $pdf->Ln();
            $pdf->Cell(3, .5, 'Kelainan', '', 0, 'L', $fill);
            foreach ($sql_medc_ass13A as $ass13A) { 
                $pdf->SetFont('Arial', 'B', '9');
                $pdf->Cell(1, .5, $ass13A->item_value2, '', 0, 'C', $fill);
                
            }
            $pdf->Ln(1);
            $pdf->SetFont('Arial', '', '9');
            $pdf->Cell(3, .5, 'Posisi Gigi Bawah', '', 0, 'L', $fill);
            
            foreach ($sql_medc_ass13B as $ass13B) {
                $pdf->Cell(1, .5, $ass13B->item_name, '', 0, 'C', $fill);
                
            }
            
            $pdf->Ln();
            $pdf->Cell(3, .5, 'Kelainan', '', 0, 'L', $fill);
            foreach ($sql_medc_ass13B as $ass13B) {                
                $pdf->SetFont('Arial', 'B', '9');
                $pdf->Cell(1, .5, $ass13B->item_value2, '', 0, 'C', $fill);
            }
            $pdf->Ln();
            $pdf->SetFont('Arial', 'B', '9');
            $pdf->Cell(3, .5, 'Keterangan', '', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '', 0, 'C', $fill);
            $pdf->SetFont('Arial', 'i', '9');
            $pdf->Cell(3, .5, '*Caries', '', 0, 'L', $fill);
            $pdf->Cell(3, .5, '*Tanggal', '', 0, 'L', $fill);
            $pdf->Cell(3, .5, '*Impacted', '', 0, 'L', $fill);
            $pdf->Cell(3, .5, '*Palsu', '', 0, 'L', $fill);
            $pdf->Cell(3, .5, '*Radix', '', 0, 'L', $fill);
            $pdf->Ln(1);
            # --- END BLOK 13 --

            // QR GENERATOR VALIDASI
            $qr_validasi        = FCPATH.'/file/pasien/'.strtolower($kode_pasien).'/qr-validasi-'.strtolower($kode_pasien).'.png';
            $params['data']     = 'Telah diverifikasi dan ditandatangani secara elektronik oleh manajemen '.$setting->judul.'. Pasien a/n. ';
//            $params['data']    .= strtoupper($sql_pasien->nama_pgl).' ('.strtoupper($kode_pasien).')';
//            $params['data']     = 'https://verify.esensia.co.id/?id='.general::enkrip($sql_medc_srt->id).'&id_pasien='.general::enkrip($sql_pasien->id).'&role=surat';
            $params['level']    = 'H';
            $params['size']     = 2;
            $params['savename'] = $qr_validasi;
            $this->ciqrcode->generate($params);
            
//            $gambar4            = base_url('file/qr/validasi-'.$sql_pasien->id.'.png');         
            $gambar4            = $qr_validasi;         
                        
            // QR GENERATOR DOKTER
            $qr_dokter          = FCPATH.'/file/pasien/'.strtolower($kode_pasien).'/qr-dokter-'.strtolower($sql_dokter2->id).'.png';
            $params['data']     = 'Telah diverifikasi dan ditandatangani secara elektronik oleh dokter penanggung jawab ['.(!empty($sql_dokter2->nama_dpn) ? $sql_dokter2->nama_dpn.' ' : '').$sql_dokter2->nama.(!empty($sql_dokter2->nama_blk) ? ', '.$sql_dokter2->nama_blk : '').']';
            $params['level']    = 'H';
            $params['size']     = 2;
            $params['savename'] = $qr_dokter;
            $this->ciqrcode->generate($params);
            
            $gambar5            = $qr_dokter;
//            $gambar5            = base_url('file/qr/dokter-'.strtolower($sql_dokter2->id).'.png');
            
            // Gambar VALIDASI
            $getY = $pdf->GetY() + 1;
            $pdf->Image($gambar4,2,$getY,2,2);
            $pdf->Image($gambar5,12,$getY,2,2);
            
            
            $pdf->SetFont('Arial', '', '10');
            $pdf->Cell(10.5, .5, '', '', 0, 'L', $fill);
            $pdf->Cell(7.5, .5, 'Semarang, '.$this->tanggalan->tgl_indo3($sql_medc_lab->tgl_masuk), '', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->SetFont('Arial', 'B', '10');
            $pdf->Cell(4, .5, 'Validasi', '0', 0, 'C', $fill);
            $pdf->Cell(6.5, .5, '', '0', 0, 'C', $fill);
            $pdf->SetFont('Arial', '', '10');
            $pdf->Cell(7.5, .5, (!empty($ket) ? $ket : 'Dokter Pemeriksa'), '0', 0, 'L', $fill);
            $pdf->Ln(2.5);
            
            $pdf->SetFont('Arial', '', '10');
            $pdf->Cell(10.5, .5, '', '', 0, 'L', $fill);
            $pdf->Cell(7.5, .5, (!empty($sql_dokter->nama_dpn) ? $sql_dokter->nama_dpn.' ' : '').$sql_dokter->nama.(!empty($sql_dokter->nama_blk) ? ', '.$sql_dokter->nama_blk : ''), '', 0, 'L', $fill);
//            $pdf->Ln();
//            $pdf->Cell(10.5, .5, '', '', 0, 'L', $fill);
//            $pdf->Cell(7.5, .5, (!empty($sql_dokter->nik) || $sql_dokter->nik != '-' ? $sql_dokter->nik : ''), '', 0, 'L', $fill);
            $pdf->Ln();
            
            $type = (isset($_GET['type']) ? $_GET['type'] : 'I');

            ob_start();
            $pdf->Output($sql_pasien->nama_pgl. '.pdf', $type);
            ob_end_flush();
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }
    
    public function pdf_medcheck_nota_rajal() {
        if (akses::aksesLogin() == TRUE) {
            $setting            = $this->db->get('tbl_pengaturan')->row();
//            $id                 = $this->input->get('id');
            $id_medcheck        = $this->input->get('id');
            
            $sql_medc           = $this->db->where('id', general::dekrip($id_medcheck))->get('tbl_trans_medcheck')->row();
            $sql_medc_plat      = $this->db->where('id_medcheck', $sql_medc->id)->get('v_medcheck_plat')->result();
            $sql_medc_det       = $this->db->where('id_medcheck', $sql_medc->id)->where('status_pkt', '0')->group_by('id_item_kat')->get('tbl_trans_medcheck_det')->result();
            $sql_medc_det_sum   = $this->db->select('SUM(diskon) AS diskon, SUM(potongan) AS potongan, SUM(subtotal) AS subtotal')->where('id_medcheck', $sql_medc->id)->where('status_pkt', '0')->get('tbl_trans_medcheck_det')->row();
            $sql_pasien         = $this->db->where('id', $sql_medc->id_pasien)->get('tbl_m_pasien')->row(); 
            $sql_pasien_poin    = $this->db->where('id_pasien', $sql_medc->id_pasien)->get('tbl_m_pasien_poin')->row();
            $sql_pekerjaan      = $this->db->where('id', $sql_pasien->id_pekerjaan)->get('tbl_m_jenis_kerja')->row();
            $sql_dokter         = $this->db->where('id_user', $sql_medc->id_dokter)->get('tbl_m_karyawan')->row();
            $kode_pasien        = $sql_pasien->kode_dpn.$sql_pasien->kode;
            $gambar1            = FCPATH.'/assets/theme/admin-lte-3/dist/img/logo-esensia-2.png';
            $gambar2            = FCPATH.'/assets/theme/admin-lte-3/dist/img/logo-bw-bg2-1440px.png';
            $gambar3            = FCPATH.'/assets/theme/admin-lte-3/dist/img/logo-footer.png';
            $kasir              = (!empty($sql_medc->id_kasir) ? $this->ion_auth->user($sql_medc->id_kasir)->row()->first_name : $this->ion_auth->user()->row()->first_name);

            $judul              = ($sql_medc->tipe == '6' ? 'INVOICE FARMASI' : 'INVOICE');
            
            $this->load->library('MedPDF');
            $pdf = new MedPDF('P', 'cm', array(21.5,33));
            $pdf->SetAutoPageBreak('auto', 7);
            $pdf->SetMargins(1,0.35,1);
            $pdf->addPage();
            
            // Gambar Watermark Tengah
            $pdf->Image($gambar2,5,4,17,19);
            
            // Blok Judul
            $pdf->SetFont('Arial', 'B', '14');
            $pdf->Cell(19, .5, $judul, 0, 1, 'C');
            $pdf->Ln();
            
            // Blok ID PASIEN
            $pdf->SetFont('Arial', '', '9');
            $pdf->Cell(3.5, .5, 'Nama / Name', '0', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
            $pdf->Cell(8, .5, strtoupper($sql_pasien->nama_pgl).' ('.$sql_pasien->kode_dpn . $sql_pasien->kode.')', '0', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->Cell(3.5, .5, 'Alamat / Address', '0', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
            $pdf->Cell(8, .5, (!empty($sql_pasien->alamat) ? $sql_pasien->alamat : (!empty($sql_pasien->alamat_dom) ? $sql_pasien->alamat_dom : '-')), '0', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->Cell(3.5, .5, 'Tanggal / Date', '0', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
            $pdf->Cell(8, .5, $this->tanggalan->tgl_indo5($sql_medc->tgl_masuk).' - '.$this->tanggalan->tgl_indo5(date('Y-m-d H:i')), '0', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->Cell(3.5, .5, 'Kasir / Cashier', '0', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
            $pdf->Cell(8, .5, $this->ion_auth->user($sql_medc->id_kasir)->row()->first_name, '0', 0, 'L', $fill);
            $pdf->Ln(1);
                        
            $fill = FALSE;
            $pdf->SetTextColor(5,148,19);
            $pdf->SetFont('Arial', 'B', '11');
            $pdf->Cell(7, 1, 'DESKRIPSI', 'TB', 0, 'L', $fill);
            $pdf->Cell(1, 1, 'JML', 'TB', 0, 'C', $fill);
            $pdf->Cell(3, 1, 'HARGA', 'TB', 0, 'R', $fill);
            $pdf->Cell(2, 1, 'DISK (%)', 'TB', 0, 'R', $fill);
            $pdf->Cell(3, 1, 'POTONGAN', 'TB', 0, 'R', $fill);
            $pdf->Cell(3, 1, 'SUBTOTAL', 'TB', 0, 'R', $fill);
            $pdf->SetTextColor(0,0,0);
            $pdf->Ln();
            
            $fill = FALSE;
            $no = 1; $gtotal = 0;
            foreach ($sql_medc_det as $det){
                $sql_medc_itm = $this->db->where('id_medcheck', $det->id_medcheck)->where('id_item_kat', $det->id_item_kat)->where('status_pkt', '0')->get('tbl_trans_medcheck_det')->result();
                $sql_medc_kat = $this->db->where('id', $det->id_item_kat)->get('tbl_m_kategori')->row();
                
                $pdf->SetFont('Arial', 'Bi', '8');
                $pdf->Cell(19, .5, strtoupper($sql_medc_kat->keterangan), '', 0, 'L', $fill);
                $pdf->Ln();
                
                // Detail Pemeriksaan dan hasilnya
                $sub = 0;
                foreach ($sql_medc_itm as $medc){                  
//                    if ($medc->jml >= 0) {
//                        $subtot  = $medc->harga * $medc->jml;
                        $sub     = $sub + $medc->subtotal;
                        
                        $pdf->SetFont('Arial', '', '7.5');
                        $pdf->Cell(7, .5, $medc->item, '', 0, '', $fill);
                        $pdf->Cell(1, .5, (float) $medc->jml, '', 0, 'C', $fill);
                        $pdf->Cell(3, .5, general::format_angka($medc->harga), '', 0, 'R', $fill);
                        $pdf->Cell(2, .5, ($medc->disk1 != 0 ? (float)$medc->disk1 : '').($medc->disk2 != 0 ? ' + '.(float)$medc->disk2 : '').($medc->disk3 != 0 ? ' + '.(float)$medc->disk3 : ''), '', 0, 'C', $fill);
                        $pdf->Cell(3, .5, general::format_angka($medc->potongan), '', 0, 'R', $fill);
                        $pdf->Cell(3, .5, general::format_angka($medc->subtotal), '', 0, 'R', $fill);
                        $pdf->Ln();
                        
                        foreach (json_decode($medc->resep) as $racikan) {
                            $pdf->SetFont('Arial', 'i', '9');
                            $pdf->Cell(7, .5, '- R/ '.strtolower($racikan->item), '', 0, '', $fill);
                            $pdf->Cell(1, .5, (float) $racikan->jml, '', 0, 'C', $fill);
                            $pdf->Cell(3, .5, general::format_angka($racikan->harga), '', 0, 'R', $fill);
                            $pdf->Cell(3, .5, general::format_angka($racikan->subtotal), '', 0, 'R', $fill);
                            $pdf->Ln();                            
                        }
                        
                        $no++;
//                    }
                }
                
                // Kolom Subtotal
                $pdf->SetFont('Arial', 'B', '8');
                $pdf->Cell(16, .5, 'SUBTOTAL', 'B', 0, 'R', $fill);
                $pdf->Cell(3, .5, general::format_angka($sub), 'B', 0, 'R', $fill);
                $pdf->Ln();
                
                $gtotal = $gtotal + $sub;
            }
            
            $sql_platform   = $this->db->where('id', $sql_medc->metode)->get('tbl_m_platform')->row();
            $jml_total      = $sql_medc_sum->subtotal + $sql_medc_sum->diskon + $sql_medc_sum->potongan;
            $jml_diskon     = $jml_total - ($jml_total - $sql_medc->jml_diskon);
            $diskon         = ($jml_diskon / $jml_total) * 100; 
            
            // Kolom Total
            $pdf->SetTextColor(5,148,19);
            $pdf->SetFont('Arial', 'B', '8');
            $pdf->Cell(1, .5, 'POIN', '', 0, 'C', $fill);
            $pdf->Cell(15, .5, 'TOTAL', '', 0, 'R', $fill);
            $pdf->SetTextColor(0,0,0);
            $pdf->Cell(3, .5, general::format_angka($sql_medc->jml_total), '', 0, 'R', $fill);
            $pdf->Ln();
            $pdf->SetTextColor(5,148,19);
            $pdf->Cell(1, .5, general::format_angka($sql_pasien_poin->jml_poin), '', 0, 'C', $fill);
            $pdf->Cell(15, .5, 'DISKON '.(!empty($diskon) ? $diskon.'%' : ''), '', 0, 'R', $fill);
            $pdf->SetTextColor(0,0,0);
            $pdf->Cell(3, .5, '('.general::format_angka($jml_diskon).')', '', 0, 'R', $fill);
            $pdf->Ln();
            $pdf->Cell(13, .5, '', '', 0, 'R', $fill);
            $pdf->SetTextColor(5,148,19);
            $pdf->Cell(3, .5, 'GRAND TOTAL', 'T', 0, 'R', $fill);
            $pdf->SetTextColor(0,0,0);
            $pdf->Cell(3, .5, general::format_angka($sql_medc_det_sum->subtotal), 'T', 0, 'R', $fill);
            $pdf->Ln();
            
            $jml_tot_byr = 0;
            foreach ($sql_medc_plat as $plat){
                $sql_plat    = $this->db->where('id', $plat->id_platform)->get('tbl_m_platform')->row();
                $jml_tot_byr = $jml_tot_byr + $plat->nominal;

                $pdf->SetFont('Arial', 'i', '8');
                $pdf->Cell(16, .5, '('.$this->tanggalan->tgl_indo5($plat->tgl_simpan).') '.$sql_plat->platform, '', 0, 'R', $fill);
                $pdf->SetFont('Arial', 'B', '8');
                $pdf->Cell(3, .5, general::format_angka($plat->nominal), '', 0, 'R', $fill);
                $pdf->Ln();
            }
            
            $jml_kembali = $jml_tot_byr - $sql_medc_det_sum->subtotal;
            
            $pdf->Cell(13, .5, '', '', 0, 'R', $fill);
            $pdf->SetTextColor(5,148,19);
            $pdf->Cell(3, .5, 'KEMBALIAN', '', 0, 'R', $fill);
            $pdf->SetTextColor(0,0,0);
            $pdf->Cell(3, .5, ($jml_kembali >= 0 ? general::format_angka($jml_kembali) : 0), '', 0, 'R', $fill);
            
            $pdf->Ln(1);
            
            // QR GENERATOR VALIDASI
            $qr_validasi        = FCPATH.'/file/pasien/'.strtolower($kode_pasien).'/qr-validasi-'.strtolower($kode_pasien).'.png';
//            $params['data']     = 'https://verify.esensia.co.id/?id='.general::enkrip($sql_medc_srt->id).'&id_pasien='.general::enkrip($sql_pasien->id).'&role=surat';
            $params['data']     = 'Telah diverifikasi dan ditandatangani secara elektronik oleh manajemen '.$setting->judul.'. Pasien a/n. ';
            $params['data']    .= strtoupper($sql_pasien->nama_pgl).' ('.strtoupper($kode_pasien).')';
            $params['level']    = 'H';
            $params['size']     = 2;
            $params['savename'] = $qr_validasi; 
            $this->ciqrcode->generate($params);
            
            $gambar4            = $qr_validasi;
                        
            // QR GENERATOR PETUGAS KASIR
            $qr_kasir           = FCPATH.'/file/pasien/'.strtolower($kode_pasien).'/qr-kasir-'.strtolower(md5($kasir)).'.png';
            $params['data']     = 'Telah diverifikasi oleh petugas kasir '.$kasir.'. Pada tanggal '.$this->tanggalan->tgl_indo5($sql_medc->tgl_bayar);
            $params['level']    = 'H';
            $params['size']     = 2;
            $params['savename'] = $qr_kasir;
            $this->ciqrcode->generate($params);
            
            $gambar5            = $qr_kasir;
            
            // Gambar VALIDASI
            $getY = $pdf->GetY() + 1;
            $pdf->Image($gambar4,1,$getY,2,2);
            $pdf->Image($gambar5,12.5,$getY,2,2);

            $pdf->SetFont('Arial', '', '10');
            $pdf->Cell(11.5, .5, '', '', 0, 'L', $fill);
            $pdf->Cell(7.5, .5, 'Semarang, '.$this->tanggalan->tgl_indo3($sql_medc->tgl_bayar), '', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->Cell(11.5, .5, 'Validasi', '', 0, 'L', $fill);
            $pdf->Cell(7.5, .5, 'Petugas Kasir', '', 0, 'L', $fill);
            $pdf->Ln(2.5);
            
            $pdf->SetFont('Arial', '', '10');
            $pdf->Cell(11.5, .5, '', '', 0, 'L', $fill);
            $pdf->Cell(7.5, .5, '('.$kasir.')', '', 0, 'L', $fill);
            $pdf->Ln();

            $type = (isset($_GET['type']) ? $_GET['type'] : 'I');

            ob_start();
            $pdf->Output($sql_pasien->nama_pgl.'_INV'. '.pdf', $type);
            ob_end_flush();
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }
    
    public function pdf_medcheck_nota_ranap() {
        if (akses::aksesLogin() == TRUE) {
            $setting            = $this->db->get('tbl_pengaturan')->row();
//            $id                 = $this->input->get('id');
            $id_medcheck        = $this->input->get('id');
            
            $sql_medc           = $this->db->where('id', general::dekrip($id_medcheck))->get('tbl_trans_medcheck')->row();
            $sql_medc_det       = $this->db->where('id_medcheck', $sql_medc->id)->where('status_pkt', '0')->group_by('id_item_kat')->get('tbl_trans_medcheck_det')->result();
            $sql_pasien         = $this->db->where('id', $sql_medc->id_pasien)->get('tbl_m_pasien')->row(); 
            $sql_pekerjaan      = $this->db->where('id', $sql_pasien->id_pekerjaan)->get('tbl_m_jenis_kerja')->row();
            $sql_dokter         = $this->db->where('id_user', $sql_medc->id_dokter)->get('tbl_m_karyawan')->row();
            $kode_pasien        = $sql_pasien->kode_dpn.$sql_pasien->kode;
            $gambar1            = FCPATH.'/assets/theme/admin-lte-3/dist/img/logo-esensia-2.png';
            $gambar2            = FCPATH.'/assets/theme/admin-lte-3/dist/img/logo-bw-bg2-1440px.png';
            $gambar3            = FCPATH.'/assets/theme/admin-lte-3/dist/img/logo-footer.png';
            $kasir              = (!empty($sql_medc->id_kasir) ? $this->ion_auth->user($sql_medc->id_kasir)->row()->first_name : $this->ion_auth->user()->row()->first_name);

            $judul = "BILLING ".strtoupper(general::status_rawat2($sql_medc->tipe));
            
            $this->load->library('MedPDF');
            $pdf = new MedPDF('P', 'cm', array(21.5,33));
            $pdf->SetAutoPageBreak('auto', 6.5);
            $pdf->addPage();
            
            // Gambar Watermark Tengah
            $pdf->Image($gambar2,5,4,17,19);
            
            // Blok Judul
            $pdf->SetFont('Arial', 'B', '14');
            $pdf->Cell(19, .5, $judul, 0, 1, 'C');
            $pdf->Ln();
            
            // Blok ID PASIEN
            $pdf->SetFont('Arial', '', '9');
            $pdf->Cell(5.5, .5, 'NIK / ID Card', '0', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
            $pdf->Cell(8, .5, $sql_pasien->nik, '0', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->Cell(5.5, .5, 'Nama / Name', '0', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
            $pdf->Cell(8, .5, strtoupper($sql_pasien->nama_pgl).' ('.$sql_pasien->kode_dpn . $sql_pasien->kode.')', '0', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->Cell(5.5, .5, 'Tgl Lahir / Date of Birth', '0', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
            $pdf->Cell(8, .5, $this->tanggalan->tgl_indo($sql_pasien->tgl_lahir), '0', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->Cell(5.5, .5, 'Jenis Kelamin / Gender', '0', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
            $pdf->Cell(8, .5, $this->tanggalan->usia_lkp($sql_pasien->tgl_lahir).' ('.general::jns_klm($sql_pasien->jns_klm).')', '0', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->Cell(5.5, .5, 'Alamat / Address', '0', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
            $pdf->Cell(8, .5, (!empty($sql_pasien->alamat) ? $sql_pasien->alamat : (!empty($sql_pasien->alamat_dom) ? $sql_pasien->alamat_dom : '-')), '0', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->Cell(5.5, .5, 'No. Telp / Phone Number', '0', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
            $pdf->Cell(8, .5, $sql_pasien->no_hp, '0', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->Cell(5.5, .5, 'Tanggal / Date', '0', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
            $pdf->Cell(8, .5, $this->tanggalan->tgl_indo5($sql_medc->tgl_masuk).' - '.$this->tanggalan->tgl_indo5(date('Y-m-d H:i')), '0', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->Cell(5.5, .5, 'Kasir / Cashier', '0', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
            $pdf->Cell(8, .5, $this->ion_auth->user()->row()->first_name, '0', 0, 'L', $fill);
            $pdf->Ln(1);
                        
            $fill = FALSE;
            $pdf->SetFont('Arial', 'B', '11');
            $pdf->Cell(1, .5, '#', 'TB', 0, 'C', $fill);
            $pdf->Cell(4, .5, 'TGL', 'TB', 0, 'L', $fill);
            $pdf->Cell(7, .5, 'ITEM', 'TB', 0, 'L', $fill);
            $pdf->Cell(1, .5, 'JML', 'TB', 0, 'C', $fill);
            $pdf->Cell(3, .5, 'HARGA', 'TB', 0, 'R', $fill);
            $pdf->Cell(3, .5, 'SUBTOTAL', 'TB', 0, 'R', $fill);
            $pdf->Ln();
            
            $fill = FALSE;
            $no = 1; $gtotal = 0;
            foreach ($sql_medc_det as $det){
                $sql_medc_itm = $this->db
                                     ->where('id_medcheck', $det->id_medcheck)
                                     ->where('id_item_kat', $det->id_item_kat)
                                     ->where('status_pkt', '0')
                                     ->where('jml >=', '0')
                                     ->order_by('tgl_simpan', 'asc')
                                     ->get('tbl_trans_medcheck_det')->result();
                $sql_medc_kat = $this->db->where('id', $det->id_item_kat)->get('tbl_m_kategori')->row();
                
                $pdf->SetFont('Arial', 'Bi', '10');
                $pdf->Cell(19, .5, ' '.strtoupper($sql_medc_kat->keterangan), '', 0, 'L', $fill);
                $pdf->Ln();
                
                // Detail Pemeriksaan dan hasilnya
                $sub = 0;
                foreach ($sql_medc_itm as $medc){                  
                    if ($medc->jml > 0) {
                        $sub     = $sub + $medc->subtotal;
                        $hrg_pcs = $medc->subtotal / $medc->jml;
               
                        $pdf->SetFont('Arial', '', '10');
                        $pdf->Cell(1, .5, $no . '.', '', 0, 'C', $fill);
                        $pdf->Cell(4, .5, $this->tanggalan->tgl_indo5($medc->tgl_simpan), '', 0, 'L', $fill);
                        $pdf->Cell(7, .5, $medc->item, '', 0, '', $fill);
                        $pdf->Cell(1, .5, (float) $medc->jml, '', 0, 'C', $fill);
                        $pdf->Cell(3, .5, general::format_angka($medc->harga), '', 0, 'R', $fill);
                        $pdf->Cell(3, .5, general::format_angka($medc->subtotal), '', 0, 'R', $fill);
                        $pdf->Ln();
                        
                        foreach (json_decode($medc->resep) as $racikan) {
                            $pdf->SetFont('Arial', 'i', '9');
                            $pdf->Cell(1, .5, '', '', 0, 'C', $fill);
                            $pdf->Cell(4, .5, '', '', 0, 'L', $fill);
                            $pdf->Cell(7, .5, '- R/ '.strtolower($racikan->item), '', 0, '', $fill);
                            $pdf->Cell(1, .5, (float) $racikan->jml, '', 0, 'C', $fill);
                            $pdf->Cell(3, .5, general::format_angka($racikan->harga), '', 0, 'R', $fill);
                            $pdf->Cell(3, .5, general::format_angka($racikan->subtotal), '', 0, 'R', $fill);
                            $pdf->Ln();                            
                        }
                        
                        $no++;
                    }
                }
                
                // Kolom Subtotal
                $pdf->SetFont('Arial', 'B', '10');
                $pdf->Cell(16, .5, 'SUBTOTAL', 'B', 0, 'R', $fill);
                $pdf->Cell(3, .5, general::format_angka($sub), 'B', 0, 'R', $fill);
                $pdf->Ln();
                
                $gtotal = $gtotal + $sub;
            }
                
            // Kolom Grandtotal
            $pdf->SetFont('Arial', 'B', '10');
            $pdf->Cell(16, .5, 'GRAND TOTAL', '', 0, 'R', $fill);
            $pdf->Cell(3, .5, general::format_angka($gtotal), '', 0, 'R', $fill);
            $pdf->Ln(1);
            
            // QR GENERATOR VALIDASI
            $qr_validasi        = FCPATH.'/file/pasien/'.strtolower($kode_pasien).'/qr-validasi-'.strtolower($kode_pasien).'.png';
            $params['data']     = 'Telah diverifikasi dan ditandatangani secara elektronik oleh manajemen '.$setting->judul.'. Pasien a/n. ';
            $params['data']    .= strtoupper($sql_pasien->nama_pgl).' ('.strtoupper($kode_pasien).')';
            $params['level']    = 'H';
            $params['size']     = 2;
            $params['savename'] = $qr_validasi; 
            $this->ciqrcode->generate($params);
            
            $gambar4            = $qr_validasi;
                        
            // QR GENERATOR PETUGAS KASIR
            $qr_kasir           = FCPATH.'/file/pasien/'.strtolower($kode_pasien).'/qr-kasir-'.strtolower(md5($kasir)).'.png';
            $params['data']     = 'Telah diverifikasi oleh petugas kasir '.$kasir.'. Pada tanggal '.$this->tanggalan->tgl_indo5($sql_medc->tgl_bayar);
            $params['level']    = 'H';
            $params['size']     = 2;
            $params['savename'] = $qr_kasir;
            $this->ciqrcode->generate($params);
            
            $gambar5            = $qr_kasir;
            
            // Gambar VALIDASI
            $getY = $pdf->GetY() + 1;
            $pdf->Image($gambar4,1,$getY,2,2);
            $pdf->Image($gambar5,12.5,$getY,2,2);

            $pdf->SetFont('Arial', '', '10');
            $pdf->Cell(11.5, .5, '', '', 0, 'L', $fill);
            $pdf->Cell(7.5, .5, 'Semarang, '.$this->tanggalan->tgl_indo3($sql_medc->tgl_masuk), '', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->Cell(11.5, .5, 'Validasi', '', 0, 'L', $fill);
            $pdf->Cell(7.5, .5, 'Petugas Kasir', '', 0, 'L', $fill);
            $pdf->Ln(2.5);
            
            $pdf->SetFont('Arial', '', '10');
            $pdf->Cell(11.5, .5, '', '', 0, 'L', $fill);
            $pdf->Cell(7.5, .5, '('.$kasir.')', '', 0, 'L', $fill);
            $pdf->Ln();

            $type = (isset($_GET['type']) ? $_GET['type'] : 'I');

            ob_start();
            $pdf->Output($sql_pasien->nama_pgl.'_BILLING'. '.pdf', $type);
            ob_end_flush();
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }
    
    # INVOICE RANAP
    public function pdf_medcheck_nota_ranap2() {
        if (akses::aksesLogin() == TRUE) {
            $setting            = $this->db->get('tbl_pengaturan')->row();
//            $id                 = $this->input->get('id');
            $id_medcheck        = $this->input->get('id');
            
            $sql_medc           = $this->db->where('id', general::dekrip($id_medcheck))->get('tbl_trans_medcheck')->row();
            $sql_medc_plat      = $this->db->where('id_medcheck', $sql_medc->id)->get('v_medcheck_plat')->result();
            $sql_medc_det       = $this->db->where('id_medcheck', $sql_medc->id)->where('status_pkt', '0')->group_by('id_item_kat')->get('tbl_trans_medcheck_det')->result();
            $sql_medc_det_sum   = $this->db->select('SUM(diskon) AS diskon, SUM(potongan) AS potongan, SUM(subtotal) AS subtotal')->where('id_medcheck', $sql_medc->id)->where('status_pkt', '0')->get('tbl_trans_medcheck_det')->row();
            $sql_pasien         = $this->db->where('id', $sql_medc->id_pasien)->get('tbl_m_pasien')->row(); 
            $sql_pasien_poin    = $this->db->where('id_pasien', $sql_medc->id_pasien)->get('tbl_m_pasien_poin')->row(); 
            $sql_pekerjaan      = $this->db->where('id', $sql_pasien->id_pekerjaan)->get('tbl_m_jenis_kerja')->row();
            $sql_dokter         = $this->db->where('id_user', $sql_medc->id_dokter)->get('tbl_m_karyawan')->row();
            $kode_pasien        = $sql_pasien->kode_dpn.$sql_pasien->kode;
            $gambar1            = FCPATH.'/assets/theme/admin-lte-3/dist/img/logo-esensia-2.png';
            $gambar2            = FCPATH.'/assets/theme/admin-lte-3/dist/img/logo-bw-bg2-1440px.png';
            $gambar3            = FCPATH.'/assets/theme/admin-lte-3/dist/img/logo-footer.png';
            $kasir              = (!empty($sql_medc->id_kasir) ? $this->ion_auth->user($sql_medc->id_kasir)->row()->first_name : $this->ion_auth->user()->row()->first_name);

            $judul = "INVOICE RAWAT INAP";
            
            $this->load->library('MedPDF');
            $pdf = new MedPDF('P', 'cm', array(21.5,33));
            $pdf->SetAutoPageBreak('auto', 6.5);
            $pdf->addPage();
            
            // Gambar Watermark Tengah
            $pdf->Image($gambar2,5,4,17,19);
            
            // Blok Judul
            $pdf->SetFont('Arial', 'B', '14');
            $pdf->Cell(19, .5, $judul, 0, 1, 'C');
            $pdf->Ln();
            
            // Blok ID PASIEN
            $pdf->SetFont('Arial', '', '9');
            $pdf->Cell(5.5, .5, 'NIK / ID Card', '0', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
            $pdf->Cell(8, .5, $sql_pasien->nik, '0', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->Cell(5.5, .5, 'Nama / Name', '0', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
            $pdf->Cell(8, .5, strtoupper($sql_pasien->nama_pgl).' ('.$sql_pasien->kode_dpn . $sql_pasien->kode.')', '0', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->Cell(5.5, .5, 'Tgl Lahir / Date of Birth', '0', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
            $pdf->Cell(8, .5, $this->tanggalan->tgl_indo($sql_pasien->tgl_lahir), '0', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->Cell(5.5, .5, 'Jenis Kelamin / Gender', '0', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
            $pdf->Cell(8, .5, $this->tanggalan->usia_lkp($sql_pasien->tgl_lahir).' ('.general::jns_klm($sql_pasien->jns_klm).')', '0', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->Cell(5.5, .5, 'Alamat / Address', '0', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
            $pdf->Cell(8, .5, (!empty($sql_pasien->alamat) ? $sql_pasien->alamat : (!empty($sql_pasien->alamat_dom) ? $sql_pasien->alamat_dom : '-')), '0', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->Cell(5.5, .5, 'No. Telp / Phone Number', '0', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
            $pdf->Cell(8, .5, $sql_pasien->no_hp, '0', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->Cell(5.5, .5, 'Tanggal / Date', '0', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
            $pdf->Cell(8, .5, $this->tanggalan->tgl_indo5($sql_medc->tgl_masuk).' - '.$this->tanggalan->tgl_indo5($sql_medc->tgl_bayar), '0', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->Cell(5.5, .5, 'Kasir / Cashier', '0', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
            $pdf->Cell(8, .5, $this->ion_auth->user()->row()->first_name, '0', 0, 'L', $fill);
            $pdf->Ln(1);
            
            $fill = FALSE;
            $pdf->SetTextColor(5,148,19);
            $pdf->SetFont('Arial', 'B', '11');
            $pdf->Cell(4, 1, 'TGL', 'TB', 0, 'L', $fill);
            $pdf->Cell(8, 1, 'DESKRIPSI', 'TB', 0, 'L', $fill);
            $pdf->Cell(1, 1, 'JML', 'TB', 0, 'C', $fill);
            $pdf->Cell(3, 1, 'HARGA', 'TB', 0, 'R', $fill);
            $pdf->Cell(3, 1, 'SUBTOTAL', 'TB', 0, 'R', $fill);
            $pdf->SetTextColor(0,0,0);
            $pdf->Ln();
            
            $fill = FALSE;
            $no = 1; $gtotal = 0;
            foreach ($sql_medc_det as $det){
                $sql_medc_itm = $this->db->where('id_medcheck', $det->id_medcheck)->where('id_item_kat', $det->id_item_kat)->where('status_pkt', '0')->where('jml >=', '0')->get('tbl_trans_medcheck_det')->result();
                $sql_medc_kat = $this->db->where('id', $det->id_item_kat)->get('tbl_m_kategori')->row();
                
                $pdf->SetFont('Arial', 'Bi', '10');
                $pdf->Cell(19, .5, strtoupper($sql_medc_kat->keterangan), '', 0, 'L', $fill);
                $pdf->Ln();
                
                // Detail Pemeriksaan dan hasilnya
                $sub = 0;
                foreach ($sql_medc_itm as $medc){                  
//                    if ($medc->jml >= 0) {
                        $sub = $sub + $medc->subtotal;
                        
                        if($medc->jml > 0){
                            $pdf->SetFont('Arial', '', '10');
                            $pdf->Cell(4, .5, $this->tanggalan->tgl_indo5($medc->tgl_simpan), '', 0, 'L', $fill);
                            $pdf->Cell(8, .5, $medc->item, '', 0, '', $fill);
                            $pdf->Cell(1, .5, (float) $medc->jml, '', 0, 'C', $fill);
                            $pdf->Cell(3, .5, general::format_angka($medc->harga), '', 0, 'R', $fill);
                            $pdf->Cell(3, .5, general::format_angka($medc->subtotal), '', 0, 'R', $fill);
                            $pdf->Ln();
                        
                            foreach (json_decode($medc->resep) as $racikan) {
                                $pdf->SetFont('Arial', 'i', '9');
                                $pdf->Cell(4, .5, '', '', 0, 'C', $fill);
                                $pdf->Cell(8, .5, '- R/ '.strtolower($racikan->item), '', 0, '', $fill);
                                $pdf->Cell(1, .5, (float) $racikan->jml, '', 0, 'C', $fill);
                                $pdf->Cell(3, .5, general::format_angka($racikan->harga), '', 0, 'R', $fill);
                                $pdf->Cell(3, .5, general::format_angka($racikan->subtotal), '', 0, 'R', $fill);
                                $pdf->Ln();                            
                            }
                        }
                        
                        $no++;
//                    }
                }
                
                // Kolom Subtotal
                $pdf->SetFont('Arial', 'B', '10');
                $pdf->Cell(16, .5, 'SUBTOTAL', 'B', 0, 'R', $fill);
                $pdf->Cell(3, .5, general::format_angka($sub), 'B', 0, 'R', $fill);
                $pdf->Ln();
                
                $gtotal = $gtotal + $sub;
            }
            
            $jml_total      = $sql_medc_det_sum->subtotal + $sql_medc_det_sum->diskon + $sql_medc_det_sum->potongan;
            $jml_diskon     = $jml_total - $sql_medc_det_sum->subtotal;
            $diskon         = ($jml_diskon / $jml_total) * 100;
            
            // Kolom Total
            $pdf->SetTextColor(5,148,19);
            $pdf->SetFont('Arial', 'B', '10');
            $pdf->Cell(1, .5, 'POIN', '', 0, 'C', $fill);
            $pdf->Cell(15, .5, 'TOTAL', '', 0, 'R', $fill);
            $pdf->SetTextColor(0,0,0);
            $pdf->Cell(3, .5, general::format_angka($jml_total), '', 0, 'R', $fill);
            $pdf->Ln();
            $pdf->Cell(1, .5, general::format_angka($sql_pasien_poin->jml_poin), '', 0, 'C', $fill);
            $pdf->SetTextColor(5,148,19);
            $pdf->Cell(15, .5, 'DISKON '.(!empty($diskon) ? $diskon.'%' : ''), '', 0, 'R', $fill);
            $pdf->SetTextColor(0,0,0);
            $pdf->Cell(3, .5, '('.general::format_angka($jml_diskon).')', '', 0, 'R', $fill);
            $pdf->Ln();
            $pdf->Cell(13, .5, '', '', 0, 'R', $fill);
            $pdf->SetTextColor(5,148,19);
            $pdf->Cell(3, .5, 'GRAND TOTAL', 'T', 0, 'R', $fill);
            $pdf->SetTextColor(0,0,0);
            $pdf->Cell(3, .5, general::format_angka($sql_medc_det_sum->subtotal), 'T', 0, 'R', $fill);
            $pdf->Ln();
            
            $jml_tot_byr = 0;
            foreach ($sql_medc_plat as $plat){
                $sql_plat    = $this->db->where('id', $plat->id_platform)->get('tbl_m_platform')->row();
                $jml_tot_byr = $jml_tot_byr + $plat->nominal;                
                
                $pdf->SetFont('Arial', 'i', '10');
                $pdf->Cell(16, .5, '('.$this->tanggalan->tgl_indo5($plat->tgl_simpan).') '.$sql_plat->platform, '', 0, 'R', $fill);
                $pdf->SetFont('Arial', 'B', '10');
                $pdf->Cell(3, .5, general::format_angka($plat->nominal), '', 0, 'R', $fill);
                $pdf->Ln();
            }
            
            $kembalian = $jml_tot_byr - $sql_medc_det_sum->subtotal;
            $jml_kembali = ($kembalian < 0 ? '0' : $kembalian);
            
            $pdf->Cell(13, .5, '', '', 0, 'R', $fill);
            $pdf->SetTextColor(5,148,19); //257a35
            $pdf->Cell(3, .5, 'TOTAL BAYAR', '', 0, 'R', $fill);
            $pdf->SetTextColor(0,0,0);
            $pdf->Cell(3, .5, general::format_angka($jml_tot_byr), '', 0, 'R', $fill);
            $pdf->Ln();
            $pdf->Cell(13, .5, '', '', 0, 'R', $fill);
            $pdf->SetTextColor(5,148,19);
            $pdf->Cell(3, .5, 'KEMBALIAN', '', 0, 'R', $fill);
            $pdf->SetTextColor(0,0,0);
            $pdf->Cell(3, .5, general::format_angka($jml_kembali), '', 0, 'R', $fill);
            
            $pdf->Ln(1);
            
            // QR GENERATOR VALIDASI
            $qr_validasi        = FCPATH.'/file/pasien/'.strtolower($kode_pasien).'/qr-validasi-'.strtolower($kode_pasien).'.png';
//            $params['data']     = 'https://verify.esensia.co.id/?id='.general::enkrip($sql_medc_srt->id).'&id_pasien='.general::enkrip($sql_pasien->id).'&role=surat';
            $params['data']     = 'Telah diverifikasi dan ditandatangani secara elektronik oleh manajemen '.$setting->judul.'. Pasien a/n. ';
//            $params['data']    .= strtoupper($sql_pasien->nama_pgl).' ('.strtoupper($kode_pasien).')';
            $params['level']    = 'H';
            $params['size']     = 2;
            $params['savename'] = $qr_validasi; 
            $this->ciqrcode->generate($params);
            
            $gambar4            = $qr_validasi;
                        
            // QR GENERATOR PETUGAS KASIR
            $qr_kasir           = FCPATH.'/file/pasien/'.strtolower($kode_pasien).'/qr-kasir-'.strtolower(md5($kasir)).'.png';
            $params['data']     = 'Telah diverifikasi oleh petugas kasir '.$kasir.'. Pada tanggal '.$this->tanggalan->tgl_indo5($sql_medc->tgl_bayar);
            $params['level']    = 'H';
            $params['size']     = 2;
            $params['savename'] = $qr_kasir;
            $this->ciqrcode->generate($params);
            
            $gambar5            = $qr_kasir;
            
            // Gambar VALIDASI
            $getY = $pdf->GetY() + 1;
            $pdf->Image($gambar4,1,$getY,2,2);
            $pdf->Image($gambar5,12.5,$getY,2,2);

            $pdf->SetFont('Arial', '', '10');
            $pdf->Cell(11.5, .5, '', '', 0, 'L', $fill);
            $pdf->Cell(7.5, .5, 'Semarang, '.$this->tanggalan->tgl_indo3($sql_medc->tgl_bayar), '', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->Cell(11.5, .5, 'Validasi', '', 0, 'L', $fill);
            $pdf->Cell(7.5, .5, 'Petugas Kasir', '', 0, 'L', $fill);
            $pdf->Ln(2.5);
            
            $pdf->SetFont('Arial', '', '10');
            $pdf->Cell(11.5, .5, '', '', 0, 'L', $fill);
            $pdf->Cell(7.5, .5, '('.$kasir.')', '', 0, 'L', $fill);
            $pdf->Ln();

            $type = (isset($_GET['type']) ? $_GET['type'] : 'I');

            ob_start();
            $pdf->Output($sql_pasien->nama_pgl.'_INV'. '.pdf', $type);
            ob_end_flush();
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }
    
    # KUITANSI
    public function pdf_medcheck_nota_ranap3() {
        if (akses::aksesLogin() == TRUE) {
            $this->load->helper("terbilang");
            $setting            = $this->db->get('tbl_pengaturan')->row();
//            $id                 = $this->input->get('id');
            $id_medcheck        = $this->input->get('id');
            
            $sql_medc           = $this->db->where('id', general::dekrip($id_medcheck))->get('tbl_trans_medcheck')->row();
            $sql_medc_plat      = $this->db->where('id_medcheck', $sql_medc->id)->get('v_medcheck_plat')->result();
            $sql_medc_det       = $this->db->where('id_medcheck', $sql_medc->id)->where('status_pkt', '0')->group_by('id_item_kat')->get('tbl_trans_medcheck_det')->result();
            $sql_medc_det_sum   = $this->db->select('SUM(diskon) AS diskon, SUM(potongan) AS potongan, SUM(subtotal) AS subtotal')->where('id_medcheck', $sql_medc->id)->get('tbl_trans_medcheck_det')->row();
            $sql_pasien         = $this->db->where('id', $sql_medc->id_pasien)->get('tbl_m_pasien')->row(); 
            $sql_pasien_poin    = $this->db->where('id_pasien', $sql_medc->id_pasien)->get('tbl_m_pasien_poin')->row();
            $sql_pekerjaan      = $this->db->where('id', $sql_pasien->id_pekerjaan)->get('tbl_m_jenis_kerja')->row();
            $sql_dokter         = $this->db->where('id_user', $sql_medc->id_dokter)->get('tbl_m_karyawan')->row();
            $kode_pasien        = $sql_pasien->kode_dpn.$sql_pasien->kode;
            $gambar1            = FCPATH.'/assets/theme/admin-lte-3/dist/img/logo-esensia-2.png';
            $gambar2            = FCPATH.'/assets/theme/admin-lte-3/dist/img/logo-bw-bg2-1440px.png';
            $gambar3            = FCPATH.'/assets/theme/admin-lte-3/dist/img/logo-footer.png';
            $kasir              = (!empty($sql_medc->id_kasir) ? $this->ion_auth->user($sql_medc->id_kasir)->row()->first_name : $this->ion_auth->user()->row()->first_name);

            $judul = "KWITANSI ".strtoupper(general::status_rawat2($sql_medc->tipe));
            
            $this->load->library('MedPDF');
            $pdf = new MedPDF('P', 'cm', array(21.5,33));
            $pdf->SetAutoPageBreak('auto', 6.5);
            $pdf->addPage();
            
            // Gambar Watermark Tengah
            $pdf->Image($gambar2,5,4,17,19);
            
            // Blok Judul
            $pdf->SetFont('Arial', 'B', '14');
            $pdf->Cell(19, .5, $judul, 0, 1, 'C');
            $pdf->Ln();
            
            // Blok ID PASIEN
            $pdf->SetFont('Arial', '', '9');
            $pdf->Cell(5.5, .5, 'TELAH MENERIMA PEMBAYARAN DARI :', '0', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->Cell(19, .5, strtoupper($sql_pasien->nama_pgl).' ('.$sql_pasien->kode_dpn . $sql_pasien->kode.')'.' / '.$this->tanggalan->usia($sql_pasien->tgl_lahir).' ('.general::jns_klm($sql_pasien->jns_klm).')', '0', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->Cell(19, .5, (!empty($sql_pasien->alamat) ? $sql_pasien->alamat : (!empty($sql_pasien->alamat_dom) ? $sql_pasien->alamat_dom : '-')), '0', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->Cell(19, .5, $sql_pasien->no_hp, '0', 0, 'L', $fill);
            $pdf->Ln(1);
            
            $fill = FALSE;
            $pdf->SetTextColor(5,148,19);
            $pdf->SetFont('Arial', 'B', '11');
            $pdf->Cell(5, 1, 'NO. INVOICE', 'TB', 0, 'L', $fill);
            $pdf->Cell(4, 1, 'TANGGAL', 'TB', 0, 'L', $fill);
            $pdf->Cell(6, 1, 'PLATFORM', 'TB', 0, 'L', $fill);
            $pdf->Cell(4, 1, 'NOMINAL', 'TB', 0, 'R', $fill);
            $pdf->SetTextColor(0,0,0);
            $pdf->Ln();
            
            $fill = FALSE;
            $no = 1; $gtotal = 0;
            foreach ($sql_medc_plat as $det){
                $sql_medc_itm = $this->db->where('id_medcheck', $det->id_medcheck)->where('id_item_kat', $det->id_item_kat)->get('tbl_trans_medcheck_det')->result();
                $sql_platform = $this->db->where('id', $det->id_platform)->get('tbl_m_platform')->row();
                
                $pdf->SetFont('Arial', '', '10');
                $pdf->Cell(5, .5, $det->no_nota, '', 0, 'L', $fill);
                $pdf->Cell(4, .5, $this->tanggalan->tgl_indo5($det->tgl_simpan), '', 0, 'L', $fill);
                $pdf->Cell(6, .5, $sql_platform->platform.($det->platform != '-' ? $det->platform : ''), '', 0, 'L', $fill);
                $pdf->Cell(4, .5, general::format_angka($det->nominal), '', 0, 'R', $fill);
                $pdf->Ln();
                
                $gtotal = $gtotal + $det->nominal;
            }
            
            // Kolom Total
//            $pdf->SetTextColor(5,148,19);
//            $pdf->SetFont('Arial', 'Bi', '10');            
//            $pdf->Cell(13, .5, '', '', 0, 'R', $fill);
//            $pdf->SetTextColor(5,148,19);
//            $pdf->Cell(3, .5, 'TOTAL BAYAR', '', 0, 'R', $fill);
//            $pdf->SetTextColor(0,0,0);
//            $pdf->Cell(3, .5, general::format_angka($gtotal), '', 0, 'R', $fill);
//            $pdf->Ln(1);
            
            // Kolom Grand Total
            $pdf->Ln();
            $pdf->SetTextColor(5,148,19);
            $pdf->SetFont('Arial', 'B', '10');            
            $pdf->Cell(13, .5, '', '', 0, 'R', $fill);
            $pdf->SetTextColor(5,148,19);
            $pdf->Cell(3, .5, 'GRAND TOTAL', 'T', 0, 'R', $fill);
            $pdf->SetTextColor(0,0,0);
            $pdf->Cell(3, .5, general::format_angka($sql_medc->jml_gtotal), 'T', 0, 'R', $fill);
            $pdf->Ln();
            // Kolom Grand Total          
            $pdf->Cell(13, .5, '', '', 0, 'R', $fill);
            $pdf->SetTextColor(5,148,19);
            $pdf->Cell(3, .5, 'TOTAL BAYAR', '', 0, 'R', $fill);
            $pdf->SetTextColor(0,0,0);
            $pdf->Cell(3, .5, general::format_angka($gtotal), '', 0, 'R', $fill);
            $pdf->Ln();
            // Kolom Grand Total          
            $pdf->Cell(13, .5, '', '', 0, 'R', $fill);
            $pdf->SetTextColor(5,148,19);
            $pdf->Cell(3, .5, 'KEMBALIAN', 'B', 0, 'R', $fill);
            $pdf->SetTextColor(0,0,0);
            $pdf->Cell(3, .5, general::format_angka($sql_medc->jml_kembali), 'B', 0, 'R', $fill);
            $pdf->Ln(1);
            
            // Kolom Terbilang
            $pdf->SetFont('Arial', 'Bi', '11');
            $pdf->SetTextColor(0,0,0);
            $pdf->Cell(3, .5, '  TERBILANG :  ', 'TB', 0, 'L', $fill);
            $pdf->SetFont('Arial', 'i', '11');
            $pdf->Cell(16, .5, strtoupper(penyebut($sql_medc->jml_gtotal)), 'TB', 0, 'L', $fill);
            $pdf->Ln();
            
            $pdf->Ln(1);
            
            // QR GENERATOR VALIDASI
            $qr_validasi        = FCPATH.'/file/pasien/'.strtolower($kode_pasien).'/qr-validasi-'.strtolower($kode_pasien).'.png';
            $params['data']     = 'Telah diverifikasi dan ditandatangani secara elektronik oleh manajemen '.$setting->judul.'. Pasien a/n. ';
            $params['data']    .= strtoupper($sql_pasien->nama_pgl).' ('.strtoupper($kode_pasien).')';
            $params['level']    = 'H';
            $params['size']     = 2;
            $params['savename'] = $qr_validasi; 
            $this->ciqrcode->generate($params);
            
            $gambar4            = $qr_validasi;
                        
            // QR GENERATOR PETUGAS KASIR
            $qr_kasir           = FCPATH.'/file/pasien/'.strtolower($kode_pasien).'/qr-kasir-'.strtolower(md5($kasir)).'.png';
            $params['data']     = 'Telah diverifikasi oleh petugas kasir '.$kasir.'. Pada tanggal '.$this->tanggalan->tgl_indo5($sql_medc->tgl_bayar);
            $params['level']    = 'H';
            $params['size']     = 2;
            $params['savename'] = $qr_kasir;
            $this->ciqrcode->generate($params);
            
            $gambar5            = $qr_kasir;
            
            // Gambar VALIDASI
            $getY = $pdf->GetY() + 1;
            $pdf->Image($gambar4,1,$getY,2,2);
            $pdf->Image($gambar5,12.5,$getY,2,2);

            $pdf->SetFont('Arial', '', '10');
            $pdf->Cell(11.5, .5, '', '', 0, 'L', $fill);
            $pdf->Cell(7.5, .5, 'Semarang, '.$this->tanggalan->tgl_indo3($sql_medc->tgl_bayar), '', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->Cell(11.5, .5, 'Validasi', '', 0, 'L', $fill);
            $pdf->Cell(7.5, .5, 'Petugas Kasir', '', 0, 'L', $fill);
            $pdf->Ln(2.5);
            
            $pdf->SetFont('Arial', '', '10');
            $pdf->Cell(11.5, .5, '', '', 0, 'L', $fill);
            $pdf->Cell(7.5, .5, '('.$kasir.')', '', 0, 'L', $fill);
            $pdf->Ln();

            $type = (isset($_GET['type']) ? $_GET['type'] : 'I');

            ob_start();
            $pdf->Output($sql_pasien->nama_pgl . '_KWI' . '.pdf', $type);
            ob_end_flush();
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }
    
    # LABEL
    public function pdf_medcheck_label() {
        if (akses::aksesLogin() == TRUE) {
            $setting            = $this->db->get('tbl_pengaturan')->row();
            $id_resep           = $this->input->get('id_resep');
            $id_medcheck        = $this->input->get('id');
            
            $sql_medc           = $this->db->where('id', general::dekrip($id_medcheck))->get('tbl_trans_medcheck')->row();
            $sql_medc_plat      = $this->db->where('id_medcheck', $sql_medc->id)->get('v_medcheck_plat')->result();
            $sql_medc_det       = $this->db->where('id_medcheck', $sql_medc->id)->group_by('id_item_kat')->get('tbl_trans_medcheck_det')->result();
            $sql_medc_res       = $this->db->where('id', general::dekrip($id_resep))->get('tbl_trans_medcheck_resep')->row();
            $sql_medc_res_det   = $this->db->where('id_resep', general::dekrip($id_resep))->get('tbl_trans_medcheck_resep_det')->result();
            $sql_pasien         = $this->db->where('id', $sql_medc->id_pasien)->get('tbl_m_pasien')->row(); 
            $sql_dokter         = $this->db->where('id_user', $sql_medc->id_dokter)->get('tbl_m_karyawan')->row();
            $kode_pasien        = $sql_pasien->kode_dpn.$sql_pasien->kode;
            $gambar1            = FCPATH.'/assets/theme/admin-lte-3/dist/img/logo-esensia-2.png';
            $gambar2            = FCPATH.'/assets/theme/admin-lte-3/dist/img/logo-bw-bg2-1440px.png';
            $gambar3            = FCPATH.'/assets/theme/admin-lte-3/dist/img/logo-footer.png';
            $kasir              = (!empty($sql_medc->id_kasir) ? $this->ion_auth->user($sql_medc->id_kasir)->row()->first_name : $this->ion_auth->user()->row()->first_name);

            
            $this->load->library('MedLblPDF');
            $pdf = new MedLblPDF('P', 'cm', 'a4');
            # LEft 1.65
            $pdf->SetMargins(1.40,1,0.1);
            $pdf->SetAutoPageBreak('auto', 9);
            $pdf->header = 0;
            $pdf->addPage('','',false);

            foreach ($sql_medc_res_det as $resep_det){                                
                $pdf->SetFont('Arial', '', '6');
                $pdf->Cell(1, .3, strtoupper($sql_pasien->kode_dpn . $sql_pasien->kode), 'LT', 0, 'L', $fill);
                $pdf->Cell(1.23, .3, '', 'T', 0, 'L', $fill);
                $pdf->Cell(1.23, .3, $this->tanggalan->tgl_indo2($sql_medc->tgl_masuk), 'TR', 0, 'R', $fill);
                $pdf->Cell(0.42, .3, '', '0', 0, '1', $fill); # Separator
                $pdf->Ln();
                $pdf->SetFont('Arial', '', '6');
                $pdf->Cell(3.46, .3, substr($sql_pasien->nama_pgl, 0, 19), 'LR', 0, 'L', $fill);
                $pdf->Cell(0.42, .3, '', '0', 0, '1', $fill); # Separator
                $pdf->Ln();
                $pdf->SetFont('Arial', '', '4.5');
                $pdf->Cell(3.46, .3, substr($resep_det->item, 0, 35), 'LR', 0, 'L', $fill);
                $pdf->Cell(0.42, .3, '', '0', 0, '1', $fill); # Separator
                $pdf->Ln();
                $pdf->SetFont('Arial', 'Bi', '6');
                $pdf->Cell(3.46, .3, (strlen($resep_det->dosis) == '8' ? '' : $resep_det->dosis), 'LR', 0, 'L', $fill);
                $pdf->Cell(0.42, .3, '', '', 0, '1', $fill); # Separator
                $pdf->Ln();
                $pdf->Cell(3.46, .3, '('.(float)$resep_det->jml.' '.$resep_det->satuan.')', 'LR', 0, 'L', $fill);
                $pdf->Cell(0.42, .3, '', '0', 0, '1', $fill); # Separator
                $pdf->Ln();
                $pdf->SetFont('Arial', 'B', '6');
                $pdf->Cell(3.46, .3, '- Semoga Lekas Sembuh -', 'LBR', 0, 'C', $fill);
                $pdf->Cell(0.42, .3, '', '0', 0, '1', $fill); # Separator
                $pdf->Ln(1.3);
            }

            $type = (isset($_GET['type']) ? $_GET['type'] : 'I');

            ob_start();
            $pdf->Output('label_'.str_replace(array('.', ' ', ','), '', strtolower($sql_pasien->nama)).'.pdf', $type);
            ob_end_flush();
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }
    
    # KWITANSI
    public function pdf_medcheck_kwi() {
        if (akses::aksesLogin() == TRUE) {
            $this->load->helper("terbilang");
            $setting            = $this->db->get('tbl_pengaturan')->row();
            $id_medcheck        = $this->input->get('id');
            $id                 = $this->input->get('id_kwi');
            
            $sql_medc           = $this->db->where('id', general::dekrip($id_medcheck))->get('tbl_trans_medcheck')->row();
            $sql_medc_kwi       = $this->db->where('id', general::dekrip($id))->get('tbl_trans_medcheck_kwi')->row();
            $sql_pasien         = $this->db->where('id', $sql_medc->id_pasien)->get('tbl_m_pasien')->row(); 
            $sql_dokter         = $this->db->where('id_user', $sql_medc->id_dokter)->get('tbl_m_karyawan')->row();
            $sql_user           = $this->db->where('id_user', $sql_medc_kwi->id_user)->get('tbl_m_karyawan')->row();
            $kode_pasien        = $sql_pasien->kode_dpn.$sql_pasien->kode;
            $gambar1            = FCPATH.'/assets/theme/admin-lte-3/dist/img/logo-header-es1.png'; // base_url('file/img/logo-header-es1.png');
            $gambar2            = FCPATH.'/assets/theme/admin-lte-3/dist/img/logo-header-es2.png'; // base_url('file/img/logo-header-es2.png');
            $gambar3            = FCPATH.'/assets/theme/admin-lte-3/dist/img/logo-header-es3.png'; // base_url('file/img/logo-header-es3.png');
            $gambar4            = FCPATH.'/assets/theme/admin-lte-3/dist/img/logo-header-es4.png'; // base_url('file/img/img/logo-header-es4.png');
            $kasir              = (!empty($sql_medc->id_kasir) ? $this->ion_auth->user($sql_medc->id_kasir)->row()->first_name : $this->ion_auth->user()->row()->first_name);

            $judul  = "RESUME MEDIS";
            $judul2 = "Medical Resume Result";
            
            $this->load->library('MedLblPDF');
            $pdf = new MedLblPDF('P', 'cm', array(21.5,33));
            $pdf->SetAutoPageBreak('auto', 6);
            $pdf->header = 0;
            $pdf->addPage('','',false);
                        
            // Gambar Logo Atas 1
            $pdf->Image($gambar1, 1.3, 1.15, 1.94, 1.21);
            // Gambar Logo Atas 2
            $pdf->Image($gambar2, 8.7, 1.15, 1.02, 1.15);
            // Gambar Logo Atas 3
            $pdf->Image($gambar3, 9.85, 1.15, 0.71, 1.59);
            // Gambar Logo Atas 4
            $pdf->Image($gambar4, 10.75, 1.15, 1.17, 1.23);

            $pdf->SetFont('Arial', '', '9');
            $pdf->Cell(11, 1.75, '', 'B', 0, 'L', $fill);
//            $pdf->Cell(2.5, 1.75, '', 'LTB', 0, 'L', $fill);
//            $pdf->Cell(5, 1.75, 'sas', 'LTB', 0, 'L', $fill);
//            $pdf->Cell(3.5, 1.75, '', 'LTB', 0, 'L', $fill);
            $pdf->Cell(3, 1.75, 'KWITANSI', 'B', 0, 'C', $fill);
            $pdf->Ln();
            $pdf->Cell(14, .5, '', '', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->SetFont('Arial', 'B', '9');
            $pdf->Cell(3, .5, 'Sudah terima dari', '', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '', 0, 'C', $fill);
            $pdf->SetFont('Arial', '', '9');
            $pdf->Cell(7.5, .5, $sql_medc_kwi->dari, '', 0, 'L', $fill);
            $pdf->Cell(.5, .5, 'Rp.', '', 0, '', $fill);
            $pdf->Cell(2.5, .5, general::format_angka($sql_medc_kwi->nominal), '', 0, 'R', $fill);
            $pdf->Ln();
            $pdf->SetFont('Arial', 'B', '9');
            $pdf->Cell(3, .5, 'Terbilang', '', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '', 0, 'C', $fill);
            $pdf->SetFont('Arial', 'i', '8');
            $pdf->MultiCell(10.5, .5, strtoupper(general::format_angka_str($sql_medc_kwi->nominal)).' RUPIAH', '', 'L');
//            $pdf->Cell(10.5, .5, strtoupper(general::format_angka_str($sql_medc_kwi->nominal)).' RUPIAH', 'R', 0, 'L', $fill);
//            $pdf->Ln();
            $pdf->SetFont('Arial', 'B', '9');
            $pdf->Cell(3, .5, 'Untuk Pembayaran', '', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '', 0, 'C', $fill);
            $pdf->SetFont('Arial', '', '9');
            $pdf->Cell(10.5, .5, $sql_medc_kwi->ket, '', 0, 'C', $fill);
            $pdf->Ln();
            $pdf->SetFont('Arial', 'B', '9');
            $pdf->Cell(3, .5, '', '', 0, 'L', $fill);
            $pdf->Cell(.5, .5, '', '', 0, 'C', $fill);
            $pdf->SetFont('Arial', '', '9');
            $pdf->Cell(10.5, .5, $sql_pasien->nama_pgl, '', 0, 'C', $fill);
            $pdf->Ln();
            
            # Jika diagnosa tidak diisi maka tidak tambpil
            if(!empty($sql_medc_kwi->diagnosa)){
                $pdf->SetFont('Arial', 'B', '9');
                $pdf->Cell(3, .5, 'Diagnosa', '', 0, 'L', $fill);
                $pdf->Cell(.5, .5, ':', '', 0, 'C', $fill);
                $pdf->SetFont('Arial', '', '9');
                $pdf->MultiCell(10.5, .5, $sql_medc_kwi->diagnosa, '', 'L');
                $pdf->Ln();
                $pdf->Cell(14, .5, '', '', 0, 'L', $fill);
                $pdf->Ln();
            }
            $pdf->SetFont('Arial', 'B', '9');
            $pdf->Cell(3, .5, '', '', 0, 'L', $fill);
            $pdf->Cell(.5, .5, '', '', 0, 'C', $fill);
            $pdf->SetFont('Arial', '', '9');
            $pdf->Cell(7.5, .5, '', '', 0, 'L', $fill);
            $pdf->Cell(3, .5, 'Semarang, '.$this->tanggalan->tgl_indo3($sql_medc_kwi->tgl_masuk), '', 0, 'R', $fill);
            $pdf->Ln();
            $pdf->Cell(14, .5, '', '', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->SetFont('Arial', '', '7');
            $pdf->Cell(14, .5, $setting->judul, '', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->Cell(14, .5, $setting->alamat, '', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->Cell(9, .5, $setting->tlp, 'B', 0, 'L', $fill);
            $pdf->Cell(5, .5, $sql_user->nama, 'B', 0, 'R', $fill);
            $pdf->Ln();

            $type = (isset($_GET['type']) ? $_GET['type'] : 'I');

            ob_start();
            $pdf->Output($sql_pasien->nama_pgl.'_KWI'. '.pdf', $type);
            ob_end_flush();
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }
    
    # RESEP
    public function pdf_medcheck_resep() {
        if (akses::aksesLogin() == TRUE) {
            $setting            = $this->db->get('tbl_pengaturan')->row();
            $id_medcheck        = $this->input->get('id');
            $id_resep           = $this->input->get('id_resep');
            
            $sql_medc           = $this->db->where('id', general::dekrip($id_medcheck))->get('tbl_trans_medcheck')->row();
            $sql_medc_res       = $this->db->where('id', general::dekrip($id_resep))->get('tbl_trans_medcheck_resep')->row();
            $sql_medc_rsp       = $this->db->where('id_resep', general::dekrip($id_resep))->get('tbl_trans_medcheck_resep_det')->result();
            $sql_poli           = $this->db->where('id', $sql_medc->id_poli)->get('tbl_m_poli')->row(); 
            $sql_pasien         = $this->db->where('id', $sql_medc->id_pasien)->get('tbl_m_pasien')->row(); 
            $sql_dokter         = $this->db->where('id_user', $sql_medc->id_dokter)->get('tbl_m_karyawan')->row();
            $kode_pasien        = $sql_pasien->kode_dpn.$sql_pasien->kode;
            $gambar1            = FCPATH.'/assets/theme/admin-lte-3/dist/img/logo-esensia-2.png';
            $gambar2            = FCPATH.'/assets/theme/admin-lte-3/dist/img/logo-bw-bg2-1440px.png';
            $gambar3            = FCPATH.'/assets/theme/admin-lte-3/dist/img/logo-footer.png';

            $judul  = "RESEP";
            
            $this->load->library('MedResepPDF');
            $pdf = new MedResepPDF('P', 'cm', array(11,20));
            $pdf->SetAutoPageBreak('auto', 7);
            $pdf->SetMargins(1,0.35,1);
            $pdf->header = 0;
            $pdf->addPage('','',false);
                                    
            // Blok ID PASIEN
            $pdf->SetFont('Arial', 'B', '9');
            $pdf->Cell(4, .5, '', '0', 0, 'L', $fill);
            $pdf->SetFont('Arial', '', '9');
            $pdf->Cell(5.5, .5, $setting->kota.', '.$this->tanggalan->tgl_indo3($sql_medc->tgl_masuk), '', 0, 'R', $fill);
            $pdf->Ln();
            $pdf->SetFont('Arial', 'B', '9');
            $pdf->Cell(1, .5, 'Dokter', '0', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
            $pdf->SetFont('Arial', '', '9');
            $pdf->MultiCell(7, .5, (!empty($sql_dokter->nama_dpn) ? $sql_dokter->nama_dpn.' ' : '').$sql_dokter->nama.(!empty($sql_dokter->nama_blk) ? ', '.$sql_dokter->nama_blk.' ' : ''), '0', 'L');
            $pdf->SetFont('Arial', 'B', '9');
            $pdf->Cell(1, .5, 'SIP', '0', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '0', 0, 'C', $fill);
            $pdf->SetFont('Arial', '', '9');
            $pdf->Cell(8, .5, $sql_dokter->sip, '', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->SetFont('Arial', 'B', '9');
            $pdf->Cell(1, .5, 'Poli', '', 0, 'L', $fill);
            $pdf->Cell(.5, .5, ':', '', 0, 'C', $fill);
            $pdf->SetFont('Arial', '', '9');
            $pdf->Cell(7, .5, $sql_poli->lokasi, '', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->Cell(9.5, .5, '', 'T', 0, 'L', $fill);
            $pdf->Ln();
            
            # DATA RESEP            
            $fill = FALSE;
            $no   = 1;
            foreach ($sql_medc_rsp as $res){
                $sql_medc_rsp_rc = $this->db->where('id_resep_det', $res->id)->get('tbl_trans_medcheck_resep_det_rc')->result();
                
                $pdf->SetFont('Arial', 'B', '9');
                $pdf->Cell(.5, .5, 'R/', '', 0, 'L', $fill);
                $pdf->SetFont('Arial', '', '9');
                $pdf->Cell(7, .5, $res->item, '', 0, 'L', $fill);
                $pdf->Cell(2, .5, (empty($res->resep) ? (float)$res->jml.' '.$res->satuan : ''), '', 0, 'L', $fill);
                $pdf->Ln();
                
                # Item Racikan
                foreach ($sql_medc_rsp_rc as $res_rc){
                    $pdf->Cell(.5, .25, '', '', 0, 'L', $fill);
                    $pdf->SetFont('Arial', 'i', '7');
                    $pdf->Cell(7, .25, '- '.$res_rc->item, '', 0, 'L', $fill);
                    $pdf->Cell(2, .25, (float)$res_rc->jml.' '.$res_rc->satuan, '', 0, 'L', $fill);
                    $pdf->Ln();                    
                }
                
                # Dosis resep
                $pdf->SetFont('Arial', 'i', '8');
                $pdf->Cell(.5, .5, '', '', 0, 'L', $fill);
                $pdf->Cell(9, .5, ($res->dosis != '  Tiap  ' ? (!empty($res->dosis) ? '('.$res->dosis.' / ' : '(').$res->dosis_ket.')' : ''), '', 0, 'L', $fill);
                $pdf->Ln();                
            }
            
            $pdf->Ln();
            $pdf->Cell(9.5, .5, 'TTD Pasien', 'T', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->SetFont('Arial', '', '7');
            $pdf->Cell(1.5, .3, '', 'TLR', 0, 'L', $fill);
            $pdf->Cell(1, .3, 'Pro', '', 0, 'L', $fill);
            $pdf->Cell(.5, .3, ':', '0', 0, 'C', $fill);
            $pdf->Cell(6.5, .3, $sql_pasien->nama_pgl.' ('.$sql_pasien->jns_klm.') / '.$kode_pasien, '0', 0, 'L', $fill);
            
            if(!empty($sql_medc->ttd_obat)){
                # Gambar TTD Pasien
                $gambar4    = FCPATH.$sql_medc->ttd_obat;
                $getY       = $pdf->GetY();
                $pdf->Image($gambar4,1,$getY,2,2);
            }
            
            $pdf->Ln();
            $pdf->Cell(1.5, .3, '', 'LR', 0, 'L', $fill);
            $pdf->Cell(1, .3, 'Umur', '0', 0, 'L', $fill);
            $pdf->Cell(.5, .3, ':', '0', 0, 'C', $fill);
            $pdf->Cell(6.5, .3, $this->tanggalan->usia_lkp($sql_pasien->tgl_lahir), '0', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->Cell(1.5, .3, '', 'LRB', 0, 'L', $fill);
            $pdf->Cell(1, .3, 'Alamat', '0', 0, 'L', $fill);
            $pdf->Cell(.5, .3, ':', '0', 0, 'C', $fill);
            $pdf->MultiCell(6.5, .3, (!empty($sql_pasien->alamat) ? $sql_pasien->alamat : (!empty($sql_pasien->alamat_dom) ? $sql_pasien->alamat_dom : '-')), '0', 'L');
            $pdf->Ln();
            $pdf->Cell(2, .3, 'Diserahkan Oleh', '', 0, 'L', $fill);
            $pdf->Cell(.5, .3, ':', '0', 0, 'C', $fill);
            $pdf->Cell(6, .3, $this->ion_auth->user($sql_medc->id_farmasi)->row()->first_name, '0', 0, 'L', $fill);
            $pdf->Ln();
            $pdf->Cell(2, .3, $this->tanggalan->tgl_indo5($sql_medc->tgl_ttd), '', 0, 'L', $fill);
            
            
//            // QR GENERATOR VALIDASI
//            $qr_validasi        = FCPATH.'/file/pasien/'.strtolower($kode_pasien).'/qr-validasi-'.strtolower($kode_pasien).'.png';
//            $params['data']     = 'https://verify.esensia.co.id/?id='.general::enkrip($sql_medc_srt->id).'&id_pasien='.general::enkrip($sql_pasien->id).'&role=surat';
////            $params['data']     = 'Telah diverifikasi dan ditandatangani secara elektronik oleh manajemen '.$setting->judul.'. Pasien a/n. ';
////            $params['data']    .= strtoupper($sql_pasien->nama_pgl).' ('.strtoupper($kode_pasien).')';
//            $params['level']    = 'H';
//            $params['size']     = 2;
//            $params['savename'] = $qr_validasi; 
//            $this->ciqrcode->generate($params);
//            
//            $gambar4            = $qr_validasi; 
//                        
//            // QR GENERATOR DOKTER
//            $qr_dokter          = FCPATH.'/file/pasien/'.strtolower($kode_pasien).'/qr-dokter-'.strtolower($sql_dokter->id).'.png';
//            $params['data']     = 'Telah diverifikasi dan ditandatangani secara elektronik oleh dokter penanggung jawab ['.(!empty($sql_dokter->nama_dpn) ? $sql_dokter->nama_dpn.' ' : '').$sql_dokter->nama.(!empty($sql_dokter->nama_blk) ? ', '.$sql_dokter->nama_blk : '').']';
//            $params['level']    = 'H';
//            $params['size']     = 2;
//            $params['savename'] = $qr_dokter;
//            $this->ciqrcode->generate($params);
//            
//            $gambar5            = $qr_dokter;
            
//            $pdf->Image($gambar5,13.5,$getY,2,2);
//            
//            $pdf->SetFont('Arial', '', '10');
//            $pdf->Cell(10.5, .5, '', '', 0, 'L', $fill);
//            $pdf->Cell(8.5, .5, '', '', 0, 'L', $fill);
//            $pdf->Ln();
//            $pdf->SetFont('Arial', 'B', '10');
//            $pdf->Cell(4, .5, 'Validasi', '0', 0, 'C', $fill);
//            $pdf->Cell(6.5, .5, '', '0', 0, 'C', $fill);
//            $pdf->SetFont('Arial', '', '10');
//            $pdf->Cell(8.5, .5, 'Semarang, '.$this->tanggalan->tgl_indo3($sql_medc_rsm->tgl_masuk), '0', 0, 'C', $fill);
//            $pdf->Ln(2.5);
//            
//            $pdf->SetFont('Arial', '', '10');
//            $pdf->Cell(10.5, .5, '', '0', 0, 'L', $fill);
//            $pdf->Cell(8.5, .5, (!empty($sql_dokter->nama_dpn) ? $sql_dokter->nama_dpn.' ' : '').$sql_dokter->nama.(!empty($sql_dokter->nama_blk) ? ', '.$sql_dokter->nama_blk.' ' : ''), '0', 0, 'C', $fill);
//            $pdf->Ln();
//                    
//            $pdf->SetFillColor(235, 232, 228);
//            $pdf->SetTextColor(0);
//            $pdf->SetFont('Arial', '', '10');
            
            $type = (isset($_GET['type']) ? $_GET['type'] : 'I');
            
            ob_start();
            $pdf->Output($sql_pasien->nama_pgl. '.pdf', $type);
            ob_end_flush();
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }
    
    # XLS LABEL
    public function xls_medcheck_label(){
        if (akses::aksesLogin() == TRUE) {
            $setting            = $this->db->get('tbl_pengaturan')->row();
            $id_resep           = $this->input->get('id_resep');
            $id_medcheck        = $this->input->get('id');

            $sql_medc           = $this->db->where('id', general::dekrip($id_medcheck))->get('tbl_trans_medcheck')->row();
            $sql_medc_plat      = $this->db->where('id_medcheck', $sql_medc->id)->get('v_medcheck_plat')->result();
            $sql_medc_det       = $this->db->where('id_medcheck', $sql_medc->id)->group_by('id_item_kat')->get('tbl_trans_medcheck_det')->result();
            $sql_medc_res       = $this->db->where('id', general::dekrip($id_resep))->get('tbl_trans_medcheck_resep')->row();
            $sql_medc_res_det   = $this->db->where('id_resep', general::dekrip($id_resep))->get('tbl_trans_medcheck_resep_det')->result();
            $sql_pasien         = $this->db->where('id', $sql_medc->id_pasien)->get('tbl_m_pasien')->row(); 
            $sql_dokter         = $this->db->where('id_user', $sql_medc->id_dokter)->get('tbl_m_karyawan')->row();
            $kode_pasien        = $sql_pasien->kode_dpn.$sql_pasien->kode;
            $res                = str_replace('/','', $sql_medc_res->no_resep);
            $no_res             = strtolower($res);

            $objPHPExcel = new PHPExcel();

            // Header Tabel Nota
            $objPHPExcel->getActiveSheet()->getStyle('A1:N1')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
            $objPHPExcel->getActiveSheet()->getStyle('A1:N1')->getFont()->setBold(TRUE);

            $objPHPExcel->setActiveSheetIndex(0)
                    ->setCellValue('A1', '')
                    ->setCellValue('B1', 'Tanggal')
                    ->setCellValue('C1', 'RM')
                    ->setCellValue('D1', 'Pasien')
                    ->setCellValue('E1', 'Tgl Lahir')
                    ->setCellValue('F1', 'L/P')
                    ->setCellValue('G1', 'Item')
                    ->setCellValue('H1', 'Qty')
                    ->setCellValue('I1', 'Satuan')
                    ->setCellValue('J1', 'Exp')
                    ->setCellValue('K1', 'Dosis')
                    ->setCellValue('L1', 'Keterangan')
                    ->setCellValue('M1', 'Dokter')
                    ->setCellValue('N1', 'Judul');

            $objPHPExcel->getActiveSheet()->getColumnDimension('A')->setWidth(2);
            $objPHPExcel->getActiveSheet()->getColumnDimension('B')->setWidth(13);
            $objPHPExcel->getActiveSheet()->getColumnDimension('C')->setWidth(10);
            $objPHPExcel->getActiveSheet()->getColumnDimension('D')->setWidth(65);
            $objPHPExcel->getActiveSheet()->getColumnDimension('E')->setWidth(30);
            $objPHPExcel->getActiveSheet()->getColumnDimension('F')->setWidth(14);
            $objPHPExcel->getActiveSheet()->getColumnDimension('G')->setWidth(50);
            $objPHPExcel->getActiveSheet()->getColumnDimension('H')->setWidth(8);
            $objPHPExcel->getActiveSheet()->getColumnDimension('I')->setWidth(10);
            $objPHPExcel->getActiveSheet()->getColumnDimension('J')->setWidth(13);
            $objPHPExcel->getActiveSheet()->getColumnDimension('K')->setWidth(40);
            $objPHPExcel->getActiveSheet()->getColumnDimension('L')->setWidth(30);
            $objPHPExcel->getActiveSheet()->getColumnDimension('M')->setWidth(65);
            $objPHPExcel->getActiveSheet()->getColumnDimension('N')->setWidth(40);

            if(!empty($sql_medc_res_det)){
                $no    = 1;
                $cell  = 2;
                $total = 0;
                foreach ($sql_medc_res_det as $resep_det){
                    $sql_doc    = $this->db->where('id_user', $sql_medc->id_dokter)->get('tbl_m_karyawan')->row();
                    $item       = $this->db->where('id', $resep_det->id_item)->get('tbl_m_produk')->row();

                    $objPHPExcel->getActiveSheet()->getStyle('B'.$cell.':C'.$cell)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
                    $objPHPExcel->getActiveSheet()->getStyle('D'.$cell)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_LEFT);
                    $objPHPExcel->getActiveSheet()->getStyle('E'.$cell.':F'.$cell)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
                    $objPHPExcel->getActiveSheet()->getStyle('G'.$cell)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_LEFT);
                    $objPHPExcel->getActiveSheet()->getStyle('H'.$cell.':J'.$cell)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
                    $objPHPExcel->getActiveSheet()->getStyle('K'.$cell.':M'.$cell)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_LEFT);
                    
                    $objPHPExcel->setActiveSheetIndex(0)
                            ->setCellValue('A'.$cell, '')
                            ->setCellValue('B'.$cell, $this->tanggalan->tgl_indo($resep_det->tgl_simpan))
                            ->setCellValue('C'.$cell, $kode_pasien)
                            ->setCellValue('D'.$cell, $sql_pasien->nama)
                            ->setCellValue('E'.$cell, $this->tanggalan->tgl_indo($sql_pasien->tgl_lahir).' ('.$this->tanggalan->usia_lkp($sql_pasien->tgl_lahir).')')
                            ->setCellValue('F'.$cell, general::jns_klm($sql_pasien->jns_klm))
                            ->setCellValue('G'.$cell, $resep_det->item)
                            ->setCellValue('H'.$cell, (float)$resep_det->jml)
                            ->setCellValue('I'.$cell, $resep_det->satuan)
                            ->setCellValue('J'.$cell, ($resep_det->tgl_ed != '0000-00-00' ? $this->tanggalan->tgl_indo($resep_det->tgl_ed) : ''))
                            ->setCellValue('K'.$cell, ($resep_det->dosis == '  Tiap  ' ? '' : $resep_det->dosis))
                            ->setCellValue('L'.$cell, $resep_det->dosis_ket)
                            ->setCellValue('M'.$cell, (!empty($sql_doc->nama_dpn) ? $sql_doc->nama_dpn.' ' : '').$sql_doc->nama.(!empty($sql_doc->nama_blk) ? ', '.$sql_doc->nama_blk : ''))
                            ->setCellValue('N'.$cell, $setting->judul);

                    $no++;
                    $cell++;
                }
            }

            // Rename worksheet
            $objPHPExcel->getActiveSheet()->setTitle('Label Farmasi');

            /** Page Setup * */
            $objPHPExcel->getActiveSheet()->getPageSetup()->setOrientation(PHPExcel_Worksheet_PageSetup::ORIENTATION_PORTRAIT);
            $objPHPExcel->getActiveSheet()->getPageSetup()->setPaperSize(PHPExcel_Worksheet_PageSetup::PAPERSIZE_A4);

            /* -- Margin -- */
            $objPHPExcel->getActiveSheet()
                    ->getPageMargins()->setTop(0.25);
            $objPHPExcel->getActiveSheet()
                    ->getPageMargins()->setRight(0);
            $objPHPExcel->getActiveSheet()
                    ->getPageMargins()->setLeft(0);
            $objPHPExcel->getActiveSheet()
                    ->getPageMargins()->setFooter(0);


            /** Page Setup * */
            // Set document properties
            $objPHPExcel->getProperties()->setCreator("Mikhael Felian Waskito")
                    ->setLastModifiedBy($this->ion_auth->user()->row()->username)
                    ->setTitle("Stok")
                    ->setSubject("Aplikasi Bengkel POS")
                    ->setDescription("Kunjungi http://tigerasoft.co.id")
                    ->setKeywords($setting->judul_app)
                    ->setCategory("Untuk mencetak nota dot matrix");



            // Redirect output to a client’s web browser (Excel5)
            header('Content-Type: application/vnd.ms-excel');
            // header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
            header('Content-Disposition: attachment;filename="label_'.$no_res.'_'.str_replace(array(' ','.'),'_', strtolower($sql_pasien->nama)).'.xls"');

            // If you're serving to IE over SSL, then the following may be needed
            header('Expires: Mon, 15 Feb 1992 05:00:00 GMT'); // Date in the past
            header('Last-Modified: ' . gmdate('D, d M Y H:i:s') . ' GMT'); // always modified
            header('Cache-Control: cache, must-revalidate'); // HTTP/1.1
            header('Pragma: public'); // HTTP/1.0

            ob_clean();
            $objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel5');
            $objWriter->save('php://output');
            exit;
        }else{
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }


    # Pencarian modul pendaftaran
    public function set_cari_daftar() {
        if (akses::aksesLogin() == TRUE) {
            $id         = $this->input->post('id_medcheck');
            $nama       = $this->input->post('pasien');
            $tipe       = $this->input->post('tipe');
            $tgl        = $this->input->post('tgl_daftar');
            $status_byr = $this->input->post('status_bayar');

            $sql        = $sql   = $this->db->select('*')->where('status_akt !=', '2')->like('nama',$nama)->limit(10)->get('tbl_pendaftaran');
            
            $sql_row    = $sql->row();
            $sql_jml    = $sql->num_rows();
            
            redirect(base_url('medcheck/data_pendaftaran.php?'.(!empty($tgl) ? 'filter_tgl='.$this->tanggalan->tgl_indo_sys($tgl) : '').(!empty($nama) ? 'filter_nama='.$nama : '').(!empty($id) ? '&id='.general::enkrip($id) : '')));
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }
    
    

    public function set_cari_medcheck() {
        if (akses::aksesLogin() == TRUE) {
            $id         = $this->input->post('id_medcheck');
            $nama       = $this->input->post('pasien');
            $tipe       = $this->input->post('tipe');
            $tgl        = $this->input->post('tgl');
            $status_byr = $this->input->post('status_bayar');

            $sql        = $this->db
                                    ->where('status_hps', '0')
                                    ->where('status_pos', '0')
                                    ->like('DATE(tgl_masuk)', $this->tanggalan->tgl_indo_sys($tgl))
                                    ->like('id', $id)
                                    ->like('pasien', $nama)
                                    ->like('tipe', $tipe)
                                    ->like('status_bayar', $status_byr)
                                    ->get('v_medcheck');
            
            $sql_row    = $sql->row();
            $sql_jml    = $sql->num_rows();
            
            redirect(base_url('medcheck/index.php?tipe=1'.(!empty($nama) ? '&filter_nama='.$nama : '').(!empty($id) ? '&id='.general::enkrip($id) : '').(!empty($tgl) ? '&filter_tgl='.$this->tanggalan->tgl_indo_sys($tgl) : '').(!empty($tipe) ? '&filter_tipe='.$tipe : '').(isset($status_byr) ? '&filter_bayar='.$status_byr : '')));
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }

    public function set_cari_medcheck_kons() {
        if (akses::aksesLogin() == TRUE) {
            $nama       = $this->input->post('pasien');

            $sql        = $this->db
                                ->select('tbl_trans_medcheck.id, tbl_trans_medcheck.tgl_masuk, tbl_trans_medcheck.no_nota, tbl_trans_medcheck.no_rm, tbl_trans_medcheck.tipe AS tipe_rawat, tbl_m_pasien.id AS id_pasien, tbl_m_pasien.nik, tbl_m_pasien.nama, tbl_m_pasien.nama_pgl, tbl_m_pasien.no_hp, tbl_m_pasien.tgl_lahir, tbl_m_pasien.jns_klm, tbl_m_pasien.alamat, tbl_m_poli.lokasi AS poli')
                                ->join('tbl_m_pasien', 'tbl_m_pasien.id=tbl_trans_medcheck.id_pasien')
                                ->join('tbl_m_poli', 'tbl_m_poli.id=tbl_trans_medcheck.id_poli')
                                ->where('tbl_trans_medcheck.status_hps', '0')
                                ->like('tbl_trans_medcheck.pasien', $nama)
                                ->get('tbl_trans_medcheck');
            
            $sql_row    = $sql->row();
            $sql_jml    = $sql->num_rows();
            
            redirect(base_url('medcheck/data_konsul_cari.php?tipe=1'.(!empty($nama) ? '&filter_nama='.$nama : '').(!empty($sql_jml) ? '&jml='.$sql_jml : '')));
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }

    public function set_cari_medcheck_rad() {
        if (akses::aksesLogin() == TRUE) {
            $id         = $this->input->post('id_medcheck');
            $nama       = $this->input->post('pasien');
            $tipe       = $this->input->post('tipe');
            $tgl        = $this->input->post('tgl');
            $status     = $this->input->post('status');

            $sql        = $this->db
                                ->select('tbl_trans_medcheck.id, tbl_trans_medcheck.tgl_masuk, tbl_trans_medcheck.no_nota, tbl_trans_medcheck.no_rm, tbl_trans_medcheck.tipe AS tipe_rawat, tbl_m_pasien.id AS id_pasien, tbl_m_pasien.nik, tbl_m_pasien.nama, tbl_m_pasien.nama_pgl, tbl_m_pasien.no_hp, tbl_m_pasien.tgl_lahir, tbl_m_pasien.jns_klm, tbl_m_pasien.alamat, tbl_m_poli.lokasi AS poli')
                                ->join('tbl_m_pasien', 'tbl_m_pasien.id=tbl_trans_medcheck.id_pasien')
                                ->join('tbl_m_poli', 'tbl_m_poli.id=tbl_trans_medcheck.id_poli')
                                ->where('tbl_trans_medcheck.status_hps', '0')
                                ->like('DATE(tbl_trans_medcheck.tgl_masuk)', $this->tanggalan->tgl_indo_sys($tgl))
                                ->like('tbl_trans_medcheck.id', $id)
                                ->like('tbl_trans_medcheck.pasien', $nama)
                                ->like('tbl_trans_medcheck.tipe', $tipe)
                                ->like('tbl_trans_medcheck.status_bayar', $status_byr)
                                ->get('tbl_trans_medcheck');
            
            $sql_row    = $sql->row();
            $sql_jml    = $sql->num_rows();
            
            redirect(base_url('medcheck/data_radiologi.php?status='.$status.(!empty($nama) ? '&filter_nama='.$nama : '').(!empty($id) ? '&id='.general::enkrip($id) : '').(!empty($tgl) ? '&filter_tgl='.$this->tanggalan->tgl_indo_sys($tgl) : '').(!empty($tipe) ? '&filter_tipe='.$tipe : '')));
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }

    public function set_cari_medcheck_batal() {
        if (akses::aksesLogin() == TRUE) {
            $id         = $this->input->post('id_medcheck');
            $nama       = $this->input->post('pasien');
            $tipe       = $this->input->post('tipe');
            $tgl        = $this->input->post('tgl');
            $status_byr = $this->input->post('status_bayar');

            $sql        = $this->db
                                   ->like('DATE(tgl_masuk)', $this->tanggalan->tgl_indo_sys($tgl))
                                   ->like('id', $id)
                                   ->like('pasien', $nama)
                                   ->like('tipe', $tipe)
                                   ->like('status_bayar', $status_byr)
                                   ->get('v_medcheck_hapus');
            
            $sql_row    = $sql->row();
            $sql_jml    = $sql->num_rows();
            
            redirect(base_url('medcheck/data_hapus.php?tipe=1'.(!empty($nama) ? '&filter_nama='.$nama : '').(!empty($id) ? '&id='.general::enkrip($id) : '').(!empty($tgl) ? '&filter_tgl='.$this->tanggalan->tgl_indo_sys($tgl) : '').(!empty($tipe) ? '&filter_tipe='.$tipe : '').(isset($status_byr) ? '&filter_bayar='.$status_byr : '')));
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }

    public function set_cari_medcheck_bayar() {
        if (akses::aksesLogin() == TRUE) {
            $id         = $this->input->post('id_medcheck');
            $nama       = $this->input->post('pasien');
            $tgl_msk    = $this->input->post('tgl');

            $sql        = $this->db
                                ->select('tbl_trans_medcheck.id, tbl_trans_medcheck.tgl_masuk, tbl_trans_medcheck.no_nota, tbl_trans_medcheck.no_rm, tbl_trans_medcheck.tipe AS tipe_rawat, tbl_m_pasien.id AS id_pasien, tbl_m_pasien.nik, tbl_m_pasien.nama, tbl_m_pasien.nama_pgl, tbl_m_pasien.no_hp, tbl_m_pasien.tgl_lahir, tbl_m_pasien.jns_klm, tbl_m_pasien.alamat, tbl_m_poli.lokasi AS poli')
                                ->join('tbl_m_pasien', 'tbl_m_pasien.id=tbl_trans_medcheck.id_pasien')
                                ->join('tbl_m_poli', 'tbl_m_poli.id=tbl_trans_medcheck.id_poli')
                                ->where('tbl_trans_medcheck.status >=', '5')
                                ->where('tbl_trans_medcheck.status_bayar !=', '1')
                                ->like('tbl_trans_medcheck.tgl_masuk', $this->tanggalan->tgl_indo_sys($tgl_msk))
                                ->like('tbl_trans_medcheck.pasien', $nama)
                                ->get('tbl_trans_medcheck');
            
            $sql_row    = $sql->row();
            $sql_jml    = $sql->num_rows();
            
            redirect(base_url('medcheck/data_pemb.php?tipe=1'.(!empty($nama) ? '&filter_nama='.$nama : '').(!empty($tgl_msk) ? '&filter_tgl='.$this->tanggalan->tgl_indo_sys($tgl_msk) : '')));
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }
    
    public function set_cari_konsul() {
        if (akses::aksesLogin() == TRUE) {
            $nama       = $this->input->post('judul');

            $sql        = $this->db
                                ->select('id')
                                ->where('id_parent', '0')
                                ->like('judul', $nama)
                                ->get('tbl_trans_konsul');
            
            $sql_row    = $sql->row();
            $sql_jml    = $sql->num_rows();
            
            redirect(base_url('medcheck/data_konsul.php?'.(!empty($nama) ? 'filter_judul='.$nama.'&' : '').(!empty($sql_jml) ? 'jml='.$sql_jml : '')));
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }

    public function set_cari_resep() {
        if (akses::aksesLogin() == TRUE) {
            $f_nama = $this->input->post('pasien');
            $f_tgl  = $this->input->post('tgl');
                        
            redirect(base_url('medcheck/resep/data_resep.php?'.(!empty($f_tgl) ? 'filter_tgl='.$this->tanggalan->tgl_indo_sys($f_tgl).'&' : '').(!empty($f_nama) ? 'filter_nama='.$f_nama.'&' : '').(!empty($sql_jml) ? 'jml='.$sql_jml : '')));
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }
    
    public function json_pasien() {
        if (akses::aksesLogin() == TRUE) {
            $term  = $this->input->get('term');
            $sql   = $this->db->select('id, kode, kode_dpn, nik, nama_pgl, alamat, jns_klm, tgl_lahir')
                              ->like('nama',$term)
                              ->or_like('nik',$term)
                              ->or_like('alamat',$term)
                              ->limit(200)->get('tbl_m_pasien')->result();
            
            if(!empty($sql)){
                foreach ($sql as $sql){
                    $produk[] = array(
                        'id'         => $sql->id,
                        'id_pas'     => general::enkrip($sql->id),
                        'kode'       => $sql->kode_dpn.$sql->kode,
                        'nik'        => $sql->nik,
                        'nama'       => $sql->nama_pgl,
                        'nama2'      => $sql->nama,
                        'tgl_lahir'  => $sql->tgl_lahir,
                        'jns_klm'    => $sql->jns_klm,
                        'alamat'     => $sql->alamat,
                    );
                }
                
                if(!empty($term)){
                    echo json_encode($produk);
                }
            }
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }
    
    public function json_pasien_gc() {
        if (akses::aksesLogin() == TRUE) {
            $term  = $this->input->get('term');
            $sql   = $this->db->select('id, kode, kode_dpn, nik, nama_pgl, alamat, jns_klm, tgl_lahir')
                              ->like('nama',$term)
                              ->or_like('nik',$term)
                              ->or_like('alamat',$term)
                              ->limit(200)->get('tbl_m_pasien')->result();
            
            if(!empty($sql)){
                foreach ($sql as $sql){
                    $produk[] = array(
                        'id'         => $sql->id,
                        'id_pas'     => general::enkrip($sql->id),
                        'kode'       => $sql->kode_dpn.$sql->kode,
                        'nik'        => $sql->nik,
                        'nama'       => $sql->nama_pgl,
                        'nama2'      => $sql->nama,
                        'tgl_lahir'  => $sql->tgl_lahir,
                        'jns_klm'    => $sql->jns_klm,
                        'alamat'     => $sql->alamat,
                    );
                }
                
                if(!empty($term)){
                    echo json_encode($produk);
                }
            }
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }
    
    public function json_dokter() {
        if (akses::aksesLogin() == TRUE) {
            $term  = $this->input->get('term');
            $sql   = $this->db->select('id, id_user, kode, nik, nama, nama_dpn, nama_blk')->like('nama',$term)->where('id_user_group', '10')->get('tbl_m_karyawan')->result();
            
            if(!empty($sql)){
                foreach ($sql as $sql){
                    $produk[] = array(
                        'id'         => $sql->id,
                        'id_user'    => $sql->id_user,
                        'kode'       => $sql->kode,
                        'nik'        => $sql->nik,
                        'nama'       => (!empty($sql->nama_dpn) ? $sql->nama_dpn.' ' : '').$sql->nama.(!empty($sql->nama_blk) ? ', '.$sql->nama_blk : ''),
                    );
                }
                echo json_encode($produk);
            }
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }
    
    public function json_item() {
        if (akses::aksesLogin() == TRUE) {
            $term  = $this->input->get('term');
            $stat  = $this->input->get('status');
            $page  = $this->input->get('page');
            $sg    = $this->ion_auth->user()->row()->status_gudang;
            
            switch ($page){
                default:
                    $sql = $this->db->select('tbl_m_produk.id, tbl_m_produk.id_satuan, tbl_m_produk.kode, tbl_m_produk.produk, tbl_m_produk.produk_alias, tbl_m_produk.produk_kand, tbl_m_produk.jml, tbl_m_produk.harga_jual, tbl_m_produk.harga_beli, tbl_m_produk.harga_beli, tbl_m_produk.status_brg_dep')
                                    ->where('status_hps', '0')
                                    ->where("(tbl_m_produk.produk LIKE '%" . $term . "%' OR tbl_m_produk.produk_alias LIKE '%" . $term . "%' OR tbl_m_produk.produk_kand LIKE '%" . $term . "%' OR tbl_m_produk.kode LIKE '%" . $term . "%' OR tbl_m_produk.barcode LIKE '" . $term . "')")
                                    ->order_by('tbl_m_produk.jml', ($_GET['mod'] == 'beli' ? 'asc' : 'desc'))
                                    ->get('tbl_m_produk')->result();
                    break;
                    
                case 'tindakan':
                    $sql = $this->db->select('tbl_m_produk.id, tbl_m_produk.id_satuan, tbl_m_produk.kode, tbl_m_produk.produk, tbl_m_produk.produk_alias, tbl_m_produk.produk_kand, tbl_m_produk.jml, tbl_m_produk.harga_jual, tbl_m_produk.harga_beli, tbl_m_produk.harga_beli, tbl_m_produk.status_brg_dep')
                                    ->where("(tbl_m_produk.produk LIKE '%" . $term . "%' OR tbl_m_produk.produk_alias LIKE '%" . $term . "%' OR tbl_m_produk.produk_kand LIKE '%" . $term . "%' OR tbl_m_produk.kode LIKE '%" . $term . "%' OR tbl_m_produk.barcode LIKE '" . $term . "')")
                                    ->where('tbl_m_produk.status', '2')
                                    ->where('status_hps', '0')
                                    ->or_where('tbl_m_produk.status', '6')
                                    ->order_by('tbl_m_produk.jml', ($_GET['mod'] == 'beli' ? 'asc' : 'desc'))
                                    ->get('tbl_m_produk')->result();
                    break;
                    
                case 'lab':
                    $sql = $this->db->select('tbl_m_produk.id, tbl_m_produk.id_satuan, tbl_m_produk.kode, tbl_m_produk.produk, tbl_m_produk.produk_alias, tbl_m_produk.produk_kand, tbl_m_produk.jml, tbl_m_produk.harga_jual, tbl_m_produk.harga_beli, tbl_m_produk.harga_beli, tbl_m_produk.status_brg_dep')
                                    ->where('tbl_m_produk.status', '3')
                                    ->where('status_hps', '0')
                                    ->where("(tbl_m_produk.produk LIKE '%" . $term . "%' OR tbl_m_produk.produk_alias LIKE '%" . $term . "%' OR tbl_m_produk.produk_kand LIKE '%" . $term . "%' OR tbl_m_produk.kode LIKE '%" . $term . "%' OR tbl_m_produk.barcode LIKE '" . $term . "')")
                                    ->get('tbl_m_produk')->result();
                    break;
                    
                case 'rad':
                    $sql = $this->db->select('tbl_m_produk.id, tbl_m_produk.id_satuan, tbl_m_produk.kode, tbl_m_produk.produk, tbl_m_produk.produk_alias, tbl_m_produk.produk_kand, tbl_m_produk.jml, tbl_m_produk.harga_jual, tbl_m_produk.harga_beli, tbl_m_produk.harga_beli, tbl_m_produk.status_brg_dep')
                                    ->where("(tbl_m_produk.produk LIKE '%" . $term . "%' OR tbl_m_produk.produk_alias LIKE '%" . $term . "%' OR tbl_m_produk.produk_kand LIKE '%" . $term . "%' OR tbl_m_produk.kode LIKE '%" . $term . "%' OR tbl_m_produk.barcode LIKE '" . $term . "')")
                                    ->where('tbl_m_produk.status', '5')
                                    ->where('status_hps', '0')
                                    ->order_by('tbl_m_produk.jml', ($_GET['mod'] == 'beli' ? 'asc' : 'desc'))
                                    ->get('tbl_m_produk')->result();
                    break;
                    
                case 'obat':
                    $sql = $this->db->select('tbl_m_produk.id, tbl_m_produk.id_satuan, tbl_m_produk.kode, tbl_m_produk.produk, tbl_m_produk.produk_alias, tbl_m_produk.produk_kand, tbl_m_produk.jml, tbl_m_produk.harga_jual, tbl_m_produk.harga_beli, tbl_m_produk.harga_beli, tbl_m_produk.status_brg_dep')
                                    ->where("(tbl_m_produk.produk LIKE '%" . $term . "%' OR tbl_m_produk.produk_alias LIKE '%" . $term . "%' OR tbl_m_produk.produk_kand LIKE '%" . $term . "%' OR tbl_m_produk.kode LIKE '%" . $term . "%' OR tbl_m_produk.barcode LIKE '" . $term . "')")
                                    ->where('tbl_m_produk.status', '4')
                                    ->where('status_hps', '0')
                                    ->order_by('tbl_m_produk.jml', ($_GET['mod'] == 'beli' ? 'asc' : 'desc'))
                                    ->get('tbl_m_produk')->result();
                    break;
            }

            if(!empty($sql)){
                foreach ($sql as $sql){
                    $sql_satuan = $this->db->where('id', $sql->id_satuan)->get('tbl_m_satuan')->row();
                    $sql_stok   = $this->db->select('SUM(jml * jml_satuan) AS jml')->where('id_produk', $sql->id)->where('id_gudang', $sg)->get('tbl_m_produk_stok')->row();
                        
                    $produk[] = array(
                            'id'            => general::enkrip($sql->id),
                            'kode'          => $sql->kode,
                            'name'          => $sql->produk,
                            'alias'         => (!empty($sql->produk_alias) ? $sql->produk_alias : ''),
                            'kandungan'     => (!empty($sql->produk_kand) ? '('.strtolower($sql->produk_kand).')' : ''),
                            'jml'           => ($sql_stok->jml < 0 ? 0 : $sql_stok->jml.' '.$sql_satuan->satuanTerkecil),
                            'satuan'        => $sql_satuan->satuanTerkecil,
                            'harga'         => (float)$sql->harga_jual,
                            'harga_beli'    => (float)$sql->harga_beli,
                            'harga_grosir'  => (float)$sql->harga_grosir,
                    );
                }

                echo json_encode($produk);
            }
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }
    
    public function json_icd() {
        if (akses::aksesLogin() == TRUE) {
            $term  = $this->input->get('term');
            $stat  = $this->input->get('status');
//            $sql   = $this->db->select('id,kode,diagnosa,diagnosa_en')->where('status_icd', $stat)->like('kode',$term)->like('diagnosa',$term)->like('diagnosa_en',$term)->limit(10)->get('tbl_m_icd')->result();
            $sql   = $this->db->select('id,kode,icd')
//                                ->where('status_icd', $stat)
                                ->where("(kode LIKE '%".$term."%' OR icd LIKE '%".$term."%')")
                            ->limit(500)->get('tbl_m_icd')->result();
//            $sql   = $this->db->select('id,kode,icd,diagnosa,diagnosa_en')
//                                ->where('status_icd', $stat)
//                                ->where("(kode LIKE '%".$term."%' OR diagnosa LIKE '%".$term."%' OR diagnosa_en LIKE '%".$term."%')")
//                            ->limit(500)->get('tbl_m_icd')->result();


            if(!empty($sql)){
                foreach ($sql as $sql){
                    $produk[] = array(
                        'id'            => $sql->id,
                        'kode'          => $sql->kode,
                        'diagnosa'      => $sql->icd,
                        'diagnosa_en'   => $sql->icd,
//                        'diagnosa_en'   => ($sql->icd != $sql->diagnosa_en ? $sql->icd.' &raquo; ' : '').$sql->diagnosa_en,
                    );
                }
                
//                if(!empty($term)){
//                    echo json_encode($produk);
//                }
        return $this->output
        ->set_content_type('application/json')
        ->set_status_header(200) // Return status
        ->set_output(json_encode($produk));
            }
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }
    
    public function json_po() {
        if (akses::aksesLogin() == TRUE) {
            $term  = $this->input->get('term');
            $sql   = $this->db
                          ->select('tbl_trans_medcheck.id, tbl_trans_medcheck.tgl_masuk, tbl_trans_medcheck.no_nota, tbl_trans_medcheck.no_rm, tbl_trans_medcheck.tipe AS tipe_rawat, tbl_m_pasien.id AS id_pasien, tbl_m_pasien.nik, tbl_m_pasien.nama, tbl_m_pasien.nama_pgl, tbl_m_pasien.no_hp, tbl_m_pasien.tgl_lahir, tbl_m_pasien.jns_klm, tbl_m_pasien.alamat, tbl_m_poli.lokasi AS poli')
                           ->join('tbl_m_pasien', 'tbl_m_pasien.id=tbl_trans_medcheck.id_pasien')
                           ->join('tbl_m_poli', 'tbl_m_poli.id=tbl_trans_medcheck.id_poli')
                           ->like('tbl_m_pasien.nama', $term)
                           ->or_like('tbl_m_pasien.nik', $term)
                           ->or_like('tbl_m_pasien.alamat', $term)
                           ->get('tbl_trans_medcheck')->result();
            
            if(!empty($sql)){
                foreach ($sql as $sql){
                    $produk[] = array(
                        'id'         => $sql->id,
                        'id_pasien'  => $sql->id_pasien,
                        'nik'        => $sql->nik,
                        'nama'       => $sql->nama_pgl,
                        'nama2'      => $sql->nama,
                        'no_hp'      => $sql->no_hp,
                        'tgl_lahir'  => $this->tanggalan->tgl_indo2($sql->tgl_lahir).' ('.$this->tanggalan->usia($sql->tgl_lahir).')',
                        'jns_klm'    => general::jns_klm($sql->jns_klm),
                        'alamat'     => $sql->alamat,
                        'no_trx'     => $sql->no_rm,
                        'no_nota'    => $sql->no_nota,
                        'tgl_masuk'  => $this->tanggalan->tgl_indo5($sql->tgl_masuk),
                        'poli'       => $sql->poli,
                        'tipe_rawat' => general::status_rawat2($sql->tipe_rawat),
                    );
                }
                
                echo json_encode($produk);
                
//                echo '<pre>';
//                print_r(json_encode($produk, JSON_PRETTY_PRINT));
//                echo '</pre>';
            }
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }
    
    public function json_medcheck() {
        if (akses::aksesLogin() == TRUE) {
            $term  = $this->input->get('term');
            $sql   = $this->db
                           ->where('status_pos', '0')
                           ->where('status_bayar', '0')
                           ->like('tbl_trans_medcheck.pasien', $term)
//                           ->or_like('tbl_m_pasien.nik', $term)
                           ->get('tbl_trans_medcheck')->result();
            
            if(!empty($sql)){
                foreach ($sql as $sql){
                    $produk[] = array(
                        'id'         => general::enkrip($sql->id),
                        'id_pasien'  => $sql->id_pasien,
                        'no_rm'      => $sql->no_rm,
                        'nama'       => $sql->pasien,
                        'tipe_rawat' => general::status_rawat2($sql->tipe_rawat),
                    );
                }
                
                echo json_encode($produk);
                
//                echo '<pre>';
//                print_r(json_encode($produk, JSON_PRETTY_PRINT));
//                echo '</pre>';
            }
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }
    
    public function json_medcheck_retur() {
        if (akses::aksesLogin() == TRUE) {
            $term  = $this->input->get('term');
            $sql   = $this->db
                          ->select("tbl_trans_medcheck.id, tbl_trans_medcheck.tgl_masuk, tbl_trans_medcheck.no_nota, tbl_trans_medcheck.no_rm, tbl_trans_medcheck.tipe AS tipe_rawat, tbl_m_pasien.id AS id_pasien, tbl_m_pasien.kode_dpn, tbl_m_pasien.kode, tbl_m_pasien.nik, tbl_m_pasien.nama, tbl_m_pasien.nama_pgl, tbl_m_pasien.no_hp, tbl_m_pasien.tgl_lahir, tbl_m_pasien.jns_klm, tbl_m_pasien.alamat, tbl_m_poli.lokasi AS poli")
                           ->join('tbl_m_pasien', 'tbl_m_pasien.id=tbl_trans_medcheck.id_pasien')
                           ->join('tbl_m_poli', 'tbl_m_poli.id=tbl_trans_medcheck.id_poli')
                           ->where('tbl_trans_medcheck.status_bayar', '1')
                           ->like('tbl_m_pasien.nama', $term)
                           ->or_like('tbl_m_pasien.nik', $term)
                           ->or_like('tbl_m_pasien.alamat', $term)
                           ->or_like('tbl_trans_medcheck.no_rm', $term)
                           ->get('tbl_trans_medcheck')->result();
            
            if(!empty($sql)){
                foreach ($sql as $sql){
                    $produk[] = array(
                        'id'         => general::enkrip($sql->id),
                        'id_pasien'  => $sql->id_pasien,
                        'nik'        => $sql->nik,
                        'kode'       => $sql->kode_dpn.$sql->kode,
                        'nama'       => $sql->nama_pgl,
                        'nama2'      => $sql->nama,
                        'no_hp'      => $sql->no_hp,
                        'tgl_lahir'  => $this->tanggalan->tgl_indo2($sql->tgl_lahir).' ('.$this->tanggalan->usia($sql->tgl_lahir).')',
                        'jns_klm'    => general::jns_klm($sql->jns_klm),
                        'alamat'     => $sql->alamat,
                        'no_trx'     => $sql->no_rm,
                        'no_nota'    => $sql->no_nota,
                        'tgl_masuk'  => $this->tanggalan->tgl_indo5($sql->tgl_masuk),
                        'poli'       => $sql->poli,
                        'tipe_rawat' => general::status_rawat2($sql->tipe_rawat),
                    );
                }
                
                echo json_encode($produk);
                
//                echo '<pre>';
//                print_r(json_encode($produk, JSON_PRETTY_PRINT));
//                echo '</pre>';
            }
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }

    public function json_medcheck_ant() {
        if (akses::aksesLogin() == TRUE) {
            $term  = $this->input->get('term');
            $sql   = $this->db->select('*')->where('status_akt !=', '2')->like('nama',$term)->limit(10)->get('tbl_pendaftaran')->result();
            
            if(!empty($sql)){
                foreach ($sql as $sql){
                    $produk[] = array(
                        'id'         => $sql->id,
                        'nik'        => $sql->nik,
                        'no_urut'    => $sql->no_urut,
                        'nama'       => $sql->nama_pgl,
                        'nama2'      => $sql->nama,
                        'tgl_lahir'  => $sql->tgl_lahir,
                        'jns_klm'    => $sql->jns_klm,
                        'alamat'     => $sql->alamat,
                    );
                }
                
                if(!empty($term)){
                    echo json_encode($produk);
                }
            }
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }
    
    # JSON Label Pendaftaran
    public function json_medcheck_label_dft() {
        if (akses::aksesLogin() == TRUE) {
            $id_dft = $this->input->get('dft');
            
            $sql   = $this->db->select("tbl_pendaftaran.tgl_masuk, tbl_pendaftaran.id_dokter, tbl_pendaftaran.id_pasien, tbl_pendaftaran.nama_pgl, tbl_pendaftaran.tgl_lahir, tbl_pendaftaran.jns_klm, tbl_pendaftaran.alamat, tbl_m_poli.lokasi AS poli")
                              ->where('tbl_pendaftaran.id', general::dekrip($id_dft))
                              ->join('tbl_m_poli', 'tbl_m_poli.id=tbl_pendaftaran.id_poli')
                              ->get('tbl_pendaftaran')->result();

            if(!empty($sql)){
                foreach ($sql as $label){
                    $setting    = $this->db->get('tbl_pengaturan')->row();
                    $sql_doc    = $this->db->where('id_user', $label->id_dokter)->get('tbl_m_karyawan')->row();
                    
                    $cetak[] = array(
                        'tgl'           => $this->tanggalan->tgl_indo($label->tgl_masuk),
                        'trx'           => '',
                        'rm'            => (!empty($label->id_pasien) ? $setting->kode_pasien.''.$label->id_pasien : '-'),
                        'nama'          => $label->nama_pgl,
                        'tgl_lahir'     => $this->tanggalan->tgl_indo($label->tgl_lahir).' ('.$this->tanggalan->usia_lkp($label->tgl_lahir).')',
                        'jns_klm'       => general::jns_klm($label->jns_klm),
                        'alamat'        => $label->alamat,
                        'dokter'        => (!empty($sql_doc->nama_dpn) ? $sql_doc->nama_dpn.' ' : '').$sql_doc->nama.(!empty($sql_doc->nama_blk) ? ', '.$sql_doc->nama_blk : ''),
                        'poli'          => $label->poli,
                        'judul'         => $setting->judul
                    );
                }

                echo json_encode($cetak);
            }
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }
    
    # JSON Label
    public function json_medcheck_label() {
        if (akses::aksesLogin() == TRUE) {
            $id_resep           = $this->input->get('id_resep');
            $id_medcheck        = $this->input->get('id');
            
            $sql   = $this->db->select("tbl_trans_medcheck.id, tbl_trans_medcheck.id_dokter, tbl_trans_medcheck_resep.tgl_simpan, tbl_m_pasien.kode_dpn, tbl_m_pasien.kode, tbl_m_pasien.nama, tbl_m_pasien.tgl_lahir, tbl_m_pasien.jns_klm, tbl_trans_medcheck_resep_det.item, tbl_trans_medcheck_resep_det.jml, tbl_trans_medcheck_resep_det.satuan, tbl_trans_medcheck_resep_det.keterangan as catatan, tbl_trans_medcheck_resep_det.dosis, tbl_trans_medcheck_resep_det.dosis_ket, tbl_trans_medcheck_resep_det.status_mkn, tbl_trans_medcheck_resep_det.status_etiket")
                              ->where('tbl_trans_medcheck_resep_det.id_resep', general::dekrip($id_resep))
                              ->join('tbl_trans_medcheck_resep', 'tbl_trans_medcheck_resep.id=tbl_trans_medcheck_resep_det.id_resep')
                              ->join('tbl_trans_medcheck', 'tbl_trans_medcheck.id=tbl_trans_medcheck_resep_det.id_medcheck')
                              ->join('tbl_m_pasien', 'tbl_m_pasien.id=tbl_trans_medcheck.id_pasien')
                              ->order_by('tbl_trans_medcheck_resep_det.id', 'ASC')
                              ->get('tbl_trans_medcheck_resep_det')->result();

            if(!empty($sql)){
                foreach ($sql as $resep){
                    $setting    = $this->db->get('tbl_pengaturan')->row();
                    $sql_doc    = $this->db->where('id_user', $resep->id_dokter)->get('tbl_m_karyawan')->row();
                    
                    $recipe[] = array(
                        'tgl'           => $this->tanggalan->tgl_indo($resep->tgl_simpan),
                        'rm'            => $resep->kode_dpn.''.$resep->kode,
                        'nama'          => $resep->nama,
                        'tgl_lahir'     => $this->tanggalan->tgl_indo($resep->tgl_lahir).' ('.$this->tanggalan->usia_lkp($resep->tgl_lahir).')',
                        'jns_klm'       => general::jns_klm($resep->jns_klm),
                        'item'          => $resep->item,
                        'jml'           => (float)$resep->jml,
                        'satuan'        => $resep->satuan,
                        'catatan'       => $resep->catatan,
                        'dosis'         => $resep->dosis,
                        'makan'         => general::tipe_obat_makan($resep->status_mkn),
                        'status_etiket' => general::tipe_obat_etiket($resep->status_etiket),
                        'ket'           => $resep->dosis_ket,
                        'dokter'        => (!empty($sql_doc->nama_dpn) ? $sql_doc->nama_dpn.' ' : '').$sql_doc->nama.(!empty($sql_doc->nama_blk) ? ', '.$sql_doc->nama_blk : ''),
                        'judul'         => $setting->judul
                    );
                }

                echo json_encode($recipe);
            }
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }
    
    # JSON Label ID Pasien
    public function json_medcheck_label_id() {
        if (akses::aksesLogin() == TRUE) {
            $id_medcheck        = $this->input->get('id');
            
            $sql   = $this->db->select("tbl_trans_medcheck.tgl_masuk, tbl_trans_medcheck.id_dokter, tbl_trans_medcheck.no_rm AS trx, tbl_m_pasien.kode_dpn, tbl_m_pasien.kode, tbl_m_pasien.nama_pgl, tbl_m_pasien.tgl_lahir, tbl_m_pasien.jns_klm, tbl_m_pasien.alamat, tbl_m_poli.lokasi AS poli")
                              ->where('tbl_trans_medcheck.id', general::dekrip($id_medcheck))
                              ->join('tbl_m_pasien', 'tbl_m_pasien.id=tbl_trans_medcheck.id_pasien')
                              ->join('tbl_m_poli', 'tbl_m_poli.id=tbl_trans_medcheck.id_poli')
                              ->get('tbl_trans_medcheck')->result();

            if(!empty($sql)){
                foreach ($sql as $label){
                    $setting    = $this->db->get('tbl_pengaturan')->row();
                    $sql_doc    = $this->db->where('id_user', $label->id_dokter)->get('tbl_m_karyawan')->row();
                    
                    $cetak[] = array(
                        'tgl'           => $this->tanggalan->tgl_indo($label->tgl_masuk),
                        'trx'           => $label->trx,
                        'rm'            => $label->kode_dpn.''.$label->kode,
                        'nama'          => $label->nama_pgl,
                        'tgl_lahir'     => $this->tanggalan->tgl_indo($label->tgl_lahir).' ('.$this->tanggalan->usia_lkp($label->tgl_lahir).')',
                        'jns_klm'       => general::jns_klm($label->jns_klm),
                        'alamat'        => $label->alamat,
                        'dokter'        => (!empty($sql_doc->nama_dpn) ? $sql_doc->nama_dpn.' ' : '').$sql_doc->nama.(!empty($sql_doc->nama_blk) ? ', '.$sql_doc->nama_blk : ''),
                        'poli'          => $label->poli,
                        'judul'         => $setting->judul
                    );
                }

                echo json_encode($cetak);
            }
        } else {
            $errors = $this->ion_auth->messages();
            $this->session->set_flashdata('login', '<div class="alert alert-danger">Authentifikasi gagal, silahkan login ulang!!</div>');
            redirect();
        }
    }
    
    # Data Dokter
    public function data_dokter() {
        $id_poli = $this->input->get('id_poli');

        $sql_dokter = $this->db->where('id_poli', $id_poli)->get('v_master_dokter')->result();

        foreach ($sql_dokter as $dokter) {
            echo '<option value="' . $dokter->id_user . '">' . (!empty($dokter->nama_dpn) ? $dokter->nama_dpn . ' ' : '') . strtoupper($dokter->nama) . (!empty($dokter->nama_blk) ? ', ' . $dokter->nama_blk : '') . '</option>';
        }
    }
}
